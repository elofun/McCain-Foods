System.register(["./ammo-instantiated-51ae4412.js"],(function(t){"use strict";var e,i,r,n,s,a,o,l,h,u,c,p,d,f,_,g,m,y,v,b,S,T,A,E,C,R,w,x,O,P,D,M,B,I,L,F,k,N,G,U,z,V,H,W,X,Y,j,K,q,Z,J,Q,$,tt,et,it,rt,nt,st,at,ot,lt,ht,ut,ct,pt,dt,ft,_t,gt,mt,yt,vt,bt,St,Tt,At,Et,Ct,Rt,wt,xt,Ot,Pt,Dt,Mt,Bt,It,Lt,Ft,kt,Nt,Gt,Ut,zt,Vt,Ht,Wt,Xt,Yt,jt,Kt,qt,Zt,Jt,Qt,$t,te,ee,ie,re,ne,se,ae,oe,le,he,ue,ce,pe,de,fe,_e,ge,me,ye,ve,be,Se,Te,Ae,Ee,Ce,Re,we,xe,Oe,Pe,De,Me,Be,Ie,Le,Fe,ke,Ne,Ge,Ue,ze,Ve,He,We,Xe,Ye,je,Ke,qe,Ze,Je,Qe,$e,ti,ei,ii,ri,ni,si,ai,oi,li,hi,ui,ci,pi,di,fi,_i,gi,mi,yi,vi,bi,Si,Ti,Ai,Ei,Ci,Ri,wi,xi,Oi,Pi,Di,Mi,Bi,Ii,Li,Fi,ki,Ni,Gi,Ui,zi,Vi,Hi,Wi,Xi,Yi,ji,Ki,qi,Zi,Ji,Qi,$i,tr,er,ir,rr,nr,sr,ar,or,lr,hr,ur,cr,pr,dr,fr,_r,gr,mr,yr,vr,br,Sr,Tr,Ar,Er,Cr,Rr,wr,xr,Or,Pr,Dr,Mr,Br,Ir,Lr,Fr,kr,Nr,Gr,Ur,zr,Vr,Hr,Wr,Xr,Yr,jr,Kr,qr,Zr,Jr,Qr,$r,tn,en,rn,nn,sn,an,on,ln,hn,un,cn,pn,dn,fn,_n,gn,mn,yn,vn,bn,Sn,Tn,An,En,Cn,Rn,wn,xn,On,Pn,Dn,Mn,Bn,In,Ln,Fn,kn,Nn,Gn,Un,zn,Vn,Hn,Wn,Xn,Yn,jn,Kn,qn,Zn,Jn,Qn,$n,ts,es,is,rs,ns,ss,as,os,ls,hs,us,cs,ps,ds,fs,_s;return{setters:[function(gs){e=gs.P,i=gs.R,r=gs.C,n=gs.D,s=gs.B,a=gs.a,o=gs.O,l=gs.S,h=gs.A,u=gs.b,c=gs.F,p=gs.c,d=gs.d,f=gs.T,_=gs.e,g=gs.f,m=gs.M,y=gs.g,v=gs.h,b=gs.i,S=gs.j,T=gs.k,A=gs.l,E=gs.m,C=gs.n,R=gs.o,w=gs.p,x=gs.q,O=gs.r,P=gs.s,D=gs.L,M=gs.t,B=gs.u,I=gs.v,L=gs.w,F=gs.x,k=gs.y,N=gs.z,G=gs.E,U=gs.G,z=gs.H,V=gs.Q,H=gs.I,W=gs.J,X=gs.K,Y=gs.N,j=gs.U,K=gs.V,q=gs.W,Z=gs.X,J=gs.Y,Q=gs.Z,$=gs._,tt=gs.$,et=gs.a0,it=gs.a1,rt=gs.a2,nt=gs.a3,st=gs.a4,at=gs.a5,ot=gs.a6,lt=gs.a7,ht=gs.a8,ut=gs.a9,ct=gs.aa,pt=gs.ab,dt=gs.ac,ft=gs.ad,_t=gs.ae,gt=gs.af,mt=gs.ag,yt=gs.ah,vt=gs.ai,bt=gs.aj,St=gs.ak,Tt=gs.al,At=gs.am,Et=gs.an,Ct=gs.ao,Rt=gs.ap,wt=gs.aq,xt=gs.ar,Ot=gs.as,Pt=gs.at,Dt=gs.au,Mt=gs.av,Bt=gs.aw,It=gs.ax,Lt=gs.ay,Ft=gs.az,kt=gs.aA,Nt=gs.aB,Gt=gs.aC,Ut=gs.aD,zt=gs.aE,Vt=gs.aF,Ht=gs.aG,Wt=gs.aH,Xt=gs.aI,Yt=gs.aJ,jt=gs.aK,Kt=gs.aL,qt=gs.aM,Zt=gs.aN,Jt=gs.aO,Qt=gs.aP,$t=gs.aQ,te=gs.aR,ee=gs.aS,ie=gs.aT,re=gs.aU,ne=gs.aV,se=gs.aW,ae=gs.aX,oe=gs.aY,le=gs.aZ,he=gs.a_,ue=gs.a$,ce=gs.b0,pe=gs.b1,de=gs.b2,fe=gs.b3,_e=gs.b4,ge=gs.b5,me=gs.b6,ye=gs.b7,ve=gs.b8,be=gs.b9,Se=gs.ba,Te=gs.bb,Ae=gs.bc,Ee=gs.bd,Ce=gs.be,Re=gs.bf,we=gs.bg,xe=gs.bh,Oe=gs.bi,Pe=gs.bj,De=gs.bk,Me=gs.bl,Be=gs.bm,Ie=gs.bn,Le=gs.bo,Fe=gs.bp,ke=gs.bq,Ne=gs.br,Ge=gs.bs,Ue=gs.bt,ze=gs.bu,Ve=gs.bv,He=gs.bw,We=gs.bx,Xe=gs.by,Ye=gs.bz,je=gs.bA,Ke=gs.bB,qe=gs.bC,Ze=gs.bD,Je=gs.bE,Qe=gs.bF,$e=gs.bG,ti=gs.bH,ei=gs.bI,ii=gs.bJ,ri=gs.bK,ni=gs.bL,si=gs.bM,ai=gs.bN,oi=gs.bO,li=gs.bP,hi=gs.bQ,ui=gs.bR,ci=gs.bS,pi=gs.bT,di=gs.bU,fi=gs.bV,_i=gs.bW,gi=gs.bX,mi=gs.bY,yi=gs.bZ,vi=gs.b_,bi=gs.b$,Si=gs.c0,Ti=gs.c1,Ai=gs.c2,Ei=gs.c3,Ci=gs.c4,Ri=gs.c5,wi=gs.c6,xi=gs.c7,Oi=gs.c8,Pi=gs.c9,Di=gs.ca,Mi=gs.cb,Bi=gs.cc,Ii=gs.cd,Li=gs.ce,Fi=gs.cf,ki=gs.cg,Ni=gs.ch,Gi=gs.ci,Ui=gs.cj,zi=gs.ck,Vi=gs.cl,Hi=gs.cm,Wi=gs.cn,Xi=gs.co,Yi=gs.cp,ji=gs.cq,Ki=gs.cr,qi=gs.cs,Zi=gs.ct,Ji=gs.cu,Qi=gs.cv,$i=gs.cw,tr=gs.cx,er=gs.cy,ir=gs.cz,rr=gs.cA,nr=gs.cB,sr=gs.cC,ar=gs.cD,or=gs.cE,lr=gs.cF,hr=gs.cG,ur=gs.cH,cr=gs.cI,pr=gs.cJ,dr=gs.cK,fr=gs.cL,_r=gs.cM,gr=gs.cN,mr=gs.cO,yr=gs.cP,vr=gs.cQ,br=gs.cR,Sr=gs.cS,Tr=gs.cT,Ar=gs.cU,Er=gs.cV,Cr=gs.cW,Rr=gs.cX,wr=gs.cY,xr=gs.cZ,Or=gs.c_,Pr=gs.c$,Dr=gs.d0,Mr=gs.d1,Br=gs.d2,Ir=gs.d3,Lr=gs.d4,Fr=gs.d5,kr=gs.d6,Nr=gs.d7,Gr=gs.d8,Ur=gs.d9,zr=gs.da,Vr=gs.db,Hr=gs.dc,Wr=gs.dd,Xr=gs.de,Yr=gs.df,jr=gs.dg,Kr=gs.dh,qr=gs.di,Zr=gs.dj,Jr=gs.dk,Qr=gs.dl,$r=gs.dm,tn=gs.dn,en=gs.dp,rn=gs.dq,nn=gs.dr,sn=gs.ds,an=gs.dt,on=gs.du,ln=gs.dv,hn=gs.dw,un=gs.dx,cn=gs.dy,pn=gs.dz,dn=gs.dA,fn=gs.dB,_n=gs.dC,gn=gs.dD,mn=gs.dE,yn=gs.dF,vn=gs.dG,bn=gs.dH,Sn=gs.dI,Tn=gs.dJ,An=gs.dK,En=gs.dL,Cn=gs.dM,Rn=gs.dN,wn=gs.dO,xn=gs.dP,On=gs.dQ,Pn=gs.dR,Dn=gs.dS,Mn=gs.dT,Bn=gs.dU,In=gs.dV,Ln=gs.dW,Fn=gs.dX,kn=gs.dY,Nn=gs.dZ,Gn=gs.d_,Un=gs.d$,zn=gs.e0,Vn=gs.e1,Hn=gs.e2,Wn=gs.e3,Xn=gs.e4,Yn=gs.e5,jn=gs.e6,Kn=gs.e7,qn=gs.e8,Zn=gs.e9,Jn=gs.ea,Qn=gs.eb,$n=gs.ec,ts=gs.ed,es=gs.ee,is=gs.ef,rs=gs.eg,ns=gs.eh,ss=gs.ei,as=gs.ej,os=gs.ek,ls=gs.el,hs=gs.em,us=gs.en,cs=gs.eo,ps=gs.ep,ds=gs.eq,fs=gs.er,_s=gs.es;var ms={};ms.AffineTransform=gs.eC,ms.AnimCurve=gs.g1,ms.Animation=gs.dj,ms.AnimationClip=gs.g5,ms.AnimationComponent=gs.dj,ms.AnimationManager=gs.g6,ms.AnimationState=gs.di,ms.Asset=gs.bE,ms.AssetLibrary=gs.fM,ms.AssetManager=gs.fI,ms.BaseNode=gs.fO,ms.BitMask=gs.eN,ms.BufferAsset=gs.f2,ms.CCBoolean=gs.eq,ms.CCClass=gs.es,ms.CCFloat=gs.e$,ms.CCInteger=gs.ep,ms.CCLoader=gs.fK,ms.CCObject=gs.cr,ms.CCString=gs.cT,ms.CachedArray=gs.C,ms.Camera=gs.c9,ms.CameraComponent=gs.c9,ms.Color=gs.cd,ms.CompactValueTypeArray=gs.f0,ms.Component=gs.bR,ms.ComponentModifier=gs.fU,ms.CubicSplineNumberValue=gs.bk,ms.CubicSplineQuatValue=gs.bj,ms.CubicSplineVec2Value=gs.bg,ms.CubicSplineVec3Value=gs.bh,ms.CubicSplineVec4Value=gs.bi,ms.CurveValueAdapter=gs.fV,ms.DebugMode=gs.ff,ms.DeferredPipeline=gs.fx,ms.Details=gs.e_,ms.Director=gs.c3,ms.EPSILON=gs.eG,ms.EffectAsset=gs.f7,ms.Enum=gs.c8,ms.Event=gs.ed,ms.EventAcceleration=gs.fl,ms.EventHandler=gs.co,ms.EventInfo=gs.g2,ms.EventKeyboard=gs.fm,ms.EventMouse=gs.fk,ms.EventTarget=gs.bB,ms.EventTouch=gs.ec,ms.Eventify=gs.dE,ms.ForwardFlow=gs.fv,ms.ForwardPipeline=gs.fu,ms.ForwardStage=gs.fw,ms.Game=gs.dR,ms.GbufferFlow=gs.fy,ms.GbufferStage=gs.fz,ms.HierachyModifier=gs.fT,ms.ImageAsset=gs.cy,ms.InstancedBuffer=gs.fF,ms.JavaScript=gs.f9,ms.JsonAsset=gs.f5,ms.Layers=gs.dY,ms.LightingFlow=gs.fA,ms.LightingStage=gs.fB,ms.Mat3=gs.eB,ms.Mat4=gs.bX,ms.Material=gs.cf,ms.MissingScript=gs.fR,ms.Node=gs.df,ms.NodeActivator=gs.fP,ms.NodePool=gs.g8,ms.PipelineStateManager=gs.fG,ms.Pool=gs.P,ms.PostprocessStage=gs.fC,ms.Prefab=gs.f3,ms.PrefabLink=gs.eS,ms.PrivateNode=gs.fQ,ms.Quat=gs.cH,ms.RatioSampler=gs.g0,ms.Rect=gs.bY,ms.RecyclePool=gs.R,ms.RenderFlow=gs.fs,ms.RenderPipeline=gs.fr,ms.RenderStage=gs.ft,ms.RenderTexture=gs.dS,ms.RenderableComponent=gs.cj,ms.RenderingSubMesh=gs.cI,ms.ResolutionPolicy=gs.fg,ms.Scene=gs.ee,ms.SceneAsset=gs.f4,ms.Scheduler=gs.fo,ms.Script=gs.f8,ms.ShadowFlow=gs.fD,ms.ShadowStage=gs.fE,ms.Size=gs.c6,ms.SkelAnimDataHub=gs.d2,ms.System=gs.cs,ms.SystemEvent=gs.fi,ms.SystemEventType=gs.b$,ms.TextAsset=gs.er,ms.Texture2D=gs.cz,ms.TextureCube=gs.f6,ms.Touch=gs.fn,ms.TypeScript=gs.fa,ms.UniformCurveValueAdapter=gs.fW,ms.VERSION=gs.cu,ms.ValueType=gs.eO,ms.Vec2=gs.bW,ms.Vec3=gs.c0,ms.Vec4=gs.cS,ms.View=gs.eh,ms.WorldNode3DToLocalNodeUI=gs.eU,ms.WorldNode3DToWorldNodeUI=gs.eV,ms._decorator=gs.eX,ms.absMax=gs.dH,ms.absMaxComponent=gs.eM,ms.approx=gs.eH,ms.assert=gs.fb,ms.assertID=gs.fc,ms.assetManager=gs.dU,ms.bezier=gs.f_,ms.bezierByTime=gs.f$,ms.bits=gs.ew,ms.builtinResMgr=gs.cg,ms.ccenum=gs.ce,ms.cclegacy=gs.by,ms.clamp=gs.bz,ms.clamp01=gs.bC,ms.color=gs.eF,ms.computeRatioByType=gs.g4,ms.convertUtils=gs.eW,ms.createDefaultPipeline=gs.fq,ms.deserialize=gs.eZ,ms.director=gs.c2,ms.easing=gs.ct,ms.editorExtrasTag=gs.f1,ms.effects=gs.fS,ms.equals=gs.dD,ms.error=gs.bo,ms.errorID=gs.bn,ms.eventManager=gs.fh,ms.find=gs.cL,ms.game=gs.cb,ms.geometry=gs.ev,ms.getError=gs.el,ms.getPathFromRoot=gs.g7,ms.getPhaseID=gs.fH,ms.getWorldTransformUntilRoot=gs.d1,ms.instantiate=gs.dB,ms.inverseLerp=gs.eL,ms.isCustomTargetModifier=gs.fZ,ms.isDisplayStats=gs.fd,ms.isElementModifier=gs.fY,ms.isPropertyModifier=gs.fX,ms.isValid=gs.eY,ms.js=gs.eP,ms.lerp=gs.dm,ms.loader=gs.fL,ms.log=gs.bV,ms.logID=gs.cq,ms.macro=gs.bp,ms.markAsWarning=gs.bT,ms.mat4=gs.cl,ms.math=gs.eu,ms.misc=gs.eQ,ms.murmurhash2_32_gc=gs.cJ,ms.nextPow2=gs.eK,ms.path=gs.eR,ms.pingPong=gs.dy,ms.pipeline=gs.fp,ms.pseudoRandom=gs.ds,ms.pseudoRandomRange=gs.eI,ms.pseudoRandomRangeInt=gs.eJ,ms.quat=gs.eA,ms.random=gs.dt,ms.randomRange=gs.du,ms.randomRangeInt=gs.dv,ms.rect=gs.eE,ms.removeProperty=gs.ck,ms.renderer=gs.et,ms.repeat=gs.dq,ms.replaceProperty=gs.bS,ms.resources=gs.fJ,ms.sampleAnimationCurve=gs.g3,ms.screen=gs.cm,ms.setDefaultLogTimes=gs.eT,ms.setDisplayStats=gs.fe,ms.size=gs.eD,ms.sys=gs.bt,ms.systemEvent=gs.fj,ms.toDegree=gs.dk,ms.toRadian=gs.c$,ms.url=gs.fN,ms.v2=gs.ex,ms.v3=gs.ey,ms.v4=gs.ez,ms.view=gs.cc,ms.warn=gs.bx,ms.warnID=gs.bw,t(ms)}],execute:function(){t({CacheMode:void 0,EAxisDirection:void 0,ECollider2DType:void 0,EJoint2DType:void 0,EPhysics2DDrawFlags:void 0,ERaycast2DType:void 0,ERigidBody2DType:void 0,ERigidBodyType:void 0,HorizontalTextAlignment:void 0,InstanceMaterialType:void 0,Overflow:void 0,Physics2DManifoldType:void 0,VerticalTextAlignment:void 0,earcut:yV,fragmentText:DF,getBaselineOffset:function(){return 0},isUnicodeCJK:wF,isUnicodeSpace:xF,safeMeasureText:OF,tween:cc,tweenUtil:pc}),t("memop",Object.freeze({__proto__:null,Pool:e,RecyclePool:i,CachedArray:r})),t("gfx",Object.freeze({__proto__:null,DescriptorSet:n,Buffer:s,CommandBuffer:a,get ObjectType(){return o},get Status(){return l},get API(){return h},get SurfaceTransform(){return u},get Feature(){return c},get Format(){return p},get FormatType(){return d},get Type(){return f},get BufferUsageBit(){return _},get BufferFlagBit(){return g},get MemoryAccessBit(){return m},get MemoryUsageBit(){return y},get TextureType(){return v},get TextureUsageBit(){return b},get TextureFlagBit(){return S},get SampleCount(){return T},get Filter(){return A},get Address(){return E},get ComparisonFunc(){return C},get StencilOp(){return R},get BlendFactor(){return w},get BlendOp(){return x},get ColorMask(){return O},get ShaderStageFlagBit(){return P},get LoadOp(){return D},get StoreOp(){return M},get AccessType(){return B},get PipelineBindPoint(){return I},get PrimitiveMode(){return L},get PolygonMode(){return F},get ShadeModel(){return k},get CullMode(){return N},get DynamicStateFlagBit(){return G},get StencilFace(){return U},get DescriptorType(){return z},get QueueType(){return V},get CommandBufferType(){return H},get ClearFlagBit(){return W},Size:X,DeviceCaps:Y,Offset:j,Rect:K,Extent:q,TextureSubresLayers:Z,TextureSubresRange:J,TextureCopy:Q,TextureBlit:$,BufferTextureCopy:tt,Viewport:et,Color:it,BindingMappingInfo:rt,BufferInfo:nt,BufferViewInfo:st,DrawInfo:at,DispatchInfo:ot,IndirectBuffer:lt,TextureInfo:ht,TextureViewInfo:ut,SamplerInfo:ct,Uniform:pt,UniformBlock:dt,UniformSamplerTexture:ft,UniformSampler:_t,UniformTexture:gt,UniformStorageImage:mt,UniformStorageBuffer:yt,UniformInputAttachment:vt,ShaderStage:bt,Attribute:St,ShaderInfo:Tt,InputAssemblerInfo:At,ColorAttachment:Et,DepthStencilAttachment:Ct,SubpassInfo:Rt,RenderPassInfo:wt,GlobalBarrierInfo:xt,TextureBarrierInfo:Ot,FramebufferInfo:Pt,DescriptorSetLayoutBinding:Dt,DescriptorSetLayoutInfo:Mt,DescriptorSetInfo:Bt,PipelineLayoutInfo:It,InputState:Lt,CommandBufferInfo:Ft,QueueInfo:kt,FormatInfo:Nt,MemoryStatus:Gt,DynamicStencilStates:Ut,DynamicStates:zt,Obj:Vt,DeviceInfo:Ht,get AttributeName(){return Wt},FormatInfos:Xt,DESCRIPTOR_BUFFER_TYPE:Yt,DESCRIPTOR_SAMPLER_TYPE:jt,DESCRIPTOR_DYNAMIC_TYPE:Kt,DRAW_INFO_SIZE:qt,IsPowerOf2:Zt,FormatSize:Jt,FormatSurfaceSize:Qt,GetTypeSize:$t,getTypedArrayConstructor:te,Device:ee,Framebuffer:ie,InputAssembler:re,DescriptorSetLayout:ne,PipelineLayout:se,RasterizerState:ae,DepthStencilState:oe,BlendTarget:le,BlendState:he,PipelineStateInfo:ue,PipelineState:ce,Queue:pe,RenderPass:de,Sampler:fe,Shader:_e,Texture:ge,GlobalBarrier:me,TextureBarrier:ye})),t("animation",Object.freeze({__proto__:null,UniformProxyFactory:ve,MorphWeightsValueProxy:be,MorphWeightsAllValueProxy:Se,isPropertyPath:Te,isCustomPath:Ae,HierarchyPath:Ee,ComponentPath:Ce,evaluatePath:Re,CubicSplineVec2Value:we,CubicSplineVec3Value:xe,CubicSplineVec4Value:Oe,CubicSplineQuatValue:Pe,CubicSplineNumberValue:De}));var gs,ms=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSet=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,i=e.bindings,r=e.descriptorIndices,n=e.descriptorCount;this._buffers=Array(n).fill(null),this._textures=Array(n).fill(null),this._samplers=Array(n).fill(null);var s=[];this._gpuDescriptorSet={gpuDescriptors:s,descriptorIndices:r};for(var a=0;a<i.length;++a)for(var o=i[a],l=0;l<o.count;l++)s.push({type:o.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null});return!0},i.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},i.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)if(t[e].type&Yt){var i=this._buffers[e];i&&(t[e].gpuBuffer=i.gpuBuffer||i.gpuBufferView)}else t[e].type&jt&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},Be(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(n);function ys(t,e){switch(t){case p.R8:return e.UNSIGNED_BYTE;case p.R8SN:return e.BYTE;case p.R8UI:return e.UNSIGNED_BYTE;case p.R8I:return e.BYTE;case p.R16F:return gs.HALF_FLOAT_OES;case p.R16UI:return e.UNSIGNED_SHORT;case p.R16I:return e.SHORT;case p.R32F:return e.FLOAT;case p.R32UI:return e.UNSIGNED_INT;case p.R32I:return e.INT;case p.RG8:return e.UNSIGNED_BYTE;case p.RG8SN:return e.BYTE;case p.RG8UI:return e.UNSIGNED_BYTE;case p.RG8I:return e.BYTE;case p.RG16F:return gs.HALF_FLOAT_OES;case p.RG16UI:return e.UNSIGNED_SHORT;case p.RG16I:return e.SHORT;case p.RG32F:return e.FLOAT;case p.RG32UI:return e.UNSIGNED_INT;case p.RG32I:return e.INT;case p.RGB8:case p.SRGB8:return e.UNSIGNED_BYTE;case p.RGB8SN:return e.BYTE;case p.RGB8UI:return e.UNSIGNED_BYTE;case p.RGB8I:return e.BYTE;case p.RGB16F:return gs.HALF_FLOAT_OES;case p.RGB16UI:return e.UNSIGNED_SHORT;case p.RGB16I:return e.SHORT;case p.RGB32F:return e.FLOAT;case p.RGB32UI:return e.UNSIGNED_INT;case p.RGB32I:return e.INT;case p.BGRA8:case p.RGBA8:case p.SRGB8_A8:return e.UNSIGNED_BYTE;case p.RGBA8SN:return e.BYTE;case p.RGBA8UI:return e.UNSIGNED_BYTE;case p.RGBA8I:return e.BYTE;case p.RGBA16F:return gs.HALF_FLOAT_OES;case p.RGBA16UI:return e.UNSIGNED_SHORT;case p.RGBA16I:return e.SHORT;case p.RGBA32F:return e.FLOAT;case p.RGBA32UI:return e.UNSIGNED_INT;case p.RGBA32I:return e.INT;case p.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case p.R11G11B10F:return e.FLOAT;case p.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case p.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case p.RGB10A2:return e.UNSIGNED_BYTE;case p.RGB10A2UI:return e.UNSIGNED_INT;case p.RGB9E5:return e.UNSIGNED_BYTE;case p.D16:return e.UNSIGNED_SHORT;case p.D16S8:return gs.UNSIGNED_INT_24_8_WEBGL;case p.D24:return e.UNSIGNED_INT;case p.D24S8:return gs.UNSIGNED_INT_24_8_WEBGL;case p.D32F:return e.UNSIGNED_INT;case p.D32F_S8:return gs.UNSIGNED_INT_24_8_WEBGL;case p.BC1:case p.BC1_SRGB:case p.BC2:case p.BC2_SRGB:case p.BC3:case p.BC3_SRGB:case p.BC4:return e.UNSIGNED_BYTE;case p.BC4_SNORM:return e.BYTE;case p.BC5:return e.UNSIGNED_BYTE;case p.BC5_SNORM:return e.BYTE;case p.BC6H_SF16:case p.BC6H_UF16:return e.FLOAT;case p.BC7:case p.BC7_SRGB:case p.ETC_RGB8:case p.ETC2_RGB8:case p.ETC2_SRGB8:case p.ETC2_RGB8_A1:case p.ETC2_SRGB8_A1:case p.EAC_R11:return e.UNSIGNED_BYTE;case p.EAC_R11SN:return e.BYTE;case p.EAC_RG11:return e.UNSIGNED_BYTE;case p.EAC_RG11SN:return e.BYTE;case p.PVRTC_RGB2:case p.PVRTC_RGBA2:case p.PVRTC_RGB4:case p.PVRTC_RGBA4:case p.PVRTC2_2BPP:case p.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case p.ASTC_RGBA_4x4:case p.ASTC_RGBA_5x4:case p.ASTC_RGBA_5x5:case p.ASTC_RGBA_6x5:case p.ASTC_RGBA_6x6:case p.ASTC_RGBA_8x5:case p.ASTC_RGBA_8x6:case p.ASTC_RGBA_8x8:case p.ASTC_RGBA_10x5:case p.ASTC_RGBA_10x6:case p.ASTC_RGBA_10x8:case p.ASTC_RGBA_10x10:case p.ASTC_RGBA_12x10:case p.ASTC_RGBA_12x12:case p.ASTC_SRGBA_4x4:case p.ASTC_SRGBA_5x4:case p.ASTC_SRGBA_5x5:case p.ASTC_SRGBA_6x5:case p.ASTC_SRGBA_6x6:case p.ASTC_SRGBA_8x5:case p.ASTC_SRGBA_8x6:case p.ASTC_SRGBA_8x8:case p.ASTC_SRGBA_10x5:case p.ASTC_SRGBA_10x6:case p.ASTC_SRGBA_10x8:case p.ASTC_SRGBA_10x10:case p.ASTC_SRGBA_12x10:case p.ASTC_SRGBA_12x12:default:return e.UNSIGNED_BYTE}}function vs(t,e){switch(t){case p.A8:return e.ALPHA;case p.L8:return e.LUMINANCE;case p.LA8:return e.LUMINANCE_ALPHA;case p.RGB8:case p.RGB16F:case p.RGB32F:return e.RGB;case p.BGRA8:case p.RGBA8:case p.RGBA16F:case p.RGBA32F:return e.RGBA;case p.R5G6B5:return e.RGB565;case p.RGB5A1:return e.RGB5_A1;case p.RGBA4:return e.RGBA4;case p.D16:return e.DEPTH_COMPONENT;case p.D16S8:return e.DEPTH_STENCIL;case p.D24:return e.DEPTH_COMPONENT;case p.D24S8:return e.DEPTH_STENCIL;case p.D32F:return e.DEPTH_COMPONENT;case p.D32F_S8:return e.DEPTH_STENCIL;case p.BC1:return gs.COMPRESSED_RGB_S3TC_DXT1_EXT;case p.BC1_ALPHA:return gs.COMPRESSED_RGBA_S3TC_DXT1_EXT;case p.BC1_SRGB:return gs.COMPRESSED_SRGB_S3TC_DXT1_EXT;case p.BC1_SRGB_ALPHA:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case p.BC2:return gs.COMPRESSED_RGBA_S3TC_DXT3_EXT;case p.BC2_SRGB:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case p.BC3:return gs.COMPRESSED_RGBA_S3TC_DXT5_EXT;case p.BC3_SRGB:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case p.ETC_RGB8:return gs.COMPRESSED_RGB_ETC1_WEBGL;case p.ETC2_RGB8:return gs.COMPRESSED_RGB8_ETC2;case p.ETC2_SRGB8:return gs.COMPRESSED_SRGB8_ETC2;case p.ETC2_RGB8_A1:return gs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case p.ETC2_SRGB8_A1:return gs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case p.ETC2_RGBA8:return gs.COMPRESSED_RGBA8_ETC2_EAC;case p.ETC2_SRGB8_A8:return gs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case p.EAC_R11:return gs.COMPRESSED_R11_EAC;case p.EAC_R11SN:return gs.COMPRESSED_SIGNED_R11_EAC;case p.EAC_RG11:return gs.COMPRESSED_RG11_EAC;case p.EAC_RG11SN:return gs.COMPRESSED_SIGNED_RG11_EAC;case p.PVRTC_RGB2:return gs.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case p.PVRTC_RGBA2:return gs.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case p.PVRTC_RGB4:return gs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case p.PVRTC_RGBA4:return gs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case p.ASTC_RGBA_4x4:return gs.COMPRESSED_RGBA_ASTC_4x4_KHR;case p.ASTC_RGBA_5x4:return gs.COMPRESSED_RGBA_ASTC_5x4_KHR;case p.ASTC_RGBA_5x5:return gs.COMPRESSED_RGBA_ASTC_5x5_KHR;case p.ASTC_RGBA_6x5:return gs.COMPRESSED_RGBA_ASTC_6x5_KHR;case p.ASTC_RGBA_6x6:return gs.COMPRESSED_RGBA_ASTC_6x6_KHR;case p.ASTC_RGBA_8x5:return gs.COMPRESSED_RGBA_ASTC_8x5_KHR;case p.ASTC_RGBA_8x6:return gs.COMPRESSED_RGBA_ASTC_8x6_KHR;case p.ASTC_RGBA_8x8:return gs.COMPRESSED_RGBA_ASTC_8x8_KHR;case p.ASTC_RGBA_10x5:return gs.COMPRESSED_RGBA_ASTC_10x5_KHR;case p.ASTC_RGBA_10x6:return gs.COMPRESSED_RGBA_ASTC_10x6_KHR;case p.ASTC_RGBA_10x8:return gs.COMPRESSED_RGBA_ASTC_10x8_KHR;case p.ASTC_RGBA_10x10:return gs.COMPRESSED_RGBA_ASTC_10x10_KHR;case p.ASTC_RGBA_12x10:return gs.COMPRESSED_RGBA_ASTC_12x10_KHR;case p.ASTC_RGBA_12x12:return gs.COMPRESSED_RGBA_ASTC_12x12_KHR;case p.ASTC_SRGBA_4x4:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case p.ASTC_SRGBA_5x4:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case p.ASTC_SRGBA_5x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case p.ASTC_SRGBA_6x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case p.ASTC_SRGBA_6x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case p.ASTC_SRGBA_8x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case p.ASTC_SRGBA_8x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case p.ASTC_SRGBA_8x8:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case p.ASTC_SRGBA_10x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case p.ASTC_SRGBA_10x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case p.ASTC_SRGBA_10x8:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case p.ASTC_SRGBA_10x10:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case p.ASTC_SRGBA_12x10:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case p.ASTC_SRGBA_12x12:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}function bs(t,e){switch(t){case p.A8:return e.ALPHA;case p.L8:return e.LUMINANCE;case p.LA8:return e.LUMINANCE_ALPHA;case p.RGB8:case p.RGB16F:case p.RGB32F:return e.RGB;case p.BGRA8:case p.RGBA8:case p.RGBA16F:case p.RGBA32F:return e.RGBA;case p.R5G6B5:return e.RGB;case p.RGB5A1:case p.RGBA4:return e.RGBA;case p.D16:return e.DEPTH_COMPONENT;case p.D16S8:return e.DEPTH_STENCIL;case p.D24:return e.DEPTH_COMPONENT;case p.D24S8:return e.DEPTH_STENCIL;case p.D32F:return e.DEPTH_COMPONENT;case p.D32F_S8:return e.DEPTH_STENCIL;case p.BC1:return gs.COMPRESSED_RGB_S3TC_DXT1_EXT;case p.BC1_ALPHA:return gs.COMPRESSED_RGBA_S3TC_DXT1_EXT;case p.BC1_SRGB:return gs.COMPRESSED_SRGB_S3TC_DXT1_EXT;case p.BC1_SRGB_ALPHA:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case p.BC2:return gs.COMPRESSED_RGBA_S3TC_DXT3_EXT;case p.BC2_SRGB:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case p.BC3:return gs.COMPRESSED_RGBA_S3TC_DXT5_EXT;case p.BC3_SRGB:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case p.ETC_RGB8:return gs.COMPRESSED_RGB_ETC1_WEBGL;case p.ETC2_RGB8:return gs.COMPRESSED_RGB8_ETC2;case p.ETC2_SRGB8:return gs.COMPRESSED_SRGB8_ETC2;case p.ETC2_RGB8_A1:return gs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case p.ETC2_SRGB8_A1:return gs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case p.ETC2_RGBA8:return gs.COMPRESSED_RGBA8_ETC2_EAC;case p.ETC2_SRGB8_A8:return gs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case p.EAC_R11:return gs.COMPRESSED_R11_EAC;case p.EAC_R11SN:return gs.COMPRESSED_SIGNED_R11_EAC;case p.EAC_RG11:return gs.COMPRESSED_RG11_EAC;case p.EAC_RG11SN:return gs.COMPRESSED_SIGNED_RG11_EAC;case p.PVRTC_RGB2:return gs.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case p.PVRTC_RGBA2:return gs.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case p.PVRTC_RGB4:return gs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case p.PVRTC_RGBA4:return gs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case p.ASTC_RGBA_4x4:return gs.COMPRESSED_RGBA_ASTC_4x4_KHR;case p.ASTC_RGBA_5x4:return gs.COMPRESSED_RGBA_ASTC_5x4_KHR;case p.ASTC_RGBA_5x5:return gs.COMPRESSED_RGBA_ASTC_5x5_KHR;case p.ASTC_RGBA_6x5:return gs.COMPRESSED_RGBA_ASTC_6x5_KHR;case p.ASTC_RGBA_6x6:return gs.COMPRESSED_RGBA_ASTC_6x6_KHR;case p.ASTC_RGBA_8x5:return gs.COMPRESSED_RGBA_ASTC_8x5_KHR;case p.ASTC_RGBA_8x6:return gs.COMPRESSED_RGBA_ASTC_8x6_KHR;case p.ASTC_RGBA_8x8:return gs.COMPRESSED_RGBA_ASTC_8x8_KHR;case p.ASTC_RGBA_10x5:return gs.COMPRESSED_RGBA_ASTC_10x5_KHR;case p.ASTC_RGBA_10x6:return gs.COMPRESSED_RGBA_ASTC_10x6_KHR;case p.ASTC_RGBA_10x8:return gs.COMPRESSED_RGBA_ASTC_10x8_KHR;case p.ASTC_RGBA_10x10:return gs.COMPRESSED_RGBA_ASTC_10x10_KHR;case p.ASTC_RGBA_12x10:return gs.COMPRESSED_RGBA_ASTC_12x10_KHR;case p.ASTC_RGBA_12x12:return gs.COMPRESSED_RGBA_ASTC_12x12_KHR;case p.ASTC_SRGBA_4x4:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case p.ASTC_SRGBA_5x4:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case p.ASTC_SRGBA_5x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case p.ASTC_SRGBA_6x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case p.ASTC_SRGBA_6x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case p.ASTC_SRGBA_8x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case p.ASTC_SRGBA_8x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case p.ASTC_SRGBA_8x8:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case p.ASTC_SRGBA_10x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case p.ASTC_SRGBA_10x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case p.ASTC_SRGBA_10x8:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case p.ASTC_SRGBA_10x10:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case p.ASTC_SRGBA_12x10:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case p.ASTC_SRGBA_12x12:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}function Ss(t,e){switch(t){case f.BOOL:return e.BOOL;case f.BOOL2:return e.BOOL_VEC2;case f.BOOL3:return e.BOOL_VEC3;case f.BOOL4:return e.BOOL_VEC4;case f.INT:return e.INT;case f.INT2:return e.INT_VEC2;case f.INT3:return e.INT_VEC3;case f.INT4:return e.INT_VEC4;case f.UINT:return e.UNSIGNED_INT;case f.FLOAT:return e.FLOAT;case f.FLOAT2:return e.FLOAT_VEC2;case f.FLOAT3:return e.FLOAT_VEC3;case f.FLOAT4:return e.FLOAT_VEC4;case f.MAT2:return e.FLOAT_MAT2;case f.MAT3:return e.FLOAT_MAT3;case f.MAT4:return e.FLOAT_MAT4;case f.SAMPLER2D:return e.SAMPLER_2D;case f.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),f.UNKNOWN}}function Ts(t){switch(t){case f.BOOL:case f.BOOL2:case f.BOOL3:case f.BOOL4:case f.INT:case f.INT2:case f.INT3:case f.INT4:case f.UINT:return Int32Array;case f.FLOAT:case f.FLOAT2:case f.FLOAT3:case f.FLOAT4:case f.MAT2:case f.MAT3:case f.MAT4:return Float32Array;default:return console.error("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function As(t,e){switch(t){case e.BOOL:return f.BOOL;case e.BOOL_VEC2:return f.BOOL2;case e.BOOL_VEC3:return f.BOOL3;case e.BOOL_VEC4:return f.BOOL4;case e.INT:return f.INT;case e.INT_VEC2:return f.INT2;case e.INT_VEC3:return f.INT3;case e.INT_VEC4:return f.INT4;case e.UNSIGNED_INT:return f.UINT;case e.FLOAT:return f.FLOAT;case e.FLOAT_VEC2:return f.FLOAT2;case e.FLOAT_VEC3:return f.FLOAT3;case e.FLOAT_VEC4:return f.FLOAT4;case e.FLOAT_MAT2:return f.MAT2;case e.FLOAT_MAT3:return f.MAT3;case e.FLOAT_MAT4:return f.MAT4;case e.SAMPLER_2D:return f.SAMPLER2D;case e.SAMPLER_CUBE:return f.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),f.UNKNOWN}}function Es(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function Cs(t,e){switch(t){case e.FLOAT_MAT2:return 2;case e.FLOAT_MAT3:return 3;case e.FLOAT_MAT4:return 4;default:return 1}}!function(t){t[t.RGBA16F_EXT=34842]="RGBA16F_EXT",t[t.RGB16F_EXT=34843]="RGB16F_EXT",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(gs||(gs={}));var Rs,ws=[512,513,514,515,516,517,518,519],xs=[0,7680,7681,7682,7683,5386,34055,34056],Os=[32774,32778,32779,32775,32776],Ps=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(Rs||(Rs={}));var Ds=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},Ms=function(t){function e(){var e;return(e=t.call(this,Rs.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new K,e.clearFlag=W.NONE,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return Me(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(Ds),Bs=function(t){function e(){var e;return(e=t.call(this,Rs.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.dynamicStates=new zt,e}return Me(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0},e}(Ds),Is=function(t){function e(){var e;return(e=t.call(this,Rs.DRAW)||this).drawInfo=new at,e}return Me(e,t),e.prototype.clear=function(){},e}(Ds),Ls=function(t){function e(){var e;return(e=t.call(this,Rs.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return Me(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(Ds),Fs=function(t){function e(){var e;return(e=t.call(this,Rs.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return Me(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(Ds),ks=function(){function t(){this.cmds=new r(1),this.beginRenderPassCmds=new r(1),this.bindStatesCmds=new r(1),this.drawCmds=new r(1),this.updateBufferCmds=new r(1),this.copyBufferToTextureCmds=new r(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function Ns(t,e,i,r,n){if(e.usage&_.UNIFORM)ArrayBuffer.isView(i)?e.vf32.set(i,r/Float32Array.BYTES_PER_ELEMENT):e.vf32.set(new Float32Array(i),r/Float32Array.BYTES_PER_ELEMENT);else if(e.usage&_.INDIRECT)e.indirects.length=r,Array.prototype.push.apply(e.indirects,i.drawInfos);else{var s=i,a=t.gl,o=t.stateCache;switch(e.glTarget){case a.ARRAY_BUFFER:t.useVAO&&o.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),o.glVAO=Gs.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(a.bindBuffer(a.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer);break;case a.ELEMENT_ARRAY_BUFFER:t.useVAO&&o.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),o.glVAO=Gs.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer);break;default:return void console.error("Unsupported BufferType, update buffer failed.")}n===s.byteLength?a.bufferSubData(e.glTarget,r,s):a.bufferSubData(e.glTarget,r,s.slice(0,n))}}var Gs={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0};function Us(t,e,i,r,n,s,a){var o=t.gl,l=t.stateCache,h=0;if(i&&e){l.glFramebuffer!==i.glFramebuffer&&(o.bindFramebuffer(o.FRAMEBUFFER,i.glFramebuffer),l.glFramebuffer=i.glFramebuffer),l.viewport.left===r.x&&l.viewport.top===r.y&&l.viewport.width===r.width&&l.viewport.height===r.height||(o.viewport(r.x,r.y,r.width,r.height),l.viewport.left=r.x,l.viewport.top=r.y,l.viewport.width=r.width,l.viewport.height=r.height),l.scissorRect.x===r.x&&l.scissorRect.y===r.y&&l.scissorRect.width===r.width&&l.scissorRect.height===r.height||(o.scissor(r.x,r.y,r.width,r.height),l.scissorRect.x=r.x,l.scissorRect.y=r.y,l.scissorRect.width=r.width,l.scissorRect.height=r.height);var u=n.length;t.WEBGL_draw_buffers||(u=1);for(var c=0;c<u;++c){var d=e.colorAttachments[c];if(d.format!==p.UNKNOWN)switch(d.loadOp){case D.LOAD:break;case D.CLEAR:l.bs.targets[0].blendColorMask!==O.ALL&&o.colorMask(!0,!0,!0,!0);var f=n[0];o.clearColor(f.x,f.y,f.z,f.w),h|=o.COLOR_BUFFER_BIT;break;case D.DISCARD:}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==p.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case D.LOAD:break;case D.CLEAR:l.dss.depthWrite||o.depthMask(!0),o.clearDepth(s),h|=o.DEPTH_BUFFER_BIT;break;case D.DISCARD:}if(Xt[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case D.LOAD:break;case D.CLEAR:l.dss.stencilWriteMaskFront||o.stencilMaskSeparate(o.FRONT,65535),l.dss.stencilWriteMaskBack||o.stencilMaskSeparate(o.BACK,65535),o.clearStencil(a),h|=o.STENCIL_BUFFER_BIT;break;case D.DISCARD:}}if(h&&o.clear(h),h&o.COLOR_BUFFER_BIT){var _=l.bs.targets[0].blendColorMask;if(_!==O.ALL){var g=(_&O.R)!==O.NONE,m=(_&O.G)!==O.NONE,y=(_&O.B)!==O.NONE,v=(_&O.A)!==O.NONE;o.colorMask(g,m,y,v)}}h&o.DEPTH_BUFFER_BIT&&!l.dss.depthWrite&&o.depthMask(!1),h&o.STENCIL_BUFFER_BIT&&(l.dss.stencilWriteMaskFront||o.stencilMaskSeparate(o.FRONT,0),l.dss.stencilWriteMaskBack||o.stencilMaskSeparate(o.BACK,0))}}function zs(t,e,i,r,n,s){var a,o,l,h=t.gl,u=t.stateCache,c=e&&e.gpuShader,p=!1;if(e&&Gs.gpuPipelineState!==e){if(Gs.gpuPipelineState=e,Gs.glPrimitive=e.glPrimitive,e.gpuShader){var d=e.gpuShader.glProgram;u.glProgram!==d&&(h.useProgram(d),u.glProgram=d,p=!0)}var f=e.rs;if(f){if(u.rs.cullMode!==f.cullMode){switch(f.cullMode){case N.NONE:h.disable(h.CULL_FACE);break;case N.FRONT:h.enable(h.CULL_FACE),h.cullFace(h.FRONT);break;case N.BACK:h.enable(h.CULL_FACE),h.cullFace(h.BACK)}u.rs.cullMode=f.cullMode}var _=f.isFrontFaceCCW;u.rs.isFrontFaceCCW!==_&&(h.frontFace(_?h.CCW:h.CW),u.rs.isFrontFaceCCW=_),u.rs.depthBias===f.depthBias&&u.rs.depthBiasSlop===f.depthBiasSlop||(h.polygonOffset(f.depthBias,f.depthBiasSlop),u.rs.depthBias=f.depthBias,u.rs.depthBiasSlop=f.depthBiasSlop),u.rs.lineWidth!==f.lineWidth&&(h.lineWidth(f.lineWidth),u.rs.lineWidth=f.lineWidth)}var g=e.dss;g&&(u.dss.depthTest!==g.depthTest&&(g.depthTest?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),u.dss.depthTest=g.depthTest),u.dss.depthWrite!==g.depthWrite&&(h.depthMask(g.depthWrite),u.dss.depthWrite=g.depthWrite),u.dss.depthFunc!==g.depthFunc&&(h.depthFunc(ws[g.depthFunc]),u.dss.depthFunc=g.depthFunc),u.dss.stencilTestFront===g.stencilTestFront&&u.dss.stencilTestBack===g.stencilTestBack||(g.stencilTestFront||g.stencilTestBack?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),u.dss.stencilTestFront=g.stencilTestFront,u.dss.stencilTestBack=g.stencilTestBack),u.dss.stencilFuncFront===g.stencilFuncFront&&u.dss.stencilRefFront===g.stencilRefFront&&u.dss.stencilReadMaskFront===g.stencilReadMaskFront||(h.stencilFuncSeparate(h.FRONT,ws[g.stencilFuncFront],g.stencilRefFront,g.stencilReadMaskFront),u.dss.stencilFuncFront=g.stencilFuncFront,u.dss.stencilRefFront=g.stencilRefFront,u.dss.stencilReadMaskFront=g.stencilReadMaskFront),u.dss.stencilFailOpFront===g.stencilFailOpFront&&u.dss.stencilZFailOpFront===g.stencilZFailOpFront&&u.dss.stencilPassOpFront===g.stencilPassOpFront||(h.stencilOpSeparate(h.FRONT,xs[g.stencilFailOpFront],xs[g.stencilZFailOpFront],xs[g.stencilPassOpFront]),u.dss.stencilFailOpFront=g.stencilFailOpFront,u.dss.stencilZFailOpFront=g.stencilZFailOpFront,u.dss.stencilPassOpFront=g.stencilPassOpFront),u.dss.stencilWriteMaskFront!==g.stencilWriteMaskFront&&(h.stencilMaskSeparate(h.FRONT,g.stencilWriteMaskFront),u.dss.stencilWriteMaskFront=g.stencilWriteMaskFront),u.dss.stencilFuncBack===g.stencilFuncBack&&u.dss.stencilRefBack===g.stencilRefBack&&u.dss.stencilReadMaskBack===g.stencilReadMaskBack||(h.stencilFuncSeparate(h.BACK,ws[g.stencilFuncBack],g.stencilRefBack,g.stencilReadMaskBack),u.dss.stencilFuncBack=g.stencilFuncBack,u.dss.stencilRefBack=g.stencilRefBack,u.dss.stencilReadMaskBack=g.stencilReadMaskBack),u.dss.stencilFailOpBack===g.stencilFailOpBack&&u.dss.stencilZFailOpBack===g.stencilZFailOpBack&&u.dss.stencilPassOpBack===g.stencilPassOpBack||(h.stencilOpSeparate(h.BACK,xs[g.stencilFailOpBack],xs[g.stencilZFailOpBack],xs[g.stencilPassOpBack]),u.dss.stencilFailOpBack=g.stencilFailOpBack,u.dss.stencilZFailOpBack=g.stencilZFailOpBack,u.dss.stencilPassOpBack=g.stencilPassOpBack),u.dss.stencilWriteMaskBack!==g.stencilWriteMaskBack&&(h.stencilMaskSeparate(h.BACK,g.stencilWriteMaskBack),u.dss.stencilWriteMaskBack=g.stencilWriteMaskBack));var m=e.bs;if(m){u.bs.isA2C!==m.isA2C&&(m.isA2C?h.enable(h.SAMPLE_ALPHA_TO_COVERAGE):h.disable(h.SAMPLE_ALPHA_TO_COVERAGE),u.bs.isA2C=m.isA2C),u.bs.blendColor.x===m.blendColor.x&&u.bs.blendColor.y===m.blendColor.y&&u.bs.blendColor.z===m.blendColor.z&&u.bs.blendColor.w===m.blendColor.w||(h.blendColor(m.blendColor.x,m.blendColor.y,m.blendColor.z,m.blendColor.w),u.bs.blendColor.x=m.blendColor.x,u.bs.blendColor.y=m.blendColor.y,u.bs.blendColor.z=m.blendColor.z,u.bs.blendColor.w=m.blendColor.w);var y=m.targets[0],v=u.bs.targets[0];v.blend!==y.blend&&(y.blend?h.enable(h.BLEND):h.disable(h.BLEND),v.blend=y.blend),v.blendEq===y.blendEq&&v.blendAlphaEq===y.blendAlphaEq||(h.blendEquationSeparate(Os[y.blendEq],Os[y.blendAlphaEq]),v.blendEq=y.blendEq,v.blendAlphaEq=y.blendAlphaEq),v.blendSrc===y.blendSrc&&v.blendDst===y.blendDst&&v.blendSrcAlpha===y.blendSrcAlpha&&v.blendDstAlpha===y.blendDstAlpha||(h.blendFuncSeparate(Ps[y.blendSrc],Ps[y.blendDst],Ps[y.blendSrcAlpha],Ps[y.blendDstAlpha]),v.blendSrc=y.blendSrc,v.blendDst=y.blendDst,v.blendSrcAlpha=y.blendSrcAlpha,v.blendDstAlpha=y.blendDstAlpha),v.blendColorMask!==y.blendColorMask&&(h.colorMask((y.blendColorMask&O.R)!==O.NONE,(y.blendColorMask&O.G)!==O.NONE,(y.blendColorMask&O.B)!==O.NONE,(y.blendColorMask&O.A)!==O.NONE),v.blendColorMask=y.blendColorMask)}}if(e&&e.gpuPipelineLayout&&c){for(var b=c.glBlocks.length,S=e.gpuPipelineLayout.dynamicOffsetIndices,T=0;T<b;T++){var A=c.glBlocks[T],E=r[A.set],C=E&&E.descriptorIndices[A.binding],R=C>=0&&E.gpuDescriptors[C],w=null,x=0;if(R&&R.gpuBuffer){var P=R.gpuBuffer,D=S[A.set],M=D&&D[A.binding];M>=0&&(x=n[M]),"vf32"in P?w=P.vf32:(x+=P.offset,w=P.gpuBuffer.vf32),x>>=2}if(w)for(var B=A.glActiveUniforms.length,I=0;I<B;I++){var L=A.glActiveUniforms[I];switch(L.glType){case h.BOOL:case h.INT:for(var F=0;F<L.array.length;++F){var k=L.begin+x+F;if(w[k]!==L.array[F]){for(var U=F,z=k;U<L.array.length;++U,++z)L.array[U]=w[z];h.uniform1iv(L.glLoc,L.array);break}}break;case h.BOOL_VEC2:case h.INT_VEC2:for(var V=0;V<L.array.length;++V){var H=L.begin+x+V;if(w[H]!==L.array[V]){for(var W=V,X=H;W<L.array.length;++W,++X)L.array[W]=w[X];h.uniform2iv(L.glLoc,L.array);break}}break;case h.BOOL_VEC3:case h.INT_VEC3:for(var Y=0;Y<L.array.length;++Y){var j=L.begin+x+Y;if(w[j]!==L.array[Y]){for(var K=Y,q=j;K<L.array.length;++K,++q)L.array[K]=w[q];h.uniform3iv(L.glLoc,L.array);break}}break;case h.BOOL_VEC4:case h.INT_VEC4:for(var Z=0;Z<L.array.length;++Z){var J=L.begin+x+Z;if(w[J]!==L.array[Z]){for(var Q=Z,$=J;Q<L.array.length;++Q,++$)L.array[Q]=w[$];h.uniform4iv(L.glLoc,L.array);break}}break;case h.FLOAT:for(var tt=0;tt<L.array.length;++tt){var et=L.begin+x+tt;if(w[et]!==L.array[tt]){for(var it=tt,rt=et;it<L.array.length;++it,++rt)L.array[it]=w[rt];h.uniform1fv(L.glLoc,L.array);break}}break;case h.FLOAT_VEC2:for(var nt=0;nt<L.array.length;++nt){var st=L.begin+x+nt;if(w[st]!==L.array[nt]){for(var at=nt,ot=st;at<L.array.length;++at,++ot)L.array[at]=w[ot];h.uniform2fv(L.glLoc,L.array);break}}break;case h.FLOAT_VEC3:for(var lt=0;lt<L.array.length;++lt){var ht=L.begin+x+lt;if(w[ht]!==L.array[lt]){for(var ut=lt,ct=ht;ut<L.array.length;++ut,++ct)L.array[ut]=w[ct];h.uniform3fv(L.glLoc,L.array);break}}break;case h.FLOAT_VEC4:for(var pt=0;pt<L.array.length;++pt){var dt=L.begin+x+pt;if(w[dt]!==L.array[pt]){for(var ft=pt,_t=dt;ft<L.array.length;++ft,++_t)L.array[ft]=w[_t];h.uniform4fv(L.glLoc,L.array);break}}break;case h.FLOAT_MAT2:for(var gt=0;gt<L.array.length;++gt){var mt=L.begin+x+gt;if(w[mt]!==L.array[gt]){for(var yt=gt,vt=mt;yt<L.array.length;++yt,++vt)L.array[yt]=w[vt];h.uniformMatrix2fv(L.glLoc,!1,L.array);break}}break;case h.FLOAT_MAT3:for(var bt=0;bt<L.array.length;++bt){var St=L.begin+x+bt;if(w[St]!==L.array[bt]){for(var Tt=bt,At=St;Tt<L.array.length;++Tt,++At)L.array[Tt]=w[At];h.uniformMatrix3fv(L.glLoc,!1,L.array);break}}break;case h.FLOAT_MAT4:for(var Et=0;Et<L.array.length;++Et){var Ct=L.begin+x+Et;if(w[Ct]!==L.array[Et]){for(var Rt=Et,wt=Ct;Rt<L.array.length;++Rt,++wt)L.array[Rt]=w[wt];h.uniformMatrix4fv(L.glLoc,!1,L.array);break}}}}else Le("Buffer binding '"+A.name+"' at set "+A.set+" binding "+A.binding+" is not bounded")}for(var xt=c.glSamplerTextures.length,Ot=0;Ot<xt;Ot++)for(var Pt=c.glSamplerTextures[Ot],Dt=r[Pt.set],Mt=Dt&&Dt.descriptorIndices[Pt.binding],Bt=Mt>=0&&Dt.gpuDescriptors[Mt],It=Pt.units.length,Lt=0;Lt<It;Lt++){var Ft=Pt.units[Lt];if(Bt&&Bt.gpuSampler){if(Bt.gpuTexture&&Bt.gpuTexture.size>0){var kt=Bt.gpuTexture,Nt=u.glTexUnits[Ft];Nt.glTexture!==kt.glTexture&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),kt.glTexture?h.bindTexture(kt.glTarget,kt.glTexture):h.bindTexture(kt.glTarget,t.nullTex2D.gpuTexture.glTexture),Nt.glTexture=kt.glTexture);var Gt=Bt.gpuSampler;kt.isPowerOf2?(a=Gt.glWrapS,o=Gt.glWrapT):(a=h.CLAMP_TO_EDGE,o=h.CLAMP_TO_EDGE),l=kt.isPowerOf2?kt.mipLevel<=1&&(Gt.glMinFilter===h.LINEAR_MIPMAP_NEAREST||Gt.glMinFilter===h.LINEAR_MIPMAP_LINEAR)?h.LINEAR:Gt.glMinFilter:Gt.glMinFilter===h.LINEAR||Gt.glMinFilter===h.LINEAR_MIPMAP_NEAREST||Gt.glMinFilter===h.LINEAR_MIPMAP_LINEAR?h.LINEAR:h.NEAREST,kt.glWrapS!==a&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),h.texParameteri(kt.glTarget,h.TEXTURE_WRAP_S,a),kt.glWrapS=a),kt.glWrapT!==o&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),h.texParameteri(kt.glTarget,h.TEXTURE_WRAP_T,o),kt.glWrapT=o),kt.glMinFilter!==l&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),h.texParameteri(kt.glTarget,h.TEXTURE_MIN_FILTER,l),kt.glMinFilter=l),kt.glMagFilter!==Gt.glMagFilter&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),h.texParameteri(kt.glTarget,h.TEXTURE_MAG_FILTER,Gt.glMagFilter),kt.glMagFilter=Gt.glMagFilter)}Bt=Dt.gpuDescriptors[++Mt]}else Le("Sampler binding '"+Pt.name+"' at set "+Pt.set+" binding "+Pt.binding+" index "+Lt+" is not bounded")}}if(i&&c&&(p||Gs.gpuInputAssembler!==i)){Gs.gpuInputAssembler=i;var Ut=t.ANGLE_instanced_arrays;if(t.useVAO){var zt=t.OES_vertex_array_object,Vt=i.glVAOs.get(c.glProgram);if(!Vt){var Ht;Vt=zt.createVertexArrayOES(),i.glVAOs.set(c.glProgram,Vt),zt.bindVertexArrayOES(Vt),h.bindBuffer(h.ARRAY_BUFFER,null),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null;for(var Wt=c.glInputs.length,Xt=0;Xt<Wt;Xt++){var Yt=c.glInputs[Xt];Ht=null;for(var jt=i.glAttribs.length,Kt=0;Kt<jt;Kt++){var qt=i.glAttribs[Kt];if(qt.name===Yt.name){Ht=qt;break}}if(Ht){u.glArrayBuffer!==Ht.glBuffer&&(h.bindBuffer(h.ARRAY_BUFFER,Ht.glBuffer),u.glArrayBuffer=Ht.glBuffer);for(var Zt=0;Zt<Ht.componentCount;++Zt){var Jt=Yt.glLoc+Zt,Qt=Ht.offset+Ht.size*Zt;h.enableVertexAttribArray(Jt),u.glCurrentAttribLocs[Jt]=!0,h.vertexAttribPointer(Jt,Ht.count,Ht.glType,Ht.isNormalized,Ht.stride,Qt),Ut&&Ut.vertexAttribDivisorANGLE(Jt,Ht.isInstanced?1:0)}}}var $t=i.gpuIndexBuffer;$t&&h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,$t.glBuffer),zt.bindVertexArrayOES(null),h.bindBuffer(h.ARRAY_BUFFER,null),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null}u.glVAO!==Vt&&(zt.bindVertexArrayOES(Vt),u.glVAO=Vt)}else{for(var te=0;te<t.capabilities.maxVertexAttributes;++te)u.glCurrentAttribLocs[te]=!1;for(var ee=c.glInputs.length,ie=0;ie<ee;ie++){for(var re=c.glInputs[ie],ne=null,se=i.glAttribs.length,ae=0;ae<se;ae++){var oe=i.glAttribs[ae];if(oe.name===re.name){ne=oe;break}}if(ne){u.glArrayBuffer!==ne.glBuffer&&(h.bindBuffer(h.ARRAY_BUFFER,ne.glBuffer),u.glArrayBuffer=ne.glBuffer);for(var le=0;le<ne.componentCount;++le){var he=re.glLoc+le,ue=ne.offset+ne.size*le;!u.glEnabledAttribLocs[he]&&he>=0&&(h.enableVertexAttribArray(he),u.glEnabledAttribLocs[he]=!0),u.glCurrentAttribLocs[he]=!0,h.vertexAttribPointer(he,ne.count,ne.glType,ne.isNormalized,ne.stride,ue),Ut&&Ut.vertexAttribDivisorANGLE(he,ne.isInstanced?1:0)}}}var ce=i.gpuIndexBuffer;ce&&u.glElementArrayBuffer!==ce.glBuffer&&(h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,ce.glBuffer),u.glElementArrayBuffer=ce.glBuffer);for(var pe=0;pe<t.capabilities.maxVertexAttributes;++pe)u.glEnabledAttribLocs[pe]!==u.glCurrentAttribLocs[pe]&&(h.disableVertexAttribArray(pe),u.glEnabledAttribLocs[pe]=!1)}}if(e&&e.dynamicStates.length)for(var de=e.dynamicStates.length,fe=0;fe<de;fe++)switch(e.dynamicStates[fe]){case G.VIEWPORT:var _e=s.viewport;u.viewport.left===_e.left&&u.viewport.top===_e.top&&u.viewport.width===_e.width&&u.viewport.height===_e.height||(h.viewport(_e.left,_e.top,_e.width,_e.height),u.viewport.left=_e.left,u.viewport.top=_e.top,u.viewport.width=_e.width,u.viewport.height=_e.height);break;case G.SCISSOR:var ge=s.scissor;u.scissorRect.x===ge.x&&u.scissorRect.y===ge.y&&u.scissorRect.width===ge.width&&u.scissorRect.height===ge.height||(h.scissor(ge.x,ge.y,ge.width,ge.height),u.scissorRect.x=ge.x,u.scissorRect.y=ge.y,u.scissorRect.width=ge.width,u.scissorRect.height=ge.height);break;case G.LINE_WIDTH:u.rs.lineWidth!==s.lineWidth&&(h.lineWidth(s.lineWidth),u.rs.lineWidth=s.lineWidth);break;case G.DEPTH_BIAS:u.rs.depthBias===s.depthBiasConstant&&u.rs.depthBiasSlop===s.depthBiasSlope||(h.polygonOffset(s.depthBiasConstant,s.depthBiasSlope),u.rs.depthBias=s.depthBiasConstant,u.rs.depthBiasSlop=s.depthBiasSlope);break;case G.BLEND_CONSTANTS:var me=s.blendConstant;u.bs.blendColor.x===me.x&&u.bs.blendColor.y===me.y&&u.bs.blendColor.z===me.z&&u.bs.blendColor.w===me.w||(h.blendColor(me.x,me.y,me.z,me.w),u.bs.blendColor.copy(me));break;case G.STENCIL_WRITE_MASK:var ye=s.stencilStatesFront,ve=s.stencilStatesBack;u.dss.stencilWriteMaskFront!==ye.writeMask&&(h.stencilMaskSeparate(h.FRONT,ye.writeMask),u.dss.stencilWriteMaskFront=ye.writeMask),u.dss.stencilWriteMaskBack!==ve.writeMask&&(h.stencilMaskSeparate(h.BACK,ve.writeMask),u.dss.stencilWriteMaskBack=ve.writeMask);break;case G.STENCIL_COMPARE_MASK:var be=s.stencilStatesFront,Se=s.stencilStatesBack;u.dss.stencilRefFront===be.reference&&u.dss.stencilReadMaskFront===be.compareMask||(h.stencilFuncSeparate(h.FRONT,ws[u.dss.stencilFuncFront],be.reference,be.compareMask),u.dss.stencilRefFront=be.reference,u.dss.stencilReadMaskFront=be.compareMask),u.dss.stencilRefBack===Se.reference&&u.dss.stencilReadMaskBack===Se.compareMask||(h.stencilFuncSeparate(h.BACK,ws[u.dss.stencilFuncBack],Se.reference,Se.compareMask),u.dss.stencilRefBack=Se.reference,u.dss.stencilReadMaskBack=Se.compareMask)}}function Vs(t,e){var i=t.gl,r=t.ANGLE_instanced_arrays,n=Gs.gpuInputAssembler,s=Gs.glPrimitive;if(n)if(n.gpuIndirectBuffer)for(var a=n.gpuIndirectBuffer.indirects.length,o=0;o<a;o++){var l=n.gpuIndirectBuffer.indirects[o],h=n.gpuIndexBuffer;if(l.instanceCount&&r)if(h){if(l.indexCount>0){var u=l.firstIndex*h.stride;r.drawElementsInstancedANGLE(s,l.indexCount,n.glIndexType,u,l.instanceCount)}}else l.vertexCount>0&&r.drawArraysInstancedANGLE(s,l.firstVertex,l.vertexCount,l.instanceCount);else if(h){if(l.indexCount>0){var c=l.firstIndex*h.stride;i.drawElements(s,l.indexCount,n.glIndexType,c)}}else l.vertexCount>0&&i.drawArrays(s,l.firstVertex,l.vertexCount)}else{var p=n.gpuIndexBuffer;if(e.instanceCount&&r)if(p){if(e.indexCount>0){var d=e.firstIndex*p.stride;r.drawElementsInstancedANGLE(s,e.indexCount,n.glIndexType,d,e.instanceCount)}}else e.vertexCount>0&&r.drawArraysInstancedANGLE(s,e.firstVertex,e.vertexCount,e.instanceCount);else if(p){if(e.indexCount>0){var f=e.firstIndex*p.stride;i.drawElements(s,e.indexCount,n.glIndexType,f)}}else e.vertexCount>0&&i.drawArrays(s,e.firstVertex,e.vertexCount)}}var Hs=new Array(Rs.COUNT);function Ws(t,e){Hs.fill(0);for(var i=0;i<e.cmds.length;++i){var r=e.cmds.array[i],n=Hs[r]++;switch(r){case Rs.BEGIN_RENDER_PASS:var s=e.beginRenderPassCmds.array[n];Us(t,s.gpuRenderPass,s.gpuFramebuffer,s.renderArea,s.clearColors,s.clearDepth,s.clearStencil);break;case Rs.BIND_STATES:var a=e.bindStatesCmds.array[n];zs(t,a.gpuPipelineState,a.gpuInputAssembler,a.gpuDescriptorSets,a.dynamicOffsets,a.dynamicStates);break;case Rs.DRAW:Vs(t,e.drawCmds.array[n].drawInfo);break;case Rs.UPDATE_BUFFER:var o=e.updateBufferCmds.array[n];Ns(t,o.gpuBuffer,o.buffer,o.offset,o.size);break;case Rs.COPY_BUFFER_TO_TEXTURE:var l=e.copyBufferToTextureCmds.array[n];Xs(t,l.buffers,l.gpuTexture,l.regions)}}}function Xs(t,e,i,r){var n=t.gl,s=t.stateCache.glTexUnits[t.stateCache.texUnit];s.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),s.glTexture=i.glTexture);var a=0,o=1,l=1,h=0,u=Xt[i.format].isCompressed;switch(i.glTarget){case n.TEXTURE_2D:for(var c=0;c<r.length;c++){var p=r[c];o=p.texExtent.width,l=p.texExtent.height;var d=e[a++];u?i.glInternalFmt===gs.COMPRESSED_RGB_ETC1_WEBGL||t.noCompressedTexSubImage2D?n.compressedTexImage2D(n.TEXTURE_2D,p.texSubres.mipLevel,i.glInternalFmt,o,l,0,d):n.compressedTexSubImage2D(n.TEXTURE_2D,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,o,l,i.glFormat,d):n.texSubImage2D(n.TEXTURE_2D,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,o,l,i.glFormat,i.glType,d)}break;case n.TEXTURE_CUBE_MAP:for(var f=0;f<r.length;f++){var _=r[f],g=_.texSubres.baseArrayLayer+_.texSubres.layerCount;for(h=_.texSubres.baseArrayLayer;h<g;++h){o=_.texExtent.width,l=_.texExtent.height;var m=e[a++];u?i.glInternalFmt===gs.COMPRESSED_RGB_ETC1_WEBGL||t.noCompressedTexSubImage2D?n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,i.glInternalFmt,o,l,0,m):n.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,o,l,i.glFormat,m):n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,o,l,i.glFormat,i.glType,m)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&S.GEN_MIPMAP&&n.generateMipmap(i.glTarget)}var Ys=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuBuffer=null,e._gpuBufferView=null,e._uniformBuffer=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBufferView={gpuBuffer:e.gpuBuffer,offset:t.offset,range:t.range}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&_.INDIRECT&&(this._indirectBuffer=new lt),this._usage&_.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:[],glTarget:0,glBuffer:null},t.usage&_.INDIRECT&&(this._gpuBuffer.indirects=this._indirectBuffer.drawInfos),this._usage&_.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),function(t,e){var i=t.gl,r=t.stateCache,n=e.memUsage&y.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;if(e.usage&_.VERTEX){e.glTarget=i.ARRAY_BUFFER;var s=i.createBuffer();s&&(e.glBuffer=s,e.size>0&&(t.useVAO&&r.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),r.glVAO=Gs.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),i.bufferData(i.ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&_.INDEX){e.glTarget=i.ELEMENT_ARRAY_BUFFER;var a=i.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.useVAO&&r.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),r.glVAO=Gs.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else e.usage&_.UNIFORM?(e.glTarget=i.NONE,e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer))):(e.usage&_.INDIRECT||e.usage&_.TRANSFER_DST||e.usage&_.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize+=this._size;return!0},i.destroy=function(){var t,e;this._gpuBuffer&&(t=this._device,(e=this._gpuBuffer).glBuffer&&(t.gl.deleteBuffer(e.glBuffer),e.glBuffer=null),this._device.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},i.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e,i,r,n,s,a=this._size;a!==t&&(this._size=t,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(t)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=t,t>0&&(e=this._device,i=this._gpuBuffer,r=e.gl,n=e.stateCache,s=i.memUsage&y.HOST?r.DYNAMIC_DRAW:r.STATIC_DRAW,i.usage&_.VERTEX?(e.useVAO&&n.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=Gs.gpuInputAssembler=null),e.stateCache.glArrayBuffer!==i.glBuffer&&r.bindBuffer(r.ARRAY_BUFFER,i.glBuffer),i.buffer?r.bufferData(r.ARRAY_BUFFER,i.buffer,s):r.bufferData(r.ARRAY_BUFFER,i.size,s),r.bindBuffer(r.ARRAY_BUFFER,null),e.stateCache.glArrayBuffer=null):i.usage&_.INDEX?(e.useVAO&&n.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=Gs.gpuInputAssembler=null),e.stateCache.glElementArrayBuffer!==i.glBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glBuffer),i.buffer?r.bufferData(r.ELEMENT_ARRAY_BUFFER,i.buffer,s):r.bufferData(r.ELEMENT_ARRAY_BUFFER,i.size,s),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),e.stateCache.glElementArrayBuffer=null):i.usage&_.UNIFORM?i.buffer&&(i.vf32=new Float32Array(i.buffer.buffer)):(i.usage&_.INDIRECT||i.usage&_.TRANSFER_DST||i.usage&_.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),i.glTarget=r.NONE),this._device.memoryStatus.bufferSize-=a,this._device.memoryStatus.bufferSize+=t)))}},i.update=function(t,e){var i;this._isBufferView?console.warn("cannot update through buffer views!"):(i=void 0!==e?e:this._usage&_.INDIRECT?0:t.byteLength,Ns(this._device,this._gpuBuffer,t,0,i))},Be(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),e}(s),js=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new r(e);for(var i=0;i<e;++i)this._frees[i]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,i=this._frees;this._frees=new Array(e);for(var r=e-i.length,n=0;n<r;++n)this._frees[n]=new t;for(var s=r,a=0;s<e;++s,++a)this._frees[s]=i[a];this._freeIdx+=r}var o=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++o.refCount,o},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),Ks=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new js(Ms,1),this.bindStatesCmdPool=new js(Bs,1),this.drawCmdPool=new js(Is,1),this.updateBufferCmdPool=new js(Ls,1),this.copyBufferToTextureCmdPool=new js(Fs,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),qs=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).cmdPackage=new ks,e._webGLAllocator=null,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUInputAssembler=null,e._curGPUDescriptorSets=[],e._curDynamicOffsets=Array(8).fill(0),e._curDynamicStates=new zt,e._isStateInvalied=!1,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._type=t.type,this._queue=t.queue,this._webGLAllocator=this._device.cmdAllocator;for(var e=this._device.bindingMappingInfo.bufferOffsets.length,i=0;i<e;i++)this._curGPUDescriptorSets.push(null);return!0},i.destroy=function(){this._webGLAllocator&&(this._webGLAllocator.clearCmds(this.cmdPackage),this._webGLAllocator=null)},i.begin=function(){this._webGLAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},i.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},i.beginRenderPass=function(t,e,i,r,n,s){var a=this._webGLAllocator.beginRenderPassCmdPool.alloc(Ms);a.gpuRenderPass=t.gpuRenderPass,a.gpuFramebuffer=e.gpuFramebuffer,a.renderArea=i,a.clearColors.length=r.length;for(var o=0;o<r.length;++o)a.clearColors[o]=r[o];a.clearDepth=n,a.clearStencil=s,this.cmdPackage.beginRenderPassCmds.push(a),this.cmdPackage.cmds.push(Rs.BEGIN_RENDER_PASS),this._isInRenderPass=!0},i.endRenderPass=function(){this._isInRenderPass=!1},i.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},i.bindDescriptorSet=function(t,e,i){var r=e.gpuDescriptorSet;if(r!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=r,this._isStateInvalied=!0),i){var n,s=null===(n=this._curGPUPipelineState)||void 0===n?void 0:n.gpuPipelineLayout;if(s){for(var a=this._curDynamicOffsets,o=s.dynamicOffsetOffsets[t],l=0;l<i.length;l++)a[o+l]=i[l];this._isStateInvalied=!0}}},i.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},i.setViewport=function(t){var e=this._curDynamicStates.viewport;e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height&&e.minDepth===t.minDepth&&e.maxDepth===t.maxDepth||(e.left=t.left,e.top=t.top,e.width=t.width,e.height=t.height,e.minDepth=t.minDepth,e.maxDepth=t.maxDepth,this._isStateInvalied=!0)},i.setScissor=function(t){var e=this._curDynamicStates.scissor;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._isStateInvalied=!0)},i.setLineWidth=function(t){this._curDynamicStates.lineWidth!==t&&(this._curDynamicStates.lineWidth=t,this._isStateInvalied=!0)},i.setDepthBias=function(t,e,i){var r=this._curDynamicStates;r.depthBiasConstant===t&&r.depthBiasClamp===e&&r.depthBiasSlope===i||(r.depthBiasConstant=t,r.depthBiasClamp=e,r.depthBiasSlope=i,this._isStateInvalied=!0)},i.setBlendConstants=function(t){var e=this._curDynamicStates.blendConstant;e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w||(e.copy(t),this._isStateInvalied=!0)},i.setDepthBound=function(t,e){var i=this._curDynamicStates;i.depthMinBounds===t&&i.depthMaxBounds===e||(i.depthMinBounds=t,i.depthMaxBounds=e,this._isStateInvalied=!0)},i.setStencilWriteMask=function(t,e){var i=this._curDynamicStates.stencilStatesFront,r=this._curDynamicStates.stencilStatesBack;t&U.FRONT&&i.writeMask!==e&&(i.writeMask=e,this._isStateInvalied=!0),t&U.BACK&&r.writeMask!==e&&(r.writeMask=e,this._isStateInvalied=!0)},i.setStencilCompareMask=function(t,e,i){var r=this._curDynamicStates.stencilStatesFront,n=this._curDynamicStates.stencilStatesBack;t&U.FRONT&&(r.compareMask===i&&r.reference===e||(r.reference=e,r.compareMask=i,this._isStateInvalied=!0)),t&U.BACK&&(n.compareMask===i&&n.reference===e||(n.reference=e,n.compareMask=i,this._isStateInvalied=!0))},i.draw=function(t){if(this._type===H.PRIMARY&&this._isInRenderPass||this._type===H.SECONDARY){this._isStateInvalied&&this.bindStates();var e=this._webGLAllocator.drawCmdPool.alloc(Is);e.drawInfo.vertexCount=t.vertexCount,e.drawInfo.firstVertex=t.firstVertex,e.drawInfo.indexCount=t.indexCount,e.drawInfo.firstIndex=t.firstIndex,e.drawInfo.vertexOffset=t.vertexOffset,e.drawInfo.instanceCount=t.instanceCount,e.drawInfo.firstInstance=t.firstInstance,this.cmdPackage.drawCmds.push(e),this.cmdPackage.cmds.push(Rs.DRAW),++this._numDrawCalls,this._numInstances+=t.instanceCount;var i=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i){if(this._type===H.PRIMARY&&!this._isInRenderPass||this._type===H.SECONDARY){var r=t.gpuBuffer;if(r){var n,s=this._webGLAllocator.updateBufferCmdPool.alloc(Ls),a=0;t.usage&_.INDIRECT||(a=void 0!==i?i:e.byteLength),n=e,s.gpuBuffer=r,s.buffer=n,s.offset=0,s.size=a,this.cmdPackage.updateBufferCmds.push(s),this.cmdPackage.cmds.push(Rs.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},i.copyBuffersToTexture=function(t,e,i){if(this._type===H.PRIMARY&&!this._isInRenderPass||this._type===H.SECONDARY){var r=e.gpuTexture;if(r){var n=this._webGLAllocator.copyBufferToTextureCmdPool.alloc(Fs);n&&(n.gpuTexture=r,n.regions=i,n.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(n),this.cmdPackage.cmds.push(Rs.COPY_BUFFER_TO_TEXTURE))}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},i.execute=function(t,e){for(var i=0;i<e;++i){for(var r=t[i],n=0;n<r.cmdPackage.beginRenderPassCmds.length;++n){var s=r.cmdPackage.beginRenderPassCmds.array[n];++s.refCount,this.cmdPackage.beginRenderPassCmds.push(s)}for(var a=0;a<r.cmdPackage.bindStatesCmds.length;++a){var o=r.cmdPackage.bindStatesCmds.array[a];++o.refCount,this.cmdPackage.bindStatesCmds.push(o)}for(var l=0;l<r.cmdPackage.drawCmds.length;++l){var h=r.cmdPackage.drawCmds.array[l];++h.refCount,this.cmdPackage.drawCmds.push(h)}for(var u=0;u<r.cmdPackage.updateBufferCmds.length;++u){var c=r.cmdPackage.updateBufferCmds.array[u];++c.refCount,this.cmdPackage.updateBufferCmds.push(c)}for(var p=0;p<r.cmdPackage.copyBufferToTextureCmds.length;++p){var d=r.cmdPackage.copyBufferToTextureCmds.array[p];++d.refCount,this.cmdPackage.copyBufferToTextureCmds.push(d)}this.cmdPackage.cmds.concat(r.cmdPackage.cmds.array),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.pipelineBarrier=function(){},i.bindStates=function(){var t=this._webGLAllocator.bindStatesCmdPool.alloc(Bs);t&&(t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets),t.gpuInputAssembler=this._curGPUInputAssembler,t.dynamicStates.copy(this._curDynamicStates),this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(Rs.BIND_STATES),this._isStateInvalied=!1)},Be(e,[{key:"webGLDevice",get:function(){return this._device}}]),e}(a),Zs=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuFramebuffer=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null,0!==t.depthStencilMipmapLevel&&console.warn("The mipmap level of th texture image to be attached of depth stencil attachment should be 0. Convert to 0.");for(var e=0;e<t.colorMipmapLevels.length;++e)0!==t.colorMipmapLevels[e]&&console.warn("The mipmap level of th texture image to be attached of color attachment "+e+" should be 0. Convert to 0.");for(var i=[],r=0;r<t.colorTextures.length;++r){var n=t.colorTextures[r];n&&i.push(n.gpuTexture)}var s=null;return t.depthStencilTexture&&(s=t.depthStencilTexture.gpuTexture),this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:i,gpuDepthStencilTexture:s,glFramebuffer:null},function(t,e){if(e.gpuColorTextures.length||e.gpuDepthStencilTexture){var i=t.gl,r=[],n=i.createFramebuffer();if(n){e.glFramebuffer=n,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var s=0;s<e.gpuColorTextures.length;++s){var a=e.gpuColorTextures[s];a&&(a.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,a.glTarget,a.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,i.RENDERBUFFER,a.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+s))}var o=e.gpuDepthStencilTexture;if(o){var l=Xt[o.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;o.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,l,o.glTarget,o.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,o.glRenderbuffer)}t.WEBGL_draw_buffers&&t.WEBGL_draw_buffers.drawBuffersWEBGL(r);var h=i.checkFramebufferStatus(i.FRAMEBUFFER);if(h!==i.FRAMEBUFFER_COMPLETE)switch(h){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}}(this._device,this._gpuFramebuffer),!0},i.destroy=function(){var t,e;this._gpuFramebuffer&&(t=this._device,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),e.glFramebuffer=null),this._gpuFramebuffer=null)},Be(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(ie),Js=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuInputAssembler=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){if(0===t.vertexBuffers.length)return console.error("InputAssemblerInfo.vertexBuffers is null."),!1;if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._firstIndex=0;else{var e=this._vertexBuffers[0];this._vertexCount=e.size/e.stride,this._firstVertex=0,this._vertexOffset=0}this._instanceCount=0,this._firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var i=new Array(t.vertexBuffers.length),r=0;r<t.vertexBuffers.length;++r){var n=t.vertexBuffers[r];n.gpuBuffer&&(i[r]=n.gpuBuffer)}var s=null,a=0;if(t.indexBuffer&&(s=t.indexBuffer.gpuBuffer))switch(s.stride){case 1:a=5121;break;case 2:a=5123;break;case 4:a=5125;break;default:console.error("Error index buffer stride.")}var o=null;return t.indirectBuffer&&(o=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:i,gpuIndexBuffer:s,gpuIndirectBuffer:o,glAttribs:[],glIndexType:a,glVAOs:new Map},function(t,e){var i=t.gl;e.glAttribs=new Array(e.attributes.length);for(var r=[0,0,0,0,0,0,0,0],n=0;n<e.attributes.length;++n){var s=e.attributes[n],a=void 0!==s.stream?s.stream:0,o=e.gpuVertexBuffers[a],l=ys(s.format,i),h=Xt[s.format].size;e.glAttribs[n]={name:s.name,glBuffer:o.glBuffer,glType:l,size:h,count:Xt[s.format].count,stride:o.stride,componentCount:Cs(l,i),isNormalized:void 0!==s.isNormalized&&s.isNormalized,isInstanced:void 0!==s.isInstanced&&s.isInstanced,offset:r[a]},r[a]+=h}}(this._device,this._gpuInputAssembler),!0},i.destroy=function(){var t=this._device;this._gpuInputAssembler&&t.useVAO&&function(t,e){for(var i=e.glVAOs.values(),r=i.next();!r.done;)t.OES_vertex_array_object.deleteVertexArrayOES(r.value),r=i.next();e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},Be(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(re),Qs=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSetLayout=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,i=-1,r=[],n=0;n<this._bindings.length;n++){var s=this._bindings[n];r.push(e),e+=s.count,s.binding>i&&(i=s.binding)}this._bindingIndices=Array(i+1).fill(-1);for(var a=this._descriptorIndices=Array(i+1).fill(-1),o=0;o<this._bindings.length;o++){var l=this._bindings[o];this._bindingIndices[l.binding]=o,a[l.binding]=r[o]}for(var h=[],u=0;u<this._bindings.length;u++){var c=this._bindings[u];if(c.descriptorType&Kt)for(var p=0;p<c.count;p++)h.push(c.binding)}return this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:h,descriptorIndices:a,descriptorCount:e},!0},i.destroy=function(){this._bindings.length=0},Be(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(ne),$s=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineLayout=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],i=[],r=0,n=[],s=0;s<this._setLayouts.length;s++){for(var a=this._setLayouts[s],o=a.gpuDescriptorSetLayout.dynamicBindings,l=Array(a.bindingIndices.length).fill(-1),h=0;h<o.length;h++){var u=o[h];l[u]<0&&(l[u]=r+h)}i.push(a.gpuDescriptorSetLayout),e.push(l),n.push(r),r+=o.length}return this._gpuPipelineLayout={gpuSetLayouts:i,dynamicOffsetIndices:e,dynamicOffsetCount:r,dynamicOffsetOffsets:n},!0},i.destroy=function(){this._setLayouts.length=0},Be(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(se),ta=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],ea=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineState=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var i=t.blendState,r=i.targets;r&&r.forEach((function(t,i){e.setTarget(i,t)})),void 0!==i.isA2C&&(e.isA2C=i.isA2C),void 0!==i.isIndepend&&(e.isIndepend=i.isIndepend),void 0!==i.blendColor&&(e.blendColor=i.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var n=[],s=0;s<31;s++)this._dynamicStates&1<<s&&n.push(1<<s);return this._gpuPipelineState={glPrimitive:ta[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:n},!0},i.destroy=function(){this._gpuPipelineState=null},Be(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(ce),ia=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.beginRenderPass=function(t,e,i,r,n,s){Us(this._device,t.gpuRenderPass,e.gpuFramebuffer,i,r,n,s),this._isInRenderPass=!0},i.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates(),Vs(this._device,t),++this._numDrawCalls,this._numInstances+=t.instanceCount;var e=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=e/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(e-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var r,n=t.gpuBuffer;n&&(r=void 0!==i?i:t.usage&_.INDIRECT?0:e.byteLength,Ns(this._device,n,e,0,r))}},i.copyBuffersToTexture=function(t,e,i){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var r=e.gpuTexture;r&&Xs(this._device,t,r,i)}},i.execute=function(t,e){for(var i=0;i<e;++i){var r=t[i];Ws(this._device,r.cmdPackage),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.bindStates=function(){zs(this._device,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},e}(qs),ra=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){return this._type=t.type,!0},i.destroy=function(){},i.submit=function(t){if(!this._isAsync)for(var e=t.length,i=0;i<e;i++){var r=t[i];this.numDrawCalls+=r.numDrawCalls,this.numInstances+=r.numInstances,this.numTris+=r.numTris}},i.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(pe),na=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuRenderPass=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){return this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,t.subpasses&&(this._subpasses=t.subpasses),this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash(),!0},i.destroy=function(){this._gpuRenderPass=null},Be(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(de),sa=[10497,33648,33071,33071],aa=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuSampler=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._minFilter=t.minFilter,this._magFilter=t.magFilter,this._mipFilter=t.mipFilter,this._addressU=t.addressU,this._addressV=t.addressV,this._addressW=t.addressW,this._maxAnisotropy=t.maxAnisotropy,this._cmpFunc=t.cmpFunc,this._borderColor=t.borderColor,this._mipLODBias=t.mipLODBias;var e,i,r=this._minFilter,n=this._magFilter,s=this._mipFilter;e=r===A.LINEAR||r===A.ANISOTROPIC?s===A.LINEAR||s===A.ANISOTROPIC?9987:s===A.POINT?9985:9729:s===A.LINEAR||s===A.ANISOTROPIC?9986:s===A.POINT?9984:9728,i=n===A.LINEAR||n===A.ANISOTROPIC?9729:9728;var a=sa[this._addressU],o=sa[this._addressV],l=sa[this._addressW];return this._gpuSampler={glMinFilter:e,glMagFilter:i,glWrapS:a,glWrapT:o,glWrapR:l},!0},i.destroy=function(){this._gpuSampler=null},Be(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(fe),oa=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuShader=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks,samplerTextures:t.samplerTextures,gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var e=0;e<t.stages.length;++e){var i=t.stages[e];this._gpuShader.gpuStages[e]={type:i.stage,source:i.source,glShader:null}}return function(t,e){for(var i=t.gl,r=function(t){var r=e.gpuStages[t],n=0,s="",a=1;switch(r.type){case P.VERTEX:s="VertexShader",n=i.VERTEX_SHADER;break;case P.FRAGMENT:s="FragmentShader",n=i.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var o=i.createShader(n);if(o&&(r.glShader=o,i.shaderSource(r.glShader,r.source),i.compileShader(r.glShader),!i.getShaderParameter(r.glShader,i.COMPILE_STATUS))){console.error(s+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",r.source.replace(/^|\n/g,(function(){return"\n"+a+++" "}))),console.error(i.getShaderInfoLog(r.glShader));for(var l=0;l<e.gpuStages.length;l++){var h=e.gpuStages[t];h.glShader&&(i.deleteShader(h.glShader),h.glShader=null)}return{v:void 0}}},n=0;n<e.gpuStages.length;n++){var s=r(n);if("object"==typeof s)return s.v}var a=i.createProgram();if(a){e.glProgram=a;for(var o=0;o<e.gpuStages.length;o++){var l=e.gpuStages[o];i.attachShader(e.glProgram,l.glShader)}if(i.linkProgram(e.glProgram),t.destroyShadersImmediately)for(var h=0;h<e.gpuStages.length;h++){var u=e.gpuStages[h];u.glShader&&(i.detachShader(e.glProgram,u.glShader),i.deleteShader(u.glShader),u.glShader=null)}if(!i.getProgramParameter(e.glProgram,i.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(i.getProgramInfoLog(e.glProgram));console.info("Shader '"+e.name+"' compilation succeeded.");var c=i.getProgramParameter(e.glProgram,i.ACTIVE_ATTRIBUTES);e.glInputs=new Array(c);for(var p=0;p<c;++p){var d=i.getActiveAttrib(e.glProgram,p);if(d){var f,_=d.name.indexOf("[");f=-1!==_?d.name.substr(0,_):d.name;var g=i.getAttribLocation(e.glProgram,f),m=As(d.type,i),y=Es(d.type,i);e.glInputs[p]={binding:g,name:f,type:m,stride:y,count:d.size,size:y*d.size,glType:d.type,glLoc:g}}}if(e.blocks.length>0){e.glBlocks=new Array(e.blocks.length);for(var v=0;v<e.blocks.length;++v){var b=e.blocks[v],S={set:b.set,binding:b.binding,name:b.name,size:0,glUniforms:new Array(b.members.length),glActiveUniforms:[]};e.glBlocks[v]=S;for(var T=0;T<b.members.length;++T){var A=b.members[T],E=Ss(A.type,i),C=Ts(A.type),R=Es(E,i),w=R*A.count,x=S.size/4,O=new C(w/4);S.glUniforms[T]={binding:-1,name:A.name,type:A.type,stride:R,count:A.count,size:w,offset:S.size,glType:E,glLoc:-1,array:O,begin:x},S.size+=w}}}if(e.samplerTextures.length>0){e.glSamplerTextures=new Array(e.samplerTextures.length);for(var D=0;D<e.samplerTextures.length;++D){var M=e.samplerTextures[D];e.glSamplerTextures[D]={set:M.set,binding:M.binding,name:M.name,type:M.type,count:M.count,units:[],glUnits:null,glType:Ss(M.type,i),glLoc:null}}}for(var B=i.getProgramParameter(e.glProgram,i.ACTIVE_UNIFORMS),I=0;I<B;++I){var L=i.getActiveUniform(e.glProgram,I);if(L&&L.type!==i.SAMPLER_2D&&L.type!==i.SAMPLER_CUBE){var F=i.getUniformLocation(e.glProgram,L.name);if(null!==F&&("number"==typeof F||-1!==F.id)){var k,N=L.name.indexOf("[");k=-1!==N?L.name.substr(0,N):L.name;for(var G=0;G<e.glBlocks.length;G++)for(var U=e.glBlocks[G],z=0;z<U.glUniforms.length;z++){var V=U.glUniforms[z];if(V.name===k){V.glLoc=F,U.glActiveUniforms.push(V);break}}}}}for(var H=[],W=[],X=t.bindingMappingInfo,Y=t.stateCache.texUnitCacheMap,j=0,K=0;K<e.blocks.length;++K)e.blocks[K].set===X.flexibleSet&&j++;for(var q=0,Z=0;Z<e.samplerTextures.length;++Z){var J=e.samplerTextures[Z],Q=i.getUniformLocation(e.glProgram,J.name);if(null===Q||"number"!=typeof Q&&-1===Q.id||(H.push(e.glSamplerTextures[Z]),W.push(Q)),void 0===Y[J.name]){var $=J.binding+X.samplerOffsets[J.set]+q;J.set===X.flexibleSet&&($-=j),Y[J.name]=$%t.capabilities.maxTextureUnits,q+=J.count-1}}if(H.length){for(var tt=[],et=0;et<H.length;++et){var it=H[et],rt=Y[it.name];if(void 0!==rt){it.glLoc=W[et];for(var nt=0;nt<it.count;++nt){for(;tt[rt];)rt=(rt+1)%t.capabilities.maxTextureUnits;it.units.push(rt),tt[rt]=!0}}}for(var st=0,at=0;at<H.length;++at){var ot=H[at];if(!ot.glLoc){ot.glLoc=W[at];for(var lt=0;lt<ot.count;++lt){for(;tt[st];)st=(st+1)%t.capabilities.maxTextureUnits;void 0===Y[ot.name]&&(Y[ot.name]=st),ot.units.push(st),tt[st]=!0}}}t.stateCache.glProgram!==e.glProgram&&i.useProgram(e.glProgram);for(var ht=0;ht<H.length;ht++){var ut=H[ht];ut.glUnits=new Int32Array(ut.units),i.uniform1iv(ut.glLoc,ut.glUnits)}t.stateCache.glProgram!==e.glProgram&&i.useProgram(t.stateCache.glProgram)}for(var ct=0;ct<e.glBlocks.length;)e.glBlocks[ct].glActiveUniforms.length?ct++:(e.glBlocks[ct]=e.glBlocks[e.glBlocks.length-1],e.glBlocks.length--);e.glSamplerTextures=H}}(this._device,this._gpuShader),!0},i.destroy=function(){this._gpuShader&&(function(t,e){if(e.glProgram){var i=t.gl;if(!t.destroyShadersImmediately)for(var r=0;r<e.gpuStages.length;r++){var n=e.gpuStages[r];n.glShader&&(i.detachShader(e.glProgram,n.glShader),i.deleteShader(n.glShader),n.glShader=null)}i.deleteProgram(e.glProgram),e.glProgram=null}}(this._device,this._gpuShader),this._gpuShader=null)},Be(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(_e),la=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new et,this.scissorRect=new K(0,0,0,0),this.rs=new ae,this.dss=new oe,this.bs=new he,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e){for(var i=0;i<t;++i)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=e,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=e,this.glCurrentAttribLocs.fill(!1)},t}(),ha=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuTexture=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){return"texture"in t?(console.log("WebGL does not support texture view."),!1):(this._type=t.type,this._usage=t.usage,this._format=t.format,this._width=t.width,this._height=t.height,this._depth=t.depth,this._layerCount=t.layerCount,this._levelCount=t.levelCount,this._samples=t.samples,this._flags=t.flags,this._isPowerOf2=Zt(this._width)&&Zt(this._height),this._size=Qt(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0},function(t,e){var i=t.gl;e.glInternalFmt=vs(e.format,i),e.glFormat=bs(e.format,i),e.glType=ys(e.format,i);var r=e.width,n=e.height;switch(e.type){case v.TEX2D:e.glTarget=i.TEXTURE_2D;var s=Math.max(r,n);if(s>t.capabilities.maxTextureSize&&Ie(9100,s,t.capabilities.maxTextureSize),!t.WEBGL_depth_texture&&Xt[e.format].hasDepth){var a=i.createRenderbuffer();a&&e.size>0&&(e.glRenderbuffer=a,t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),e.glInternalFmt===i.DEPTH_COMPONENT&&(e.glInternalFmt=i.DEPTH_COMPONENT16),i.renderbufferStorage(i.RENDERBUFFER,e.glInternalFmt,r,n))}else if(e.samples===T.X1){var o=i.createTexture();if(o&&e.size>0){e.glTexture=o;var l=t.stateCache.glTexUnits[t.stateCache.texUnit];if(l.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),l.glTexture=e.glTexture),Xt[e.format].isCompressed)if(e.glInternalFmt!==gs.COMPRESSED_RGB_ETC1_WEBGL)for(var h=0;h<e.mipLevel;++h){var u=Jt(e.format,r,n,1),c=new Uint8Array(u);i.compressedTexImage2D(i.TEXTURE_2D,h,e.glInternalFmt,r,n,0,c),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else{var p=Jt(e.format,2,2,1),d=new Uint8Array(p);i.compressedTexImage2D(i.TEXTURE_2D,0,e.glInternalFmt,2,2,0,d)}else for(var f=0;f<e.mipLevel;++f)i.texImage2D(i.TEXTURE_2D,f,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1);e.isPowerOf2?(e.glWrapS=i.REPEAT,e.glWrapT=i.REPEAT):(e.glWrapS=i.CLAMP_TO_EDGE,e.glWrapT=i.CLAMP_TO_EDGE),e.glMinFilter=i.LINEAR,e.glMagFilter=i.LINEAR,i.texParameteri(e.glTarget,i.TEXTURE_WRAP_S,e.glWrapS),i.texParameteri(e.glTarget,i.TEXTURE_WRAP_T,e.glWrapT),i.texParameteri(e.glTarget,i.TEXTURE_MIN_FILTER,e.glMinFilter),i.texParameteri(e.glTarget,i.TEXTURE_MAG_FILTER,e.glMagFilter)}else i.deleteTexture(o)}break;case v.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var _=Math.max(r,n);_>t.capabilities.maxCubeMapTextureSize&&Ie(9100,_,t.capabilities.maxTextureSize);var g=i.createTexture();if(g&&e.size>0){e.glTexture=g;var m=t.stateCache.glTexUnits[t.stateCache.texUnit];if(m.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),m.glTexture=e.glTexture),Xt[e.format].isCompressed)if(e.glInternalFmt!==gs.COMPRESSED_RGB_ETC1_WEBGL)for(var y=0;y<6;++y){r=e.width,n=e.height;for(var b=0;b<e.mipLevel;++b){var S=Jt(e.format,r,n,1),A=new Uint8Array(S);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+y,b,e.glInternalFmt,r,n,0,A),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var E=0;E<6;++E){var C=Jt(e.format,2,2,1),R=new Uint8Array(C);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+E,0,e.glInternalFmt,2,2,0,R)}else for(var w=0;w<6;++w){r=e.width,n=e.height;for(var x=0;x<e.mipLevel;++x)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+w,x,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}e.isPowerOf2?(e.glWrapS=i.REPEAT,e.glWrapT=i.REPEAT):(e.glWrapS=i.CLAMP_TO_EDGE,e.glWrapT=i.CLAMP_TO_EDGE),e.glMinFilter=i.LINEAR,e.glMagFilter=i.LINEAR,i.texParameteri(e.glTarget,i.TEXTURE_WRAP_S,e.glWrapS),i.texParameteri(e.glTarget,i.TEXTURE_WRAP_T,e.glWrapT),i.texParameteri(e.glTarget,i.TEXTURE_MIN_FILTER,e.glMinFilter),i.texParameteri(e.glTarget,i.TEXTURE_MAG_FILTER,e.glMagFilter)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=v.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize+=this._size,!0)},i.destroy=function(){var t,e;this._gpuTexture&&(t=this._device,(e=this._gpuTexture).glTexture&&(t.gl.deleteTexture(e.glTexture),e.glTexture=null),e.glRenderbuffer&&(t.gl.deleteRenderbuffer(e.glRenderbuffer),e.glRenderbuffer=null),this._device.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},i.resize=function(t,e){var i=this._size;this._width=t,this._height=e,this._size=Qt(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=e,this._gpuTexture.size=this._size,function(t,e){var i=t.gl;e.glInternalFmt=vs(e.format,i),e.glFormat=bs(e.format,i),e.glType=ys(e.format,i);var r=e.width,n=e.height;switch(e.type){case v.TEX2D:e.glTarget=i.TEXTURE_2D;var s=Math.max(r,n);if(s>t.capabilities.maxTextureSize&&Ie(9100,s,t.capabilities.maxTextureSize),e.glRenderbuffer)t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorage(i.RENDERBUFFER,e.glInternalFmt,r,n);else if(e.glTexture){var a=t.stateCache.glTexUnits[t.stateCache.texUnit];if(a.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),a.glTexture=e.glTexture),Xt[e.format].isCompressed){if(e.glInternalFmt!==gs.COMPRESSED_RGB_ETC1_WEBGL)for(var o=0;o<e.mipLevel;++o){var l=Jt(e.format,r,n,1),h=new Uint8Array(l);i.compressedTexImage2D(i.TEXTURE_2D,o,e.glInternalFmt,r,n,0,h),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var u=0;u<e.mipLevel;++u)i.texImage2D(i.TEXTURE_2D,u,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}break;case v.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var c=Math.max(r,n);c>t.capabilities.maxCubeMapTextureSize&&Ie(9100,c,t.capabilities.maxTextureSize);var p=t.stateCache.glTexUnits[t.stateCache.texUnit];if(p.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),p.glTexture=e.glTexture),Xt[e.format].isCompressed){if(e.glInternalFmt!==gs.COMPRESSED_RGB_ETC1_WEBGL)for(var d=0;d<6;++d){r=e.width,n=e.height;for(var f=0;f<e.mipLevel;++f){var _=Jt(e.format,r,n,1),g=new Uint8Array(_);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+d,f,e.glInternalFmt,r,n,0,g),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}}else for(var m=0;m<6;++m){r=e.width,n=e.height;for(var y=0;y<e.mipLevel;++y)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+m,y,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=v.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize-=i,this._device.memoryStatus.textureSize+=this._size)},Be(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),e}(ge),ua="webglcontextlost",ca=t("WebGLDevice",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).stateCache=new la,e.cmdAllocator=new Ks,e.nullTex2D=null,e.nullTexCube=null,e._webGLRC=null,e._isAntialias=!0,e._isPremultipliedAlpha=!0,e._useVAO=!1,e._destroyShadersImmediately=!0,e._noCompressedTexSubImage2D=!1,e._bindingMappingInfo=new rt,e._webGLContextLostHandler=null,e._extensions=null,e._EXT_texture_filter_anisotropic=null,e._EXT_blend_minmax=null,e._EXT_frag_depth=null,e._EXT_shader_texture_lod=null,e._EXT_sRGB=null,e._OES_vertex_array_object=null,e._EXT_color_buffer_half_float=null,e._WEBGL_color_buffer_float=null,e._WEBGL_compressed_texture_etc1=null,e._WEBGL_compressed_texture_etc=null,e._WEBGL_compressed_texture_pvrtc=null,e._WEBGL_compressed_texture_astc=null,e._WEBGL_compressed_texture_s3tc=null,e._WEBGL_compressed_texture_s3tc_srgb=null,e._WEBGL_debug_shaders=null,e._WEBGL_draw_buffers=null,e._WEBGL_lose_context=null,e._WEBGL_depth_texture=null,e._WEBGL_debug_renderer_info=null,e._OES_texture_half_float=null,e._OES_texture_half_float_linear=null,e._OES_texture_float=null,e._OES_texture_float_linear=null,e._OES_standard_derivatives=null,e._OES_element_index_uint=null,e._ANGLE_instanced_arrays=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._canvas=t.canvasElm,this._isAntialias=t.isAntialias,this._isPremultipliedAlpha=t.isPremultipliedAlpha,this._bindingMappingInfo=t.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);try{var e={alpha:Fe.ENABLE_TRANSPARENT_CANVAS,antialias:this._isAntialias,depth:!0,stencil:!0,premultipliedAlpha:this._isPremultipliedAlpha,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};this._webGLRC=this._canvas.getContext("webgl",e)}catch(t){return console.error(t),!1}if(!this._webGLRC)return console.error("This device does not support WebGL."),!1;this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(ua,this._onWebGLContextLost),this._canvas2D=document.createElement("canvas"),console.info("WebGL device initialized."),this._gfxAPI=h.WEBGL,this._deviceName="WebGL";var i=this._webGLRC;this._WEBGL_debug_renderer_info=this.getExtension("WEBGL_debug_renderer_info"),this._WEBGL_debug_renderer_info?(this._renderer=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=i.getParameter(i.RENDERER),this._vendor=i.getParameter(i.VENDOR)),this._version=i.getParameter(i.VERSION),this._caps.maxVertexAttributes=i.getParameter(i.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.depthBits=i.getParameter(i.DEPTH_BITS),this._caps.stencilBits=i.getParameter(i.STENCIL_BITS),this.stateCache.initialize(this._caps.maxTextureUnits,this._caps.maxVertexAttributes),this._devicePixelRatio=t.devicePixelRatio||1,this._width=this._canvas.width,this._height=this._canvas.height,this._nativeWidth=Math.max(t.nativeWidth||this._width,0),this._nativeHeight=Math.max(t.nativeHeight||this._height,0),this._colorFmt=p.RGBA8,24===this._caps.depthBits?8===this._caps.stencilBits?this._depthStencilFmt=p.D24S8:this._depthStencilFmt=p.D24:8===this._caps.stencilBits?this._depthStencilFmt=p.D16S8:this._depthStencilFmt=p.D16,this._extensions=i.getSupportedExtensions();var r="";if(this._extensions){for(var n,s=ke(this._extensions);!(n=s()).done;)r+=n.value+" ";console.debug("EXTENSIONS: "+r)}this._EXT_texture_filter_anisotropic=this.getExtension("EXT_texture_filter_anisotropic"),this._EXT_blend_minmax=this.getExtension("EXT_blend_minmax"),this._EXT_frag_depth=this.getExtension("EXT_frag_depth"),this._EXT_shader_texture_lod=this.getExtension("EXT_shader_texture_lod"),this._EXT_sRGB=this.getExtension("EXT_sRGB"),this._OES_vertex_array_object=this.getExtension("OES_vertex_array_object"),this._EXT_color_buffer_half_float=this.getExtension("EXT_color_buffer_half_float"),this._WEBGL_color_buffer_float=this.getExtension("WEBGL_color_buffer_float"),this._WEBGL_compressed_texture_etc1=this.getExtension("WEBGL_compressed_texture_etc1"),this._WEBGL_compressed_texture_etc=this.getExtension("WEBGL_compressed_texture_etc"),this._WEBGL_compressed_texture_pvrtc=this.getExtension("WEBGL_compressed_texture_pvrtc"),this._WEBGL_compressed_texture_s3tc=this.getExtension("WEBGL_compressed_texture_s3tc"),this._WEBGL_compressed_texture_s3tc_srgb=this.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this._WEBGL_debug_shaders=this.getExtension("WEBGL_debug_shaders"),this._WEBGL_draw_buffers=this.getExtension("WEBGL_draw_buffers"),this._WEBGL_lose_context=this.getExtension("WEBGL_lose_context"),this._WEBGL_depth_texture=this.getExtension("WEBGL_depth_texture"),this._OES_texture_half_float=this.getExtension("OES_texture_half_float"),this._OES_texture_half_float_linear=this.getExtension("OES_texture_half_float_linear"),this._OES_texture_float=this.getExtension("OES_texture_float"),this._OES_texture_float_linear=this.getExtension("OES_texture_float_linear"),this._OES_standard_derivatives=this.getExtension("OES_standard_derivatives"),this._OES_element_index_uint=this.getExtension("OES_element_index_uint"),this._ANGLE_instanced_arrays=this.getExtension("ANGLE_instanced_arrays"),Ne.os===Ge.IOS&&14===Ue.osMainVersion&&Ue.isBrowser||(this._WEBGL_compressed_texture_astc=this.getExtension("WEBGL_compressed_texture_astc")),Ne.browserType===ze.UC&&(this._ANGLE_instanced_arrays=null),(Ne.os===Ge.IOS&&Ue.osMainVersion<=10||Ve)&&(this._destroyShadersImmediately=!1),this._features.fill(!1),this._EXT_blend_minmax&&(this._features[c.BLEND_MINMAX]=!0),this._WEBGL_color_buffer_float&&(this._features[c.COLOR_FLOAT]=!0),this._EXT_color_buffer_half_float&&(this._features[c.COLOR_HALF_FLOAT]=!0),this._OES_texture_float&&(this._features[c.TEXTURE_FLOAT]=!0),this._OES_texture_half_float&&(this._features[c.TEXTURE_HALF_FLOAT]=!0),this._OES_texture_float_linear&&(this._features[c.TEXTURE_FLOAT_LINEAR]=!0),this._OES_texture_half_float_linear&&(this._features[c.TEXTURE_HALF_FLOAT_LINEAR]=!0),this._features[c.FORMAT_RGB8]=!0,this._WEBGL_depth_texture&&(this._features[c.FORMAT_D16]=!0,this._features[c.FORMAT_D24]=!0,this._features[c.FORMAT_D24S8]=!0),this._OES_element_index_uint&&(this._features[c.ELEMENT_INDEX_UINT]=!0),this._ANGLE_instanced_arrays&&(this._features[c.INSTANCED_ARRAYS]=!0),this._WEBGL_draw_buffers&&(this._features[c.MULTIPLE_RENDER_TARGETS]=!0);var a="";this._WEBGL_compressed_texture_etc1&&(this._features[c.FORMAT_ETC1]=!0,a+="etc1 "),this._WEBGL_compressed_texture_etc&&(this._features[c.FORMAT_ETC2]=!0,a+="etc2 "),this._WEBGL_compressed_texture_s3tc&&(this._features[c.FORMAT_DXT]=!0,a+="dxt "),this._WEBGL_compressed_texture_pvrtc&&(this._features[c.FORMAT_PVRTC]=!0,a+="pvrtc "),this._WEBGL_compressed_texture_astc&&(this._features[c.FORMAT_ASTC]=!0,a+="astc "),this._OES_vertex_array_object&&(this._useVAO=!0),console.info("RENDERER: "+this._renderer),console.info("VENDOR: "+this._vendor),console.info("VERSION: "+this._version),console.info("DPR: "+this._devicePixelRatio),console.info("SCREEN_SIZE: "+this._width+" x "+this._height),console.info("NATIVE_SIZE: "+this._nativeWidth+" x "+this._nativeHeight),console.info("MAX_VERTEX_UNIFORM_VECTORS: "+this._caps.maxVertexUniformVectors),console.info("DEPTH_BITS: "+this._caps.depthBits),console.info("STENCIL_BITS: "+this._caps.stencilBits),this._EXT_texture_filter_anisotropic&&console.info("MAX_TEXTURE_MAX_ANISOTROPY_EXT: "+this._EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),console.info("USE_VAO: "+this._useVAO),console.info("COMPRESSED_FORMAT: "+a),this.initStates(i),this._queue=this.createQueue(new kt(V.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Ft(this._queue)),this.nullTex2D=this.createTexture(new ht(v.TEX2D,b.SAMPLED,p.RGBA8,2,2,S.GEN_MIPMAP)),this.nullTexCube=this.createTexture(new ht(v.CUBE,b.SAMPLED,p.RGBA8,2,2,S.GEN_MIPMAP,6));var o=new tt;o.texExtent.width=2,o.texExtent.height=2;var l=new Uint8Array(this.nullTex2D.size);return l.fill(0),this.copyBuffersToTexture([l],this.nullTex2D,[o]),o.texSubres.layerCount=6,this.copyBuffersToTexture([l,l,l,l,l,l],this.nullTexCube,[o]),!0},i.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener(ua,this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._extensions=null,this._webGLRC=null},i.resize=function(t,e){this._width===t&&this._height===e||(console.info("Resizing device: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._width=t,this._height=e)},i.flushCommands=function(){},i.acquire=function(){this.cmdAllocator.releaseCmds()},i.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},i.createCommandBuffer=function(t){var e=new(t.type===H.PRIMARY?ia:qs)(this);return e.initialize(t),e},i.createBuffer=function(t){var e=new Ys(this);return e.initialize(t)?e:null},i.createTexture=function(t){var e=new ha(this);return e.initialize(t)?e:null},i.createSampler=function(t){var e=new aa(this);return e.initialize(t)?e:null},i.createDescriptorSet=function(t){var e=new ms(this);return e.initialize(t)?e:null},i.createShader=function(t){var e=new oa(this);return e.initialize(t)?e:null},i.createInputAssembler=function(t){var e=new Js(this);return e.initialize(t)?e:null},i.createRenderPass=function(t){var e=new na(this);return e.initialize(t)?e:null},i.createFramebuffer=function(t){var e=new Zs(this);return e.initialize(t)?e:null},i.createDescriptorSetLayout=function(t){var e=new Qs(this);return e.initialize(t)?e:null},i.createPipelineLayout=function(t){var e=new $s(this);return e.initialize(t)?e:null},i.createPipelineState=function(t){var e=new ea(this);return e.initialize(t)?e:null},i.createQueue=function(t){var e=new ra(this);return e.initialize(t)?e:null},i.createGlobalBarrier=function(t){var e=new me(this);return e.initialize(t)?e:null},i.createTextureBarrier=function(t){var e=new ye(this);return e.initialize(t)?e:null},i.copyBuffersToTexture=function(t,e,i){Xs(this,t,e.gpuTexture,i)},i.copyTexImagesToTexture=function(t,e,i){!function(t,e,i,r){var n=t.gl,s=t.stateCache.glTexUnits[t.stateCache.texUnit];s.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),s.glTexture=i.glTexture);var a=0,o=0;switch(i.glTarget){case n.TEXTURE_2D:for(var l=0;l<r.length;l++){var h=r[l];n.texSubImage2D(n.TEXTURE_2D,h.texSubres.mipLevel,h.texOffset.x,h.texOffset.y,i.glFormat,i.glType,e[a++])}break;case n.TEXTURE_CUBE_MAP:for(var u=0;u<r.length;u++){var c=r[u],p=c.texSubres.baseArrayLayer+c.texSubres.layerCount;for(o=c.texSubres.baseArrayLayer;o<p;++o)n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+o,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,i.glFormat,i.glType,e[a++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&S.GEN_MIPMAP&&i.isPowerOf2&&n.generateMipmap(i.glTarget)}(this,t,e.gpuTexture,i)},i.copyFramebufferToBuffer=function(t,e,i){var r=this._webGLRC,n=t.gpuFramebuffer,s=n.gpuColorTextures[0].format,a=bs(s,r),o=ys(s,r),l=te(Xt[s]),h=this.stateCache.glFramebuffer;this.stateCache.glFramebuffer!==n.glFramebuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,n.glFramebuffer),this.stateCache.glFramebuffer=n.glFramebuffer);for(var u,c=new l(e),p=ke(i);!(u=p()).done;){var d=u.value,f=d.texExtent.width,_=d.texExtent.height;r.readPixels(d.texOffset.x,d.texOffset.y,f,_,a,o,c)}this.stateCache.glFramebuffer!==h&&(r.bindFramebuffer(r.FRAMEBUFFER,h),this.stateCache.glFramebuffer=h)},i.blitFramebuffer=function(){},i.getExtension=function(t){for(var e=["","WEBKIT_","MOZ_"],i=0;i<e.length;++i){var r=this.gl.getExtension(e[i]+t);if(r)return r}return null},i.initStates=function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.disable(t.POLYGON_OFFSET_FILL),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.depthRange(0,1),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)},i._onWebGLContextLost=function(t){He(11e3),We(t)},Be(e,[{key:"gl",get:function(){return this._webGLRC}},{key:"webGLQueue",get:function(){return this._queue}},{key:"isAntialias",get:function(){return this._isAntialias}},{key:"isPremultipliedAlpha",get:function(){return this._isPremultipliedAlpha}},{key:"useVAO",get:function(){return this._useVAO}},{key:"destroyShadersImmediately",get:function(){return this._destroyShadersImmediately}},{key:"noCompressedTexSubImage2D",get:function(){return this._noCompressedTexSubImage2D}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}},{key:"EXT_texture_filter_anisotropic",get:function(){return this._EXT_texture_filter_anisotropic}},{key:"EXT_blend_minmax",get:function(){return this._EXT_blend_minmax}},{key:"EXT_frag_depth",get:function(){return this._EXT_frag_depth}},{key:"EXT_shader_texture_lod",get:function(){return this._EXT_shader_texture_lod}},{key:"EXT_sRGB",get:function(){return this._EXT_sRGB}},{key:"OES_vertex_array_object",get:function(){return this._OES_vertex_array_object}},{key:"WEBGL_color_buffer_float",get:function(){return this._WEBGL_color_buffer_float}},{key:"WEBGL_compressed_texture_etc1",get:function(){return this._WEBGL_compressed_texture_etc1}},{key:"WEBGL_compressed_texture_pvrtc",get:function(){return this._WEBGL_compressed_texture_pvrtc}},{key:"WEBGL_compressed_texture_astc",get:function(){return this._WEBGL_compressed_texture_astc}},{key:"WEBGL_compressed_texture_s3tc",get:function(){return this._WEBGL_compressed_texture_s3tc}},{key:"WEBGL_compressed_texture_s3tc_srgb",get:function(){return this._WEBGL_compressed_texture_s3tc_srgb}},{key:"WEBGL_debug_shaders",get:function(){return this._WEBGL_debug_shaders}},{key:"WEBGL_draw_buffers",get:function(){return this._WEBGL_draw_buffers}},{key:"WEBGL_lose_context",get:function(){return this._WEBGL_lose_context}},{key:"WEBGL_depth_texture",get:function(){return this._WEBGL_depth_texture}},{key:"WEBGL_debug_renderer_info",get:function(){return this._WEBGL_debug_renderer_info}},{key:"OES_texture_half_float",get:function(){return this._OES_texture_half_float}},{key:"OES_texture_half_float_linear",get:function(){return this._OES_texture_half_float_linear}},{key:"OES_texture_float",get:function(){return this._OES_texture_float}},{key:"OES_standard_derivatives",get:function(){return this._OES_standard_derivatives}},{key:"OES_element_index_uint",get:function(){return this._OES_element_index_uint}},{key:"ANGLE_instanced_arrays",get:function(){return this._ANGLE_instanced_arrays}}]),e}(ee));Xe.WebGLDevice=ca;var pa=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSet=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,i=e.bindings,r=e.descriptorIndices,n=e.descriptorCount;this._buffers=Array(n).fill(null),this._textures=Array(n).fill(null),this._samplers=Array(n).fill(null);var s=[];this._gpuDescriptorSet={gpuDescriptors:s,descriptorIndices:r};for(var a=0;a<i.length;++a)for(var o=i[a],l=0;l<o.count;l++)s.push({type:o.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null});return!0},i.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},i.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)t[e].type&Yt?this._buffers[e]&&(t[e].gpuBuffer=this._buffers[e].gpuBuffer):t[e].type&jt&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},Be(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(n),da=[10497,33648,33071,33071],fa=[1,2,4,8,16,32,64],_a=new Float32Array(4);function ga(t,e){switch(t){case p.R8:return e.UNSIGNED_BYTE;case p.R8SN:return e.BYTE;case p.R8UI:return e.UNSIGNED_BYTE;case p.R8I:return e.BYTE;case p.R16F:return e.HALF_FLOAT;case p.R16UI:return e.UNSIGNED_SHORT;case p.R16I:return e.SHORT;case p.R32F:return e.FLOAT;case p.R32UI:return e.UNSIGNED_INT;case p.R32I:return e.INT;case p.RG8:return e.UNSIGNED_BYTE;case p.RG8SN:return e.BYTE;case p.RG8UI:return e.UNSIGNED_BYTE;case p.RG8I:return e.BYTE;case p.RG16F:return e.HALF_FLOAT;case p.RG16UI:return e.UNSIGNED_SHORT;case p.RG16I:return e.SHORT;case p.RG32F:return e.FLOAT;case p.RG32UI:return e.UNSIGNED_INT;case p.RG32I:return e.INT;case p.RGB8:case p.SRGB8:return e.UNSIGNED_BYTE;case p.RGB8SN:return e.BYTE;case p.RGB8UI:return e.UNSIGNED_BYTE;case p.RGB8I:return e.BYTE;case p.RGB16F:return e.HALF_FLOAT;case p.RGB16UI:return e.UNSIGNED_SHORT;case p.RGB16I:return e.SHORT;case p.RGB32F:return e.FLOAT;case p.RGB32UI:return e.UNSIGNED_INT;case p.RGB32I:return e.INT;case p.BGRA8:case p.RGBA8:case p.SRGB8_A8:return e.UNSIGNED_BYTE;case p.RGBA8SN:return e.BYTE;case p.RGBA8UI:return e.UNSIGNED_BYTE;case p.RGBA8I:return e.BYTE;case p.RGBA16F:return e.HALF_FLOAT;case p.RGBA16UI:return e.UNSIGNED_SHORT;case p.RGBA16I:return e.SHORT;case p.RGBA32F:return e.FLOAT;case p.RGBA32UI:return e.UNSIGNED_INT;case p.RGBA32I:return e.INT;case p.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case p.R11G11B10F:return e.UNSIGNED_INT_10F_11F_11F_REV;case p.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case p.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case p.RGB10A2:case p.RGB10A2UI:return e.UNSIGNED_INT_2_10_10_10_REV;case p.RGB9E5:return e.FLOAT;case p.D16:return e.UNSIGNED_SHORT;case p.D16S8:return e.UNSIGNED_INT_24_8;case p.D24:return e.UNSIGNED_INT;case p.D24S8:return e.UNSIGNED_INT_24_8;case p.D32F:return e.FLOAT;case p.D32F_S8:return e.FLOAT_32_UNSIGNED_INT_24_8_REV;case p.BC1:case p.BC1_SRGB:case p.BC2:case p.BC2_SRGB:case p.BC3:case p.BC3_SRGB:case p.BC4:return e.UNSIGNED_BYTE;case p.BC4_SNORM:return e.BYTE;case p.BC5:return e.UNSIGNED_BYTE;case p.BC5_SNORM:return e.BYTE;case p.BC6H_SF16:case p.BC6H_UF16:return e.FLOAT;case p.BC7:case p.BC7_SRGB:case p.ETC_RGB8:case p.ETC2_RGB8:case p.ETC2_SRGB8:case p.ETC2_RGB8_A1:case p.ETC2_SRGB8_A1:case p.EAC_R11:return e.UNSIGNED_BYTE;case p.EAC_R11SN:return e.BYTE;case p.EAC_RG11:return e.UNSIGNED_BYTE;case p.EAC_RG11SN:return e.BYTE;case p.PVRTC_RGB2:case p.PVRTC_RGBA2:case p.PVRTC_RGB4:case p.PVRTC_RGBA4:case p.PVRTC2_2BPP:case p.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case p.ASTC_RGBA_4x4:case p.ASTC_RGBA_5x4:case p.ASTC_RGBA_5x5:case p.ASTC_RGBA_6x5:case p.ASTC_RGBA_6x6:case p.ASTC_RGBA_8x5:case p.ASTC_RGBA_8x6:case p.ASTC_RGBA_8x8:case p.ASTC_RGBA_10x5:case p.ASTC_RGBA_10x6:case p.ASTC_RGBA_10x8:case p.ASTC_RGBA_10x10:case p.ASTC_RGBA_12x10:case p.ASTC_RGBA_12x12:case p.ASTC_SRGBA_4x4:case p.ASTC_SRGBA_5x4:case p.ASTC_SRGBA_5x5:case p.ASTC_SRGBA_6x5:case p.ASTC_SRGBA_6x6:case p.ASTC_SRGBA_8x5:case p.ASTC_SRGBA_8x6:case p.ASTC_SRGBA_8x8:case p.ASTC_SRGBA_10x5:case p.ASTC_SRGBA_10x6:case p.ASTC_SRGBA_10x8:case p.ASTC_SRGBA_10x10:case p.ASTC_SRGBA_12x10:case p.ASTC_SRGBA_12x12:default:return e.UNSIGNED_BYTE}}function ma(t,e){switch(t){case p.A8:return e.ALPHA;case p.L8:return e.LUMINANCE;case p.LA8:return e.LUMINANCE_ALPHA;case p.R8:return e.R8;case p.R8SN:return e.R8_SNORM;case p.R8UI:return e.R8UI;case p.R8I:return e.R8I;case p.RG8:return e.RG8;case p.RG8SN:return e.RG8_SNORM;case p.RG8UI:return e.RG8UI;case p.RG8I:return e.RG8I;case p.RGB8:return e.RGB8;case p.RGB8SN:return e.RGB8_SNORM;case p.RGB8UI:return e.RGB8UI;case p.RGB8I:return e.RGB8I;case p.BGRA8:case p.RGBA8:return e.RGBA8;case p.RGBA8SN:return e.RGBA8_SNORM;case p.RGBA8UI:return e.RGBA8UI;case p.RGBA8I:return e.RGBA8I;case p.R16I:return e.R16I;case p.R16UI:return e.R16UI;case p.R16F:return e.R16F;case p.RG16I:return e.RG16I;case p.RG16UI:return e.RG16UI;case p.RG16F:return e.RG16F;case p.RGB16I:return e.RGB16I;case p.RGB16UI:return e.RGB16UI;case p.RGB16F:return e.RGB16F;case p.RGBA16I:return e.RGBA16I;case p.RGBA16UI:return e.RGBA16UI;case p.RGBA16F:return e.RGBA16F;case p.R32I:return e.R32I;case p.R32UI:return e.R32UI;case p.R32F:return e.R32F;case p.RG32I:return e.RG32I;case p.RG32UI:return e.RG32UI;case p.RG32F:return e.RG32F;case p.RGB32I:return e.RGB32I;case p.RGB32UI:return e.RGB32UI;case p.RGB32F:return e.RGB32F;case p.RGBA32I:return e.RGBA32I;case p.RGBA32UI:return e.RGBA32UI;case p.RGBA32F:return e.RGBA32F;case p.R5G6B5:return e.RGB565;case p.RGB5A1:return e.RGB5_A1;case p.RGBA4:return e.RGBA4;case p.RGB10A2:return e.RGB10_A2;case p.RGB10A2UI:return e.RGB10_A2UI;case p.R11G11B10F:return e.R11F_G11F_B10F;case p.D16:return e.DEPTH_COMPONENT16;case p.D16S8:return e.DEPTH24_STENCIL8;case p.D24:return e.DEPTH_COMPONENT24;case p.D24S8:return e.DEPTH24_STENCIL8;case p.D32F:return e.DEPTH_COMPONENT32F;case p.D32F_S8:return e.DEPTH32F_STENCIL8;case p.BC1:return gs.COMPRESSED_RGB_S3TC_DXT1_EXT;case p.BC1_ALPHA:return gs.COMPRESSED_RGBA_S3TC_DXT1_EXT;case p.BC1_SRGB:return gs.COMPRESSED_SRGB_S3TC_DXT1_EXT;case p.BC1_SRGB_ALPHA:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case p.BC2:return gs.COMPRESSED_RGBA_S3TC_DXT3_EXT;case p.BC2_SRGB:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case p.BC3:return gs.COMPRESSED_RGBA_S3TC_DXT5_EXT;case p.BC3_SRGB:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case p.ETC_RGB8:return gs.COMPRESSED_RGB_ETC1_WEBGL;case p.ETC2_RGB8:return gs.COMPRESSED_RGB8_ETC2;case p.ETC2_SRGB8:return gs.COMPRESSED_SRGB8_ETC2;case p.ETC2_RGB8_A1:return gs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case p.ETC2_SRGB8_A1:return gs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case p.ETC2_RGBA8:return gs.COMPRESSED_RGBA8_ETC2_EAC;case p.ETC2_SRGB8_A8:return gs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case p.EAC_R11:return gs.COMPRESSED_R11_EAC;case p.EAC_R11SN:return gs.COMPRESSED_SIGNED_R11_EAC;case p.EAC_RG11:return gs.COMPRESSED_RG11_EAC;case p.EAC_RG11SN:return gs.COMPRESSED_SIGNED_RG11_EAC;case p.PVRTC_RGB2:return gs.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case p.PVRTC_RGBA2:return gs.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case p.PVRTC_RGB4:return gs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case p.PVRTC_RGBA4:return gs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case p.ASTC_RGBA_4x4:return gs.COMPRESSED_RGBA_ASTC_4x4_KHR;case p.ASTC_RGBA_5x4:return gs.COMPRESSED_RGBA_ASTC_5x4_KHR;case p.ASTC_RGBA_5x5:return gs.COMPRESSED_RGBA_ASTC_5x5_KHR;case p.ASTC_RGBA_6x5:return gs.COMPRESSED_RGBA_ASTC_6x5_KHR;case p.ASTC_RGBA_6x6:return gs.COMPRESSED_RGBA_ASTC_6x6_KHR;case p.ASTC_RGBA_8x5:return gs.COMPRESSED_RGBA_ASTC_8x5_KHR;case p.ASTC_RGBA_8x6:return gs.COMPRESSED_RGBA_ASTC_8x6_KHR;case p.ASTC_RGBA_8x8:return gs.COMPRESSED_RGBA_ASTC_8x8_KHR;case p.ASTC_RGBA_10x5:return gs.COMPRESSED_RGBA_ASTC_10x5_KHR;case p.ASTC_RGBA_10x6:return gs.COMPRESSED_RGBA_ASTC_10x6_KHR;case p.ASTC_RGBA_10x8:return gs.COMPRESSED_RGBA_ASTC_10x8_KHR;case p.ASTC_RGBA_10x10:return gs.COMPRESSED_RGBA_ASTC_10x10_KHR;case p.ASTC_RGBA_12x10:return gs.COMPRESSED_RGBA_ASTC_12x10_KHR;case p.ASTC_RGBA_12x12:return gs.COMPRESSED_RGBA_ASTC_12x12_KHR;case p.ASTC_SRGBA_4x4:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case p.ASTC_SRGBA_5x4:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case p.ASTC_SRGBA_5x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case p.ASTC_SRGBA_6x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case p.ASTC_SRGBA_6x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case p.ASTC_SRGBA_8x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case p.ASTC_SRGBA_8x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case p.ASTC_SRGBA_8x8:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case p.ASTC_SRGBA_10x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case p.ASTC_SRGBA_10x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case p.ASTC_SRGBA_10x8:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case p.ASTC_SRGBA_10x10:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case p.ASTC_SRGBA_12x10:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case p.ASTC_SRGBA_12x12:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}function ya(t,e){switch(t){case p.A8:return e.ALPHA;case p.L8:return e.LUMINANCE;case p.LA8:return e.LUMINANCE_ALPHA;case p.R8:case p.R8SN:return e.RED;case p.R8UI:case p.R8I:return e.RED;case p.RG8:case p.RG8SN:case p.RG8UI:case p.RG8I:return e.RG;case p.RGB8:case p.RGB8SN:case p.RGB8UI:case p.RGB8I:return e.RGB;case p.BGRA8:case p.RGBA8:case p.RGBA8SN:case p.RGBA8UI:case p.RGBA8I:return e.RGBA;case p.R16UI:case p.R16I:case p.R16F:return e.RED;case p.RG16UI:case p.RG16I:case p.RG16F:return e.RG;case p.RGB16UI:case p.RGB16I:case p.RGB16F:return e.RGB;case p.RGBA16UI:case p.RGBA16I:case p.RGBA16F:return e.RGBA;case p.R32UI:case p.R32I:case p.R32F:return e.RED;case p.RG32UI:case p.RG32I:case p.RG32F:return e.RG;case p.RGB32UI:case p.RGB32I:case p.RGB32F:return e.RGB;case p.RGBA32UI:case p.RGBA32I:case p.RGBA32F:case p.RGB10A2:return e.RGBA;case p.R11G11B10F:case p.R5G6B5:return e.RGB;case p.RGB5A1:case p.RGBA4:return e.RGBA;case p.D16:return e.DEPTH_COMPONENT;case p.D16S8:return e.DEPTH_STENCIL;case p.D24:return e.DEPTH_COMPONENT;case p.D24S8:return e.DEPTH_STENCIL;case p.D32F:return e.DEPTH_COMPONENT;case p.D32F_S8:return e.DEPTH_STENCIL;case p.BC1:return gs.COMPRESSED_RGB_S3TC_DXT1_EXT;case p.BC1_ALPHA:return gs.COMPRESSED_RGBA_S3TC_DXT1_EXT;case p.BC1_SRGB:return gs.COMPRESSED_SRGB_S3TC_DXT1_EXT;case p.BC1_SRGB_ALPHA:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case p.BC2:return gs.COMPRESSED_RGBA_S3TC_DXT3_EXT;case p.BC2_SRGB:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case p.BC3:return gs.COMPRESSED_RGBA_S3TC_DXT5_EXT;case p.BC3_SRGB:return gs.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case p.ETC_RGB8:return gs.COMPRESSED_RGB_ETC1_WEBGL;case p.ETC2_RGB8:return gs.COMPRESSED_RGB8_ETC2;case p.ETC2_SRGB8:return gs.COMPRESSED_SRGB8_ETC2;case p.ETC2_RGB8_A1:return gs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case p.ETC2_SRGB8_A1:return gs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case p.ETC2_RGBA8:return gs.COMPRESSED_RGBA8_ETC2_EAC;case p.ETC2_SRGB8_A8:return gs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case p.EAC_R11:return gs.COMPRESSED_R11_EAC;case p.EAC_R11SN:return gs.COMPRESSED_SIGNED_R11_EAC;case p.EAC_RG11:return gs.COMPRESSED_RG11_EAC;case p.EAC_RG11SN:return gs.COMPRESSED_SIGNED_RG11_EAC;case p.PVRTC_RGB2:return gs.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case p.PVRTC_RGBA2:return gs.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case p.PVRTC_RGB4:return gs.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case p.PVRTC_RGBA4:return gs.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case p.ASTC_RGBA_4x4:return gs.COMPRESSED_RGBA_ASTC_4x4_KHR;case p.ASTC_RGBA_5x4:return gs.COMPRESSED_RGBA_ASTC_5x4_KHR;case p.ASTC_RGBA_5x5:return gs.COMPRESSED_RGBA_ASTC_5x5_KHR;case p.ASTC_RGBA_6x5:return gs.COMPRESSED_RGBA_ASTC_6x5_KHR;case p.ASTC_RGBA_6x6:return gs.COMPRESSED_RGBA_ASTC_6x6_KHR;case p.ASTC_RGBA_8x5:return gs.COMPRESSED_RGBA_ASTC_8x5_KHR;case p.ASTC_RGBA_8x6:return gs.COMPRESSED_RGBA_ASTC_8x6_KHR;case p.ASTC_RGBA_8x8:return gs.COMPRESSED_RGBA_ASTC_8x8_KHR;case p.ASTC_RGBA_10x5:return gs.COMPRESSED_RGBA_ASTC_10x5_KHR;case p.ASTC_RGBA_10x6:return gs.COMPRESSED_RGBA_ASTC_10x6_KHR;case p.ASTC_RGBA_10x8:return gs.COMPRESSED_RGBA_ASTC_10x8_KHR;case p.ASTC_RGBA_10x10:return gs.COMPRESSED_RGBA_ASTC_10x10_KHR;case p.ASTC_RGBA_12x10:return gs.COMPRESSED_RGBA_ASTC_12x10_KHR;case p.ASTC_RGBA_12x12:return gs.COMPRESSED_RGBA_ASTC_12x12_KHR;case p.ASTC_SRGBA_4x4:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case p.ASTC_SRGBA_5x4:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case p.ASTC_SRGBA_5x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case p.ASTC_SRGBA_6x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case p.ASTC_SRGBA_6x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case p.ASTC_SRGBA_8x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case p.ASTC_SRGBA_8x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case p.ASTC_SRGBA_8x8:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case p.ASTC_SRGBA_10x5:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case p.ASTC_SRGBA_10x6:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case p.ASTC_SRGBA_10x8:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case p.ASTC_SRGBA_10x10:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case p.ASTC_SRGBA_12x10:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case p.ASTC_SRGBA_12x12:return gs.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}function va(t,e){switch(t){case f.BOOL:return e.BOOL;case f.BOOL2:return e.BOOL_VEC2;case f.BOOL3:return e.BOOL_VEC3;case f.BOOL4:return e.BOOL_VEC4;case f.INT:return e.INT;case f.INT2:return e.INT_VEC2;case f.INT3:return e.INT_VEC3;case f.INT4:return e.INT_VEC4;case f.UINT:return e.UNSIGNED_INT;case f.FLOAT:return e.FLOAT;case f.FLOAT2:return e.FLOAT_VEC2;case f.FLOAT3:return e.FLOAT_VEC3;case f.FLOAT4:return e.FLOAT_VEC4;case f.MAT2:return e.FLOAT_MAT2;case f.MAT2X3:return e.FLOAT_MAT2x3;case f.MAT2X4:return e.FLOAT_MAT2x4;case f.MAT3X2:return e.FLOAT_MAT3x2;case f.MAT3:return e.FLOAT_MAT3;case f.MAT3X4:return e.FLOAT_MAT3x4;case f.MAT4X2:return e.FLOAT_MAT4x2;case f.MAT4X3:return e.FLOAT_MAT4x3;case f.MAT4:return e.FLOAT_MAT4;case f.SAMPLER2D:return e.SAMPLER_2D;case f.SAMPLER2D_ARRAY:return e.SAMPLER_2D_ARRAY;case f.SAMPLER3D:return e.SAMPLER_3D;case f.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),f.UNKNOWN}}function ba(t,e){switch(t){case e.BOOL:return f.BOOL;case e.BOOL_VEC2:return f.BOOL2;case e.BOOL_VEC3:return f.BOOL3;case e.BOOL_VEC4:return f.BOOL4;case e.INT:return f.INT;case e.INT_VEC2:return f.INT2;case e.INT_VEC3:return f.INT3;case e.INT_VEC4:return f.INT4;case e.UNSIGNED_INT:return f.UINT;case e.UNSIGNED_INT_VEC2:return f.UINT2;case e.UNSIGNED_INT_VEC3:return f.UINT3;case e.UNSIGNED_INT_VEC4:return f.UINT4;case e.FLOAT:return f.FLOAT;case e.FLOAT_VEC2:return f.FLOAT2;case e.FLOAT_VEC3:return f.FLOAT3;case e.FLOAT_VEC4:return f.FLOAT4;case e.FLOAT_MAT2:return f.MAT2;case e.FLOAT_MAT2x3:return f.MAT2X3;case e.FLOAT_MAT2x4:return f.MAT2X4;case e.FLOAT_MAT3x2:return f.MAT3X2;case e.FLOAT_MAT3:return f.MAT3;case e.FLOAT_MAT3x4:return f.MAT3X4;case e.FLOAT_MAT4x2:return f.MAT4X2;case e.FLOAT_MAT4x3:return f.MAT4X3;case e.FLOAT_MAT4:return f.MAT4;case e.SAMPLER_2D:return f.SAMPLER2D;case e.SAMPLER_2D_ARRAY:return f.SAMPLER2D_ARRAY;case e.SAMPLER_3D:return f.SAMPLER3D;case e.SAMPLER_CUBE:return f.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),f.UNKNOWN}}function Sa(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:return 4;case e.UNSIGNED_INT_VEC2:return 8;case e.UNSIGNED_INT_VEC3:return 12;case e.UNSIGNED_INT_VEC4:return 16;case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT2x3:return 24;case e.FLOAT_MAT2x4:return 32;case e.FLOAT_MAT3x2:return 24;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT3x4:return 48;case e.FLOAT_MAT4x2:return 32;case e.FLOAT_MAT4x3:return 48;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_3D:case e.SAMPLER_CUBE:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_2D_ARRAY:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function Ta(t,e){switch(t){case e.FLOAT_MAT2:case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:return 2;case e.FLOAT_MAT3x2:case e.FLOAT_MAT3:case e.FLOAT_MAT3x4:return 3;case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:case e.FLOAT_MAT4:return 4;default:return 1}}var Aa,Ea=[512,513,514,515,516,517,518,519],Ca=[0,7680,7681,7682,7683,5386,34055,34056],Ra=[32774,32778,32779,32775,32776],wa=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(Aa||(Aa={}));var xa=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},Oa=function(t){function e(){var e;return(e=t.call(this,Aa.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new K,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return Me(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(xa),Pa=function(t){function e(){var e;return(e=t.call(this,Aa.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.dynamicStates=new zt,e}return Me(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuInputAssembler=null,this.gpuDescriptorSets.length=0,this.dynamicOffsets.length=0},e}(xa),Da=function(t){function e(){var e;return(e=t.call(this,Aa.DRAW)||this).drawInfo=new at,e}return Me(e,t),e.prototype.clear=function(){},e}(xa),Ma=function(t){function e(){var e;return(e=t.call(this,Aa.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return Me(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(xa),Ba=function(t){function e(){var e;return(e=t.call(this,Aa.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return Me(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(xa),Ia=function(){function t(){this.cmds=new r(1),this.beginRenderPassCmds=new r(1),this.bindStatesCmds=new r(1),this.drawCmds=new r(1),this.updateBufferCmds=new r(1),this.copyBufferToTextureCmds=new r(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function La(t,e,i,r,n){if(e.usage&_.INDIRECT)e.indirects.length=r,Array.prototype.push.apply(e.indirects,i.drawInfos);else{var s=i,a=t.gl,o=t.stateCache;switch(e.glTarget){case a.ARRAY_BUFFER:o.glVAO&&(a.bindVertexArray(null),o.glVAO=Fa.gpuInputAssembler=null),o.glArrayBuffer!==e.glBuffer&&(a.bindBuffer(a.ARRAY_BUFFER,e.glBuffer),o.glArrayBuffer=e.glBuffer),n===s.byteLength?a.bufferSubData(e.glTarget,r,s):a.bufferSubData(e.glTarget,r,s.slice(0,n));break;case a.ELEMENT_ARRAY_BUFFER:o.glVAO&&(a.bindVertexArray(null),o.glVAO=Fa.gpuInputAssembler=null),o.glElementArrayBuffer!==e.glBuffer&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e.glBuffer),o.glElementArrayBuffer=e.glBuffer),n===s.byteLength?a.bufferSubData(e.glTarget,r,s):a.bufferSubData(e.glTarget,r,s.slice(0,n));break;case a.UNIFORM_BUFFER:o.glUniformBuffer!==e.glBuffer&&(a.bindBuffer(a.UNIFORM_BUFFER,e.glBuffer),o.glUniformBuffer=e.glBuffer),n===s.byteLength?a.bufferSubData(e.glTarget,r,s):a.bufferSubData(e.glTarget,r,new Float32Array(s,0,n/4));break;default:console.error("Unsupported BufferType, update buffer failed.")}}}var Fa={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0,invalidateAttachments:[]};function ka(t,e,i,r,n,s,a){var o=t.gl,l=t.stateCache,h=0;if(i&&e){l.glFramebuffer!==i.glFramebuffer&&(o.bindFramebuffer(o.FRAMEBUFFER,i.glFramebuffer),l.glFramebuffer=i.glFramebuffer),l.viewport.left===r.x&&l.viewport.top===r.y&&l.viewport.width===r.width&&l.viewport.height===r.height||(o.viewport(r.x,r.y,r.width,r.height),l.viewport.left=r.x,l.viewport.top=r.y,l.viewport.width=r.width,l.viewport.height=r.height),l.scissorRect.x===r.x&&l.scissorRect.y===r.y&&l.scissorRect.width===r.width&&l.scissorRect.height===r.height||(o.scissor(r.x,r.y,r.width,r.height),l.scissorRect.x=r.x,l.scissorRect.y=r.y,l.scissorRect.width=r.width,l.scissorRect.height=r.height),Fa.invalidateAttachments.length=0;for(var u=0;u<n.length;++u){var c=e.colorAttachments[u];if(c.format!==p.UNKNOWN)switch(c.loadOp){case D.LOAD:break;case D.CLEAR:if(l.bs.targets[0].blendColorMask!==O.ALL&&o.colorMask(!0,!0,!0,!0),i.isOffscreen)_a[0]=n[u].x,_a[1]=n[u].y,_a[2]=n[u].z,_a[3]=n[u].w,o.clearBufferfv(o.COLOR,u,_a);else{var d=n[0];o.clearColor(d.x,d.y,d.z,d.w),h|=o.COLOR_BUFFER_BIT}break;case D.DISCARD:Fa.invalidateAttachments.push(o.COLOR_ATTACHMENT0+u)}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==p.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case D.LOAD:break;case D.CLEAR:l.dss.depthWrite||o.depthMask(!0),o.clearDepth(s),h|=o.DEPTH_BUFFER_BIT;break;case D.DISCARD:Fa.invalidateAttachments.push(o.DEPTH_ATTACHMENT)}if(Xt[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case D.LOAD:break;case D.CLEAR:l.dss.stencilWriteMaskFront||o.stencilMaskSeparate(o.FRONT,65535),l.dss.stencilWriteMaskBack||o.stencilMaskSeparate(o.BACK,65535),o.clearStencil(a),h|=o.STENCIL_BUFFER_BIT;break;case D.DISCARD:Fa.invalidateAttachments.push(o.STENCIL_ATTACHMENT)}}if(i.glFramebuffer&&Fa.invalidateAttachments.length&&o.invalidateFramebuffer(o.FRAMEBUFFER,Fa.invalidateAttachments),h&&o.clear(h),h&o.COLOR_BUFFER_BIT){var f=l.bs.targets[0].blendColorMask;if(f!==O.ALL){var _=(f&O.R)!==O.NONE,g=(f&O.G)!==O.NONE,m=(f&O.B)!==O.NONE,y=(f&O.A)!==O.NONE;o.colorMask(_,g,m,y)}}h&o.DEPTH_BUFFER_BIT&&!l.dss.depthWrite&&o.depthMask(!1),h&o.STENCIL_BUFFER_BIT&&(l.dss.stencilWriteMaskFront||o.stencilMaskSeparate(o.FRONT,0),l.dss.stencilWriteMaskBack||o.stencilMaskSeparate(o.BACK,0))}}function Na(t,e,i,r,n,s){var a=t.gl,o=t.stateCache,l=e&&e.gpuShader,h=!1;if(e&&Fa.gpuPipelineState!==e){if(Fa.gpuPipelineState=e,Fa.glPrimitive=e.glPrimitive,l){var u=l.glProgram;o.glProgram!==u&&(a.useProgram(u),o.glProgram=u,h=!0)}var c=e.rs;if(c){if(o.rs.cullMode!==c.cullMode){switch(c.cullMode){case N.NONE:a.disable(a.CULL_FACE);break;case N.FRONT:a.enable(a.CULL_FACE),a.cullFace(a.FRONT);break;case N.BACK:a.enable(a.CULL_FACE),a.cullFace(a.BACK)}t.stateCache.rs.cullMode=c.cullMode}var p=c.isFrontFaceCCW;t.stateCache.rs.isFrontFaceCCW!==p&&(a.frontFace(p?a.CCW:a.CW),t.stateCache.rs.isFrontFaceCCW=p),t.stateCache.rs.depthBias===c.depthBias&&t.stateCache.rs.depthBiasSlop===c.depthBiasSlop||(a.polygonOffset(c.depthBias,c.depthBiasSlop),t.stateCache.rs.depthBias=c.depthBias,t.stateCache.rs.depthBiasSlop=c.depthBiasSlop),t.stateCache.rs.lineWidth!==c.lineWidth&&(a.lineWidth(c.lineWidth),t.stateCache.rs.lineWidth=c.lineWidth)}var d=e.dss;d&&(o.dss.depthTest!==d.depthTest&&(d.depthTest?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),o.dss.depthTest=d.depthTest),o.dss.depthWrite!==d.depthWrite&&(a.depthMask(d.depthWrite),o.dss.depthWrite=d.depthWrite),o.dss.depthFunc!==d.depthFunc&&(a.depthFunc(Ea[d.depthFunc]),o.dss.depthFunc=d.depthFunc),o.dss.stencilTestFront===d.stencilTestFront&&o.dss.stencilTestBack===d.stencilTestBack||(d.stencilTestFront||d.stencilTestBack?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),o.dss.stencilTestFront=d.stencilTestFront,o.dss.stencilTestBack=d.stencilTestBack),o.dss.stencilFuncFront===d.stencilFuncFront&&o.dss.stencilRefFront===d.stencilRefFront&&o.dss.stencilReadMaskFront===d.stencilReadMaskFront||(a.stencilFuncSeparate(a.FRONT,Ea[d.stencilFuncFront],d.stencilRefFront,d.stencilReadMaskFront),o.dss.stencilFuncFront=d.stencilFuncFront,o.dss.stencilRefFront=d.stencilRefFront,o.dss.stencilReadMaskFront=d.stencilReadMaskFront),o.dss.stencilFailOpFront===d.stencilFailOpFront&&o.dss.stencilZFailOpFront===d.stencilZFailOpFront&&o.dss.stencilPassOpFront===d.stencilPassOpFront||(a.stencilOpSeparate(a.FRONT,Ca[d.stencilFailOpFront],Ca[d.stencilZFailOpFront],Ca[d.stencilPassOpFront]),o.dss.stencilFailOpFront=d.stencilFailOpFront,o.dss.stencilZFailOpFront=d.stencilZFailOpFront,o.dss.stencilPassOpFront=d.stencilPassOpFront),o.dss.stencilWriteMaskFront!==d.stencilWriteMaskFront&&(a.stencilMaskSeparate(a.FRONT,d.stencilWriteMaskFront),o.dss.stencilWriteMaskFront=d.stencilWriteMaskFront),o.dss.stencilFuncBack===d.stencilFuncBack&&o.dss.stencilRefBack===d.stencilRefBack&&o.dss.stencilReadMaskBack===d.stencilReadMaskBack||(a.stencilFuncSeparate(a.BACK,Ea[d.stencilFuncBack],d.stencilRefBack,d.stencilReadMaskBack),o.dss.stencilFuncBack=d.stencilFuncBack,o.dss.stencilRefBack=d.stencilRefBack,o.dss.stencilReadMaskBack=d.stencilReadMaskBack),o.dss.stencilFailOpBack===d.stencilFailOpBack&&o.dss.stencilZFailOpBack===d.stencilZFailOpBack&&o.dss.stencilPassOpBack===d.stencilPassOpBack||(a.stencilOpSeparate(a.BACK,Ca[d.stencilFailOpBack],Ca[d.stencilZFailOpBack],Ca[d.stencilPassOpBack]),o.dss.stencilFailOpBack=d.stencilFailOpBack,o.dss.stencilZFailOpBack=d.stencilZFailOpBack,o.dss.stencilPassOpBack=d.stencilPassOpBack),o.dss.stencilWriteMaskBack!==d.stencilWriteMaskBack&&(a.stencilMaskSeparate(a.BACK,d.stencilWriteMaskBack),o.dss.stencilWriteMaskBack=d.stencilWriteMaskBack));var f=e.bs;if(f){o.bs.isA2C!==f.isA2C&&(f.isA2C?a.enable(a.SAMPLE_ALPHA_TO_COVERAGE):a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),o.bs.isA2C=f.isA2C),o.bs.blendColor.x===f.blendColor.x&&o.bs.blendColor.y===f.blendColor.y&&o.bs.blendColor.z===f.blendColor.z&&o.bs.blendColor.w===f.blendColor.w||(a.blendColor(f.blendColor.x,f.blendColor.y,f.blendColor.z,f.blendColor.w),o.bs.blendColor.x=f.blendColor.x,o.bs.blendColor.y=f.blendColor.y,o.bs.blendColor.z=f.blendColor.z,o.bs.blendColor.w=f.blendColor.w);var _=f.targets[0],g=o.bs.targets[0];g.blend!==_.blend&&(_.blend?a.enable(a.BLEND):a.disable(a.BLEND),g.blend=_.blend),g.blendEq===_.blendEq&&g.blendAlphaEq===_.blendAlphaEq||(a.blendEquationSeparate(Ra[_.blendEq],Ra[_.blendAlphaEq]),g.blendEq=_.blendEq,g.blendAlphaEq=_.blendAlphaEq),g.blendSrc===_.blendSrc&&g.blendDst===_.blendDst&&g.blendSrcAlpha===_.blendSrcAlpha&&g.blendDstAlpha===_.blendDstAlpha||(a.blendFuncSeparate(wa[_.blendSrc],wa[_.blendDst],wa[_.blendSrcAlpha],wa[_.blendDstAlpha]),g.blendSrc=_.blendSrc,g.blendDst=_.blendDst,g.blendSrcAlpha=_.blendSrcAlpha,g.blendDstAlpha=_.blendDstAlpha),g.blendColorMask!==_.blendColorMask&&(a.colorMask((_.blendColorMask&O.R)!==O.NONE,(_.blendColorMask&O.G)!==O.NONE,(_.blendColorMask&O.B)!==O.NONE,(_.blendColorMask&O.A)!==O.NONE),g.blendColorMask=_.blendColorMask)}}if(e&&e.gpuPipelineLayout&&l){for(var m=l.glBlocks.length,y=e.gpuPipelineLayout.dynamicOffsetIndices,v=0;v<m;v++){var b=l.glBlocks[v],S=r[b.set],T=S&&S.descriptorIndices[b.binding],A=T>=0&&S.gpuDescriptors[T];if(A&&A.gpuBuffer){var E=y[b.set],C=E&&E[b.binding],R=A.gpuBuffer.glOffset;C>=0&&(R+=n[C]),o.glBindUBOs[b.glBinding]===A.gpuBuffer.glBuffer&&o.glBindUBOOffsets[b.glBinding]===R||(R?a.bindBufferRange(a.UNIFORM_BUFFER,b.glBinding,A.gpuBuffer.glBuffer,R,A.gpuBuffer.size):a.bindBufferBase(a.UNIFORM_BUFFER,b.glBinding,A.gpuBuffer.glBuffer),o.glUniformBuffer=o.glBindUBOs[b.glBinding]=A.gpuBuffer.glBuffer,o.glBindUBOOffsets[b.glBinding]=R)}else Le("Buffer binding '"+b.name+"' at set "+b.set+" binding "+b.binding+" is not bounded")}for(var w=l.glSamplerTextures.length,x=0;x<w;x++)for(var P=l.glSamplerTextures[x],D=r[P.set],M=D&&D.descriptorIndices[P.binding],B=M>=0&&D.gpuDescriptors[M],I=0;I<P.units.length;I++){var L=P.units[I],F=o.glTexUnits[L];if(B&&B.gpuTexture&&B.gpuSampler){if(B.gpuTexture&&B.gpuTexture.size>0){var k=B.gpuTexture;F.glTexture!==k.glTexture&&(o.texUnit!==L&&(a.activeTexture(a.TEXTURE0+L),o.texUnit=L),k.glTexture?a.bindTexture(k.glTarget,k.glTexture):a.bindTexture(k.glTarget,t.nullTex2D.gpuTexture.glTexture),F.glTexture=k.glTexture);var U=B.gpuSampler;o.glSamplerUnits[L]!==U.glSampler&&(a.bindSampler(L,U.glSampler),o.glSamplerUnits[L]=U.glSampler)}B=D.gpuDescriptors[++M]}else Le("Sampler binding '"+P.name+"' at set "+P.set+" binding "+P.binding+" index "+I+" is not bounded")}}if(i&&l&&(h||Fa.gpuInputAssembler!==i))if(Fa.gpuInputAssembler=i,t.useVAO){var z=i.glVAOs.get(l.glProgram);if(!z){var V;z=a.createVertexArray(),i.glVAOs.set(l.glProgram,z),a.bindVertexArray(z),a.bindBuffer(a.ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),o.glArrayBuffer=null,o.glElementArrayBuffer=null;for(var H=0;H<l.glInputs.length;H++){var W=l.glInputs[H];V=null;for(var X=0;X<i.glAttribs.length;X++){var Y=i.glAttribs[X];if(Y.name===W.name){V=Y;break}}if(V){o.glArrayBuffer!==V.glBuffer&&(a.bindBuffer(a.ARRAY_BUFFER,V.glBuffer),o.glArrayBuffer=V.glBuffer);for(var j=0;j<V.componentCount;++j){var K=W.glLoc+j,q=V.offset+V.size*j;a.enableVertexAttribArray(K),o.glCurrentAttribLocs[K]=!0,a.vertexAttribPointer(K,V.count,V.glType,V.isNormalized,V.stride,q),a.vertexAttribDivisor(K,V.isInstanced?1:0)}}}var Z=i.gpuIndexBuffer;Z&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,Z.glBuffer),a.bindVertexArray(null),a.bindBuffer(a.ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),o.glArrayBuffer=null,o.glElementArrayBuffer=null}o.glVAO!==z&&(a.bindVertexArray(z),o.glVAO=z)}else{for(var J=0;J<t.capabilities.maxVertexAttributes;++J)o.glCurrentAttribLocs[J]=!1;for(var Q=0;Q<l.glInputs.length;Q++){for(var $=l.glInputs[Q],tt=null,et=0;et<i.glAttribs.length;et++){var it=i.glAttribs[et];if(it.name===$.name){tt=it;break}}if(tt){o.glArrayBuffer!==tt.glBuffer&&(a.bindBuffer(a.ARRAY_BUFFER,tt.glBuffer),o.glArrayBuffer=tt.glBuffer);for(var rt=0;rt<tt.componentCount;++rt){var nt=$.glLoc+rt,st=tt.offset+tt.size*rt;!o.glEnabledAttribLocs[nt]&&nt>=0&&(a.enableVertexAttribArray(nt),o.glEnabledAttribLocs[nt]=!0),o.glCurrentAttribLocs[nt]=!0,a.vertexAttribPointer(nt,tt.count,tt.glType,tt.isNormalized,tt.stride,st),a.vertexAttribDivisor(nt,tt.isInstanced?1:0)}}}var at=i.gpuIndexBuffer;at&&o.glElementArrayBuffer!==at.glBuffer&&(a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,at.glBuffer),o.glElementArrayBuffer=at.glBuffer);for(var ot=0;ot<t.capabilities.maxVertexAttributes;++ot)o.glEnabledAttribLocs[ot]!==o.glCurrentAttribLocs[ot]&&(a.disableVertexAttribArray(ot),o.glEnabledAttribLocs[ot]=!1)}if(e&&e.dynamicStates.length)for(var lt=e.dynamicStates.length,ht=0;ht<lt;ht++)switch(e.dynamicStates[ht]){case G.VIEWPORT:var ut=s.viewport;o.viewport.left===ut.left&&o.viewport.top===ut.top&&o.viewport.width===ut.width&&o.viewport.height===ut.height||(a.viewport(ut.left,ut.top,ut.width,ut.height),o.viewport.left=ut.left,o.viewport.top=ut.top,o.viewport.width=ut.width,o.viewport.height=ut.height);break;case G.SCISSOR:var ct=s.scissor;o.scissorRect.x===ct.x&&o.scissorRect.y===ct.y&&o.scissorRect.width===ct.width&&o.scissorRect.height===ct.height||(a.scissor(ct.x,ct.y,ct.width,ct.height),o.scissorRect.x=ct.x,o.scissorRect.y=ct.y,o.scissorRect.width=ct.width,o.scissorRect.height=ct.height);break;case G.LINE_WIDTH:o.rs.lineWidth!==s.lineWidth&&(a.lineWidth(s.lineWidth),o.rs.lineWidth=s.lineWidth);break;case G.DEPTH_BIAS:o.rs.depthBias===s.depthBiasConstant&&o.rs.depthBiasSlop===s.depthBiasSlope||(a.polygonOffset(s.depthBiasConstant,s.depthBiasSlope),o.rs.depthBias=s.depthBiasConstant,o.rs.depthBiasSlop=s.depthBiasSlope);break;case G.BLEND_CONSTANTS:var pt=s.blendConstant;o.bs.blendColor.x===pt.x&&o.bs.blendColor.y===pt.y&&o.bs.blendColor.z===pt.z&&o.bs.blendColor.w===pt.w||(a.blendColor(pt.x,pt.y,pt.z,pt.w),o.bs.blendColor.copy(pt));break;case G.STENCIL_WRITE_MASK:var dt=s.stencilStatesFront,ft=s.stencilStatesBack;o.dss.stencilWriteMaskFront!==dt.writeMask&&(a.stencilMaskSeparate(a.FRONT,dt.writeMask),o.dss.stencilWriteMaskFront=dt.writeMask),o.dss.stencilWriteMaskBack!==ft.writeMask&&(a.stencilMaskSeparate(a.BACK,ft.writeMask),o.dss.stencilWriteMaskBack=ft.writeMask);break;case G.STENCIL_COMPARE_MASK:var _t=s.stencilStatesFront,gt=s.stencilStatesBack;o.dss.stencilRefFront===_t.reference&&o.dss.stencilReadMaskFront===_t.compareMask||(a.stencilFuncSeparate(a.FRONT,Ea[o.dss.stencilFuncFront],_t.reference,_t.compareMask),o.dss.stencilRefFront=_t.reference,o.dss.stencilReadMaskFront=_t.compareMask),o.dss.stencilRefBack===gt.reference&&o.dss.stencilReadMaskBack===gt.compareMask||(a.stencilFuncSeparate(a.BACK,Ea[o.dss.stencilFuncBack],gt.reference,gt.compareMask),o.dss.stencilRefBack=gt.reference,o.dss.stencilReadMaskBack=gt.compareMask)}}function Ga(t,e){var i=t.gl,r=Fa.gpuInputAssembler,n=Fa.glPrimitive;if(r)if(r.gpuIndirectBuffer)for(var s=r.gpuIndirectBuffer.indirects,a=0;a<s.length;a++){var o=s[a],l=r.gpuIndexBuffer;if(o.instanceCount)if(l){if(o.indexCount>0){var h=o.firstIndex*l.stride;i.drawElementsInstanced(n,o.indexCount,r.glIndexType,h,o.instanceCount)}}else o.vertexCount>0&&i.drawArraysInstanced(n,o.firstVertex,o.vertexCount,o.instanceCount);else if(l){if(o.indexCount>0){var u=o.firstIndex*l.stride;i.drawElements(n,o.indexCount,r.glIndexType,u)}}else o.vertexCount>0&&i.drawArrays(n,o.firstVertex,o.vertexCount)}else if(e.instanceCount)if(r.gpuIndexBuffer){if(e.indexCount>0){var c=e.firstIndex*r.gpuIndexBuffer.stride;i.drawElementsInstanced(n,e.indexCount,r.glIndexType,c,e.instanceCount)}}else e.vertexCount>0&&i.drawArraysInstanced(n,e.firstVertex,e.vertexCount,e.instanceCount);else if(r.gpuIndexBuffer){if(e.indexCount>0){var p=e.firstIndex*r.gpuIndexBuffer.stride;i.drawElements(n,e.indexCount,r.glIndexType,p)}}else e.vertexCount>0&&i.drawArrays(n,e.firstVertex,e.vertexCount)}var Ua=new Array(Aa.COUNT);function za(t,e){Ua.fill(0);for(var i=0;i<e.cmds.length;++i){var r=e.cmds.array[i],n=Ua[r]++;switch(r){case Aa.BEGIN_RENDER_PASS:var s=e.beginRenderPassCmds.array[n];ka(t,s.gpuRenderPass,s.gpuFramebuffer,s.renderArea,s.clearColors,s.clearDepth,s.clearStencil);break;case Aa.BIND_STATES:var a=e.bindStatesCmds.array[n];Na(t,a.gpuPipelineState,a.gpuInputAssembler,a.gpuDescriptorSets,a.dynamicOffsets,a.dynamicStates);break;case Aa.DRAW:Ga(t,e.drawCmds.array[n].drawInfo);break;case Aa.UPDATE_BUFFER:var o=e.updateBufferCmds.array[n];La(t,o.gpuBuffer,o.buffer,o.offset,o.size);break;case Aa.COPY_BUFFER_TO_TEXTURE:var l=e.copyBufferToTextureCmds.array[n];Va(t,l.buffers,l.gpuTexture,l.regions)}}}function Va(t,e,i,r){var n=t.gl,s=t.stateCache.glTexUnits[t.stateCache.texUnit];s.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),s.glTexture=i.glTexture);var a=0,o=1,l=1,h=0,u=Xt[i.format].isCompressed;switch(i.glTarget){case n.TEXTURE_2D:for(var c=0;c<r.length;c++){var p=r[c];o=p.texExtent.width,l=p.texExtent.height;var d=e[a++];u?i.glInternalFmt!==gs.COMPRESSED_RGB_ETC1_WEBGL?n.compressedTexSubImage2D(n.TEXTURE_2D,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,o,l,i.glFormat,d):n.compressedTexImage2D(n.TEXTURE_2D,p.texSubres.mipLevel,i.glInternalFmt,o,l,0,d):n.texSubImage2D(n.TEXTURE_2D,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,o,l,i.glFormat,i.glType,d)}break;case n.TEXTURE_CUBE_MAP:for(var f=0;f<r.length;f++){var _=r[f],g=_.texSubres.baseArrayLayer+_.texSubres.layerCount;for(h=_.texSubres.baseArrayLayer;h<g;++h){o=_.texExtent.width,l=_.texExtent.height;var m=e[a++];u?i.glInternalFmt!==gs.COMPRESSED_RGB_ETC1_WEBGL?n.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,o,l,i.glFormat,m):n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,i.glInternalFmt,o,l,0,m):n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,o,l,i.glFormat,i.glType,m)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&S.GEN_MIPMAP&&n.generateMipmap(i.glTarget)}var Ha,Wa,Xa,Ya=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuBuffer=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:e.gpuBuffer.indirects,glTarget:e.gpuBuffer.glTarget,glBuffer:e.gpuBuffer.glBuffer,glOffset:t.offset}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&_.INDIRECT&&(this._indirectBuffer=new lt),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,indirects:[],glTarget:0,glBuffer:null,glOffset:0},t.usage&_.INDIRECT&&(this._gpuBuffer.indirects=this._indirectBuffer.drawInfos),function(t,e){var i=t.gl,r=t.stateCache,n=e.memUsage&y.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;if(e.usage&_.VERTEX){e.glTarget=i.ARRAY_BUFFER;var s=i.createBuffer();s&&(e.glBuffer=s,e.size>0&&(t.useVAO&&r.glVAO&&(i.bindVertexArray(null),r.glVAO=Fa.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),i.bufferData(i.ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&_.INDEX){e.glTarget=i.ELEMENT_ARRAY_BUFFER;var a=i.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.useVAO&&r.glVAO&&(i.bindVertexArray(null),r.glVAO=Fa.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else if(e.usage&_.UNIFORM){e.glTarget=i.UNIFORM_BUFFER;var o=i.createBuffer();o&&e.size>0&&(e.glBuffer=o,t.stateCache.glUniformBuffer!==e.glBuffer&&(i.bindBuffer(i.UNIFORM_BUFFER,e.glBuffer),t.stateCache.glUniformBuffer=e.glBuffer),i.bufferData(i.UNIFORM_BUFFER,e.size,n),i.bindBuffer(i.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null)}else e.usage&_.INDIRECT||e.usage&_.TRANSFER_DST||e.usage&_.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize+=this._size;return!0},i.destroy=function(){this._gpuBuffer&&(this._isBufferView||(function(t,e){var i=t.gl;if(e.glBuffer){switch(e.glTarget){case i.ARRAY_BUFFER:t.useVAO&&t.stateCache.glVAO&&(i.bindVertexArray(null),t.stateCache.glVAO=Fa.gpuInputAssembler=null),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null;break;case i.ELEMENT_ARRAY_BUFFER:t.useVAO&&t.stateCache.glVAO&&(i.bindVertexArray(null),t.stateCache.glVAO=Fa.gpuInputAssembler=null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null;break;case i.UNIFORM_BUFFER:i.bindBuffer(i.UNIFORM_BUFFER,null),t.stateCache.glUniformBuffer=null}i.deleteBuffer(e.glBuffer),e.glBuffer=null}}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize-=this._size),this._gpuBuffer=null)},i.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e,i,r,n,s,a=this._size;a!==t&&(this._size=t,this._count=this._size/this._stride,this._gpuBuffer&&(this._gpuBuffer.size=t,t>0&&(e=this._device,i=this._gpuBuffer,r=e.gl,n=e.stateCache,s=i.memUsage&y.HOST?r.DYNAMIC_DRAW:r.STATIC_DRAW,i.usage&_.VERTEX?(e.useVAO&&n.glVAO&&(r.bindVertexArray(null),n.glVAO=Fa.gpuInputAssembler=null),n.glArrayBuffer!==i.glBuffer&&r.bindBuffer(r.ARRAY_BUFFER,i.glBuffer),i.buffer?r.bufferData(r.ARRAY_BUFFER,i.buffer,s):r.bufferData(r.ARRAY_BUFFER,i.size,s),r.bindBuffer(r.ARRAY_BUFFER,null),n.glArrayBuffer=null):i.usage&_.INDEX?(e.useVAO&&n.glVAO&&(r.bindVertexArray(null),n.glVAO=Fa.gpuInputAssembler=null),e.stateCache.glElementArrayBuffer!==i.glBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glBuffer),i.buffer?r.bufferData(r.ELEMENT_ARRAY_BUFFER,i.buffer,s):r.bufferData(r.ELEMENT_ARRAY_BUFFER,i.size,s),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),e.stateCache.glElementArrayBuffer=null):i.usage&_.UNIFORM?(e.stateCache.glUniformBuffer!==i.glBuffer&&r.bindBuffer(r.UNIFORM_BUFFER,i.glBuffer),r.bufferData(r.UNIFORM_BUFFER,i.size,s),r.bindBuffer(r.UNIFORM_BUFFER,null),e.stateCache.glUniformBuffer=null):(i.usage&_.INDIRECT||i.usage&_.TRANSFER_DST||i.usage&_.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),i.glTarget=r.NONE),this._device.memoryStatus.bufferSize-=a,this._device.memoryStatus.bufferSize+=t)))}},i.update=function(t,e){var i;this._isBufferView?console.warn("cannot update through buffer views!"):(i=void 0!==e?e:this._usage&_.INDIRECT?0:t.byteLength,La(this._device,this._gpuBuffer,t,0,i))},Be(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}}]),e}(s),ja=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new r(e);for(var i=0;i<e;++i)this._frees[i]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,i=this._frees;this._frees=new Array(e);for(var r=e-i.length,n=0;n<r;++n)this._frees[n]=new t;for(var s=r,a=0;s<e;++s,++a)this._frees[s]=i[a];this._freeIdx+=r}var o=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++o.refCount,o},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),Ka=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new ja(Oa,1),this.bindStatesCmdPool=new ja(Pa,1),this.drawCmdPool=new ja(Da,1),this.updateBufferCmdPool=new ja(Ma,1),this.copyBufferToTextureCmdPool=new ja(Ba,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),qa=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).cmdPackage=new Ia,e._webGLAllocator=null,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUDescriptorSets=[],e._curGPUInputAssembler=null,e._curDynamicOffsets=Array(8).fill(0),e._curDynamicStates=new zt,e._isStateInvalied=!1,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._type=t.type,this._queue=t.queue,this._webGLAllocator=this._device.cmdAllocator;for(var e=this._device.bindingMappingInfo.bufferOffsets.length,i=0;i<e;i++)this._curGPUDescriptorSets.push(null);return!0},i.destroy=function(){this._webGLAllocator&&(this._webGLAllocator.clearCmds(this.cmdPackage),this._webGLAllocator=null)},i.begin=function(){this._webGLAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},i.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},i.beginRenderPass=function(t,e,i,r,n,s){var a=this._webGLAllocator.beginRenderPassCmdPool.alloc(Oa);a.gpuRenderPass=t.gpuRenderPass,a.gpuFramebuffer=e.gpuFramebuffer,a.renderArea=i;for(var o=0;o<r.length;++o)a.clearColors[o]=r[o];a.clearDepth=n,a.clearStencil=s,this.cmdPackage.beginRenderPassCmds.push(a),this.cmdPackage.cmds.push(Aa.BEGIN_RENDER_PASS),this._isInRenderPass=!0},i.endRenderPass=function(){this._isInRenderPass=!1},i.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},i.bindDescriptorSet=function(t,e,i){var r=e.gpuDescriptorSet;if(r!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=r,this._isStateInvalied=!0),i){var n,s=null===(n=this._curGPUPipelineState)||void 0===n?void 0:n.gpuPipelineLayout;if(s){for(var a=this._curDynamicOffsets,o=s.dynamicOffsetOffsets[t],l=0;l<i.length;l++)a[o+l]=i[l];this._isStateInvalied=!0}}},i.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},i.setViewport=function(t){var e=this._curDynamicStates.viewport;e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height&&e.minDepth===t.minDepth&&e.maxDepth===t.maxDepth||(e.left=t.left,e.top=t.top,e.width=t.width,e.height=t.height,e.minDepth=t.minDepth,e.maxDepth=t.maxDepth,this._isStateInvalied=!0)},i.setScissor=function(t){var e=this._curDynamicStates.scissor;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._isStateInvalied=!0)},i.setLineWidth=function(t){this._curDynamicStates.lineWidth!==t&&(this._curDynamicStates.lineWidth=t,this._isStateInvalied=!0)},i.setDepthBias=function(t,e,i){var r=this._curDynamicStates;r.depthBiasConstant===t&&r.depthBiasClamp===e&&r.depthBiasSlope===i||(r.depthBiasConstant=t,r.depthBiasClamp=e,r.depthBiasSlope=i,this._isStateInvalied=!0)},i.setBlendConstants=function(t){var e=this._curDynamicStates.blendConstant;e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w||(e.copy(t),this._isStateInvalied=!0)},i.setDepthBound=function(t,e){var i=this._curDynamicStates;i.depthMinBounds===t&&i.depthMaxBounds===e||(i.depthMinBounds=t,i.depthMaxBounds=e,this._isStateInvalied=!0)},i.setStencilWriteMask=function(t,e){var i=this._curDynamicStates.stencilStatesFront,r=this._curDynamicStates.stencilStatesBack;t&U.FRONT&&i.writeMask!==e&&(i.writeMask=e,this._isStateInvalied=!0),t&U.BACK&&r.writeMask!==e&&(r.writeMask=e,this._isStateInvalied=!0)},i.setStencilCompareMask=function(t,e,i){var r=this._curDynamicStates.stencilStatesFront,n=this._curDynamicStates.stencilStatesBack;t&U.FRONT&&(r.compareMask===i&&r.reference===e||(r.reference=e,r.compareMask=i,this._isStateInvalied=!0)),t&U.BACK&&(n.compareMask===i&&n.reference===e||(n.reference=e,n.compareMask=i,this._isStateInvalied=!0))},i.draw=function(t){if(this._type===H.PRIMARY&&this._isInRenderPass||this._type===H.SECONDARY){this._isStateInvalied&&this.bindStates();var e=this._webGLAllocator.drawCmdPool.alloc(Da);e.drawInfo.vertexCount=t.vertexCount,e.drawInfo.firstVertex=t.firstVertex,e.drawInfo.indexCount=t.indexCount,e.drawInfo.firstIndex=t.firstIndex,e.drawInfo.vertexOffset=t.vertexOffset,e.drawInfo.instanceCount=t.instanceCount,e.drawInfo.firstInstance=t.firstInstance,this.cmdPackage.drawCmds.push(e),this.cmdPackage.cmds.push(Aa.DRAW),++this._numDrawCalls,this._numInstances+=t.instanceCount;var i=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i){if(this._type===H.PRIMARY&&!this._isInRenderPass||this._type===H.SECONDARY){var r=t.gpuBuffer;if(r){var n,s=this._webGLAllocator.updateBufferCmdPool.alloc(Ma),a=0;t.usage&_.INDIRECT||(a=void 0!==i?i:e.byteLength),n=e,s.gpuBuffer=r,s.buffer=n,s.offset=0,s.size=a,this.cmdPackage.updateBufferCmds.push(s),this.cmdPackage.cmds.push(Aa.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},i.copyBuffersToTexture=function(t,e,i){if(this._type===H.PRIMARY&&!this._isInRenderPass||this._type===H.SECONDARY){var r=e.gpuTexture;if(r){var n=this._webGLAllocator.copyBufferToTextureCmdPool.alloc(Ba);n.gpuTexture=r,n.regions=i,n.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(n),this.cmdPackage.cmds.push(Aa.COPY_BUFFER_TO_TEXTURE)}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},i.execute=function(t,e){for(var i=0;i<e;++i){for(var r=t[i],n=0;n<r.cmdPackage.beginRenderPassCmds.length;++n){var s=r.cmdPackage.beginRenderPassCmds.array[n];++s.refCount,this.cmdPackage.beginRenderPassCmds.push(s)}for(var a=0;a<r.cmdPackage.bindStatesCmds.length;++a){var o=r.cmdPackage.bindStatesCmds.array[a];++o.refCount,this.cmdPackage.bindStatesCmds.push(o)}for(var l=0;l<r.cmdPackage.drawCmds.length;++l){var h=r.cmdPackage.drawCmds.array[l];++h.refCount,this.cmdPackage.drawCmds.push(h)}for(var u=0;u<r.cmdPackage.updateBufferCmds.length;++u){var c=r.cmdPackage.updateBufferCmds.array[u];++c.refCount,this.cmdPackage.updateBufferCmds.push(c)}for(var p=0;p<r.cmdPackage.copyBufferToTextureCmds.length;++p){var d=r.cmdPackage.copyBufferToTextureCmds.array[p];++d.refCount,this.cmdPackage.copyBufferToTextureCmds.push(d)}this.cmdPackage.cmds.concat(r.cmdPackage.cmds.array),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.pipelineBarrier=function(){},i.bindStates=function(){var t=this._webGLAllocator.bindStatesCmdPool.alloc(Pa);t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets),t.gpuInputAssembler=this._curGPUInputAssembler,t.dynamicStates=this._curDynamicStates,this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(Aa.BIND_STATES),this._isStateInvalied=!1},Be(e,[{key:"webGLDevice",get:function(){return this._device}}]),e}(a),Za=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuFramebuffer=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null,0!==t.depthStencilMipmapLevel&&console.warn("The mipmap level of th texture image to be attached of depth stencil attachment should be 0. Convert to 0.");for(var e=0;e<t.colorMipmapLevels.length;++e)0!==t.colorMipmapLevels[e]&&console.warn("The mipmap level of th texture image to be attached of color attachment "+e+" should be 0. Convert to 0.");for(var i=[],r=0;r<t.colorTextures.length;r++){var n=t.colorTextures[r];n&&i.push(n.gpuTexture)}var s=null;return t.depthStencilTexture&&(s=t.depthStencilTexture.gpuTexture),this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:i,gpuDepthStencilTexture:s,glFramebuffer:null},function(t,e){if(e.gpuColorTextures.length||e.gpuDepthStencilTexture){var i=t.gl,r=[],n=i.createFramebuffer();if(n){e.glFramebuffer=n,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var s=0;s<e.gpuColorTextures.length;++s){var a=e.gpuColorTextures[s];a&&(a.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,a.glTarget,a.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+s,i.RENDERBUFFER,a.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+s))}var o=e.gpuDepthStencilTexture;if(o){var l=Xt[o.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;o.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,l,o.glTarget,o.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,o.glRenderbuffer)}i.drawBuffers(r);var h=i.checkFramebufferStatus(i.FRAMEBUFFER);if(h!==i.FRAMEBUFFER_COMPLETE)switch(h){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}}(this._device,this._gpuFramebuffer),!0},i.destroy=function(){var t,e;this._gpuFramebuffer&&(t=this._device,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),e.glFramebuffer=null),this._gpuFramebuffer=null)},Be(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(ie),Ja=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuInputAssembler=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){if(0===t.vertexBuffers.length)return console.error("InputAssemblerInfo.vertexBuffers is null."),!1;if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._firstIndex=0;else{var e=this._vertexBuffers[0];this._vertexCount=e.size/e.stride,this._firstVertex=0,this._vertexOffset=0}this._instanceCount=0,this._firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var i=new Array(t.vertexBuffers.length),r=0;r<t.vertexBuffers.length;++r){var n=t.vertexBuffers[r];n.gpuBuffer&&(i[r]=n.gpuBuffer)}var s=null,a=0;if(t.indexBuffer&&(s=t.indexBuffer.gpuBuffer))switch(s.stride){case 1:a=5121;break;case 2:a=5123;break;case 4:a=5125;break;default:console.error("Illegal index buffer stride.")}var o=null;return t.indirectBuffer&&(o=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:i,gpuIndexBuffer:s,gpuIndirectBuffer:o,glAttribs:[],glIndexType:a,glVAOs:new Map},function(t,e){var i=t.gl;e.glAttribs=new Array(e.attributes.length);for(var r=[0,0,0,0,0,0,0,0],n=0;n<e.attributes.length;++n){var s=e.attributes[n],a=void 0!==s.stream?s.stream:0,o=e.gpuVertexBuffers[a],l=ga(s.format,i),h=Xt[s.format].size;e.glAttribs[n]={name:s.name,glBuffer:o.glBuffer,glType:l,size:h,count:Xt[s.format].count,stride:o.stride,componentCount:Ta(l,i),isNormalized:void 0!==s.isNormalized&&s.isNormalized,isInstanced:void 0!==s.isInstanced&&s.isInstanced,offset:r[a]},r[a]+=h}}(this._device,this._gpuInputAssembler),!0},i.destroy=function(){var t=this._device;this._gpuInputAssembler&&t.useVAO&&function(t,e){for(var i=e.glVAOs.values(),r=i.next();!r.done;)t.gl.deleteVertexArray(r.value),r=i.next();e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},Be(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(re),Qa=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSetLayout=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,i=-1,r=[],n=0;n<this._bindings.length;n++){var s=this._bindings[n];r.push(e),e+=s.count,s.binding>i&&(i=s.binding)}this._bindingIndices=Array(i+1).fill(-1);for(var a=this._descriptorIndices=Array(i+1).fill(-1),o=0;o<this._bindings.length;o++){var l=this._bindings[o];this._bindingIndices[l.binding]=o,a[l.binding]=r[o]}for(var h=[],u=0;u<this._bindings.length;u++){var c=this._bindings[u];if(c.descriptorType&Kt)for(var p=0;p<c.count;p++)h.push(c.binding)}return this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:h,descriptorIndices:a,descriptorCount:e},!0},i.destroy=function(){this._bindings.length=0},Be(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(ne),$a=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineLayout=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],i=[],r=0,n=[],s=0;s<this._setLayouts.length;s++){for(var a=this._setLayouts[s],o=a.gpuDescriptorSetLayout.dynamicBindings,l=Array(a.bindingIndices.length).fill(-1),h=0;h<o.length;h++){var u=o[h];l[u]<0&&(l[u]=r+h)}i.push(a.gpuDescriptorSetLayout),e.push(l),n.push(r),r+=o.length}return this._gpuPipelineLayout={gpuSetLayouts:i,dynamicOffsetIndices:e,dynamicOffsetCount:r,dynamicOffsetOffsets:n},!0},i.destroy=function(){this._setLayouts.length=0},Be(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(se),to=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],eo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineState=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var i=t.blendState,r=i.targets;r&&r.forEach((function(t,i){e.setTarget(i,t)})),void 0!==i.isA2C&&(e.isA2C=i.isA2C),void 0!==i.isIndepend&&(e.isIndepend=i.isIndepend),void 0!==i.blendColor&&(e.blendColor=i.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var n=[],s=0;s<31;s++)this._dynamicStates&1<<s&&n.push(1<<s);return this._gpuPipelineState={glPrimitive:to[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:n},!0},i.destroy=function(){this._gpuPipelineState=null},Be(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(ce),io=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.beginRenderPass=function(t,e,i,r,n,s){ka(this._device,t.gpuRenderPass,e.gpuFramebuffer,i,r,n,s),this._isInRenderPass=!0},i.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates(),Ga(this._device,t),++this._numDrawCalls,this._numInstances+=t.instanceCount;var e=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=e/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(e-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var r,n=t.gpuBuffer;n&&(r=void 0!==i?i:t.usage&_.INDIRECT?0:e.byteLength,La(this._device,n,e,0,r))}},i.copyBuffersToTexture=function(t,e,i){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var r=e.gpuTexture;r&&Va(this._device,t,r,i)}},i.execute=function(t,e){for(var i=0;i<e;++i){var r=t[i];za(this._device,r.cmdPackage),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.bindStates=function(){Na(this._device,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},e}(qa),ro=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){return this._type=t.type,!0},i.destroy=function(){},i.submit=function(t){if(!this._isAsync)for(var e=0;e<t.length;e++){var i=t[e];this.numDrawCalls+=i.numDrawCalls,this.numInstances+=i.numInstances,this.numTris+=i.numTris}},i.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(pe),no=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuRenderPass=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){return this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,t.subpasses&&(this._subpasses=t.subpasses),this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash(),!0},i.destroy=function(){this._gpuRenderPass=null},Be(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(de),so=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuSampler=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){var e,i,r,n;return this._minFilter=t.minFilter,this._magFilter=t.magFilter,this._mipFilter=t.mipFilter,this._addressU=t.addressU,this._addressV=t.addressV,this._addressW=t.addressW,this._maxAnisotropy=t.maxAnisotropy,this._cmpFunc=t.cmpFunc,this._borderColor=t.borderColor,this._mipLODBias=t.mipLODBias,this._gpuSampler={glSampler:null,minFilter:this._minFilter,magFilter:this._magFilter,mipFilter:this._mipFilter,addressU:this._addressU,addressV:this._addressV,addressW:this._addressW,glMinFilter:0,glMagFilter:0,glWrapS:0,glWrapT:0,glWrapR:0},e=this._device,i=this._gpuSampler,(n=(r=e.gl).createSampler())&&(i.minFilter===A.LINEAR||i.minFilter===A.ANISOTROPIC?i.mipFilter===A.LINEAR||i.mipFilter===A.ANISOTROPIC?i.glMinFilter=r.LINEAR_MIPMAP_LINEAR:i.mipFilter===A.POINT?i.glMinFilter=r.LINEAR_MIPMAP_NEAREST:i.glMinFilter=r.LINEAR:i.mipFilter===A.LINEAR||i.mipFilter===A.ANISOTROPIC?i.glMinFilter=r.NEAREST_MIPMAP_LINEAR:i.mipFilter===A.POINT?i.glMinFilter=r.NEAREST_MIPMAP_NEAREST:i.glMinFilter=r.NEAREST,i.magFilter===A.LINEAR||i.magFilter===A.ANISOTROPIC?i.glMagFilter=r.LINEAR:i.glMagFilter=r.NEAREST,i.glWrapS=da[i.addressU],i.glWrapT=da[i.addressV],i.glWrapR=da[i.addressW],i.glSampler=n,r.samplerParameteri(n,r.TEXTURE_MIN_FILTER,i.glMinFilter),r.samplerParameteri(n,r.TEXTURE_MAG_FILTER,i.glMagFilter),r.samplerParameteri(n,r.TEXTURE_WRAP_S,i.glWrapS),r.samplerParameteri(n,r.TEXTURE_WRAP_T,i.glWrapT),r.samplerParameteri(n,r.TEXTURE_WRAP_R,i.glWrapR),r.samplerParameterf(n,r.TEXTURE_MIN_LOD,0),r.samplerParameterf(n,r.TEXTURE_MAX_LOD,1e3)),!0},i.destroy=function(){var t,e;this._gpuSampler&&(t=this._device,(e=this._gpuSampler).glSampler&&(t.gl.deleteSampler(e.glSampler),e.glSampler=null),this._gpuSampler=null)},Be(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(fe),ao=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuShader=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks,samplerTextures:t.samplerTextures,gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var e=0;e<t.stages.length;++e){var i=t.stages[e];this._gpuShader.gpuStages[e]={type:i.stage,source:i.source,glShader:null}}return function(t,e){for(var i=t.gl,r=function(t){var r=e.gpuStages[t],n=0,s="",a=1;switch(r.type){case P.VERTEX:s="VertexShader",n=i.VERTEX_SHADER;break;case P.FRAGMENT:s="FragmentShader",n=i.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var o=i.createShader(n);if(o&&(r.glShader=o,i.shaderSource(r.glShader,"#version 300 es\n"+r.source),i.compileShader(r.glShader),!i.getShaderParameter(r.glShader,i.COMPILE_STATUS))){console.error(s+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",r.source.replace(/^|\n/g,(function(){return"\n"+a+++" "}))),console.error(i.getShaderInfoLog(r.glShader));for(var l=0;l<e.gpuStages.length;l++){var h=e.gpuStages[t];h.glShader&&(i.deleteShader(h.glShader),h.glShader=null)}return{v:void 0}}},n=0;n<e.gpuStages.length;n++){var s=r(n);if("object"==typeof s)return s.v}var a=i.createProgram();if(a){e.glProgram=a;for(var o=0;o<e.gpuStages.length;o++){var l=e.gpuStages[o];i.attachShader(e.glProgram,l.glShader)}i.linkProgram(e.glProgram);for(var h=0;h<e.gpuStages.length;h++){var u=e.gpuStages[h];u.glShader&&(i.detachShader(e.glProgram,u.glShader),i.deleteShader(u.glShader),u.glShader=null)}if(!i.getProgramParameter(e.glProgram,i.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(i.getProgramInfoLog(e.glProgram));console.info("Shader '"+e.name+"' compilation succeeded.");var c=i.getProgramParameter(e.glProgram,i.ACTIVE_ATTRIBUTES);e.glInputs=new Array(c);for(var p=0;p<c;++p){var d=i.getActiveAttrib(e.glProgram,p);if(d){var f,_=d.name.indexOf("[");f=-1!==_?d.name.substr(0,_):d.name;var g=i.getAttribLocation(e.glProgram,f),m=ba(d.type,i),y=Sa(d.type,i);e.glInputs[p]={name:f,type:m,stride:y,count:d.size,size:y*d.size,glType:d.type,glLoc:g}}}var v,b,S,T,A=i.getProgramParameter(e.glProgram,i.ACTIVE_UNIFORM_BLOCKS);if(A){e.glBlocks=new Array(A);for(var E=0;E<A;++E){var C=(v=i.getActiveUniformBlockName(e.glProgram,E)).indexOf("[");-1!==C&&(v=v.substr(0,C)),T=null;for(var R=0;R<e.blocks.length;R++)if(e.blocks[R].name===v){T=e.blocks[R];break}if(T){b=E,S=i.getActiveUniformBlockParameter(e.glProgram,b,i.UNIFORM_BLOCK_DATA_SIZE);var w=T.binding+(t.bindingMappingInfo.bufferOffsets[T.set]||0);i.uniformBlockBinding(e.glProgram,b,w),e.glBlocks[E]={set:T.set,binding:T.binding,idx:b,name:v,size:S,glBinding:w}}else Le("Block '"+v+"' does not bound")}}if(e.samplerTextures.length>0){e.glSamplerTextures=new Array(e.samplerTextures.length);for(var x=0;x<e.samplerTextures.length;++x){var O=e.samplerTextures[x];e.glSamplerTextures[x]={set:O.set,binding:O.binding,name:O.name,type:O.type,count:O.count,units:[],glUnits:null,glType:va(O.type,i),glLoc:null}}}for(var D=[],M=[],B=t.stateCache.texUnitCacheMap,I=0,L=0;L<e.blocks.length;++L)e.blocks[L].set===t.bindingMappingInfo.flexibleSet&&I++;for(var F=0,k=0;k<e.samplerTextures.length;++k){var N=e.samplerTextures[k],G=i.getUniformLocation(e.glProgram,N.name);if(null===G||"number"!=typeof G&&-1===G.id||(D.push(e.glSamplerTextures[k]),M.push(G)),void 0===B[N.name]){var U=N.binding+t.bindingMappingInfo.samplerOffsets[N.set]+F;N.set===t.bindingMappingInfo.flexibleSet&&(U-=I),B[N.name]=U%t.capabilities.maxTextureUnits,F+=N.count-1}}if(D.length){for(var z=[],V=0;V<D.length;++V){var H=D[V],W=B[H.name];if(void 0!==W){H.glLoc=M[V];for(var X=0;X<H.count;++X){for(;z[W];)W=(W+1)%t.capabilities.maxTextureUnits;H.units.push(W),z[W]=!0}}}for(var Y=0,j=0;j<D.length;++j){var K=D[j];if(!K.glLoc){for(K.glLoc=M[j];z[Y];)Y++;for(var q=0;q<K.count;++q){for(;z[Y];)Y=(Y+1)%t.capabilities.maxTextureUnits;void 0===B[K.name]&&(B[K.name]=Y),K.units.push(Y),z[Y]=!0}}}t.stateCache.glProgram!==e.glProgram&&i.useProgram(e.glProgram);for(var Z=0;Z<D.length;Z++){var J=D[Z];J.glUnits=new Int32Array(J.units),i.uniform1iv(J.glLoc,J.glUnits)}t.stateCache.glProgram!==e.glProgram&&i.useProgram(t.stateCache.glProgram)}e.glSamplerTextures=D}}(this._device,this._gpuShader),!0},i.destroy=function(){var t,e;this._gpuShader&&(t=this._device,(e=this._gpuShader).glProgram&&(t.gl.deleteProgram(e.glProgram),e.glProgram=null),this._gpuShader=null)},Be(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(_e),oo=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glUniformBuffer=null,this.glBindUBOs=[],this.glBindUBOOffsets=[],this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glSamplerUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.glReadFramebuffer=null,this.viewport=new et,this.scissorRect=new K(0,0,0,0),this.rs=new ae,this.dss=new oe,this.bs=new he,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e,i){for(var r=0;r<t;++r)this.glTexUnits.push({glTexture:null});this.glSamplerUnits.length=t,this.glSamplerUnits.fill(null),this.glBindUBOs.length=e,this.glBindUBOs.fill(null),this.glBindUBOOffsets.length=e,this.glBindUBOOffsets.fill(0),this.glEnabledAttribLocs.length=i,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=i,this.glCurrentAttribLocs.fill(!1)},t}(),lo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuTexture=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){return"texture"in t?(console.log("WebGL2 does not support texture view."),!1):(this._type=t.type,this._usage=t.usage,this._format=t.format,this._width=t.width,this._height=t.height,this._depth=t.depth,this._layerCount=t.layerCount,this._levelCount=t.levelCount,this._samples=t.samples,this._flags=t.flags,this._isPowerOf2=Zt(this._width)&&Zt(this._height),this._size=Qt(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0},function(t,e){var i=t.gl;e.glInternalFmt=ma(e.format,i),e.glFormat=ya(e.format,i),e.glType=ga(e.format,i);var r=e.width,n=e.height;switch(e.type){case v.TEX2D:e.glTarget=i.TEXTURE_2D;var s=Math.max(r,n);if(s>t.capabilities.maxTextureSize&&Ie(9100,s,t.capabilities.maxTextureSize),e.samples===T.X1){var a=i.createTexture();if(a&&e.size>0){e.glTexture=a;var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),e.glInternalFmt===gs.COMPRESSED_RGB_ETC1_WEBGL){var l=Jt(e.format,2,2,1),h=new Uint8Array(l);i.compressedTexImage2D(i.TEXTURE_2D,0,e.glInternalFmt,2,2,0,h)}else if(e.flags&S.IMMUTABLE)i.texStorage2D(i.TEXTURE_2D,e.mipLevel,e.glInternalFmt,r,n);else if(Xt[e.format].isCompressed)for(var u=0;u<e.mipLevel;++u){var c=Jt(e.format,r,n,1),p=new Uint8Array(c);i.compressedTexImage2D(i.TEXTURE_2D,u,e.glInternalFmt,r,n,0,p),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else for(var d=0;d<e.mipLevel;++d)i.texImage2D(i.TEXTURE_2D,d,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else i.deleteTexture(a)}else{var f=i.createRenderbuffer();f&&e.size>0&&(e.glRenderbuffer=f,t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,fa[e.samples],e.glInternalFmt,e.width,e.height))}break;case v.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var _=Math.max(r,n);_>t.capabilities.maxCubeMapTextureSize&&Ie(9100,_,t.capabilities.maxTextureSize);var g=i.createTexture();if(g&&e.size>0){e.glTexture=g;var m=t.stateCache.glTexUnits[t.stateCache.texUnit];if(m.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),m.glTexture=e.glTexture),e.glInternalFmt===gs.COMPRESSED_RGB_ETC1_WEBGL)for(var y=0;y<6;++y){var b=Jt(e.format,2,2,1),A=new Uint8Array(b);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,e.glInternalFmt,2,2,0,A)}else if(e.flags&S.IMMUTABLE)i.texStorage2D(i.TEXTURE_CUBE_MAP,e.mipLevel,e.glInternalFmt,r,n);else if(Xt[e.format].isCompressed)for(var E=0;E<e.mipLevel;++E){for(var C=Jt(e.format,r,n,1),R=new Uint8Array(C),w=0;w<6;++w)i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+w,E,e.glInternalFmt,r,n,0,R);r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else for(var x=0;x<e.mipLevel;++x){for(var O=0;O<6;++O)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+O,x,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null);r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=v.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize+=this._size,!0)},i.destroy=function(){var t,e;this._gpuTexture&&(t=this._device,(e=this._gpuTexture).glTexture&&(t.gl.deleteTexture(e.glTexture),e.glTexture=null),e.glRenderbuffer&&(t.gl.deleteRenderbuffer(e.glRenderbuffer),e.glRenderbuffer=null),this._device.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},i.resize=function(t,e){var i=this._size;this._width=t,this._height=e,this._size=Qt(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=e,this._gpuTexture.size=this._size,function(t,e){var i=t.gl;e.glInternalFmt=ma(e.format,i),e.glFormat=ya(e.format,i),e.glType=ga(e.format,i);var r=e.width,n=e.height;switch(e.type){case v.TEX2D:e.glTarget=i.TEXTURE_2D;var s=Math.max(r,n);if(s>t.capabilities.maxTextureSize&&Ie(9100,s,t.capabilities.maxTextureSize),e.samples===T.X1){var a=t.stateCache.glTexUnits[t.stateCache.texUnit];if(a.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),a.glTexture=e.glTexture),Xt[e.format].isCompressed){if(e.glInternalFmt!==gs.COMPRESSED_RGB_ETC1_WEBGL)for(var o=0;o<e.mipLevel;++o){var l=Jt(e.format,r,n,1),h=new Uint8Array(l);i.compressedTexImage2D(i.TEXTURE_2D,o,e.glInternalFmt,r,n,0,h),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var u=0;u<e.mipLevel;++u)i.texImage2D(i.TEXTURE_2D,u,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else{var c=i.createRenderbuffer();c&&e.size>0&&(e.glRenderbuffer=c,t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,fa[e.samples],e.glInternalFmt,e.width,e.height))}break;case v.CUBE:e.type=v.CUBE,e.glTarget=i.TEXTURE_CUBE_MAP;var p=Math.max(r,n);p>t.capabilities.maxCubeMapTextureSize&&Ie(9100,p,t.capabilities.maxTextureSize);var d=t.stateCache.glTexUnits[t.stateCache.texUnit];if(d.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),d.glTexture=e.glTexture),Xt[e.format].isCompressed){if(e.glInternalFmt!==gs.COMPRESSED_RGB_ETC1_WEBGL)for(var f=0;f<6;++f){r=e.width,n=e.height;for(var _=0;_<e.mipLevel;++_){var g=Jt(e.format,r,n,1),m=new Uint8Array(g);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+f,_,e.glInternalFmt,r,n,0,m),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}}else for(var y=0;y<6;++y){r=e.width,n=e.height;for(var b=0;b<e.mipLevel;++b)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+y,b,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=v.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize-=i,this._device.memoryStatus.textureSize+=this._size)},Be(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),e}(ge),ho="webglcontextlost",uo=t("WebGL2Device",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).stateCache=new oo,e.cmdAllocator=new Ka,e.nullTex2D=null,e.nullTexCube=null,e._webGL2RC=null,e._isAntialias=!0,e._isPremultipliedAlpha=!0,e._useVAO=!0,e._bindingMappingInfo=new rt,e._webGLContextLostHandler=null,e._extensions=null,e._EXT_texture_filter_anisotropic=null,e._OES_texture_float_linear=null,e._OES_texture_half_float_linear=null,e._EXT_color_buffer_float=null,e._EXT_disjoint_timer_query_webgl2=null,e._WEBGL_compressed_texture_etc1=null,e._WEBGL_compressed_texture_etc=null,e._WEBGL_compressed_texture_pvrtc=null,e._WEBGL_compressed_texture_astc=null,e._WEBGL_compressed_texture_s3tc=null,e._WEBGL_compressed_texture_s3tc_srgb=null,e._WEBGL_debug_renderer_info=null,e._WEBGL_texture_storage_multisample=null,e._WEBGL_debug_shaders=null,e._WEBGL_lose_context=null,e}Me(e,t);var i=e.prototype;return i.initialize=function(t){this._canvas=t.canvasElm,this._isAntialias=t.isAntialias,this._isPremultipliedAlpha=t.isPremultipliedAlpha,this._bindingMappingInfo=t.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);try{var e={alpha:Fe.ENABLE_TRANSPARENT_CANVAS,antialias:this._isAntialias,depth:!0,stencil:!0,premultipliedAlpha:this._isPremultipliedAlpha,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};this._webGL2RC=this._canvas.getContext("webgl2",e)}catch(t){return console.warn(t),!1}if(!this._webGL2RC)return console.warn("This device does not support WebGL2."),!1;this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(ho,this._onWebGLContextLost),this._canvas2D=document.createElement("canvas"),console.info("WebGL2 device initialized."),this._gfxAPI=h.WEBGL2,this._deviceName="WebGL2";var i=this._webGL2RC;this._WEBGL_debug_renderer_info=this.getExtension("WEBGL_debug_renderer_info"),this._WEBGL_debug_renderer_info?(this._renderer=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=i.getParameter(i.RENDERER),this._vendor=i.getParameter(i.VENDOR)),this._version=i.getParameter(i.VERSION),this._caps.maxVertexAttributes=i.getParameter(i.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxUniformBufferBindings=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS),this._caps.maxUniformBlockSize=i.getParameter(i.MAX_UNIFORM_BLOCK_SIZE),this._caps.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.uboOffsetAlignment=i.getParameter(i.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this._caps.depthBits=i.getParameter(i.DEPTH_BITS),this._caps.stencilBits=i.getParameter(i.STENCIL_BITS),this.stateCache.initialize(this._caps.maxTextureUnits,this._caps.maxUniformBufferBindings,this._caps.maxVertexAttributes),this._devicePixelRatio=t.devicePixelRatio||1,this._width=this._canvas.width,this._height=this._canvas.height,this._nativeWidth=Math.max(t.nativeWidth||this._width,0),this._nativeHeight=Math.max(t.nativeHeight||this._height,0),this._colorFmt=p.RGBA8,32===this._caps.depthBits?8===this._caps.stencilBits?this._depthStencilFmt=p.D32F_S8:this._depthStencilFmt=p.D32F:24===this._caps.depthBits?8===this._caps.stencilBits?this._depthStencilFmt=p.D24S8:this._depthStencilFmt=p.D24:8===this._caps.stencilBits?this._depthStencilFmt=p.D16S8:this._depthStencilFmt=p.D16,this._extensions=i.getSupportedExtensions();var r="";if(this._extensions){for(var n,s=ke(this._extensions);!(n=s()).done;)r+=n.value+" ";console.debug("EXTENSIONS: "+r)}this._EXT_texture_filter_anisotropic=this.getExtension("EXT_texture_filter_anisotropic"),this._EXT_color_buffer_float=this.getExtension("EXT_color_buffer_float"),this._EXT_disjoint_timer_query_webgl2=this.getExtension("EXT_disjoint_timer_query_webgl2"),this._OES_texture_float_linear=this.getExtension("OES_texture_float_linear"),this._OES_texture_half_float_linear=this.getExtension("OES_texture_half_float_linear"),this._WEBGL_compressed_texture_etc1=this.getExtension("WEBGL_compressed_texture_etc1"),this._WEBGL_compressed_texture_etc=this.getExtension("WEBGL_compressed_texture_etc"),this._WEBGL_compressed_texture_pvrtc=this.getExtension("WEBGL_compressed_texture_pvrtc"),this._WEBGL_compressed_texture_astc=this.getExtension("WEBGL_compressed_texture_astc"),this._WEBGL_compressed_texture_s3tc=this.getExtension("WEBGL_compressed_texture_s3tc"),this._WEBGL_compressed_texture_s3tc_srgb=this.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this._WEBGL_texture_storage_multisample=this.getExtension("WEBGL_texture_storage_multisample"),this._WEBGL_debug_shaders=this.getExtension("WEBGL_debug_shaders"),this._WEBGL_lose_context=this.getExtension("WEBGL_lose_context"),this._features.fill(!1),this._features[c.TEXTURE_FLOAT]=!0,this._features[c.TEXTURE_HALF_FLOAT]=!0,this._features[c.FORMAT_R11G11B10F]=!0,this._features[c.FORMAT_RGB8]=!0,this._features[c.FORMAT_D16]=!0,this._features[c.FORMAT_D24]=!0,this._features[c.FORMAT_D32F]=!0,this._features[c.FORMAT_D24S8]=!0,this._features[c.FORMAT_D32FS8]=!0,this._features[c.MSAA]=!0,this._features[c.ELEMENT_INDEX_UINT]=!0,this._features[c.INSTANCED_ARRAYS]=!0,this._features[c.MULTIPLE_RENDER_TARGETS]=!0,this._features[c.BLEND_MINMAX]=!0,this._EXT_color_buffer_float&&(this._features[c.COLOR_FLOAT]=!0,this._features[c.COLOR_HALF_FLOAT]=!0),this._OES_texture_float_linear&&(this._features[c.TEXTURE_FLOAT_LINEAR]=!0),this._OES_texture_half_float_linear&&(this._features[c.TEXTURE_HALF_FLOAT_LINEAR]=!0);var a="";this._WEBGL_compressed_texture_etc1&&(this._features[c.FORMAT_ETC1]=!0,a+="etc1 "),this._WEBGL_compressed_texture_etc&&(this._features[c.FORMAT_ETC2]=!0,a+="etc2 "),this._WEBGL_compressed_texture_s3tc&&(this._features[c.FORMAT_DXT]=!0,a+="dxt "),this._WEBGL_compressed_texture_pvrtc&&(this._features[c.FORMAT_PVRTC]=!0,a+="pvrtc "),this._WEBGL_compressed_texture_astc&&(this._features[c.FORMAT_ASTC]=!0,a+="astc "),console.info("RENDERER: "+this._renderer),console.info("VENDOR: "+this._vendor),console.info("VERSION: "+this._version),console.info("DPR: "+this._devicePixelRatio),console.info("SCREEN_SIZE: "+this._width+" x "+this._height),console.info("NATIVE_SIZE: "+this._nativeWidth+" x "+this._nativeHeight),console.info("MAX_VERTEX_ATTRIBS: "+this._caps.maxVertexAttributes),console.info("MAX_VERTEX_UNIFORM_VECTORS: "+this._caps.maxVertexUniformVectors),console.info("MAX_FRAGMENT_UNIFORM_VECTORS: "+this._caps.maxFragmentUniformVectors),console.info("MAX_TEXTURE_IMAGE_UNITS: "+this._caps.maxTextureUnits),console.info("MAX_VERTEX_TEXTURE_IMAGE_UNITS: "+this._caps.maxVertexTextureUnits),console.info("MAX_UNIFORM_BUFFER_BINDINGS: "+this._caps.maxUniformBufferBindings),console.info("MAX_UNIFORM_BLOCK_SIZE: "+this._caps.maxUniformBlockSize),console.info("DEPTH_BITS: "+this._caps.depthBits),console.info("STENCIL_BITS: "+this._caps.stencilBits),console.info("UNIFORM_BUFFER_OFFSET_ALIGNMENT: "+this._caps.uboOffsetAlignment),this._EXT_texture_filter_anisotropic&&console.info("MAX_TEXTURE_MAX_ANISOTROPY_EXT: "+this._EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),console.info("USE_VAO: "+this._useVAO),console.info("COMPRESSED_FORMAT: "+a),this.initStates(i),this._queue=this.createQueue(new kt(V.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Ft(this._queue)),this.nullTex2D=this.createTexture(new ht(v.TEX2D,b.SAMPLED,p.RGBA8,2,2,S.GEN_MIPMAP)),this.nullTexCube=new lo(this),this.nullTexCube.initialize(new ht(v.CUBE,b.SAMPLED,p.RGBA8,2,2,S.GEN_MIPMAP,6));var o=new tt;o.texExtent.width=2,o.texExtent.height=2;var l=new Uint8Array(this.nullTex2D.size);return l.fill(0),this.copyBuffersToTexture([l],this.nullTex2D,[o]),o.texSubres.layerCount=6,this.copyBuffersToTexture([l,l,l,l,l,l],this.nullTexCube,[o]),!0},i.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener(ho,this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._extensions=null,this._webGL2RC=null},i.resize=function(t,e){this._width===t&&this._height===e||(console.info("Resizing device: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._width=t,this._height=e)},i.flushCommands=function(){},i.acquire=function(){this.cmdAllocator.releaseCmds()},i.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},i.createCommandBuffer=function(t){var e=new(t.type===H.PRIMARY?io:qa)(this);return e.initialize(t)?e:null},i.createBuffer=function(t){var e=new Ya(this);return e.initialize(t)?e:null},i.createTexture=function(t){var e=new lo(this);return e.initialize(t)?e:null},i.createSampler=function(t){var e=new so(this);return e.initialize(t)?e:null},i.createDescriptorSet=function(t){var e=new pa(this);return e.initialize(t)?e:null},i.createShader=function(t){var e=new ao(this);return e.initialize(t)?e:null},i.createInputAssembler=function(t){var e=new Ja(this);return e.initialize(t)?e:null},i.createRenderPass=function(t){var e=new no(this);return e.initialize(t)?e:null},i.createFramebuffer=function(t){var e=new Za(this);return e.initialize(t)?e:null},i.createDescriptorSetLayout=function(t){var e=new Qa(this);return e.initialize(t)?e:null},i.createPipelineLayout=function(t){var e=new $a(this);return e.initialize(t)?e:null},i.createPipelineState=function(t){var e=new eo(this);return e.initialize(t)?e:null},i.createQueue=function(t){var e=new ro(this);return e.initialize(t)?e:null},i.createGlobalBarrier=function(t){var e=new me(this);return e.initialize(t)?e:null},i.createTextureBarrier=function(t){var e=new ye(this);return e.initialize(t)?e:null},i.copyBuffersToTexture=function(t,e,i){Va(this,t,e.gpuTexture,i)},i.copyTexImagesToTexture=function(t,e,i){!function(t,e,i,r){var n=t.gl,s=t.stateCache.glTexUnits[t.stateCache.texUnit];s.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),s.glTexture=i.glTexture);var a=0,o=0;switch(i.glTarget){case n.TEXTURE_2D:for(var l=0;l<r.length;l++){var h=r[l];n.texSubImage2D(n.TEXTURE_2D,h.texSubres.mipLevel,h.texOffset.x,h.texOffset.y,i.glFormat,i.glType,e[a++])}break;case n.TEXTURE_CUBE_MAP:for(var u=0;u<r.length;u++){var c=r[u],p=c.texSubres.baseArrayLayer+c.texSubres.layerCount;for(o=c.texSubres.baseArrayLayer;o<p;++o)n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+o,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,i.glFormat,i.glType,e[a++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&S.GEN_MIPMAP&&n.generateMipmap(i.glTarget)}(this,t,e.gpuTexture,i)},i.copyFramebufferToBuffer=function(t,e,i){var r=this._webGL2RC,n=t.gpuFramebuffer,s=n.gpuColorTextures[0].format,a=ya(s,r),o=ga(s,r),l=te(Xt[s]),h=this.stateCache.glFramebuffer;this.stateCache.glFramebuffer!==n.glFramebuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,n.glFramebuffer),this.stateCache.glFramebuffer=n.glFramebuffer);for(var u,c=new l(e),p=ke(i);!(u=p()).done;){var d=u.value,f=d.texExtent.width,_=d.texExtent.height;r.readPixels(d.texOffset.x,d.texOffset.y,f,_,a,o,c)}this.stateCache.glFramebuffer!==h&&(r.bindFramebuffer(r.FRAMEBUFFER,h),this.stateCache.glFramebuffer=h)},i.blitFramebuffer=function(t,e,i,r,n){!function(t,e,i,r,n,s){var a=t.gl;t.stateCache.glReadFramebuffer!==e.glFramebuffer&&(a.bindFramebuffer(a.READ_FRAMEBUFFER,e.glFramebuffer),t.stateCache.glReadFramebuffer=e.glFramebuffer);var o=i.glFramebuffer!==t.stateCache.glFramebuffer;o&&a.bindFramebuffer(a.DRAW_FRAMEBUFFER,i.glFramebuffer);var l=0;e.gpuColorTextures.length>0&&(l|=a.COLOR_BUFFER_BIT),e.gpuDepthStencilTexture&&(l|=a.DEPTH_BUFFER_BIT,Xt[e.gpuDepthStencilTexture.format].hasStencil&&(l|=a.STENCIL_BUFFER_BIT));var h=s===A.LINEAR||s===A.ANISOTROPIC?a.LINEAR:a.NEAREST;a.blitFramebuffer(r.x,r.y,r.x+r.width,r.y+r.height,n.x,n.y,n.x+n.width,n.y+n.height,l,h),o&&a.bindFramebuffer(a.FRAMEBUFFER,t.stateCache.glFramebuffer)}(this,t.gpuFramebuffer,e.gpuFramebuffer,i,r,n)},i.getExtension=function(t){for(var e=["","WEBKIT_","MOZ_"],i=0;i<e.length;++i){var r=this.gl.getExtension(e[i]+t);if(r)return r}return null},i.initStates=function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)},i._onWebGLContextLost=function(t){He(11e3),We(t)},Be(e,[{key:"gl",get:function(){return this._webGL2RC}},{key:"isAntialias",get:function(){return this._isAntialias}},{key:"isPremultipliedAlpha",get:function(){return this._isPremultipliedAlpha}},{key:"useVAO",get:function(){return this._useVAO}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}},{key:"EXT_texture_filter_anisotropic",get:function(){return this._EXT_texture_filter_anisotropic}},{key:"OES_texture_float_linear",get:function(){return this._OES_texture_float_linear}},{key:"EXT_color_buffer_float",get:function(){return this._EXT_color_buffer_float}},{key:"EXT_disjoint_timer_query_webgl2",get:function(){return this._EXT_disjoint_timer_query_webgl2}},{key:"WEBGL_compressed_texture_etc1",get:function(){return this._WEBGL_compressed_texture_etc1}},{key:"WEBGL_compressed_texture_etc",get:function(){return this._WEBGL_compressed_texture_etc}},{key:"WEBGL_compressed_texture_pvrtc",get:function(){return this._WEBGL_compressed_texture_pvrtc}},{key:"WEBGL_compressed_texture_s3tc",get:function(){return this._WEBGL_compressed_texture_s3tc}},{key:"WEBGL_compressed_texture_s3tc_srgb",get:function(){return this._WEBGL_compressed_texture_s3tc_srgb}},{key:"WEBGL_texture_storage_multisample",get:function(){return this._WEBGL_texture_storage_multisample}},{key:"WEBGL_debug_shaders",get:function(){return this._WEBGL_debug_shaders}},{key:"WEBGL_lose_context",get:function(){return this._WEBGL_lose_context}}]),e}(ee));Xe.WebGL2Device=uo,function(t){t.PLAYED="play",t.PAUSED="pause",t.STOPPED="stop",t.SEEKED="seeked",t.ENDED="ended",t.INTERRUPTION_BEGIN="interruptionBegin",t.INTERRUPTION_END="interruptionEnd",t.USER_GESTURE="on_gesture"}(Ha||(Ha={})),function(t){t[t.DOM_AUDIO=0]="DOM_AUDIO",t[t.WEB_AUDIO=1]="WEB_AUDIO",t[t.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",t[t.NATIVE_AUDIO=3]="NATIVE_AUDIO",t[t.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(Wa||(Wa={})),function(t){t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.STOPPED=3]="STOPPED",t[t.INTERRUPTED=4]="INTERRUPTED"}(Xa||(Xa={}));var co,po,fo=0;function _o(t,e){var i;e.invoking||(e.invoking=!0,(i=e.func).call.apply(i,[t].concat(e.args)).then((function(){e.invoking=!1,t._operationQueue.shift(),t._eventTarget.emit(e.id.toString());var i=t._operationQueue[0];i&&_o(t,i)})).catch((function(){})))}function go(t,e,i){var r=i.value;i.value=function(){for(var t=this,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return new Promise((function(e){var n=fo++,s=t;s._operationQueue.push({id:n,func:r,args:i,invoking:!1}),s._eventTarget.once(n.toString(),e),_o(s,s._operationQueue[0])}))}}function mo(t){return new Promise((function(e){var i=t.play();return void 0===i?e():(i.then(e).catch((function(){var i=function(){t.play().catch((function(){})),e()},r=document.getElementById("GameCanvas");null==r||r.addEventListener("touchend",i,{once:!0}),null==r||r.addEventListener("mousedown",i,{once:!0})})),null)}))}var yo,vo,bo,So=function(){function t(t,e){this._domAudio=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._domAudio=t,t.volume=e}var e=t.prototype;return e.play=function(){var t=this;mo(this._domAudio).then((function(){var e;null===(e=t.onPlay)||void 0===e||e.call(t)})).catch((function(){}))},e.stop=function(){this._domAudio.pause()},Be(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb&&this._domAudio.removeEventListener("ended",this._onEndCb),this._onEndCb=t,t&&this._domAudio.addEventListener("ended",t)}}]),t}(),To=(po=function(){function t(t){var e=this;this._domAudio=void 0,this._state=Xa.INIT,this._onHide=void 0,this._onShow=void 0,this._onEnded=void 0,this._eventTarget=new Ke,this._operationQueue=[],this._domAudio=t,this._onHide=function(){e._state===Xa.PLAYING&&e.pause().then((function(){e._state=Xa.INTERRUPTED,e._eventTarget.emit(Ha.INTERRUPTION_BEGIN)})).catch((function(){}))},Xe.game.on(Xe.Game.EVENT_HIDE,this._onHide),this._onShow=function(){e._state===Xa.INTERRUPTED&&e.play().then((function(){e._eventTarget.emit(Ha.INTERRUPTION_END)})).catch((function(){}))},Xe.game.on(Xe.Game.EVENT_SHOW,this._onShow),this._onEnded=function(){e.seek(0).catch((function(){})),e._state=Xa.INIT,e._eventTarget.emit(Ha.ENDED)},this._domAudio.addEventListener("ended",this._onEnded)}var e=t.prototype;return e.destroy=function(){this._onShow&&(Xe.game.off(Xe.Game.EVENT_SHOW,this._onShow),this._onShow=void 0),this._onHide&&(Xe.game.off(Xe.Game.EVENT_HIDE,this._onHide),this._onHide=void 0),this._onEnded&&(this._domAudio.removeEventListener("ended",this._onEnded),this._onEnded=void 0),this._domAudio=void 0},t.load=function(e){return new Promise((function(i){t.loadNative(e).then((function(e){i(new t(e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,i){var r=document.createElement("audio"),n="canplaythrough";Ne.os===Ge.IOS?n="loadedmetadata":Ne.browserType===ze.FIREFOX&&(n="canplay");var s=setTimeout((function(){0===r.readyState?l():o()}),8e3),a=function(){clearTimeout(s),r.removeEventListener(n,o,!1),r.removeEventListener("error",l,!1)},o=function(){a(),e(r)},l=function(){a(),i("load audio failure - "+t)};r.addEventListener(n,o,!1),r.addEventListener("error",l,!1),r.src=t}))},t.loadOneShotAudio=function(e,i){return new Promise((function(r,n){t.loadNative(e).then((function(t){var e=new So(t,i);r(e)})).catch(n)}))},e.seek=function(t){return t=Ye(t,0,this.duration),this._domAudio.currentTime=t,Promise.resolve()},e.play=function(){var t=this;return new Promise((function(e){mo(t._domAudio).then((function(){t._state=Xa.PLAYING,e()})).catch((function(){}))}))},e.pause=function(){return this._domAudio.pause(),this._state=Xa.PAUSED,Promise.resolve()},e.stop=function(){var t=this;return new Promise((function(e){t._domAudio.pause(),t._domAudio.currentTime=0,t._state=Xa.STOPPED,e()}))},e.onInterruptionBegin=function(t){this._eventTarget.on(Ha.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(Ha.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(Ha.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(Ha.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(Ha.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(Ha.ENDED,t)},Be(t,[{key:"src",get:function(){return this._domAudio?this._domAudio.src:""}},{key:"type",get:function(){return Wa.DOM_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._domAudio.loop},set:function(t){this._domAudio.loop=t}},{key:"volume",get:function(){return this._domAudio.volume},set:function(t){t=qe(t),this._domAudio.volume=t}},{key:"duration",get:function(){return this._domAudio.duration}},{key:"currentTime",get:function(){return this._domAudio.currentTime}}]),t}(),je((co=po).prototype,"seek",[go],Object.getOwnPropertyDescriptor(co.prototype,"seek"),co.prototype),je(co.prototype,"play",[go],Object.getOwnPropertyDescriptor(co.prototype,"play"),co.prototype),je(co.prototype,"pause",[go],Object.getOwnPropertyDescriptor(co.prototype,"pause"),co.prototype),je(co.prototype,"stop",[go],Object.getOwnPropertyDescriptor(co.prototype,"stop"),co.prototype),co),Ao=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,Eo=function(){function t(){this._context=void 0,this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}var e=t.prototype;return e.decodeAudioData=function(t){var e=this;return new Promise((function(i){var r=e._context.decodeAudioData(t,(function(t){i(t)}),(function(t){console.error("failed to load Web Audio",t)}));null==r||r.catch((function(){}))}))},e.runContext=function(){var t=this;return new Promise((function(e){var i=t._context;if(!i.resume)return e();if("running"===i.state)return e();if(i.resume().catch((function(){})),"running"!==i.state){var r=document.getElementById("GameCanvas"),n=function(){i.resume().then(e).catch((function(){}))};null==r||r.addEventListener("touchend",n,{once:!0}),null==r||r.addEventListener("mousedown",n,{once:!0})}return null}))},e.createBufferSource=function(t,e){var i=this._context.createBufferSource();return void 0!==t&&(i.buffer=t),void 0!==e&&(i.loop=e),i},e.createGain=function(t){void 0===t&&(t=1);var e=this._context.createGain();return this.setGainValue(e,t),e},e.setGainValue=function(t,e){if(t.gain.setTargetAtTime)try{t.gain.setTargetAtTime(e,this._context.currentTime,0)}catch(i){t.gain.setTargetAtTime(e,this._context.currentTime,.01)}else t.gain.value=e},e.connectContext=function(t){this._context&&t.connect(this._context.destination)},Be(t,[{key:"currentTime",get:function(){return this._context.currentTime}}]),t}();Eo.support=!!Ao,Eo.support&&(bo=new Eo);var Co,Ro,wo,xo,Oo,Po=function(){function t(t,e){this._duration=void 0,this._bufferSourceNode=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._duration=t.duration,this._bufferSourceNode=bo.createBufferSource(t,!1);var i=bo.createGain(e);this._bufferSourceNode.connect(i),bo.connectContext(i)}var e=t.prototype;return e.play=function(){var t=this;bo.runContext().then((function(){var e;t._bufferSourceNode.start(),null===(e=t.onPlay)||void 0===e||e.call(t),window.setTimeout((function(){var e;null===(e=t.onEnd)||void 0===e||e.call(t)}),1e3*t._duration)})).catch((function(){}))},e.stop=function(){this._bufferSourceNode.stop()},Be(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb=t}}]),t}(),Do=(vo=function(){function t(t,e){var i=this;this._src=void 0,this._audioBuffer=void 0,this._sourceNode=void 0,this._gainNode=void 0,this._currentTimer=0,this._volume=1,this._loop=!1,this._startTime=0,this._playTimeOffset=0,this._state=Xa.INIT,this._eventTarget=new Ke,this._operationQueue=[],this._onHide=void 0,this._onShow=void 0,this._audioBuffer=t,this._gainNode=bo.createGain(),bo.connectContext(this._gainNode),this._src=e,this._onHide=function(){i._state===Xa.PLAYING&&i.pause().then((function(){i._state=Xa.INTERRUPTED,i._eventTarget.emit(Ha.INTERRUPTION_BEGIN)})).catch((function(){}))},Xe.game.on(Xe.Game.EVENT_HIDE,this._onHide),this._onShow=function(){i._state===Xa.INTERRUPTED&&i.play().then((function(){i._eventTarget.emit(Ha.INTERRUPTION_END)})).catch((function(){}))},Xe.game.on(Xe.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.destroy=function(){this._audioBuffer&&(this._audioBuffer=void 0),this._onShow&&(Xe.game.off(Xe.Game.EVENT_SHOW,this._onShow),this._onShow=void 0),this._onHide&&(Xe.game.off(Xe.Game.EVENT_HIDE,this._onHide),this._onHide=void 0)},t.load=function(e){return new Promise((function(i){t.loadNative(e).then((function(r){i(new t(r,e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,i){var r=new XMLHttpRequest,n="load audio failed: "+t+", status: ";r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){200===r.status||0===r.status?bo.decodeAudioData(r.response).then((function(t){e(t)})).catch((function(){})):i(new Error(""+n+r.status+"(no response)"))},r.onerror=function(){i(new Error(""+n+r.status+"(error)"))},r.ontimeout=function(){i(new Error(""+n+r.status+"(time out)"))},r.onabort=function(){i(new Error(""+n+r.status+"(abort)"))},r.send(null)}))},t.loadOneShotAudio=function(e,i){return new Promise((function(r,n){t.loadNative(e).then((function(t){var e=new Po(t,i);r(e)})).catch(n)}))},e.seek=function(t){var e=this;return new Promise((function(i){e._playTimeOffset=Ye(t,0,e._audioBuffer.duration),e._state===Xa.PLAYING?e._doPlay().then(i).catch((function(){})):i()}))},e.play=function(){return this._doPlay()},e._doPlay=function(){var t=this;return new Promise((function(e){bo.runContext().then((function(){t._stopSourceNode(),t._sourceNode=bo.createBufferSource(t._audioBuffer,t.loop),t._sourceNode.connect(t._gainNode),t._sourceNode.start(0,t._playTimeOffset),t._state=Xa.PLAYING,t._startTime=bo.currentTime,window.clearTimeout(t._currentTimer),t._currentTimer=window.setTimeout((function e(){t._playTimeOffset=0,t._startTime=bo.currentTime,t.loop?t._currentTimer=window.setTimeout(e,1e3*t._audioBuffer.duration):(t._eventTarget.emit(Ha.ENDED),t._state=Xa.INIT)}),1e3*(t._audioBuffer.duration-t._playTimeOffset)),e()})).catch((function(){}))}))},e._stopSourceNode=function(){try{var t;null===(t=this._sourceNode)||void 0===t||t.stop()}catch(t){}},e.pause=function(){return this._state===Xa.PLAYING&&this._sourceNode?(this._playTimeOffset=(bo.currentTime-this._startTime+this._playTimeOffset)%this._audioBuffer.duration,this._state=Xa.PAUSED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.stop=function(){return this._sourceNode?(this._playTimeOffset=0,this._state=Xa.STOPPED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.onInterruptionBegin=function(t){this._eventTarget.on(Ha.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(Ha.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(Ha.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(Ha.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(Ha.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(Ha.ENDED,t)},Be(t,[{key:"src",get:function(){return this._src}},{key:"type",get:function(){return Wa.WEB_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._sourceNode&&(this._sourceNode.loop=t)}},{key:"volume",get:function(){return this._volume},set:function(t){t=qe(t),this._volume=t,bo.setGainValue(this._gainNode,t)}},{key:"duration",get:function(){return this._audioBuffer.duration}},{key:"currentTime",get:function(){return this._state!==Xa.PLAYING?this._playTimeOffset:(bo.currentTime-this._startTime+this._playTimeOffset)%this._audioBuffer.duration}}]),t}(),je((yo=vo).prototype,"seek",[go],Object.getOwnPropertyDescriptor(yo.prototype,"seek"),yo.prototype),je(yo.prototype,"play",[go],Object.getOwnPropertyDescriptor(yo.prototype,"play"),yo.prototype),je(yo.prototype,"pause",[go],Object.getOwnPropertyDescriptor(yo.prototype,"pause"),yo.prototype),je(yo.prototype,"stop",[go],Object.getOwnPropertyDescriptor(yo.prototype,"stop"),yo.prototype),yo),Mo=function(){function t(t){this._audio=void 0,this._audio=t}var e=t.prototype;return e.play=function(){this._audio.play()},e.stop=function(){this._audio.stop()},Be(t,[{key:"onPlay",get:function(){return this._audio.onPlay},set:function(t){this._audio.onPlay=t}},{key:"onEnd",get:function(){return this._audio.onEnd},set:function(t){this._audio.onEnd=t}}]),t}(),Bo=function(){function t(t){this._player=void 0,this._player=t}t.load=function(e,i){return new Promise((function(r){(null==i?void 0:i.audioLoadMode)!==Wa.DOM_AUDIO&&Eo.support?Do.load(e).then((function(e){r(new t(e))})).catch((function(){})):(Eo.support||He(5201),To.load(e).then((function(e){r(new t(e))})).catch((function(){})))}))};var e=t.prototype;return e.destroy=function(){this._player.destroy()},t.loadNative=function(t,e){return(null==e?void 0:e.audioLoadMode)!==Wa.DOM_AUDIO&&Eo.support?Do.loadNative(t):(Eo.support||He(5201),To.loadNative(t))},t.loadOneShotAudio=function(t,e,i){return new Promise((function(r,n){(null==i?void 0:i.audioLoadMode)!==Wa.DOM_AUDIO&&Eo.support?Do.loadOneShotAudio(t,e).then((function(t){r(new Mo(t))})).catch(n):(Eo.support||He(5201),To.loadOneShotAudio(t,e).then((function(t){r(new Mo(t))})).catch(n))}))},e.seek=function(t){return this._player.seek(t)},e.play=function(){return this._player.play()},e.pause=function(){return this._player.pause()},e.stop=function(){return this._player.stop()},e.onInterruptionBegin=function(t){this._player.onInterruptionBegin(t)},e.offInterruptionBegin=function(t){this._player.offInterruptionBegin(t)},e.onInterruptionEnd=function(t){this._player.onInterruptionEnd(t)},e.offInterruptionEnd=function(t){this._player.offInterruptionEnd(t)},e.onEnded=function(t){this._player.onEnded(t)},e.offEnded=function(t){this._player.offEnded(t)},Be(t,[{key:"src",get:function(){return this._player.src}},{key:"type",get:function(){return this._player.type}},{key:"state",get:function(){return this._player.state}},{key:"loop",get:function(){return this._player.loop},set:function(t){this._player.loop=t}},{key:"volume",get:function(){return this._player.volume},set:function(t){this._player.volume=t}},{key:"duration",get:function(){return this._player.duration}},{key:"currentTime",get:function(){return this._player.currentTime}}]),t}();Bo.maxAudioChannel=24;var Io=t("AudioClip",Ze("cc.AudioClip")((Oo=xo=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_duration",wo,ti(e)),e._loadMode=Wa.UNKNOWN_AUDIO,e._meta=null,e._player=void 0,e.loaded=!1,e}Me(e,t);var i=e.prototype;return i.destroy=function(){var e,i=t.prototype.destroy.call(this);return null===(e=this._player)||void 0===e||e.destroy(),i},i.validate=function(){return!!this._meta},i.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},i.getCurrentTime=function(){return this._player?this._player.currentTime:0},i.getVolume=function(){return this._player?this._player.volume:0},i.getLoop=function(){return!!this._player&&this._player.loop},i.setCurrentTime=function(t){var e;null===(e=this._player)||void 0===e||e.seek(t).catch((function(){}))},i.setVolume=function(t){this._player&&(this._player.volume=t)},i.setLoop=function(t){this._player&&(this._player.loop=t)},i.play=function(){var t;null===(t=this._player)||void 0===t||t.play().catch((function(){}))},i.pause=function(){var t;null===(t=this._player)||void 0===t||t.pause().catch((function(){}))},i.stop=function(){var t;null===(t=this._player)||void 0===t||t.stop().catch((function(){}))},i.playOneShot=function(t){void 0===t&&(t=1),this._nativeAsset&&Bo.loadOneShotAudio(this._nativeAsset.url,t).then((function(t){t.play()})).catch((function(){}))},Be(e,[{key:"_nativeAsset",get:function(){return this._meta},set:function(t){this._meta=t,t?(this.loaded=!0,this._loadMode=t.type,this._player=t.player,this.emit("load")):(this._meta=null,this._loadMode=Wa.UNKNOWN_AUDIO,this._duration=0,this.loaded=!1)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.state:Xa.INIT}}]),e}(Je),xo.AudioType=Wa,wo=je((Ro=Oo).prototype,"_duration",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(Ro.prototype,"_nativeDep",[Qe],Object.getOwnPropertyDescriptor(Ro.prototype,"_nativeDep"),Ro.prototype),Co=Ro))||Co);function Lo(t,e,i,r){var n=new Io;n._nativeUrl=t,n._nativeAsset=e,n._duration=e.duration,r(null,n)}Xe.AudioClip=Io,ii.downloadAudio=function(t,e,i){Bo.load(t,{audioLoadMode:e.audioLoadMode}).then((function(e){var r={player:e,url:t,duration:e.duration,type:e.type};i(null,r)})).catch((function(t){ii.emit("error",t),i(t)}))},ii.register({".mp3":ii.downloadAudio,".ogg":ii.downloadAudio,".wav":ii.downloadAudio,".m4a":ii.downloadAudio}),ri.register({".mp3":Lo,".ogg":Lo,".wav":Lo,".m4a":Lo});var Fo,ko,No,Go,Uo,zo,Vo,Ho,Wo,Xo,Yo,jo,Ko,qo,Zo,Jo,Qo,$o,tl,el,il,rl,nl,sl=new(function(){function t(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}var e=t.prototype;return e._findIndex=function(t,e){return t.findIndex((function(t){return t.audio===e}))},e._tryAddPlaying=function(t,e){var i=this._findIndex(t,e);return i>-1?(t[i].playTime=performance.now(),!1):(t.push({audio:e,playTime:performance.now()}),!0)},e.addPlaying=function(t){if(t instanceof Bo){if(this._tryAddPlaying(this._audioPlayerInfoList,t))return}else this._tryAddPlaying(this._oneShotAudioInfoList,t)},e._tryRemovePlaying=function(t,e){var i=this._findIndex(t,e);return-1!==i&&(ni(t,i),!0)},e.removePlaying=function(t){if(t instanceof Bo){if(this._tryRemovePlaying(this._audioPlayerInfoList,t))return}else this._tryRemovePlaying(this._oneShotAudioInfoList,t)},e.discardOnePlayingIfNeeded=function(){var t;this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<Bo.maxAudioChannel||(this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})):this._audioPlayerInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})),t&&(t.audio.stop(),this.removePlaying(t.audio)))},t}()),al=(Fo=Ze("cc.AudioSource"),ko=ai(),No=oi(),Go=si(Io),Uo=si(Io),zo=li(),Vo=li(),Ho=li(),Wo=hi(),Xo=li(),tl=Fo(Yo=ko(Yo=No(($o=Qo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_clip",Ko,ti(e)),e._player=null,$e(e,"_loop",qo,ti(e)),$e(e,"_playOnAwake",Zo,ti(e)),$e(e,"_volume",Jo,ti(e)),e._cachedCurrentTime=0,e._operationsBeforeLoading=[],e._isLoaded=!1,e._lastSetClip=void 0,e}Me(e,t);var i=e.prototype;return i._syncPlayer=function(){var t=this,e=this._clip;this._isLoaded=!1,e&&this._lastSetClip!==e&&(e._nativeAsset?(this._lastSetClip=e,Bo.load(e._nativeAsset.url,{audioLoadMode:e.loadMode}).then((function(i){t._lastSetClip===e&&(t._isLoaded=!0,t._player&&(t._player.offEnded(),t._player.offInterruptionBegin(),t._player.offInterruptionEnd(),t._player.destroy()),t._player=i,i.onEnded((function(){sl.removePlaying(i)})),i.onInterruptionBegin((function(){sl.removePlaying(i)})),i.onInterruptionEnd((function(){sl.addPlaying(i)})),t._syncStates())})).catch((function(){}))):console.error("Invalid audio clip"))},i.onLoad=function(){this._syncPlayer()},i.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},i.onDisable=function(){this.pause()},i.onDestroy=function(){this.stop()},i.play=function(){var t,e,i=this;this._isLoaded?(sl.discardOnePlayingIfNeeded(),this.state===Xa.PLAYING&&(null===(e=this._player)||void 0===e||e.stop().catch((function(){}))),null===(t=this._player)||void 0===t||t.play().then((function(){sl.addPlaying(i._player)})).catch((function(){}))):this._operationsBeforeLoading.push("play")},i.pause=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.pause().then((function(){sl.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("pause")},i.stop=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.stop().then((function(){sl.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("stop")},i.playOneShot=function(t,e){void 0===e&&(e=1),t._nativeAsset?Bo.loadOneShotAudio(t._nativeAsset.url,this._volume*e,{audioLoadMode:t.loadMode}).then((function(t){sl.discardOnePlayingIfNeeded(),t.onPlay=function(){sl.addPlaying(t)},t.onEnd=function(){sl.removePlaying(t)},t.play()})).catch((function(){})):console.error("Invalid audio clip")},i._syncStates=function(){var t=this;this._player&&this._player.seek(this._cachedCurrentTime).then((function(){t._player&&(t._player.loop=t._loop,t._player.volume=t._volume,t._operationsBeforeLoading.forEach((function(e){var i;null===(i=t[e])||void 0===i||i.call(t)})),t._operationsBeforeLoading.length=0)})).catch((function(){}))},Be(e,[{key:"clip",get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this._syncPlayer())}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._player&&(this._player.loop=t)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"volume",get:function(){return this._volume},set:function(t){Number.isNaN(t)?console.warn("illegal audio volume!"):(t=Ye(t,0,1),this._player?(this._player.volume=t,this._volume=this._player.volume):this._volume=t)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this._cachedCurrentTime},set:function(t){var e;Number.isNaN(t)?console.warn("illegal audio time!"):(t=Ye(t,0,this.duration),this._cachedCurrentTime=t,null===(e=this._player)||void 0===e||e.seek(this._cachedCurrentTime).catch((function(){})))}},{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._clip)||void 0===e?void 0:e.getDuration())&&void 0!==t?t:this._player?this._player.currentTime:0}},{key:"state",get:function(){return this._player?this._player.state:Xa.INIT}},{key:"playing",get:function(){return this.state===e.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return Bo.maxAudioChannel}}]),e}(ui),Qo.AudioState=Xa,Ko=je((jo=$o).prototype,"_clip",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qo=je(jo.prototype,"_loop",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zo=je(jo.prototype,"_playOnAwake",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Jo=je(jo.prototype,"_volume",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),je(jo.prototype,"clip",[Uo,zo],Object.getOwnPropertyDescriptor(jo.prototype,"clip"),jo.prototype),je(jo.prototype,"loop",[Vo],Object.getOwnPropertyDescriptor(jo.prototype,"loop"),jo.prototype),je(jo.prototype,"playOnAwake",[Ho],Object.getOwnPropertyDescriptor(jo.prototype,"playOnAwake"),jo.prototype),je(jo.prototype,"volume",[Wo,Xo],Object.getOwnPropertyDescriptor(jo.prototype,"volume"),jo.prototype),Yo=jo))||Yo)||Yo)||Yo,t({AudioSource:tl,AudioSourceComponent:tl}),tl);ci(Io,"AudioClip",[{name:"PlayingState",newName:"AudioState",target:al,targetName:"AudioSource"}]),pi(Io.prototype,"AudioClip.prototype",["state","play","pause","stop","playOneShot","setCurrentTime","setVolume","setLoop","getCurrentTime","getVolume","getLoop"].map((function(t){return{name:t,suggest:"please use AudioSource.prototype."+t+" instead"}}))),Xe.AudioSourceComponent=al,di.setClassAlias(al,"cc.AudioSourceComponent");var ol,ll,hl,ul,cl,pl,dl,fl,_l,gl,ml,yl,vl,bl,Sl=t("VideoClip",Ze("cc.VideoClip")((nl=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_duration",rl,ti(e)),e._video=null,e.loaded=!1,e}return Me(e,t),Be(e,[{key:"_nativeAsset",get:function(){return this._video},set:function(t){this._video=t,t?(this._duration=t.duration,this.loaded=!0):(this._duration=0,this.loaded=!1)}}]),e}(Je),rl=je((il=nl).prototype,"_duration",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),el=il))||el);function Tl(t,e,i){var r=document.createElement("video"),n=document.createElement("source");r.appendChild(n);var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="blob",s.onload=function(){200===this.status||0===this.status?(n.src=URL.createObjectURL(this.response),i(null,r)):i(new Error(s.status+"(no response)"))},s.onerror=function(){var e="load video failure - "+t;fi(e),i(new Error(e))},s.send()}function Al(t,e,i,r){var n=new Sl;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}ii.register({".mp4":Tl,".avi":Tl,".mov":Tl,".mpg":Tl,".mpeg":Tl,".rm":Tl,".rmvb":Tl}),ri.register({".mp4":Al,".avi":Al,".mov":Al,".mpg":Al,".mpeg":Al,".rm":Al,".rmvb":Al});var El,Cl=new _i,Rl=new _i,wl=new gi,xl=new gi,Ol=new gi,Pl=new gi(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),Dl=new mi,Ml=function(e){return t({UITransform:e,UITransformComponent:e}),e}((ol=Ze("cc.UITransform"),ll=ai(),hl=Ci(110),ul=oi(),cl=Ri(),pl=li(),dl=Ri(),fl=li(),ol(_l=ll(_l=hl(_l=ul(_l=yi(_l=vi((bl=vl=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._priority=0,$e(e,"_contentSize",ml,ti(e)),$e(e,"_anchorPoint",yl,ti(e)),e}Me(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiTransformComp=this},i.onLoad=function(){this.node.parent&&e.insertChangeMap(this.node.parent)},i.onEnable=function(){this.node.on(bi.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},i.onDisable=function(){this.node.off(bi.PARENT_CHANGED,this._parentChanged,this)},i.onDestroy=function(){this.node._uiProps.uiTransformComp=null},i.setContentSize=function(t,e){var i=this._contentSize;if(void 0===e){if((t=t).width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this.node.emit(bi.SIZE_CHANGED),this._markRenderDataDirty()},i.setAnchorPoint=function(t,e){var i=this._anchorPoint;if(void 0===e){if((t=t).x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.node.emit(bi.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},i.isHit=function(t,e){for(var i=this._contentSize.width,r=this._contentSize.height,n=Cl,s=Rl,a=this._getRenderScene().cameras,o=0;o<a.length;o++){var l=a[o];if(l.visibility&this.node.layer){l.node.getWorldRT(wl);var h=wl.m12,u=wl.m13,c=Xe.visibleRect.center;if(wl.m12=c.x-(wl.m00*h+wl.m04*u),wl.m13=c.y-(wl.m01*h+wl.m05*u),gi.invert(wl,wl),_i.transformMat4(n,t,wl),this.node.getWorldMatrix(Ol),gi.invert(wl,Ol),!gi.strictEquals(wl,Pl)){_i.transformMat4(s,n,wl),s.x+=this._anchorPoint.x*i,s.y+=this._anchorPoint.y*r;var p=!1;if(s.x>=0&&s.y>=0&&s.x<=i&&s.y<=r&&(p=!0,e&&e.mask))for(var d=e.mask,f=this.node,_=d?d.length:0,g=0,m=0;f&&m<_;++g,f=f.parent){var y=d[m];if(g===y.index){if(f!==y.comp.node){d.length=m;break}var v=y.comp;if(v&&v._enabled&&!v.isHit(n)){p=!1;break}m++}else if(g>y.index){d.length=m;break}}if(p)return!0}}}return!1},i.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(Ol),gi.invert(wl,Ol),e||(e=new Si),Si.transformMat4(e,t,wl)},i.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(Ol),e||(e=new Si),Si.transformMat4(e,t,Ol)},i.getBoundingBox=function(){gi.fromRTS(xl,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var t=this._contentSize.width,e=this._contentSize.height,i=new mi(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return i.transformMat4(xl),i},i.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(Ol),this.getBoundingBoxTo(Ol)):this.getBoundingBox()},i.getBoundingBoxTo=function(t){gi.fromRTS(xl,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var i=this._contentSize.width,r=this._contentSize.height,n=new mi(-this._anchorPoint.x*i,-this._anchorPoint.y*r,i,r);if(gi.multiply(Ol,t,xl),n.transformMat4(Ol),!this.node.children)return n;for(var s,a=this.node.children,o=ke(a);!(s=o()).done;){var l=s.value;if(l&&l.active){var h=l.getComponent(e);if(h){var u=h.getBoundingBoxTo(t);u&&mi.union(n,n,u)}}}return n},i.getComputeAABB=function(t){var e=this._contentSize.width,i=this._contentSize.height;Dl.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),Dl.transformMat4(this.node.worldMatrix);var r=Dl.x+.5*Dl.width,n=Dl.y+.5*Dl.height,s=this.node.worldPosition.z,a=Dl.width/2,o=Dl.height/2;return null!=t?(Ti.set(t,r,n,s,a,o,.001),t):new Ti(r,n,s,a,o,.001)},i._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&e.insertChangeMap(this.node.parent)},i._markRenderDataDirty=function(){var t=this.node._uiProps.uiComp;t&&t.markForUpdateRenderData()},e.insertChangeMap=function(t){var i=t.uuid;e.priorityChangeNodeMap.has(i)||e.priorityChangeNodeMap.set(i,t)},e._sortChildrenSibling=function(t){var e=t.children;e&&e.sort((function(t,e){var i=t._uiProps.uiTransformComp,r=e._uiProps.uiTransformComp,n=(i?i._priority:0)-(r?r._priority:0);return 0===n?t.getSiblingIndex()-e.getSiblingIndex():n}))},e._sortSiblings=function(){e.priorityChangeNodeMap.forEach((function(t){e._sortChildrenSibling(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),e.priorityChangeNodeMap.clear()},e._cleanChangeMap=function(){e.priorityChangeNodeMap.clear()},Be(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(bi.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(bi.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(bi.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(bi.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(bi.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(bi.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?He(6706):(this._priority=t,this.node.parent&&e.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var t=Ai.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=Ai.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),e}(ui),vl.EventType=bi,vl.priorityChangeNodeMap=new Map,je((gl=bl).prototype,"contentSize",[cl,pl],Object.getOwnPropertyDescriptor(gl.prototype,"contentSize"),gl.prototype),je(gl.prototype,"anchorPoint",[dl,fl],Object.getOwnPropertyDescriptor(gl.prototype,"anchorPoint"),gl.prototype),ml=je(gl.prototype,"_contentSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wi(100,100)}}),yl=je(gl.prototype,"_anchorPoint",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(.5,.5)}}),_l=gl))||_l)||_l)||_l)||_l)||_l)||_l));Ai.on(Ei.EVENT_AFTER_UPDATE,Ml._sortSiblings),Ai.on(Ei.EVENT_BEFORE_SCENE_LAUNCH,Ml._cleanChangeMap);var Bl,Il,Ll,Fl,kl,Nl,Gl,Ul,zl,Vl,Hl,Wl,Xl,Yl,jl=t("RenderRoot2D",Ze("cc.RenderRoot2D")(El=Ci(100)(El=oi()(El=xi(Ml)(El=yi(El=vi(El=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.onEnable=function(){Xe.director.root.batcher2D.addScreen(this)},i.onDisable=function(){Xe.director.root.batcher2D.removeScreen(this)},i.onDestroy=function(){Xe.director.root.batcher2D.removeScreen(this)},e}(ui))||El)||El)||El)||El)||El)||El),Kl=new Si,ql=Oi({OVERLAY:0,INTERSPERSE:1}),Zl=function(e){return t({Canvas:e,CanvasComponent:e}),e}((Bl=Ze("cc.Canvas"),Il=ai(),Ll=Ci(100),Fl=oi(),kl=si(Pi),Nl=li(),Gl=li(),Ul=si(Pi),Bl(zl=Il(zl=Ll(zl=Fl(zl=vi(zl=yi((Xl=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_cameraComponent",Hl,ti(e)),$e(e,"_alignCanvasWithScreen",Wl,ti(e)),e._thisOnCameraResized=void 0,e._fitDesignResolution=void 0,e._pos=new Si,e._renderMode=ql.OVERLAY,e._thisOnCameraResized=e._onResizeCamera.bind(ti(e)),e}Me(e,t);var i=e.prototype;return i.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&this._cameraComponent._createCamera(),this._onResizeCamera(),this.node.on(bi.TRANSFORM_CHANGED,this._thisOnCameraResized)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this.node.off(bi.TRANSFORM_CHANGED,this._thisOnCameraResized)},i._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture){var t=this._cameraComponent.targetTexture.window;this._cameraComponent.camera&&this._cameraComponent.camera.setFixedSize(t.width,t.height),this._cameraComponent.orthoHeight=Di.height/2}else if(Mi.canvas){var e=Mi.canvas;this._cameraComponent.camera&&this._cameraComponent.camera.resize(e.width,e.height),this._cameraComponent.orthoHeight=Mi.canvas.height/Bi.getScaleY()/2}this.node.getWorldPosition(Kl),this._cameraComponent.node.setWorldPosition(Kl.x,Kl.y,1e3)}},i._getViewPriority=function(){if(this._cameraComponent){var t,e=null===(t=this.cameraComponent)||void 0===t?void 0:t.priority;return this._renderMode===ql.OVERLAY?e|1<<30:e&~(1<<30)}return 0},Be(e,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]),e}(jl),je((Vl=Xl).prototype,"cameraComponent",[kl,Nl],Object.getOwnPropertyDescriptor(Vl.prototype,"cameraComponent"),Vl.prototype),je(Vl.prototype,"alignCanvasWithScreen",[Gl],Object.getOwnPropertyDescriptor(Vl.prototype,"alignCanvasWithScreen"),Vl.prototype),Hl=je(Vl.prototype,"_cameraComponent",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wl=je(Vl.prototype,"_alignCanvasWithScreen",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),zl=Vl))||zl)||zl)||zl)||zl)||zl)||zl));Xe.Canvas=Zl,function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(Yl||(Yl={}));var Jl,Ql=t("StencilManager",function(){function t(){this.stage=Yl.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:C.ALWAYS,stencilMask:65535,writeMask:65535,failOp:R.KEEP,zFailOp:R.KEEP,passOp:R.KEEP,ref:1},this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){t.stencilStage=t.inverted?Yl.CLEAR_INVERTED:Yl.CLEAR},e.enterLevel=function(t){t.graphics.stencilStage=t.inverted?Yl.ENTER_LEVEL_INVERTED:Yl.ENTER_LEVEL},e.enableMask=function(){this.stage=Yl.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=Yl.DISABLED:this.stage=Yl.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.reset=function(){this._maskStack.length=0,this.stage=Yl.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var i=0,r=!1,n=!1,s=C.LESS,a=this.stencilStateMap;if(e&&e.passes[0]){var o=e.passes[0].depthStencilState,l=0,h=0;o.depthTest&&(l=1),o.depthWrite&&(h=1),i=l|h<<1|o.depthFunc<<2|t<<6|this._maskStack.length<<9,r=o.depthTest,n=o.depthWrite,s=o.depthFunc,a=this.stencilStateMapWithDepth}else i=t<<16|this._maskStack.length;if(a&&a.has(i))return a.get(i);this.setStateFromStage(t);var u=new oe(r,n,s,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return a.set(i,u),u},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===Yl.DISABLED?(e.stencilTest=!1,e.func=C.ALWAYS,e.failOp=R.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===Yl.ENABLED?(e.func=C.EQUAL,e.failOp=R.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===Yl.CLEAR?(e.func=C.NEVER,e.failOp=R.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===Yl.CLEAR_INVERTED||t===Yl.ENTER_LEVEL?(e.func=C.NEVER,e.failOp=R.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===Yl.ENTER_LEVEL_INVERTED&&(e.func=C.NEVER,e.failOp=R.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},Be(t,[{key:"pattern",get:function(){return this._stencilPattern}}]),t}());Ql.sharedManager=null,Ql.sharedManager=new Ql;var $l,th,eh,ih,rh,nh,sh,ah,oh,lh,hh,uh,ch,ph,dh,fh,_h,gh,mh,yh=t("UIComponent",Ze("cc.UIComponent")(Jl=xi(Ml)(Jl=Ci(110)(Jl=yi(Jl=vi(Jl=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._lastParent=null,e.stencilStage=Yl.DISABLED,e}Me(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiComp=this},i.onEnable=function(){},i.onDisable=function(){},i.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},i.updateAssembler=function(){},i.postUpdateAssembler=function(){},i.markForUpdateRenderData=function(){},e}(ui))||Jl)||Jl)||Jl)||Jl)||Jl),vh=function(){this.material=null,this.vertexCount=0,this.indicesCount=0},bh=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).vData=null,e.uvDirty=!0,e.vertDirty=!0,e._data=[],e._indices=[],e._pivotX=0,e._pivotY=0,e._width=0,e._height=0,e}Me(e,t),e.add=function(){return Ah.add()},e.remove=function(t){var e=Ah.data.indexOf(t);-1!==e&&(Ah.data[e].clear(),Ah.removeAt(e))};var i=e.prototype;return i.updateSizeNPivot=function(t,e,i,r){t===this._width&&e===this._height&&i===this._pivotX&&r===this._pivotY||(this._width=t,this._height=e,this._pivotX=i,this._pivotY=r,this.vertDirty=!0)},i.clear=function(){this._data.length=0,this._indices.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.uvDirty=!0,this.vertDirty=!0,this.material=null,this.vertexCount=0,this.indicesCount=0},Be(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){var i=e.length,r=0;for(r=t;r<i;r++)Th.free(e[r]);for(r=i;r<t;r++)e[r]=Th.alloc();e.length=t}}},{key:"data",get:function(){return this._data}}]),e}(vh),Sh=function(t){function e(e){var i;return void 0===e&&(e=9),(i=t.call(this)||this).vData=void 0,i.iData=void 0,i.vertexStart=0,i.indicesStart=0,i.byteStart=0,i.byteCount=0,i.lastFilledIndices=0,i.lastFilledVertex=0,i._formatByte=void 0,i._formatByte=e*Float32Array.BYTES_PER_ELEMENT,i.vData=new Float32Array(256*e*Float32Array.BYTES_PER_ELEMENT),i.iData=new Uint16Array(1536),i}Me(e,t),e.add=function(){return Eh.add()},e.remove=function(t){var e=Eh.data.indexOf(t);-1!==e&&(Eh.data[e].reset(),Eh.removeAt(e))};var i=e.prototype;return i.request=function(t,e){var i=this.byteCount+t*this._formatByte;return this.reserve(t,e),this.vertexCount+=t,this.indicesCount+=e,this.byteCount=i,!0},i.reserve=function(t,e){var i=this.byteCount+t*this._formatByte,r=this.indicesCount+e;if(t+this.vertexCount>65535)return!1;var n=this.vData.byteLength,s=this.iData.length,a=this.vData.length,o=this.iData.length;if(i>n||r>s){for(;n<i||s<r;)n=4*(a*=2),s=o*=2;this._reallocBuffer(a,o)}return!0},i.advance=function(t,e){this.vertexCount+=t,this.indicesCount+=e,this.byteCount+=t*this._formatByte},i.reset=function(){this.vertexCount=0,this.indicesCount=0,this.byteCount=0,this.vertexStart=0,this.indicesStart=0,this.byteStart=0,this.lastFilledIndices=0,this.lastFilledVertex=0},i._reallocBuffer=function(t,e){var i=this.vData;this.vData=new Float32Array(t),this.vData.set(i,0);var r=this.iData;this.iData=new Uint16Array(e),this.iData.set(r,0)},Be(e,[{key:"formatByte",get:function(){return this._formatByte},set:function(t){this._formatByte=t}},{key:"floatStride",get:function(){return this._formatByte>>2}},{key:"vDataOffset",get:function(){return this.byteCount>>>2}}]),e}(vh),Th=(function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;i._fillQuadBuffer=function(){for(var t=this.iData.length/6,e=this.iData,i=0,r=0;i<t;i++){var n=4*i;e[r++]=n,e[r++]=n+1,e[r++]=n+2,e[r++]=n+1,e[r++]=n+3,e[r++]=n+2}},i._reallocBuffer=function(e,i){t.prototype._reallocBuffer.call(this,e,i),this._fillQuadBuffer()}}(Sh),new e((function(){return{x:0,y:0,z:0,u:0,v:0,color:Ii.WHITE.clone()}}),128)),Ah=new i((function(){return new bh}),32),Eh=new i((function(){return new Sh}),32);Li(w),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(mh||(mh=t("InstanceMaterialType",{})));var Ch=function(e){return t({Renderable2D:e,RenderComponent:e,UIRenderable:e}),e}(($l=Ze("cc.Renderable2D"),th=xi(Ml),eh=Ni(),ih=si(Fi),rh=si(Fi),nh=Ri(),sh=Gi(),ah=Ri(),oh=li(),$l(lh=th(lh=yi(lh=vi((gh=_h=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_materials",uh,ti(e)),$e(e,"_customMaterial",ch,ti(e)),e.stencilStage=Yl.DISABLED,$e(e,"_srcBlendFactor",ph,ti(e)),$e(e,"_dstBlendFactor",dh,ti(e)),$e(e,"_color",fh,ti(e)),e._assembler=null,e._postAssembler=null,e._renderData=null,e._renderDataFlag=!0,e._renderFlag=!0,e._delegateSrc=null,e._instanceMaterialType=mh.ADD_COLOR_AND_TEXTURE,e._blendState=new he,e._blendHash=0,e._colorDirty=!0,e._cacheAlpha=1,e._lastParent=null,e}Me(e,t);var i=e.prototype;return i.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc()},i.updateBlendHash=function(){var t=this._blendState.targets[0].blendDst<<4;this._blendHash=t|this._blendState.targets[0].blendSrc},i.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},i.onEnable=function(){this.node.on(bi.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(bi.SIZE_CHANGED,this._nodeStateChange,this),this.updateMaterial(),this._renderFlag=this._canRender()},i.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender()},i.onDisable=function(){this.node.off(bi.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(bi.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1},i.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++)this._materialInstances[t]&&this._materialInstances[t].destroy();this._renderData=null,this._blendState&&this._blendState.destroy()},i.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),this._renderFlag=this._canRender(),t&&this._renderFlag){var e=this._renderData;e&&(e.vertDirty=!0),this._renderDataFlag=t}else t||(this._renderDataFlag=t)},i.requestRenderData=function(){var t=bh.add();return this._renderData=t,t},i.destroyRenderData=function(){this._renderData&&(bh.remove(this._renderData),this._renderData=null)},i.updateAssembler=function(t){this._updateColor(),this._renderFlag&&(this._checkAndUpdateRenderData(),this._render(t))},i.postUpdateAssembler=function(t){this._renderFlag&&this._postRender(t)},i._render=function(){},i._postRender=function(){},i._checkAndUpdateRenderData=function(){this._renderDataFlag&&(this._assembler.updateRenderData(this),this._renderDataFlag=!1)},i._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this.node._uiProps.opacity>0},i._postCanRender=function(){},i._updateColor=function(){this._updateWorldAlpha(),this._colorDirty&&this._assembler&&this._assembler.updateColor&&(this._assembler.updateColor(this),this._colorDirty=!1)},i._updateWorldAlpha=function(){var t=this.color.a/255;1===t&&(t=this.node._uiProps.localOpacity);var e=this.node.parent,i=e&&e._uiProps?e._uiProps.opacity*t:t;this.node._uiProps.opacity=i,this._colorDirty=this._colorDirty||i!==this._cacheAlpha,this._cacheAlpha=i},i._updateBlendFunc=function(){var t=this._blendState.targets[0];t||(t=new le,this._blendState.setTarget(0,t)),t.blendDst===this._dstBlendFactor&&t.blendSrc===this._srcBlendFactor||(t.blend=!0,t.blendDstAlpha=w.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor),this.updateBlendHash()},i.getBlendState=function(){return this._blendState},i._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var i=this.node.children[t].getComponent(e);i&&i.markForUpdateRenderData()}},i._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case mh.ADD_COLOR:t=ki.get("ui-base-material");break;case mh.GRAYSCALE:t=ki.get("ui-sprite-gray-material");break;case mh.USE_ALPHA_SEPARATED:t=ki.get("ui-sprite-alpha-sep-material");break;case mh.USE_ALPHA_SEPARATED_AND_GRAY:t=ki.get("ui-sprite-gray-alpha-sep-material");break;default:t=ki.get("ui-sprite-material")}return t},i._setCacheAlpha=function(t){this._cacheAlpha=t},Be(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"srcBlendFactor",get:function(){return this._customMaterial&&He(12001),this._srcBlendFactor},set:function(t){this._customMaterial?He(12001):this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._customMaterial&&He(12001),this._dstBlendFactor},set:function(t){this._customMaterial?He(12001):this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._colorDirty=!0)}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(t){this._delegateSrc=t}},{key:"blendHash",get:function(){return this._blendHash}}]),e}(Ui),_h.BlendState=w,_h.Assembler=null,_h.PostAssembler=null,uh=je((hh=gh).prototype,"_materials",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),je(hh.prototype,"sharedMaterials",[Qe,eh],Object.getOwnPropertyDescriptor(hh.prototype,"sharedMaterials"),hh.prototype),ch=je(hh.prototype,"_customMaterial",[ih],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(hh.prototype,"customMaterial",[rh,nh,sh],Object.getOwnPropertyDescriptor(hh.prototype,"customMaterial"),hh.prototype),je(hh.prototype,"color",[ah,oh],Object.getOwnPropertyDescriptor(hh.prototype,"color"),hh.prototype),ph=je(hh.prototype,"_srcBlendFactor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return w.SRC_ALPHA}}),dh=je(hh.prototype,"_dstBlendFactor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return w.ONE_MINUS_SRC_ALPHA}}),fh=je(hh.prototype,"_color",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),lh=hh))||lh)||lh)||lh)||lh));Xe.internal.Renderable2D=Ch,zi(yh.prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),ci(Zl.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){return this._cameraComponent.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:Ii.BLACK},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),pi(Ch.prototype,"Renderable2D.prototype",[{name:"srcBlendFactor",suggest:"Please use a custom material to specify blending options instead."},{name:"dstBlendFactor",suggest:"Please use a custom material to specify blending options instead."}]),pi(Ml.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),Xe.UITransformComponent=Ml,di.setClassAlias(Ml,"cc.UITransformComponent"),di.setClassAlias(Ch,"cc.RenderComponent"),Xe.CanvasComponent=Zl,di.setClassAlias(Zl,"cc.CanvasComponent");var Rh,wh,xh=Oi({REMOTE:0,LOCAL:1});!function(t){t.NONE="none",t.PLAYING="playing",t.PAUSED="paused",t.STOPPED="stopped",t.COMPLETED="completed",t.META_LOADED="meta-loaded",t.READY_TO_PLAY="ready-to-play",t.ERROR="error",t.CLICKED="clicked"}(Rh||(Rh={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(wh||(wh={}));var Oh=function(){function t(t){var e=this;this._componentEventList=new Map,this._state=Rh.NONE,this._video=null,this._onHide=void 0,this._onShow=void 0,this._interrupted=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._fullScreenOnAwake=!1,this._visible=!0,this._playing=!1,this._cachedCurrentTime=-1,this._waitingFullscreen=!1,this._waitingPlay=!1,this._keepAspectRatio=!1,this._component=null,this._uiTrans=null,this._node=null,this._stayOnBottom=!1,this._dirty=!1,this._forceUpdate=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(Ml),this._onHide=function(){e.video&&e._state===Rh.PLAYING&&(e.video.pause(),e._interrupted=!0)},this._onShow=function(){e._interrupted&&e.video&&(e.video.play(),e._interrupted=!1)},Xe.game.on(Xe.Game.EVENT_HIDE,this._onHide),Xe.game.on(Xe.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.onLoadedMetadata=function(t){this._loadedMeta=!0,this._forceUpdate=!0,this._visible?this.enable():this.disable(),this.dispatchEvent(Rh.META_LOADED);var e=t.target;this._keepAspectRatio&&e&&this.syncUITransform(e.videoWidth,e.videoHeight),this.delayedFullScreen(),this.delayedPlay()},e.onCanPlay=function(){this._loaded=!0,this.dispatchEvent(Rh.READY_TO_PLAY)},e.onPlay=function(){this._playing=!0,this.dispatchEvent(Rh.PLAYING)},e.onPlaying=function(){this.dispatchEvent(Rh.PLAYING)},e.onPause=function(){this._ignorePause?this._ignorePause=!1:(this._playing=!1,this.dispatchEvent(Rh.PAUSED))},e.onStoped=function(){this._playing=!1,this._ignorePause=!1,this.dispatchEvent(Rh.STOPPED)},e.onEnded=function(){this.dispatchEvent(Rh.COMPLETED)},e.onClick=function(){this.dispatchEvent(Rh.CLICKED)},e.onError=function(t){this.dispatchEvent(Rh.ERROR);var e=t.target;e&&e.error&&Le("Error "+e.error.code+"; details: "+e.error.message)},e.play=function(){this._loadedMeta||this._loaded?this.canPlay():this._waitingPlay=!0},e.delayedPlay=function(){this._waitingPlay&&(this.canPlay(),this._waitingPlay=!1)},e.syncFullScreenOnAwake=function(t){this._fullScreenOnAwake=t,this._loadedMeta||this._loaded?this.canFullScreen(t):this._waitingFullscreen=!0},e.delayedFullScreen=function(){this._waitingFullscreen&&(this.canFullScreen(this._fullScreenOnAwake),this._waitingFullscreen=!1)},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);e&&(this._state=t,e.call(this))},e.syncUITransform=function(t,e){this._uiTrans&&(this._uiTrans.width=t,this._uiTrans.height=e)},e.syncCurrentTime=function(){this.video&&-1!==this._cachedCurrentTime&&this.video.currentTime!==this._cachedCurrentTime&&(this.seekTo(this._cachedCurrentTime),this._cachedCurrentTime=-1)},e.destroy=function(){this.removeVideoPlayer(),this._componentEventList.clear(),Xe.game.off(Xe.Game.EVENT_HIDE,this._onHide),Xe.game.off(Xe.Game.EVENT_SHOW,this._onShow)},Be(t,[{key:"fullScreenOnAwake",get:function(){return this._fullScreenOnAwake}},{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"video",get:function(){return this._video}},{key:"state",get:function(){return this._state}},{key:"isPlaying",get:function(){return this._playing}},{key:"UICamera",get:function(){return Ai.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();Xe.internal.VideoPlayerImpl=Oh;var Ph,Dh,Mh,Bh,Ih,Lh,Fh,kh,Nh,Gh,Uh,zh,Vh,Hh,Wh,Xh,Yh,jh,Kh,qh,Zh,Jh,Qh,$h,tu,eu,iu,ru,nu,su,au,ou,lu,hu,uu,cu,pu,du,fu,_u=-Math.pow(2,15),gu=Vi(),mu=function(t){function e(e){var i;return(i=t.call(this,e)||this)._eventList=new Map,i._clearColorA=-1,i._clearFlag=void 0,i}Me(e,t);var i=e.prototype;return i.addListener=function(t,e){this._video&&(this._eventList.set(t,e),this._video.addEventListener(t,e))},i.removeAllListeners=function(){var t=this;this._eventList.forEach((function(e,i){t._video&&t._video.removeEventListener(i,e)})),this._eventList.clear()},i.canPlay=function(){var t=this;if(this.video){var e=this.video.play();window.Promise&&e instanceof Promise&&e.catch((function(){})).then((function(){t.syncCurrentTime()}))}},i.pause=function(){this.video&&(this.video.pause(),this._cachedCurrentTime=this.video.currentTime)},i.resume=function(){this.play()},i.stop=function(){var t=this;this.video&&(this._ignorePause=!0,this.video.currentTime=0,this.video.pause(),this._cachedCurrentTime=0,setTimeout((function(){t._ignorePause=!1,t.dispatchEvent(Rh.STOPPED)}),0))},i.syncClip=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t.nativeUrl)},i.syncURL=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t)},i.syncPlaybackRate=function(t){Ne.browserType!==ze.UC?this.video&&(this.video.playbackRate=t):We("playbackRate is not supported by the uc mobile browser.")},i.syncVolume=function(t){this.video&&(this.video.volume=t)},i.syncMute=function(t){this.video&&(this.video.muted=t)},i.syncLoop=function(t){this.video&&(this.video.loop=t)},i.getDuration=function(){return this.video?this.video.duration:0},i.getCurrentTime=function(){return this.video?this.video.currentTime:-1},i.seekTo=function(t){this.video&&(this.video.currentTime=t)},i.canFullScreen=function(t){var e=this,i=this._video;if(i&&i.readyState===wh.HAVE_ENOUGH_DATA)return Ne.os===Ge.IOS&&Ue.isBrowser?(t?i.webkitEnterFullscreen&&i.webkitEnterFullscreen():i.webkitExitFullscreen&&i.webkitExitFullscreen(),void(this._fullScreenOnAwake=i.webkitDisplayingFullscreen)):Hi.supportsFullScreen?void(t?(Ne.browserType===ze.IE&&(i.style.transform=""),i.setAttribute("x5-video-player-fullscreen","true"),Hi.requestFullScreen(i,(function(t){var r=Ne.browserType===ze.IE?t.msFullscreenElement:t.fullscreenElement;e._fullScreenOnAwake=r===i}),(function(){e._fullScreenOnAwake=!1}))):(i.removeAttribute("x5-video-player-fullscreen"),Hi.exitFullScreen())):(this._fullScreenOnAwake=t,this._forceUpdate=!0,void this.syncMatrix())},i.syncStayOnBottom=function(t){this._video&&(this._video.style["z-index"]=t?_u:0,this._stayOnBottom=t),this._dirty=!0},i.syncKeepAspectRatio=function(t){this._keepAspectRatio=t,t&&this._loadedMeta&&this._video&&this.syncUITransform(this._video.videoWidth,this._video.videoHeight)},i.removeVideoPlayer=function(){var t=this._video;t&&Wi(Mi.container,t)&&(Mi.container.removeChild(t),this.removeAllListeners()),this._cachedCurrentTime=0,this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._video=null},i.createVideoPlayer=function(t){var e=this._video=document.createElement("video");e.className="cocosVideo",e.style.visibility="hidden",e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["transform-origin"]="0px 100% 0px",e.style["-webkit-transform-origin"]="0px 100% 0px",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),this._bindDomEvent(),Mi.container.appendChild(e);var i=document.createElement("source");e.appendChild(i),i.src=t},i._bindDomEvent=function(){this._video,this.addListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.addListener("canplay",this.onCanPlay.bind(this)),this.addListener("canplaythrough",this.onCanPlay.bind(this)),this.addListener("play",this.onPlay.bind(this)),this.addListener("playing",this.onPlaying.bind(this)),this.addListener("pause",this.onPause.bind(this)),this.addListener("click",this.onClick.bind(this)),this.addListener("ended",this.onEnded.bind(this)),this.addListener("error",this.onError.bind(this))},i.onCanPlay=function(e){var i=e.target;if(!this._loaded||!i)switch(i.readyState){case wh.HAVE_METADATA:case wh.HAVE_ENOUGH_DATA:t.prototype.onCanPlay.call(this,e)}},i.enable=function(){if(this._video){if(this._visible=!0,"visible"===this._video.style.visibility)return;this._video.style.visibility="visible"}},i.disable=function(t){if(this._video){if(!t&&this._playing&&this._video.pause(),this._visible=!1,"hidden"===this._video.style.visibility)return;this._video.style.visibility="hidden"}},i.syncMatrix=function(){if(this._video&&this._visible&&this._component){var t=this.UICamera;if(t&&!Hi.fullScreen()){this._dirty&&(this._dirty=!1,this._stayOnBottom?(this._clearColorA=t.clearColor.w,this._clearFlag=t.clearFlag,t.clearColor.w=0,t.clearFlag=W.ALL):this._clearFlag&&(t.clearColor.w=this._clearColorA,t.clearFlag=this._clearFlag,this._clearColorA=-1,this._clearFlag=null)),this._component.node.getWorldMatrix(gu),t.update(!0),t.worldMatrixToScreen(gu,gu,Mi.canvas.width,Mi.canvas.height);var e=0,i=0;if(this._fullScreenOnAwake?(e=Di.width,i=Di.height):(e=this._uiTrans.contentSize.width,i=this._uiTrans.contentSize.height),this._forceUpdate||this._m00!==gu.m00||this._m01!==gu.m01||this._m04!==gu.m04||this._m05!==gu.m05||this._m12!==gu.m12||this._m13!==gu.m13||this._w!==e||this._h!==i){this._m00=gu.m00,this._m01=gu.m01,this._m04=gu.m04,this._m05=gu.m05,this._m12=gu.m12,this._m13=gu.m13,this._w=e,this._h=i;var r=Bi.getDevicePixelRatio(),n=1/r,s=1/r,a=Mi.container,o=gu.m00*n,l=gu.m01,h=gu.m04,u=gu.m05*s;this._video.style.width=this._w+"px",this._video.style.height=this._h+"px",Ne.browserType!==ze.MOBILE_QQ?this._video.style.objectFit=this._keepAspectRatio?"none":"fill":We("keepAspectRatio is not supported by the qq mobile browser.");var c=this._w*n,p=this._h*s,d=this._uiTrans.anchorPoint,f=d.x,_=d.y,g=c*gu.m00*f,m=p*gu.m05*_,y=a&&a.style.paddingLeft?parseInt(a.style.paddingLeft):0,v=a&&a.style.paddingBottom?parseInt(a.style.paddingBottom):0,b="matrix("+o+","+-l+","+-h+","+u+","+(gu.m12*n-g+y)+","+-(gu.m13*s-m+v)+")";this._video.style.transform=b,this._video.style["-webkit-transform"]=b,Ne.browserType!==ze.IE&&(this._forceUpdate=!1)}}}},e}(Oh),yu=function(){function t(){}return t.getImpl=function(t){return new mu(t)},t}();Xe.internal.VideoPlayerImplManager=yu;var vu,bu=t("VideoPlayer",(Ph=Ze("cc.VideoPlayer"),Dh=ai(),Mh=oi(),Bh=xi(Ml),Ih=si(Sl),Lh=si(xh),Fh=li(),kh=li(),Nh=si(Sl),Gh=li(),Uh=li(),zh=hi(),Vh=li(),Hh=hi(),Wh=li(),Xh=li(),Yh=li(),jh=li(),Kh=li(),qh=li(),Zh=si([Xi]),Jh=Ri(),Qh=li(),Ph($h=Dh($h=Mh($h=Bh($h=vi((fu=du=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_resourceType",eu,ti(e)),$e(e,"_remoteURL",iu,ti(e)),$e(e,"_clip",ru,ti(e)),$e(e,"_playOnAwake",nu,ti(e)),$e(e,"_volume",su,ti(e)),$e(e,"_mute",au,ti(e)),$e(e,"_playbackRate",ou,ti(e)),$e(e,"_loop",lu,ti(e)),$e(e,"_fullScreenOnAwake",hu,ti(e)),$e(e,"_stayOnBottom",uu,ti(e)),$e(e,"_keepAspectRatio",cu,ti(e)),e._impl=null,e._cachedCurrentTime=0,$e(e,"videoPlayerEvent",pu,ti(e)),e}Me(e,t);var i=e.prototype;return i.syncSource=function(){this._impl&&(this._resourceType===xh.REMOTE?this._impl.syncURL(this._remoteURL):this._impl.syncClip(this._clip))},i.__preload=function(){this._impl=yu.getImpl(this),this.syncSource(),this._impl.syncLoop(this._loop),this._impl.syncVolume(this._volume),this._impl.syncMute(this._mute),this._impl.seekTo(this._cachedCurrentTime),this._impl.syncPlaybackRate(this._playbackRate),this._impl.syncStayOnBottom(this._stayOnBottom),this._impl.syncKeepAspectRatio(this._keepAspectRatio),this._impl.syncFullScreenOnAwake(this._fullScreenOnAwake),this._impl.componentEventList.set(Rh.META_LOADED,this.onMetaLoaded.bind(this)),this._impl.componentEventList.set(Rh.READY_TO_PLAY,this.onReadyToPlay.bind(this)),this._impl.componentEventList.set(Rh.PLAYING,this.onPlaying.bind(this)),this._impl.componentEventList.set(Rh.PAUSED,this.onPasued.bind(this)),this._impl.componentEventList.set(Rh.STOPPED,this.onStopped.bind(this)),this._impl.componentEventList.set(Rh.COMPLETED,this.onCompleted.bind(this)),this._impl.componentEventList.set(Rh.ERROR,this.onError.bind(this)),this._playOnAwake&&this._impl.loaded&&this.play()},i.onEnable=function(){this._impl&&this._impl.enable()},i.onDisable=function(){this._impl&&this._impl.disable()},i.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},i.update=function(){this._impl&&this._impl.syncMatrix()},i.onMetaLoaded=function(){Xi.emitEvents(this.videoPlayerEvent,this,Rh.META_LOADED),this.node.emit("meta-loaded",this)},i.onReadyToPlay=function(){this._playOnAwake&&!this.isPlaying&&this.play(),Xi.emitEvents(this.videoPlayerEvent,this,Rh.READY_TO_PLAY),this.node.emit(Rh.READY_TO_PLAY,this)},i.onPlaying=function(){Xi.emitEvents(this.videoPlayerEvent,this,Rh.PLAYING),this.node.emit(Rh.PLAYING,this)},i.onPasued=function(){Xi.emitEvents(this.videoPlayerEvent,this,Rh.PAUSED),this.node.emit(Rh.PAUSED,this)},i.onStopped=function(){Xi.emitEvents(this.videoPlayerEvent,this,Rh.STOPPED),this.node.emit(Rh.STOPPED,this)},i.onCompleted=function(){Xi.emitEvents(this.videoPlayerEvent,this,Rh.COMPLETED),this.node.emit(Rh.COMPLETED,this)},i.onError=function(){Xi.emitEvents(this.videoPlayerEvent,this,Rh.ERROR),this.node.emit(Rh.ERROR,this)},i.play=function(){this._impl&&this._impl.play()},i.resume=function(){this._impl&&this._impl.resume()},i.pause=function(){this._impl&&this._impl.pause()},i.stop=function(){this._impl&&this._impl.stop()},Be(e,[{key:"resourceType",get:function(){return this._resourceType},set:function(t){this._resourceType!==t&&(this._resourceType=t,this.syncSource())}},{key:"remoteURL",get:function(){return this._remoteURL},set:function(t){this._remoteURL!==t&&(this._remoteURL=t,this.syncSource())}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip!==t&&(this._clip=t,this.syncSource())}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._impl&&this._impl.syncPlaybackRate(t)}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this._impl&&this._impl.syncVolume(t)}},{key:"mute",get:function(){return this._mute},set:function(t){this._mute=t,this._impl&&this._impl.syncMute(t)}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._impl&&this._impl.syncLoop(t)}},{key:"keepAspectRatio",get:function(){return this._keepAspectRatio},set:function(t){this._keepAspectRatio!==t&&(this._keepAspectRatio=t,this._impl&&this._impl.syncKeepAspectRatio(t))}},{key:"fullScreenOnAwake",get:function(){return this._impl?(this._fullScreenOnAwake=this._impl.fullScreenOnAwake,this._fullScreenOnAwake):this._fullScreenOnAwake},set:function(t){this._fullScreenOnAwake!==t&&(this._fullScreenOnAwake=t,this._impl&&this._impl.syncFullScreenOnAwake(t))}},{key:"stayOnBottom",get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom!==t&&(this._stayOnBottom=t,this._impl&&this._impl.syncStayOnBottom(t))}},{key:"nativeVideo",get:function(){return this._impl&&this._impl.video||null}},{key:"currentTime",get:function(){return this._impl?this._impl.getCurrentTime():this._cachedCurrentTime},set:function(t){Number.isNaN(t)?We("illegal video time! value:"+t):(t=Ye(t,0,this.duration),this._cachedCurrentTime=t,this._impl&&this._impl.seekTo(t))}},{key:"duration",get:function(){return this._impl?this._impl.getDuration():0}},{key:"state",get:function(){return this._impl?this._impl.state:Rh.NONE}},{key:"isPlaying",get:function(){return!!this._impl&&this._impl.isPlaying}}]),e}(ui),du.EventType=Rh,du.ResourceType=xh,eu=je((tu=fu).prototype,"_resourceType",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xh.LOCAL}}),iu=je(tu.prototype,"_remoteURL",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ru=je(tu.prototype,"_clip",[Ih,ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nu=je(tu.prototype,"_playOnAwake",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),su=je(tu.prototype,"_volume",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),au=je(tu.prototype,"_mute",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ou=je(tu.prototype,"_playbackRate",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),lu=je(tu.prototype,"_loop",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hu=je(tu.prototype,"_fullScreenOnAwake",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),uu=je(tu.prototype,"_stayOnBottom",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cu=je(tu.prototype,"_keepAspectRatio",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),je(tu.prototype,"resourceType",[Lh,Fh],Object.getOwnPropertyDescriptor(tu.prototype,"resourceType"),tu.prototype),je(tu.prototype,"remoteURL",[kh],Object.getOwnPropertyDescriptor(tu.prototype,"remoteURL"),tu.prototype),je(tu.prototype,"clip",[Nh,Gh],Object.getOwnPropertyDescriptor(tu.prototype,"clip"),tu.prototype),je(tu.prototype,"playOnAwake",[Uh],Object.getOwnPropertyDescriptor(tu.prototype,"playOnAwake"),tu.prototype),je(tu.prototype,"playbackRate",[Yi,zh,Vh],Object.getOwnPropertyDescriptor(tu.prototype,"playbackRate"),tu.prototype),je(tu.prototype,"volume",[Yi,Hh,Wh],Object.getOwnPropertyDescriptor(tu.prototype,"volume"),tu.prototype),je(tu.prototype,"mute",[Xh],Object.getOwnPropertyDescriptor(tu.prototype,"mute"),tu.prototype),je(tu.prototype,"loop",[Yh],Object.getOwnPropertyDescriptor(tu.prototype,"loop"),tu.prototype),je(tu.prototype,"keepAspectRatio",[jh],Object.getOwnPropertyDescriptor(tu.prototype,"keepAspectRatio"),tu.prototype),je(tu.prototype,"fullScreenOnAwake",[Kh],Object.getOwnPropertyDescriptor(tu.prototype,"fullScreenOnAwake"),tu.prototype),je(tu.prototype,"stayOnBottom",[qh],Object.getOwnPropertyDescriptor(tu.prototype,"stayOnBottom"),tu.prototype),pu=je(tu.prototype,"videoPlayerEvent",[ei,Zh,Jh,Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$h=tu))||$h)||$h)||$h)||$h)||$h));Xe.internal.VideoPlayer=bu,function(t){t.NONE="none",t.LOADING="loading",t.LOADED="loaded",t.ERROR="error"}(vu||(vu={}));var Su=function(){function t(t){this._componentEventList=new Map,this._state=vu.NONE,this._warpper=void 0,this._webview=null,this._loaded=!1,this._forceUpdate=!1,this._component=null,this._uiTrans=null,this._node=null,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(Ml),this.reset(),this.createWebView()}var e=t.prototype;return e.reset=function(){this._warpper=null,this._webview=null,this._loaded=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._state=vu.NONE,this._forceUpdate=!1},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);if(e){this._state=t;for(var i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];e.call(this,r)}},e.destroy=function(){this.removeWebView(),this._warpper=null,this._webview=null,this._loaded=!1,this._component=null,this._uiTrans=null,this._forceUpdate=!1,this._componentEventList.clear()},Be(t,[{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"webview",get:function(){return this._webview}},{key:"state",get:function(){return this._state}},{key:"UICamera",get:function(){return Ai.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();Xe.internal.WebViewImpl=Su;var Tu,Au,Eu,Cu,Ru,wu,xu,Ou,Pu,Du,Mu,Bu,Iu,Lu,Fu=Vi(),ku=function(t){function e(e){return t.call(this,e)||this}Me(e,t);var i=e.prototype;return i._bindDomEvent=function(){var t=this;this.webview&&this.webview.addEventListener("load",(function(e){t._forceUpdate=!0,t.dispatchEvent(vu.LOADED);var i=e.target,r=i.contentDocument&&i.contentDocument.body;r&&r.innerHTML.includes("404")&&t.dispatchEvent(vu.ERROR,r.innerHTML)}))},i.loadURL=function(t){this.webview&&(this.webview.src=t,this.dispatchEvent(vu.LOADING))},i.createWebView=function(){var t=document.createElement("div");this._warpper=t,t.id="webview-wrapper",t.style["-webkit-overflow"]="auto",t.style["-webkit-overflow-scrolling"]="touch",t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.style.transformOrigin="0px 100% 0px",t.style["-webkit-transform-origin"]="0px 100% 0px",Mi.container.appendChild(t);var e=document.createElement("iframe");this._webview=e,e.id="webview",e.style.border="none",e.style.width="100%",e.style.height="100%",t.appendChild(e),this._bindDomEvent()},i.removeWebView=function(){var t=this._warpper;Wi(Mi.container,t)&&Mi.container.removeChild(t),this.reset()},i.enable=function(){this._warpper&&(this._warpper.style.visibility="visible")},i.disable=function(){this._warpper&&(this._warpper.style.visibility="hidden")},i.evaluateJS=function(t){if(this.webview){var e=this.webview.contentWindow;if(e)try{e.eval(t)}catch(t){this.dispatchEvent(vu.ERROR,t),Le(t)}}},i.setOnJSCallback=function(){We("The platform does not support")},i.setJavascriptInterfaceScheme=function(){We("The platform does not support")},i.syncMatrix=function(){if(this._warpper&&this._uiTrans&&this._component&&"hidden"!==this._warpper.style.visibility){var t=this.UICamera;if(t){this._component.node.getWorldMatrix(Fu),t.update(!0),t.worldMatrixToScreen(Fu,Fu,Mi.canvas.width,Mi.canvas.height);var e=this._uiTrans.contentSize,i=e.width,r=e.height;if(this._forceUpdate||this._m00!==Fu.m00||this._m01!==Fu.m01||this._m04!==Fu.m04||this._m05!==Fu.m05||this._m12!==Fu.m12||this._m13!==Fu.m13||this._w!==i||this._h!==r){this._m00=Fu.m00,this._m01=Fu.m01,this._m04=Fu.m04,this._m05=Fu.m05,this._m12=Fu.m12,this._m13=Fu.m13,this._w=i,this._h=r;var n=Bi.getDevicePixelRatio(),s=1/n,a=1/n,o=Mi.container,l=Fu.m00*s,h=Fu.m01,u=Fu.m04,c=Fu.m05*a;this._warpper.style.width=i+"px",this._warpper.style.height=r+"px";var p=this._w*s,d=this._h*a,f=p*Fu.m00*this._uiTrans.anchorX,_=d*Fu.m05*this._uiTrans.anchorY,g=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,m=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,y="matrix("+l+","+-h+","+-u+","+c+","+(Fu.m12*s-f+g)+","+-(Fu.m13*a-_+m)+")";this._warpper.style.transform=y,this._warpper.style["-webkit-transform"]=y,this._forceUpdate=!1}}}},e}(Su),Nu=function(){function t(){}return t.getImpl=function(t){return new ku(t)},t}();Xe.internal.WebViewImplManager=Nu;var Gu=t("WebView",(Tu=Ze("cc.WebView"),Au=ai(),Eu=oi(),Cu=xi(Ml),Ru=li(),wu=si([Xi]),xu=Ri(),Ou=li(),Tu(Pu=Au(Pu=Eu(Pu=Cu(Pu=vi((Lu=Iu=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_url",Mu,ti(e)),e._impl=null,$e(e,"webviewEvents",Bu,ti(e)),e}Me(e,t);var i=e.prototype;return i.setJavascriptInterfaceScheme=function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},i.setOnJSCallback=function(t){this._impl&&this._impl.setOnJSCallback(t)},i.evaluateJS=function(t){this._impl&&this._impl.evaluateJS(t)},i.__preload=function(){this._impl=Nu.getImpl(this),this._impl.componentEventList.set(vu.LOADING,this.onLoading.bind(this)),this._impl.componentEventList.set(vu.LOADED,this.onLoaded.bind(this)),this._impl.componentEventList.set(vu.ERROR,this.onError.bind(this)),this._impl.loadURL(this._url)},i.onLoading=function(){Xi.emitEvents(this.webviewEvents,this,vu.LOADING),this.node.emit(vu.LOADING,this)},i.onLoaded=function(){Xi.emitEvents(this.webviewEvents,this,vu.LOADED),this.node.emit(vu.LOADED,this)},i.onError=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];Xi.emitEvents(this.webviewEvents,this,vu.ERROR,e),this.node.emit(vu.ERROR,this,e)},i.onEnable=function(){this._impl&&this._impl.enable()},i.onDisable=function(){this._impl&&this._impl.disable()},i.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},i.update=function(){this._impl&&this._impl.syncMatrix()},Be(e,[{key:"url",get:function(){return this._url},set:function(t){this._url=t,this._impl&&this._impl.loadURL(t)}},{key:"nativeWebView",get:function(){return this._impl&&this._impl.webview||null}},{key:"state",get:function(){return this._impl?this._impl.state:vu.NONE}}]),e}(ui),Iu.EventType=vu,Mu=je((Du=Lu).prototype,"_url",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://cocos.com"}}),je(Du.prototype,"url",[Ru],Object.getOwnPropertyDescriptor(Du.prototype,"url"),Du.prototype),Bu=je(Du.prototype,"webviewEvents",[ei,wu,xu,Ou],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Pu=Du))||Pu)||Pu)||Pu)||Pu)||Pu));Xe.internal.WebView=Gu;var Uu=function(){function t(){this.originalTarget=null,this.target=null,this.tag=t.TAG_INVALID}var e=t.prototype;return e.clone=function(){var e=new t;return e.originalTarget=null,e.target=null,e.tag=this.tag,e},e.isDone=function(){return!0},e.startWithTarget=function(t){this.originalTarget=t,this.target=t},e.stop=function(){this.target=null},e.step=function(){ji(1006)},e.update=function(){ji(1007)},e.getTarget=function(){return this.target},e.setTarget=function(t){this.target=t},e.getOriginalTarget=function(){return this.originalTarget},e.setOriginalTarget=function(t){this.originalTarget=t},e.getTag=function(){return this.tag},e.setTag=function(t){this.tag=t},e.reverse=function(){return ji(1008),null},e.retain=function(){},e.release=function(){},t}();Uu.TAG_INVALID=-1;var zu=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._duration=0,e._timesForRepeat=1,e}Me(e,t);var i=e.prototype;return i.getDuration=function(){return this._duration*(this._timesForRepeat||1)},i.setDuration=function(t){this._duration=t},i.clone=function(){return new e},e}(Uu),Vu=(function(t){function e(e,i){var r;return void 0===i&&(i=1),(r=t.call(this)||this)._speed=0,r._innerAction=null,e&&r.initWithAction(e,i),r}Me(e,t);var i=e.prototype;i.getSpeed=function(){return this._speed},i.setSpeed=function(t){this._speed=t},i.initWithAction=function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(Ie(1021),!1)},i.clone=function(){var t=new e;return t.initWithAction(this._innerAction.clone(),this._speed),t},i.startWithTarget=function(t){Uu.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.stop=function(){this._innerAction.stop(),Uu.prototype.stop.call(this)},i.step=function(t){this._innerAction.step(t*this._speed)},i.isDone=function(){return this._innerAction.isDone()},i.reverse=function(){return new e(this._innerAction.reverse(),this._speed)},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction}}(Uu),0),Hu=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},Wu=function(){function t(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}var e=t.prototype;return e._searchElementByTarget=function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},e._getElement=function(t,e){var i=this._elementPool.pop();return i||(i=new Hu),i.target=t,i.paused=!!e,i},e._putElement=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},e.addAction=function(t,e,i){if(t&&e){null==e.uuid&&(e.uuid="_TWEEN_UUID_"+Vu++);var r=this._hashTargets.get(e);r?r.actions||(r.actions=[]):(r=this._getElement(e,i),this._hashTargets.set(e,r),this._arrayTargets.push(r)),r.target=e,r.actions.push(t),t.startWithTarget(e)}else Ie(1e3)},e.removeAllActions=function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this._putElement(i)}this._arrayTargets.length=0,this._hashTargets=new Map},e.removeAllActionsFromTarget=function(t){if(null!=t){var e=this._hashTargets.get(t);e&&(e.actions.length=0,this._deleteHashElement(e))}},e.removeAction=function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets.get(e);if(i)for(var r=0;r<i.actions.length;r++)if(i.actions[r]===t){i.actions.splice(r,1),i.actionIndex>=r&&i.actionIndex--;break}}},e._removeActionByTag=function(t,e,i){for(var r=0,n=e.actions.length;r<n;++r){var s=e.actions[r];if(s&&s.getTag()===t){if(i&&s.getOriginalTarget()!==i)continue;this._removeActionAtIndex(r,e);break}}},e.removeActionByTag=function(t,e){var i=this;t===Uu.TAG_INVALID&&ji(1002);var r=this._hashTargets;if(e){var n=r.get(e);n&&this._removeActionByTag(t,n,e)}else r.forEach((function(e){i._removeActionByTag(t,e)}))},e.getActionByTag=function(t,e){t===Uu.TAG_INVALID&&ji(1004);var i=this._hashTargets.get(e);if(i){if(null!=i.actions)for(var r=0;r<i.actions.length;++r){var n=i.actions[r];if(n&&n.getTag()===t)return n}ji(1005,t)}return null},e.getNumberOfRunningActionsInTarget=function(t){var e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0},e.pauseTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!0)},e.resumeTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!1)},e.pauseAllRunningActions=function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var r=e[i];r&&!r.paused&&(r.paused=!0,t.push(r.target))}return t},e.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},e.pauseTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},e.purgeSharedManager=function(){Xe.director.getScheduler().unscheduleUpdate(this)},e._removeActionAtIndex=function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},e._deleteHashElement=function(t){var e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);for(var i=this._arrayTargets,r=0,n=i.length;r<n;r++)if(i[r]===t){i.splice(r,1);break}this._putElement(t),e=!0}return e},e.update=function(t){for(var e,i=this._arrayTargets,r=0;r<i.length;r++){this._currentTarget=i[r];var n=(e=this._currentTarget).target;if(n instanceof Ki&&!n.isValid)this.removeAllActionsFromTarget(n),r--;else{if(!e.paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var s=e.currentAction;e.currentAction=null,this.removeAction(s)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&r--}}},t}(),Xu=t("TweenSystem",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).actionMgr=new Wu,e}return Me(e,t),e.prototype.update=function(t){this.actionMgr.update(t)},Be(e,[{key:"ActionManager",get:function(){return this.actionMgr}}]),e}(qi));Xu.ID="TWEEN",Xu.instance=void 0,Ai.on(Ei.EVENT_INIT,(function(){var t=new Xu;Xu.instance=t,Ai.registerSystem(Xu.ID,t,100)}));var Yu=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.isDone=function(){return!0},i.step=function(){this.update(1)},i.update=function(){},i.reverse=function(){return this.clone()},i.clone=function(){return new e},e}(zu),ju=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.update=function(){for(var t=this.target.getComponentsInChildren(Ui),e=0;e<t.length;++e)t[e].enabled=!0},i.reverse=function(){return new Ku},i.clone=function(){return new e},e}(Yu),Ku=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.update=function(){for(var t=this.target.getComponentsInChildren(Ui),e=0;e<t.length;++e)t[e].enabled=!1},i.reverse=function(){return new ju},i.clone=function(){return new e},e}(Yu);!function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;i.update=function(){for(var t=this.target.getComponentsInChildren(Ui),e=0;e<t.length;++e){var i=t[e];i.enabled=!i.enabled}},i.reverse=function(){return new e},i.clone=function(){return new e}}(Yu);var qu=function(t){function e(e){var i;return(i=t.call(this)||this)._isNeedCleanUp=!0,void 0!==e&&i.init(e),i}Me(e,t);var i=e.prototype;return i.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},i.init=function(t){return this._isNeedCleanUp=t,!0},i.reverse=function(){return new e(this._isNeedCleanUp)},i.clone=function(){return new e(this._isNeedCleanUp)},e}(Yu),Zu=function(t){function e(e,i,r){var n;return(n=t.call(this)||this)._selectorTarget=null,n._function=null,n._data=null,n.initWithFunction(e,i,r),n}Me(e,t);var i=e.prototype;return i.initWithFunction=function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},i.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},i.update=function(){this.execute()},i.getTargetCallback=function(){return this._selectorTarget},i.setTargetCallback=function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},i.clone=function(){var t=new e;return t.initWithFunction(this._function,this._selectorTarget,this._data),t},e}(Yu),Ju=function(t){function e(e){var i;return(i=t.call(this)||this).MAX_VALUE=2,i._elapsed=0,i._firstTick=!1,i._easeList=[],i._speed=1,i._repeatForever=!1,i._repeatMethod=!1,i._speedMethod=!1,void 0===e||isNaN(e)||i.initWithDuration(e),i}Me(e,t);var i=e.prototype;return i.getElapsed=function(){return this._elapsed},i.initWithDuration=function(t){return this._duration=0===t?Fe.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},i.isDone=function(){return this._elapsed>=this._duration},i._cloneDecoration=function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},i._reverseEaseList=function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e])}},i.clone=function(){var t=new e(this._duration);return this._cloneDecoration(t),t},i.easing=function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},i._computeEaseTime=function(t){return t},i.step=function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=e<1?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},i.startWithTarget=function(t){Uu.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},i.reverse=function(){return ji(1010),this},i.setAmplitudeRate=function(){ji(1011)},i.getAmplitudeRate=function(){return ji(1012),0},i.speed=function(t){return t<=0?(ji(1013),this):(this._speedMethod=!0,this._speed*=t,this)},i.getSpeed=function(){return this._speed},i.setSpeed=function(t){return this._speed=t,this},i.repeat=function(t){return t=Math.round(t),isNaN(t)||t<1?(ji(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},i.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},e}(zu),Qu=function(t){function e(i){var r;(r=t.call(this)||this)._actions=[],r._split=0,r._last=0,r._reversed=!1;var n=i instanceof Array?i:arguments;if(1===n.length)return Ie(1019),ti(r);var s=n.length-1;if(s>=0&&null==n[s]&&ji(1015),s>=0){for(var a,o=n[0],l=1;l<s;l++)n[l]&&(a=o,o=e._actionOneTwo(a,n[l]));r.initWithTwoActions(o,n[s])}return r}Me(e,t);var i=e.prototype;return i.initWithTwoActions=function(t,e){if(!t||!e)return Ie(1025),!1;var i=t._duration,r=e._duration,n=(i*=t._repeatMethod?t._timesForRepeat:1)+(r*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(n),this._actions[0]=t,this._actions[1]=e,!0},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},i.startWithTarget=function(t){Ju.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},i.stop=function(){-1!==this._last&&this._actions[this._last].stop(),Uu.prototype.stop.call(this)},i.update=function(t){var e,i,r=0,n=this._split,s=this._actions,a=this._last;(t=this._computeEaseTime(t))<n?(e=0!==n?t/n:1,0===r&&1===a&&this._reversed&&(s[1].update(0),s[1].stop())):(r=1,e=1===n?1:(t-n)/(1-n),-1===a&&(s[0].startWithTarget(this.target),s[0].update(1),s[0].stop()),0===a&&(s[0].update(1),s[0].stop())),i=s[r],a===r&&i.isDone()||(a!==r&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=r)},i.reverse=function(){var t=e._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t},e}(Ju);function $u(t){var e=t instanceof Array?t:arguments;if(1===e.length)return Ie(1019),null;var i=e.length-1;i>=0&&null==e[i]&&ji(1015);var r=null;if(i>=0){r=e[0];for(var n=1;n<=i;n++)e[n]&&(r=Qu._actionOneTwo(r,e[n]))}return r}Qu._actionOneTwo=function(t,e){var i=new Qu;return i.initWithTwoActions(t,e),i};var tc=function(t){function e(e,i){var r;return(r=t.call(this)||this)._times=0,r._total=0,r._nextDt=0,r._actionInstant=!1,r._innerAction=null,void 0!==i&&r.initWithAction(e,i),r}Me(e,t);var i=e.prototype;return i.initWithAction=function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof Yu&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},i.startWithTarget=function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,Ju.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.stop=function(){this._innerAction.stop(),Uu.prototype.stop.call(this)},i.update=function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,r=this._times,n=this._nextDt;if(t>=n){for(;t>n&&this._total<r;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),n+=e._duration/i,this._nextDt=n>1?1:n;t>=1&&this._total<r&&(e.update(1),this._total++),this._actionInstant||(this._total===r?e.stop():e.update(t-(n-e._duration/i)))}else e.update(t*r%1)},i.isDone=function(){return this._total===this._times},i.reverse=function(){var t=new e(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction},e}(Ju),ec=function(t){function e(e){var i;return(i=t.call(this)||this)._innerAction=null,e&&i.initWithAction(e),i}Me(e,t);var i=e.prototype;return i.initWithAction=function(t){return t?(this._innerAction=t,!0):(Ie(1026),!1)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},i.startWithTarget=function(t){Ju.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.step=function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},i.isDone=function(){return!1},i.reverse=function(){var t=new e(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction},e}(Ju),ic=function(t){function e(i){var r;(r=t.call(this)||this)._one=null,r._two=null;var n=i instanceof Array?i:arguments;if(1===n.length)return Ie(1020),ti(r);var s=n.length-1;if(s>=0&&null==n[s]&&ji(1015),s>=0){for(var a,o=n[0],l=1;l<s;l++)n[l]&&(a=o,o=e._actionOneTwo(a,n[l]));r.initWithTwoActions(o,n[s])}return r}Me(e,t);var i=e.prototype;return i.initWithTwoActions=function(t,e){if(!t||!e)return Ie(1027),!1;var i=!1,r=t._duration,n=e._duration;return this.initWithDuration(Math.max(r,n))&&(this._one=t,this._two=e,r>n?this._two=Qu._actionOneTwo(e,sc(r-n)):r<n&&(this._one=Qu._actionOneTwo(t,sc(n-r))),i=!0),i},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},i.startWithTarget=function(t){Ju.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},i.stop=function(){this._one.stop(),this._two.stop(),Uu.prototype.stop.call(this)},i.update=function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},i.reverse=function(){var t=e._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},e}(Ju);function rc(t){var e=t instanceof Array?t:arguments;if(1===e.length)return Ie(1020),null;e.length>0&&null==e[e.length-1]&&ji(1015);for(var i=e[0],r=1;r<e.length;r++)null!=e[r]&&(i=ic._actionOneTwo(i,e[r]));return i}ic._actionOneTwo=function(t,e){var i=new ic;return i.initWithTwoActions(t,e),i};var nc=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.update=function(){},i.reverse=function(){var t=new e(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithDuration(this._duration),t},e}(Ju);function sc(t){return new nc(t)}var ac,oc=function(t){function e(e){var i;return(i=t.call(this)||this)._other=null,e&&i.initWithAction(e),i}Me(e,t);var i=e.prototype;return i.initWithAction=function(t){return t?t===this._other?(Ie(1029),!1):!!Ju.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(Ie(1028),!1)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},i.startWithTarget=function(t){Ju.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},i.update=function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},i.reverse=function(){return this._other.clone()},i.stop=function(){this._other.stop(),Uu.prototype.stop.call(this)},e}(Ju),lc=function(t){function e(e,i,r){var n;if((n=t.call(this)||this)._opts=void 0,n._props=void 0,n._originProps=void 0,null==r)r=Object.create(null);else if(function(t){var e=" [Tween:] ",i=" option is not support in v + "+Ji,r=t;r.delay&&We(e+"delay"+i),r.repeat&&We(e+"repeat"+i),r.repeatDelay&&We(e+"repeatDelay"+i),r.interpolation&&We(e+"interpolation"+i),r.onStop&&We(e+"onStop"+i)}(r),r.easing&&"string"==typeof r.easing&&(r.easing=function(t){var e=t.charAt(0);if(/[A-Z]/.test(e)){var i=(t=t.replace(e,e.toLowerCase())).split("-");if(2===i.length){var r=i[0];if("linear"===r)t="linear";else{var n=i[1];switch(r){case"quadratic":t="quad"+n;break;case"quartic":t="quart"+n;break;case"quintic":t="quint"+n;break;case"sinusoidal":t="sine"+n;break;case"exponential":t="expo"+n;break;case"circular":t="circ"+n;break;default:t=r+n}}}}return t}(r.easing)),r.progress||(r.progress=n.progress),r.easing&&"string"==typeof r.easing){var s=r.easing;r.easing=Zi[s],r.easing||He(1031,s)}for(var a in n._opts=r,n._props=Object.create(null),i)if(i.hasOwnProperty(a)){var o=i[a];if("function"==typeof o&&(o=o()),null!=o&&"string"!=typeof o){var l=void 0,h=void 0;void 0!==o.value&&(o.easing||o.progress)&&("string"==typeof o.easing?(l=Zi[o.easing])||He(1031,o.easing):l=o.easing,h=o.progress,o=o.value);var u=Object.create(null);u.value=o,u.easing=l,u.progress=h,n._props[a]=u}}return n._originProps=i,n.initWithDuration(e),n}Me(e,t);var i=e.prototype;return i.clone=function(){var t=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},i.startWithTarget=function(t){Ju.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative,i=this._props;for(var r in i){var n=t[r];if(void 0!==n){var s=i[r],a=s.value;if("number"==typeof n)s.start=n,s.current=n,s.end=e?n+a:a;else if("object"==typeof n)for(var o in null==s.start&&(s.start={},s.current={},s.end={}),a)isNaN(n[o])||(s.start[o]=n[o],s.current[o]=n[o],s.end[o]=e?n[o]+a[o]:a[o])}}this._opts.onStart&&this._opts.onStart(this.target)},i.update=function(t){var e=this.target;if(e){var i=this._props,r=this._opts,n=t;r.easing&&(n=r.easing(t));var s=r.progress;for(var a in i){var o=i[a],l=o.easing?o.easing(t):n,h=o.progress?o.progress:s,u=o.start,c=o.end;if("number"==typeof u)o.current=h(u,c,o.current,l);else if("object"==typeof u)for(var p in u)o.current[p]=h(u[p],c[p],o.current[p],l);e[a]=o.current}r.onUpdate&&r.onUpdate(this.target,t),1===t&&r.onComplete&&r.onComplete(this.target)}},i.progress=function(t,e,i,r){return t+(e-t)*r},e}(Ju),hc=function(t){function e(e){var i;return(i=t.call(this)||this)._props=void 0,i._props={},void 0!==e&&i.init(e),i}Me(e,t);var i=e.prototype;return i.init=function(t){for(var e in t)this._props[e]=t[e];return!0},i.update=function(){var t=this._props,e=this.target;for(var i in t)e[i]=t[i]},i.clone=function(){var t=new e;return t.init(this._props),t},e}(Yu),uc=t("Tween",function(){function t(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=Uu.TAG_INVALID,this._target=void 0===t?null:t}var e=t.prototype;return e.tag=function(t){return this._tag=t,this},e.then=function(t){return t instanceof Uu?this._actions.push(t.clone()):this._actions.push(t._union()),this},e.target=function(t){return this._target=t,this},e.start=function(){return this._target?(this._finalAction&&Xu.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),Xu.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(We("Please set target to tween first"),this)},e.stop=function(){return this._finalAction&&Xu.instance.ActionManager.removeAction(this._finalAction),this},e.clone=function(t){var e=this._union();return cc(t).then(e.clone())},e.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},e.to=function(t,e,i){(i=i||Object.create(null)).relative=!1;var r=new lc(t,e,i);return this._actions.push(r),this},e.by=function(t,e,i){(i=i||Object.create(null)).relative=!0;var r=new lc(t,e,i);return this._actions.push(r),this},e.set=function(t){var e=new hc(t);return this._actions.push(e),this},e.delay=function(t){var e=sc(t);return this._actions.push(e),this},e.call=function(t){var e=function(t){return new Zu(t,void 0,void 0)}(t);return this._actions.push(e),this},e.sequence=function(){var e=t._wrappedSequence.apply(t,arguments);return this._actions.push(e),this},e.parallel=function(){var e=t._wrappedParallel.apply(t,arguments);return this._actions.push(e),this},e.repeat=function(e,i){if(e==1/0)return this.repeatForever(i);var r,n=this._actions;return r=i instanceof t?i._union():n.pop(),n.push(function(t,e){return new tc(t,e)}(r,e)),this},e.repeatForever=function(e){var i,r=this._actions;return i=e instanceof t?e._union():r.pop(),r.push(function(t){return new ec(t)}(i)),this},e.reverseTime=function(e){var i,r=this._actions;return i=e instanceof t?e._union():r.pop(),r.push(function(t){return new oc(t)}(i)),this},e.hide=function(){var t=new Ku;return this._actions.push(t),this},e.show=function(){var t=new ju;return this._actions.push(t),this},e.removeSelf=function(){var t=new qu(!1);return this._actions.push(t),this},t.stopAll=function(){Xu.instance.ActionManager.removeAllActions()},t.stopAllByTag=function(t,e){Xu.instance.ActionManager.removeActionByTag(t,e)},t.stopAllByTarget=function(t){Xu.instance.ActionManager.removeAllActionsFromTarget(t)},e._union=function(){var t=this._actions;return 1===t.length?t[0]:$u(t)},e._destroy=function(){this.stop()},t._wrappedSequence=function(){var e=t._tmp_args;e.length=0;for(var i=arguments.length,r=0;r<i;r++){var n=e[r]=r<0||arguments.length<=r?void 0:arguments[r];n instanceof t&&(e[r]=n._union())}return $u.apply($u,e)},t._wrappedParallel=function(){var e=t._tmp_args;e.length=0;for(var i=arguments.length,r=0;r<i;r++){var n=e[r]=r<0||arguments.length<=r?void 0:arguments[r];n instanceof t&&(e[r]=n._union())}return rc.apply(rc,e)},t}());function cc(t){return new uc(t)}function pc(t){return We("tweenUtil' is deprecated, please use 'tween' instead "),new uc(t)}uc._tmp_args=[],Xe.Tween=uc,Xe.tween=cc,Xe.tweenUtil=pc,function(t){t[t.positions=Wt.ATTR_POSITION]="positions",t[t.normals=Wt.ATTR_NORMAL]="normals",t[t.uvs=Wt.ATTR_TEX_COORD]="uvs",t[t.colors=Wt.ATTR_COLOR]="colors"}(ac||(ac={}));var dc,fc,_c,gc,mc,yc,vc=function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var i=t-e;this._arrayBufferOrPaddings.push(i),this._length+=i}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(i){"number"==typeof i?e+=i:(t.set(new Uint8Array(i),e),e+=i.byteLength)})),t.buffer},t}(),bc=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var i=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(i).fill(null);for(var r=0;r<i;++r){var n=this._mesh.struct.morph.subMeshMorphs[r];n&&(n.targets.length>tr.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[r]=new Tc(this._mesh,r,this._mesh.struct.morph,e):this._subMeshRenderings[r]=new Sc(this._mesh,r,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,i=new Array(e),r=0;r<e;++r){var n,s;i[r]=null!==(n=null===(s=this._subMeshRenderings[r])||void 0===s?void 0:s.createInstance())&&void 0!==n?n:null}return{setWeights:function(t,e){var r;null===(r=i[t])||void 0===r||r.setWeights(e)},requiredPatches:function(e){ar(t._mesh.struct.morph);var r=t._mesh.struct.morph.subMeshMorphs[e],n=i[e];if(null===n)return null;var s=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:r.targets.length}];return r.attributes.includes(Wt.ATTR_POSITION)&&s.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),r.attributes.includes(Wt.ATTR_NORMAL)&&s.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),r.attributes.includes(Wt.ATTR_TANGENT)&&s.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),s.push.apply(s,n.requiredPatches()),s},adaptPipelineState:function(t,e){var r;null===(r=i[t])||void 0===r||r.adaptPipelineState(e)},destroy:function(){for(var t,e=ke(i);!(t=e()).done;){var r=t.value;null==r||r.destroy()}}}},t}(),Sc=function(){function t(t,e,i,r){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=r;var n=i.subMeshMorphs[e];this._subMeshMorph=n,Rc(t,e,r);var s=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=s;var a=n.targets.length,o=Cc(r,s*a);this._textureInfo={width:o.width,height:o.height},this._attributes=n.attributes.map((function(e,i){var r=o.create(),a=r.valueView;return n.targets.forEach((function(e,r){for(var n=e.displacements[i],o=new Float32Array(t.data.buffer,t.data.byteOffset+n.offset,n.count),l=s*r*4,h=0;h<s;++h)a[l+4*h+0]=o[3*h+0],a[l+4*h+1]=o[3*h+1],a[l+4*h+2]=o[3*h+2]})),r.updatePixels(),{name:e,morphTexture:r}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=ke(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new Ec(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(i){for(var r,n=ke(t._attributes);!(r=n()).done;){var s=r.value,a=void 0;switch(s.name){case Wt.ATTR_POSITION:a=hr;break;case Wt.ATTR_NORMAL:a=lr;break;case Wt.ATTR_TANGENT:a=or;break;default:We("Unexpected attribute!")}void 0!==a&&(i.bindSampler(a,s.morphTexture.sampler),i.bindTexture(a,s.morphTexture.texture))}i.bindBuffer(tr.BINDING,e.buffer),i.update()},destroy:function(){}}},t}(),Tc=function(){function t(t,e,i,r){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=r;var n=i.subMeshMorphs[e];Rc(t,e,r),this._attributes=n.attributes.map((function(e,i){return{name:e,targets:n.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[i].offset,e.displacements[i].count)}}))}}))}return t.prototype.createInstance=function(){return new Ac(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},Be(t,[{key:"data",get:function(){return this._attributes}}]),t}(),Ac=function(){function t(t,e,i){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new Ec(i,0);var r=Cc(i,e);this._morphUniforms.setMorphTextureInfo(r.width,r.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=r.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var i=this._attributes[e],r=i.morphTexture.valueView,n=this._owner.data[e];$i(t.length===n.targets.length);for(var s=0;s<n.targets.length;++s){var a=n.targets[s].displacements,o=t[s],l=a.length/3;if(0===s)for(var h=0;h<l;++h)r[4*h+0]=a[3*h+0]*o,r[4*h+1]=a[3*h+1]*o,r[4*h+2]=a[3*h+2]*o;else if(0!==o)for(var u=0;u<l;++u)r[4*u+0]+=a[3*u+0]*o,r[4*u+1]+=a[3*u+1]*o,r[4*u+2]+=a[3*u+2]*o}i.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,i=ke(this._attributes);!(e=i()).done;){var r=e.value,n=void 0;switch(r.attributeName){case Wt.ATTR_POSITION:n=hr;break;case Wt.ATTR_NORMAL:n=lr;break;case Wt.ATTR_TANGENT:n=or;break;default:We("Unexpected attribute!")}void 0!==n&&(t.bindSampler(n,r.morphTexture.sampler),t.bindTexture(n,r.morphTexture.texture))}t.bindBuffer(tr.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),Ec=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(tr.SIZE)),this._remoteBuffer=t.createBuffer(new nt(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,tr.SIZE,tr.SIZE))}var e=t.prototype;return e.destroy=function(){this._remoteBuffer.destroy()},e.setWeights=function(t){$i(t.length===this._targetCount);for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(tr.OFFSET_OF_WEIGHTS+4*e,t[e],Xe.sys.isLittleEndian)},e.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(tr.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,Xe.sys.isLittleEndian),this._localBuffer.setFloat32(tr.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,Xe.sys.isLittleEndian)},e.setVerticesCount=function(t){this._localBuffer.setFloat32(tr.OFFSET_OF_VERTICES_COUNT,t,Xe.sys.isLittleEndian)},e.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},Be(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function Cc(t,e){var i,r,n,s;t.hasFeature(c.TEXTURE_FLOAT)?(i=e,n=16,r=ir.PixelFormat.RGBA32F,s=Float32Array):(i=4*e,n=4,r=ir.PixelFormat.RGBA8888,s=Uint8Array);var a=function(t){t<5&&(t=5);var e=nr(t),i=sr(e),r=i>>1;return{width:1<<(1&i?r+1:r),height:1<<r}}(i),o=a.width,l=a.height;return{width:o,height:l,create:function(){var e=new ArrayBuffer(o*l*n),i=new Float32Array(e),a=s===Float32Array?i:new s(e),h=new er({width:o,height:l,_data:a,_compressed:!1,format:r}),u=new ir;u.setFilters(ir.Filter.NEAREST,ir.Filter.NEAREST),u.setMipFilter(ir.Filter.NONE),u.setWrapMode(ir.WrapMode.CLAMP_TO_EDGE,ir.WrapMode.CLAMP_TO_EDGE,ir.WrapMode.CLAMP_TO_EDGE),u.image=h,u.getGFXTexture()||We("Unexpected: failed to create morph texture?");var c=rr.getSampler(t,u.getSamplerHash());return{get texture(){return u.getGFXTexture()},get sampler(){return c},get valueView(){return i},destroy:function(){u.destroy()},updatePixels:function(){u.uploadData(a)}}}}}function Rc(t,e,i){t.renderingSubMeshes[e].enableVertexIdChannel(i)}function wc(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var xc=new Si,Oc=new Si,Pc=new Uint8Array,Dc=t("Mesh",Ze("cc.Mesh")((yc=function(t){function e(){var e;return(e=t.call(this)||this).morphRendering=null,$e(e,"_struct",_c,ti(e)),$e(e,"_dataLength",gc,ti(e)),$e(e,"_hash",mc,ti(e)),e._data=Pc,e._initialized=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e.loaded=!1,e}Me(e,t);var i=e.prototype;return i.initialize=function(){var t=this;if(!this._initialized){this._initialized=!0,this._data.byteLength!==this._dataLength&&(this._data=new Uint8Array(this._dataLength),Xe.assetManager.postLoadNative(this));for(var e=this._data.buffer,i=Xe.director.root.device,r=this._createVertexBuffers(i,e),n=[],s=function(s){var a=t._struct.primitives[s];if(0===a.vertexBundelIndices.length)return"continue";var o=null,l=null;if(a.indexView){var h=a.indexView,u=h.stride,p=h.length;if(4===u&&!i.hasFeature(c.ELEMENT_INDEX_UINT)){var d=t._struct.vertexBundles[a.vertexBundelIndices[0]].view.count;if(d>=65536)return He(10001,d,65536),"continue";u>>=1,p>>=1}o=i.createBuffer(new nt(_.INDEX,y.DEVICE,p,u)),l=new(wc(h.stride))(e,h.offset,h.count),h.stride!==u&&(l=wc(u).from(l)),t.loaded?o.update(l):t.once("load",(function(){o.update(l)}))}var f=a.vertexBundelIndices.map((function(t){return r[t]})),g=[];if(a.vertexBundelIndices.length>0)for(var m=a.vertexBundelIndices[0],v=t._struct.vertexBundles[m].attributes,b=0;b<v.length;++b){var S=v[b];g[b]=new St(S.name,S.format,S.isInstanced,S.stream,S.isInstanced,S.location)}var T=new cr(f,g,a.primitiveMode,o);T.mesh=t,T.subMeshIdx=s,n.push(T)},a=0;a<this._struct.primitives.length;a++)s(a);this._renderingSubMeshes=n,this._struct.morph&&(this.morphRendering=function(t,e){return new bc(t,e)}(this,i))}},i.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},i.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1}},i.assign=function(t,e){this.reset({struct:t,data:e})},i.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._dataLength=this.data.byteLength,this._hash=0,this.loaded=!0,this.emit("load")},i.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var i=[],r=t.bindposes,n=0;n<r.length;n++)e.push(new Ti(1/0,1/0,1/0,-1/0,-1/0,-1/0)),i.push(!1);for(var s=this._struct.primitives,a=0;a<s.length;a++){var o=this.readAttribute(a,Wt.ATTR_JOINTS),l=this.readAttribute(a,Wt.ATTR_WEIGHTS),h=this.readAttribute(a,Wt.ATTR_POSITION);if(o&&l&&h)for(var u=Math.min(o.length/4,l.length/4,h.length/3),c=0;c<u;c++){Si.set(xc,h[3*c+0],h[3*c+1],h[3*c+2]);for(var p=0;p<4;++p){var d=4*c+p,f=o[d];if(!(0===l[d]||f>=r.length)){Si.transformMat4(Oc,xc,r[f]),i[f]=!0;var _=e[f];Si.min(_.center,_.center,Oc),Si.max(_.halfExtents,_.halfExtents,Oc)}}}}for(var g=0;g<r.length;g++){var m=e[g];i[g]?Ti.fromPoints(m,m.center,m.halfExtents):e[g]=null}return e},i.merge=function(t,e,i){if(i&&(!this.loaded||!t.loaded||!this.validateMergingMesh(t)))return!1;var r=new Si,n=e&&new ur,s=e&&new Ti;if(n&&e.getRotation(n),!this._initialized){var a=JSON.parse(JSON.stringify(t._struct)),o=t._data.slice();if(e){a.maxPosition&&a.minPosition&&(Si.add(s.center,a.maxPosition,a.minPosition),Si.multiplyScalar(s.center,s.center,.5),Si.subtract(s.halfExtents,a.maxPosition,a.minPosition),Si.multiplyScalar(s.halfExtents,s.halfExtents,.5),Ti.transform(s,s,e),Si.add(a.maxPosition,s.center,s.halfExtents),Si.subtract(a.minPosition,s.center,s.halfExtents));for(var l=0;l<a.vertexBundles.length;l++)for(var h=a.vertexBundles[l],u=0;u<h.attributes.length;u++)if(h.attributes[u].name===Wt.ATTR_POSITION||h.attributes[u].name===Wt.ATTR_NORMAL){var c=h.attributes[u].format,p=new DataView(o.buffer,h.view.offset+Mc(h.attributes,u)),d=Lc(p,c),f=Fc(p,c);if(!d||!f)continue;for(var _=h.view.count,g=h.view.stride,m=Ic(c),y=0;y<_;y++){var v=y*g,b=v+m,S=b+m;switch(r.set(d(v),d(b),d(S)),h.attributes[u].name){case Wt.ATTR_POSITION:r.transformMat4(e);break;case Wt.ATTR_NORMAL:Si.transformQuat(r,r,n)}f(v,r.x),f(b,r.y),f(S,r.z)}}}return this.reset({struct:a,data:o}),this.initialize(),!0}for(var T,A,E,C,R,w=new vc,x=0,O=0,P=0,D=0,M=0,B=0,I=0,L=0,F=!1,k=new Array(this._struct.vertexBundles.length),N=0;N<this._struct.vertexBundles.length;++N){var G=this._struct.vertexBundles[N],U=t._struct.vertexBundles[N];P=G.view.offset,D=U.view.offset,O=G.view.stride,x=G.view.count+U.view.count,T=new ArrayBuffer(x*O),A=new Uint8Array(T),P+=(E=this._data.subarray(P,P+G.view.length)).length,D+=(C=t._data.subarray(D,D+U.view.length)).length,A.set(E),M=0;for(var z,V=ke(G.attributes);!(z=V()).done;){var H=z.value;I=0,F=!1;for(var W,X=ke(U.attributes);!(W=X()).done;){var Y=W.value;if(H.name===Y.name&&H.format===Y.format){F=!0;break}I+=Xt[Y.format].size}if(F){L=Xt[H.format].size,B=G.view.length+M;for(var j=0;j<U.view.count;++j){if(R=C.subarray(I,I+L),A.set(R,B),(H.name===Wt.ATTR_POSITION||H.name===Wt.ATTR_NORMAL)&&e){var K=new Float32Array(A.buffer,B,3);switch(r.set(K[0],K[1],K[2]),H.name){case Wt.ATTR_POSITION:r.transformMat4(e);break;case Wt.ATTR_NORMAL:Si.transformQuat(r,r,n)}K[0]=r.x,K[1]=r.y,K[2]=r.z}B+=G.view.stride,I+=U.view.stride}}M+=Xt[H.format].size}k[N]={attributes:G.attributes,view:{offset:w.getLength(),length:T.byteLength,count:x,stride:O}},w.addBuffer(T)}for(var q,Z,J,Q=0,$=2,tt=0,et=new Array(this._struct.primitives.length),it=0;it<this._struct.primitives.length;++it){var rt=this._struct.primitives[it],nt=t._struct.primitives[it];et[it]={primitiveMode:rt.primitiveMode,vertexBundelIndices:rt.vertexBundelIndices};for(var st,at=ke(rt.vertexBundelIndices);!(st=at()).done;){var ot=st.value;tt=Math.max(tt,this._struct.vertexBundles[ot].view.count)}if(rt.indexView&&nt.indexView){Q=rt.indexView.count,Q+=nt.indexView.count,P=rt.indexView.offset,D=nt.indexView.offset,$=Q<256?1:Q<65536?2:4;var lt=new ArrayBuffer(Q*$);if(q=2===$?new Uint16Array(lt):1===$?new Uint8Array(lt):new Uint32Array(lt),Z=2===rt.indexView.stride?new Uint16Array(this._data.buffer,P,rt.indexView.count):1===rt.indexView.stride?new Uint8Array(this._data.buffer,P,rt.indexView.count):new Uint32Array(this._data.buffer,P,rt.indexView.count),$===rt.indexView.stride)q.set(Z);else for(var ht=0;ht<rt.indexView.count;++ht)q[ht]=Z[ht];P+=rt.indexView.length,J=2===nt.indexView.stride?new Uint16Array(t._data.buffer,D,nt.indexView.count):1===nt.indexView.stride?new Uint8Array(t._data.buffer,D,nt.indexView.count):new Uint32Array(t._data.buffer,D,nt.indexView.count);for(var ut=0;ut<nt.indexView.count;++ut)q[rt.indexView.count+ut]=tt+J[ut];D+=nt.indexView.length,et[it].indexView={offset:w.getLength(),length:lt.byteLength,count:Q,stride:$},w.setNextAlignment($),w.addBuffer(lt)}}var ct={vertexBundles:k,primitives:et,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return ct.minPosition&&t._struct.minPosition&&ct.maxPosition&&t._struct.maxPosition&&(e?(Si.add(s.center,t._struct.maxPosition,t._struct.minPosition),Si.multiplyScalar(s.center,s.center,.5),Si.subtract(s.halfExtents,t._struct.maxPosition,t._struct.minPosition),Si.multiplyScalar(s.halfExtents,s.halfExtents,.5),Ti.transform(s,s,e),Si.add(r,s.center,s.halfExtents),Si.max(ct.maxPosition,ct.maxPosition,r),Si.subtract(r,s.center,s.halfExtents),Si.min(ct.minPosition,ct.minPosition,r)):(Si.min(ct.minPosition,ct.minPosition,t._struct.minPosition),Si.max(ct.maxPosition,ct.maxPosition,t._struct.maxPosition))),this.reset({struct:ct,data:new Uint8Array(w.getCombined())}),this.initialize(),!0},i.validateMergingMesh=function(t){if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var i=this._struct.vertexBundles[e],r=t._struct.vertexBundles[e];if(i.attributes.length!==r.attributes.length)return!1;for(var n=0;n<i.attributes.length;++n)if(i.attributes[n].format!==r.attributes[n].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var s=0;s<this._struct.primitives.length;++s){var a=this._struct.primitives[s],o=t._struct.primitives[s];if(a.vertexBundelIndices.length!==o.vertexBundelIndices.length)return!1;for(var l=0;l<a.vertexBundelIndices.length;++l)if(a.vertexBundelIndices[l]!==o.vertexBundelIndices[l])return!1;if(a.primitiveMode!==o.primitiveMode)return!1;if(a.indexView){if(void 0===o.indexView)return!1}else if(o.indexView)return!1}return!0},i.readAttribute=function(t,e){var i=this,r=null;return this._accessAttribute(t,e,(function(t,e){var n=t.view.count,s=t.attributes[e].format,a=te(Xt[s]);if(0!==n){var o=new DataView(i._data.buffer,t.view.offset+Mc(t.attributes,e)),l=Xt[s],h=Lc(o,s);if(a&&h){for(var u=l.count,c=new a(n*u),p=t.view.stride,d=0;d<n;++d)for(var f=0;f<u;++f)c[u*d+f]=h(p*d+c.BYTES_PER_ELEMENT*f);r=c}}})),r},i.copyAttribute=function(t,e,i,r,n){var s=this,a=!1;return this._accessAttribute(t,e,(function(t,e){var o=t.view.count;if(0!==o){var l=t.attributes[e].format,h=new DataView(s._data.buffer,t.view.offset+Mc(t.attributes,e)),u=new DataView(i,n),c=Xt[l],p=Lc(h,l),d=Fc(u,l);if(p&&d){for(var f=c.count,_=t.view.stride,g=Ic(l),m=r,y=g,v=0;v<o;++v)for(var b=0;b<f;++b)d(m*v+y*b,p(_*v+g*b));a=!0}}else a=!0})),a},i.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var i=e.indexView.stride;return new(1===i?Uint8Array:2===i?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},i.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var i=this._struct.primitives[t];if(!i.indexView)return!1;for(var r=i.indexView.count,n=1===i.indexView.stride?p.R8UI:2===i.indexView.stride?p.R16UI:p.R32UI,s=Lc(new DataView(this._data.buffer),n),a=0;a<r;++a)e[a]=s(i.indexView.offset+Xt[n].size*a);return!0},i._accessAttribute=function(t,e,i){if(!(t>=this._struct.primitives.length))for(var r,n=this._struct.primitives[t],s=ke(n.vertexBundelIndices);!(r=s()).done;){var a=r.value,o=this._struct.vertexBundles[a],l=o.attributes.findIndex((function(t){return t.name===e}));if(!(l<0)){i(o,l);break}}},i._createVertexBuffers=function(t,e){var i=this;return this._struct.vertexBundles.map((function(r){var n=t.createBuffer(new nt(_.VERTEX,y.DEVICE,r.view.length,r.view.stride)),s=new Uint8Array(e,r.view.offset,r.view.length);return i.loaded?n.update(s):i.once("load",(function(){n.update(s)})),n}))},i.initDefault=function(e){t.prototype.initDefault.call(this,e),this.reset({struct:{vertexBundles:[],primitives:[]},data:Pc})},i.validate=function(){return this.renderingSubMeshes.length>0&&this.data.byteLength>0},Be(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data.byteLength===t.byteLength?this._data.set(new Uint8Array(t)):this._data=new Uint8Array(t),this.loaded=!0,this.emit("load")}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=pr(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}}]),e}(Je),_c=je((fc=yc).prototype,"_struct",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),gc=je(fc.prototype,"_dataLength",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mc=je(fc.prototype,"_hash",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dc=fc))||dc);function Mc(t,e){for(var i=0,r=0;r<e;++r){var n=t[r];i+=Xt[n.format].size}return i}Xe.Mesh=Dc;var Bc=Ue.isLittleEndian;function Ic(t){var e=Xt[t];return e.size/e.count}function Lc(t,e){var i=Xt[e],r=i.size/i.count;switch(i.type){case d.UNORM:switch(r){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Bc)};case 4:return function(e){return t.getUint32(e,Bc)}}break;case d.SNORM:case d.INT:switch(r){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,Bc)};case 4:return function(e){return t.getInt32(e,Bc)}}break;case d.UINT:switch(r){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Bc)};case 4:return function(e){return t.getUint32(e,Bc)}}break;case d.FLOAT:return function(e){return t.getFloat32(e,Bc)}}return null}function Fc(t,e){var i=Xt[e],r=i.size/i.count;switch(i.type){case d.UNORM:switch(r){case 1:return function(e,i){return t.setUint8(e,i)};case 2:return function(e,i){return t.setUint16(e,i,Bc)};case 4:return function(e,i){return t.setUint32(e,i,Bc)}}break;case d.SNORM:case d.INT:switch(r){case 1:return function(e,i){return t.setInt8(e,i)};case 2:return function(e,i){return t.setInt16(e,i,Bc)};case 4:return function(e,i){return t.setInt32(e,i,Bc)}}break;case d.UINT:switch(r){case 1:return function(e,i){return t.setUint8(e,i)};case 2:return function(e,i){return t.setUint16(e,i,Bc)};case 4:return function(e,i){return t.setUint32(e,i,Bc)}}break;case d.FLOAT:return function(e,i){return t.setFloat32(e,i,Bc)}}return null}var kc=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_NORMAL,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RG32F),new St(Wt.ATTR_TANGENT,p.RGBA32F),new St(Wt.ATTR_COLOR,p.RGBA32F)],Nc=new Si;function Gc(t,e,i){i=i||{};var r,n=[],s=0,a=[],o=0,l=t.positions.slice();if(l.length>0){if(r=null,t.attributes)for(var h,u=ke(t.attributes);!(h=u()).done;){var c=h.value;if(c.name===Wt.ATTR_POSITION){r=c;break}}r||(r=kc[0]),n.push(r);var d=Xt[r.format];o=Math.max(o,Math.floor(l.length/d.count)),a.push({offset:s,data:l,attribute:r}),s+=d.size}if(t.normals&&t.normals.length>0){if(r=null,t.attributes)for(var f,_=ke(t.attributes);!(f=_()).done;){var g=f.value;if(g.name===Wt.ATTR_NORMAL){r=g;break}}r||(r=kc[1]);var m=Xt[r.format];n.push(r),o=Math.max(o,Math.floor(t.normals.length/m.count)),a.push({offset:s,data:t.normals,attribute:r}),s+=m.size}if(t.uvs&&t.uvs.length>0){if(r=null,t.attributes)for(var y,v=ke(t.attributes);!(y=v()).done;){var b=y.value;if(b.name===Wt.ATTR_TEX_COORD){r=b;break}}r||(r=kc[2]);var S=Xt[r.format];n.push(r),o=Math.max(o,Math.floor(t.uvs.length/S.count)),a.push({offset:s,data:t.uvs,attribute:r}),s+=S.size}if(t.tangents&&t.tangents.length>0){if(r=null,t.attributes)for(var T,A=ke(t.attributes);!(T=A()).done;){var E=T.value;if(E.name===Wt.ATTR_TANGENT){r=E;break}}r||(r=kc[3]);var C=Xt[r.format];n.push(r),o=Math.max(o,Math.floor(t.tangents.length/C.count)),a.push({offset:s,data:t.tangents,attribute:r}),s+=C.size}if(t.colors&&t.colors.length>0){if(r=null,t.attributes)for(var R,w=ke(t.attributes);!(R=w()).done;){var x=R.value;if(x.name===Wt.ATTR_COLOR){r=x;break}}r||(r=kc[4]);var O=Xt[r.format];n.push(r),o=Math.max(o,Math.floor(t.colors.length/O.count)),a.push({offset:s,data:t.colors,attribute:r}),s+=O.size}if(t.customAttributes)for(var P,D=ke(t.customAttributes);!(P=D()).done;){var M=P.value,B=Xt[M.attr.format];n.push(M.attr),o=Math.max(o,Math.floor(M.values.length/B.count)),a.push({offset:s,data:M.values,attribute:M.attr}),s+=B.size}for(var I=new vc,F=new ArrayBuffer(o*s),k=new DataView(F),N=0,G=a;N<G.length;N++){var U=G[N];dr(k,U.data,U.attribute.format,U.offset,s)}I.setNextAlignment(0);var z={attributes:n,view:{offset:I.getLength(),length:F.byteLength,count:o,stride:s}};I.addBuffer(F);var V=null,H=0;if(t.indices){var W=t.indices;H=W.length,V=new ArrayBuffer(2*H);var X=new DataView(V);dr(X,W,p.R16UI)}var Y={primitiveMode:t.primitiveMode||L.TRIANGLE_LIST,vertexBundelIndices:[0]};V&&(I.setNextAlignment(2),Y.indexView={offset:I.getLength(),length:V.byteLength,count:H,stride:2},I.addBuffer(V));var j=t.minPos;if(!j&&i.calculateBounds){j=Si.set(new Si,1/0,1/0,1/0);for(var K=0;K<o;++K)Si.set(Nc,l[3*K+0],l[3*K+1],l[3*K+2]),Si.min(j,j,Nc)}var q=t.maxPos;if(!q&&i.calculateBounds){q=Si.set(new Si,-1/0,-1/0,-1/0);for(var Z=0;Z<o;++Z)Si.set(Nc,l[3*Z+0],l[3*Z+1],l[3*Z+2]),Si.max(q,q,Nc)}var J={vertexBundles:[z],primitives:[Y]};return j&&(J.minPosition=new Si(j.x,j.y,j.z)),q&&(J.maxPosition=new Si(q.x,q.y,q.z)),e||(e=new Dc),e.reset({struct:J,data:new Uint8Array(I.getCombined())}),e}var Uc=Object.freeze({__proto__:null,find:fr,toPPM:function(t,e,i){return"P3 "+e+" "+i+" 255\n"+t.filter((function(t,e){return e%4<3})).toString()+"\n"},readMesh:function(t,e){void 0===e&&(e=0);for(var i,r={positions:[]},n=new DataView(t.data.buffer,t.data.byteOffset,t.data.byteLength),s=t.struct,a=s.primitives[e],o=ke(a.vertexBundelIndices);!(i=o()).done;)for(var l,h=i.value,u=s.vertexBundles[h],c=u.view.offset,d=u.view,f=d.length,_=d.stride,g=ke(u.attributes);!(l=g()).done;){var m=l.value,y=ac[m.name];y&&(r[y]=(r[y]||[]).concat(Qi(n,m.format,c,f,_))),c+=Xt[m.format].size}var v=a.indexView;return r.indices=Qi(n,p["R"+8*v.stride+"UI"],v.offset,v.length),r},createMesh:Gc,readBuffer:Qi,writeBuffer:dr,mapBuffer:_r});t("utils",Uc);var zc,Vc,Hc,Wc,Xc,Yc,jc,Kc,qc,Zc,Jc,Qc,$c,tp,ep,ip,rp,np,sp,ap,op,lp,hp,up,cp,pp,dp,fp,_p,gp,mp,yp,vp,bp,Sp,Tp,Ap,Ep,Cp,Rp,wp=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._morphRenderingInstance=null,e._usedMaterials=new Set,e}Me(e,t);var i=e.prototype;return i.getMacroPatches=function(t){return this._morphRenderingInstance?this._morphRenderingInstance.requiredPatches(t):null},i.initSubModel=function(e,i,r){return t.prototype.initSubModel.call(this,e,i,this._launderMaterial(r))},i.destroy=function(){t.prototype.destroy.call(this),this._morphRenderingInstance=null},i.setSubModelMaterial=function(e,i){return t.prototype.setSubModelMaterial.call(this,e,this._launderMaterial(i))},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i),this._morphRenderingInstance&&this._morphRenderingInstance.adaptPipelineState(e,i)},i._launderMaterial=function(t){return t},i.setMorphRendering=function(t){this._morphRenderingInstance=t},e}(gr),xp=Oi({OFF:0,ON:1}),Op=Oi({OFF:0,ON:1}),Pp=(zc=Ze("cc.ModelLightmapSettings"),Vc=mr("_recieveShadow"),zc((Jc=function(){function t(){$e(this,"texture",Xc,this),$e(this,"uvParam",Yc,this),$e(this,"_bakeable",jc,this),$e(this,"_castShadow",Kc,this),$e(this,"_receiveShadow",qc,this),$e(this,"_lightmapSize",Zc,this)}return Be(t,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}}]),t}(),Xc=je((Wc=Jc).prototype,"texture",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yc=je(Wc.prototype,"uvParam",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Sr}}),jc=je(Wc.prototype,"_bakeable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Kc=je(Wc.prototype,"_castShadow",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qc=je(Wc.prototype,"_receiveShadow",[Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zc=je(Wc.prototype,"_lightmapSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),je(Wc.prototype,"bakeable",[yr],Object.getOwnPropertyDescriptor(Wc.prototype,"bakeable"),Wc.prototype),je(Wc.prototype,"castShadow",[yr],Object.getOwnPropertyDescriptor(Wc.prototype,"castShadow"),Wc.prototype),je(Wc.prototype,"receiveShadow",[yr],Object.getOwnPropertyDescriptor(Wc.prototype,"receiveShadow"),Wc.prototype),je(Wc.prototype,"lightmapSize",[yr],Object.getOwnPropertyDescriptor(Wc.prototype,"lightmapSize"),Wc.prototype),Hc=Wc))||Hc),Dp=function(e){return t({MeshRenderer:e,ModelComponent:e}),e}((Qc=Ze("cc.MeshRenderer"),$c=ai(),tp=Ci(100),ep=oi(),ip=si(xp),rp=li(),np=si(Op),sp=li(),ap=si(Dc),op=li(),lp=Ni(),Qc(hp=$c(hp=tp(hp=ep(hp=vi((mp=gp=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"lightmapSettings",cp,ti(e)),$e(e,"_mesh",pp,ti(e)),$e(e,"_shadowCastingMode",dp,ti(e)),$e(e,"_shadowReceivingMode",fp,ti(e)),e._modelType=void 0,e._model=null,e._morphInstance=null,$e(e,"_enableMorph",_p,ti(e)),e._modelType=gr,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._mesh&&this._mesh.initialize(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},i.onRestore=function(){this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},i.onEnable=function(){this._model||this._updateModels(),this._attachToScene()},i.onDisable=function(){this._model&&this._detachFromScene()},i.onDestroy=function(){this._model&&(Xe.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()},i.setWeights=function(t,e){this._morphInstance&&this._morphInstance.setWeights(e,t)},i.setInstancedAttribute=function(t,e){if(this.model)for(var i=this.model.instancedAttributes,r=i.attributes,n=i.views,s=0;s<r.length;s++)if(r[s].name===t){n[s].set(e);break}},i._updateLightmap=function(t,e,i,r,n){this.lightmapSettings.texture=t,this.lightmapSettings.uvParam.x=e,this.lightmapSettings.uvParam.y=i,this.lightmapSettings.uvParam.z=r,this.lightmapSettings.uvParam.w=n,this._onUpdateLightingmap()},i._updateModels=function(){if(this.enabledInHierarchy&&this._mesh){var t=this._model;t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model&&(this._model.createBoundingShape(this._mesh.struct.minPosition,this._mesh.struct.maxPosition),this._updateModelParams(),this._onUpdateLightingmap())}},i._createModel=function(){var t=this._morphInstance&&this._modelType===gr?wp:this._modelType,e=this._model=Xe.director.root.createModel(t);e.visFlags=this.visibility,e.node=e.transform=this.node,this._models.length=0,this._models.push(this._model),this._morphInstance&&e instanceof wp&&e.setMorphRendering(this._morphInstance)},i._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=vr.POSITION,this._model.transform.hasChangedFlags|=vr.POSITION,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,e=this._mesh.renderingSubMeshes;if(e)for(var i=0;i<t;++i){var r=this.getRenderMaterial(i);r&&!r.isValid&&(r=null);var n=e[i];n&&this._model.initSubModel(i,n,r||this._getBuiltinMaterial())}this._model.enabled=!0}},i._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.lightmapSettings.texture,this.lightmapSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.lightmapSettings.uvParam.x,this.lightmapSettings.uvParam.y,this.lightmapSettings.uvParam.z,this.lightmapSettings.uvParam.w])},i._onMaterialModified=function(t,e){this._model&&this._model.inited&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())},i._onRebuildPSO=function(t,e){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,e),this._onUpdateLightingmap())},i._onMeshChanged=function(){},i._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;++e)this._onMaterialModified(e,null)},i._getBuiltinMaterial=function(){return ki.get("missing-material")},i._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},i._updateCastShadow=function(){this._model&&(this._shadowCastingMode===xp.OFF?this._model.castShadow=!1:($i(this._shadowCastingMode===xp.ON,"ShadowCastingMode "+this._shadowCastingMode+" is not supported."),this._model.castShadow=!0))},i._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===Op.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},i._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var e=this._materials[t];if(e)for(var i=0;i<e.passes.length;++i)if(e.passes[i].batchingScheme)return!0}return!1},i._watchMorphInMesh=function(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){var t=this._mesh.struct.morph;this._morphInstance=this._mesh.morphRendering.createInstance();for(var e=this._mesh.struct.primitives.length,i=0;i<e;++i){var r=t.subMeshMorphs[i];if(r){var n=r.weights||t.weights,s=n?n.slice():new Array(r.targets.length).fill(0);this._morphInstance.setWeights(i,s)}}this._model&&this._model instanceof wp&&this._model.setMorphRendering(this._morphInstance)}},i._syncMorphWeights=function(t){if(this._morphInstance){var e=this._morphInstance[t];e&&e.renderResources&&e.renderResources.setWeights(e.weights)}},Be(e,[{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var e=this._mesh;this._mesh=t,this._mesh&&this._mesh.initialize(),this._watchMorphInMesh(),this._onMeshChanged(e),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}}]),e}(Ui),gp.ShadowCastingMode=xp,gp.ShadowReceivingMode=Op,cp=je((up=mp).prototype,"lightmapSettings",[ei,yr,br],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pp}}),pp=je(up.prototype,"_mesh",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dp=je(up.prototype,"_shadowCastingMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xp.OFF}}),fp=je(up.prototype,"_shadowReceivingMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Op.ON}}),je(up.prototype,"shadowCastingMode",[ip,rp,br],Object.getOwnPropertyDescriptor(up.prototype,"shadowCastingMode"),up.prototype),je(up.prototype,"receiveShadow",[np,sp,br],Object.getOwnPropertyDescriptor(up.prototype,"receiveShadow"),up.prototype),je(up.prototype,"mesh",[ap,op],Object.getOwnPropertyDescriptor(up.prototype,"mesh"),up.prototype),je(up.prototype,"enableMorph",[lp,br],Object.getOwnPropertyDescriptor(up.prototype,"enableMorph"),up.prototype),_p=je(up.prototype,"_enableMorph",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),hp=up))||hp)||hp)||hp)||hp)||hp));function Mp(t,e){var i=t.sharedMaterials.length;if(i!==e.sharedMaterials.length)return!1;for(var r=0;r<i;r++)if(t.getRenderMaterial(r)!==e.getRenderMaterial(r))return!1;return!0}t("BatchingUtility",function(){function t(){}return t.batchStaticModel=function(t,e){var i=t.getComponentsInChildren(Dp);if(i.length<2)return console.error("the number of static models to batch is less than 2,it needn't batch."),!1;for(var r=1;r<i.length;r++){if(!i[0].mesh.validateMergingMesh(i[r].mesh))return console.error("the meshes of "+i[0].node.name+" and "+i[r].node.name+" can't be merged"),!1;if(!Mp(i[0],i[r]))return console.error("the materials of "+i[0].node.name+" and "+i[r].node.name+" can't be merged"),!1}var n=new Dc,s=new gi,a=new gi;t.getWorldMatrix(a),gi.invert(a,a);for(var o=0;o<i.length;o++){var l=i[o];l.node.getWorldMatrix(s),gi.multiply(s,a,s),n.merge(i[o].mesh,s),l.enabled=!1}var h=e.addComponent(Dp);return h.mesh=n,h.sharedMaterials=i[0].sharedMaterials,!0},t.unbatchStaticModel=function(t,e){for(var i=t.getComponentsInChildren(Dp),r=0;r<i.length;r++)i[r].enabled=!0;var n=e.getComponent(Dp);return n&&(n.mesh&&n.mesh.destroyRenderingMesh(),n.destroy()),!0},t}()),ci(Dc.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),zi(Dc.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]);var Bp,Ip,Lp,Fp,kp,Np,Gp,Up,zp,Vp,Hp,Wp,Xp,Yp,jp,Kp,qp,Zp,Jp,Qp,$p,td=t("Skeleton",(yp=Ze("cc.Skeleton"),vp=si([Tr]),bp=si([gi]),yp((Rp=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_joints",Ap,ti(e)),$e(e,"_bindposes",Ep,ti(e)),$e(e,"_hash",Cp,ti(e)),e._invBindposes=null,e}Me(e,t);var i=e.prototype;return i.destroy=function(){return Xe.director.root.dataPoolManager.releaseSkeleton(this),t.prototype.destroy.call(this)},i.validate=function(){return this.joints.length>0&&this.bindposes.length>0},Be(e,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this._invBindposes){this._invBindposes=[];for(var t=0;t<this._bindposes.length;t++){var e=new gi;gi.invert(e,this._bindposes[t]),this._invBindposes.push(e)}}return this._invBindposes}},{key:"hash",get:function(){if(!this._hash){for(var t="",e=0;e<this._bindposes.length;e++){var i=this._bindposes[e];t+=i.m00.toPrecision(2)+" "+i.m01.toPrecision(2)+" "+i.m02.toPrecision(2)+" "+i.m03.toPrecision(2)+" "+i.m04.toPrecision(2)+" "+i.m05.toPrecision(2)+" "+i.m06.toPrecision(2)+" "+i.m07.toPrecision(2)+" "+i.m08.toPrecision(2)+" "+i.m09.toPrecision(2)+" "+i.m10.toPrecision(2)+" "+i.m11.toPrecision(2)+" "+i.m12.toPrecision(2)+" "+i.m13.toPrecision(2)+" "+i.m14.toPrecision(2)+" "+i.m15.toPrecision(2)+"\n"}this._hash=pr(t,666)}return this._hash}}]),e}(Je),Ap=je((Tp=Rp).prototype,"_joints",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ep=je(Tp.prototype,"_bindposes",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cp=je(Tp.prototype,"_hash",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Sp=Tp))||Sp));Xe.Skeleton=td,zi(Dp.prototype,"MeshRenderer.prototype",[{name:"enableDynamicBatching"},{name:"recieveShadows"}]),Xe.ModelComponent=Dp,di.setClassAlias(Dp,"cc.ModelComponent");var ed,id,rd,nd,sd,ad,od,ld,hd,ud,cd,pd,dd,fd,_d,gd,md,yd,vd,bd,Sd,Td,Ad,Ed,Cd,Rd,wd,xd,Od,Pd,Dd,Md,Bd,Id,Ld,Fd,kd,Nd,Gd,Ud,zd,Vd,Hd,Wd,Xd,Yd,jd,Kd,qd=Oi({LUMINOUS_POWER:0,LUMINANCE:1}),Zd=new Si,Jd=Ze("cc.StaticLightSettings")((Gp=function(){function t(){$e(this,"_baked",Lp,this),$e(this,"_editorOnly",Fp,this),$e(this,"_bakeable",kp,this),$e(this,"_castShadow",Np,this)}return Be(t,[{key:"editorOnly",get:function(){return this._editorOnly},set:function(t){this._editorOnly=t}},{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}}]),t}(),Lp=je((Ip=Gp).prototype,"_baked",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fp=je(Ip.prototype,"_editorOnly",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kp=je(Ip.prototype,"_bakeable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Np=je(Ip.prototype,"_castShadow",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(Ip.prototype,"editorOnly",[yr],Object.getOwnPropertyDescriptor(Ip.prototype,"editorOnly"),Ip.prototype),je(Ip.prototype,"bakeable",[yr],Object.getOwnPropertyDescriptor(Ip.prototype,"bakeable"),Ip.prototype),je(Ip.prototype,"castShadow",[yr],Object.getOwnPropertyDescriptor(Ip.prototype,"castShadow"),Ip.prototype),Bp=Ip))||Bp,Qd=function(e){return t({Light:e,LightComponent:e}),e}((Up=Ze("cc.Light"),zp=li(),Vp=li(),Hp=hi(),Wp=li(),Xp=si(Jd),Up(($p=Qp=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_color",Kp,ti(e)),$e(e,"_useColorTemperature",qp,ti(e)),$e(e,"_colorTemperature",Zp,ti(e)),$e(e,"_staticSettings",Jp,ti(e)),e._type=Ar.UNKNOWN,e._lightType=void 0,e._light=null,e._lightType=Er,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._createLight()},i.onEnable=function(){this._attachToScene()},i.onDisable=function(){this._detachFromScene()},i.onDestroy=function(){this._destroyLight()},i._createLight=function(){this._light||(this._light=Xe.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node,this._light.baked=this.baked},i._destroyLight=function(){this._light&&(Xe.director.root.destroyLight(this),this._light=null)},i._attachToScene=function(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){var t=this._getRenderScene();switch(this._type){case Ar.DIRECTIONAL:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case Ar.SPHERE:t.addSphereLight(this._light);break;case Ar.SPOT:t.addSpotLight(this._light)}}},i._detachFromScene=function(){if(this._light&&this._light.scene){var t=this._light.scene;switch(this._type){case Ar.DIRECTIONAL:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case Ar.SPHERE:t.removeSphereLight(this._light);break;case Ar.SPOT:t.removeSpotLight(this._light)}}},Be(e,[{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._light&&(Zd.x=t.r/255,Zd.y=t.g/255,Zd.z=t.b/255,this._light.color=Zd)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}},{key:"colorTemperature",get:function(){return this._colorTemperature},set:function(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}},{key:"staticSettings",get:function(){return this._staticSettings},set:function(t){this._staticSettings=t}},{key:"type",get:function(){return this._type}},{key:"baked",get:function(){return this.staticSettings.baked},set:function(t){this.staticSettings.baked=t,null!==this._light&&(this._light.baked=t)}}]),e}(ui),Qp.Type=Ar,Qp.PhotometricTerm=qd,Kp=je((jp=$p).prototype,"_color",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),qp=je(jp.prototype,"_useColorTemperature",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zp=je(jp.prototype,"_colorTemperature",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6550}}),Jp=je(jp.prototype,"_staticSettings",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),je(jp.prototype,"color",[zp],Object.getOwnPropertyDescriptor(jp.prototype,"color"),jp.prototype),je(jp.prototype,"useColorTemperature",[Vp],Object.getOwnPropertyDescriptor(jp.prototype,"useColorTemperature"),jp.prototype),je(jp.prototype,"colorTemperature",[Yi,Hp,Wp],Object.getOwnPropertyDescriptor(jp.prototype,"colorTemperature"),jp.prototype),je(jp.prototype,"staticSettings",[Xp],Object.getOwnPropertyDescriptor(jp.prototype,"staticSettings"),jp.prototype),Yp=jp))||Yp)),$d=function(e){return t({DirectionalLight:e,DirectionalLightComponent:e}),e}((ed=Ze("cc.DirectionalLight"),id=ai(),rd=oi(),nd=Cr(),sd=li(),ed(ad=id(ad=rd(ad=vi((hd=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_illuminance",ld,ti(e)),e._type=Ar.DIRECTIONAL,e._light=null,e._lightType=Rr,e}return Me(e,t),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.illuminance=this._illuminance)},Be(e,[{key:"illuminance",get:function(){return this._illuminance},set:function(t){this._illuminance=t,this._light&&(this._light.illuminance=this._illuminance)}}]),e}(Qd),ld=je((od=hd).prototype,"_illuminance",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65e3}}),je(od.prototype,"illuminance",[nd,sd],Object.getOwnPropertyDescriptor(od.prototype,"illuminance"),od.prototype),ad=od))||ad)||ad)||ad)||ad)),tf=function(e){return t({SphereLight:e,SphereLightComponent:e}),e}((ud=Ze("cc.SphereLight"),cd=ai(),pd=oi(),dd=Cr(),fd=li(),_d=Cr(),gd=li(),md=si(qd),yd=li(),vd=li(),bd=li(),ud(Sd=cd(Sd=pd(Sd=vi((wd=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_size",Ad,ti(e)),$e(e,"_luminance",Ed,ti(e)),$e(e,"_term",Cd,ti(e)),$e(e,"_range",Rd,ti(e)),e._type=Ar.SPHERE,e._light=null,e._lightType=wr,e}return Me(e,t),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range)},Be(e,[{key:"luminousPower",get:function(){return this._luminance*xr(this._size)},set:function(t){this._luminance=t/xr(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),e}(Qd),Ad=je((Td=wd).prototype,"_size",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),Ed=je(Td.prototype,"_luminance",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/xr(.15)}}),Cd=je(Td.prototype,"_term",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qd.LUMINOUS_POWER}}),Rd=je(Td.prototype,"_range",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),je(Td.prototype,"luminousPower",[dd,fd],Object.getOwnPropertyDescriptor(Td.prototype,"luminousPower"),Td.prototype),je(Td.prototype,"luminance",[_d,gd],Object.getOwnPropertyDescriptor(Td.prototype,"luminance"),Td.prototype),je(Td.prototype,"term",[md,yd],Object.getOwnPropertyDescriptor(Td.prototype,"term"),Td.prototype),je(Td.prototype,"size",[vd],Object.getOwnPropertyDescriptor(Td.prototype,"size"),Td.prototype),je(Td.prototype,"range",[bd],Object.getOwnPropertyDescriptor(Td.prototype,"range"),Td.prototype),Sd=Td))||Sd)||Sd)||Sd)||Sd)),ef=function(e){return t({SpotLight:e,SpotLightComponent:e}),e}((xd=Ze("cc.SpotLight"),Od=ai(),Pd=oi(),Dd=Cr(),Md=li(),Bd=Cr(),Id=li(),Ld=si(qd),Fd=li(),kd=li(),Nd=li(),Gd=hi(),Ud=li(),xd(zd=Od(zd=Pd(zd=vi((Kd=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_size",Hd,ti(e)),$e(e,"_luminance",Wd,ti(e)),$e(e,"_term",Xd,ti(e)),$e(e,"_range",Yd,ti(e)),$e(e,"_spotAngle",jd,ti(e)),e._type=Ar.SPOT,e._light=null,e._lightType=Or,e}return Me(e,t),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle)},Be(e,[{key:"luminousPower",get:function(){return this._luminance*xr(this._size)},set:function(t){this._luminance=t/xr(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light&&(this._light.spotAngle=Pr(t))}}]),e}(Qd),Hd=je((Vd=Kd).prototype,"_size",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),Wd=je(Vd.prototype,"_luminance",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/xr(.15)}}),Xd=je(Vd.prototype,"_term",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qd.LUMINOUS_POWER}}),Yd=je(Vd.prototype,"_range",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jd=je(Vd.prototype,"_spotAngle",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),je(Vd.prototype,"luminousPower",[Dd,Md],Object.getOwnPropertyDescriptor(Vd.prototype,"luminousPower"),Vd.prototype),je(Vd.prototype,"luminance",[Bd,Id],Object.getOwnPropertyDescriptor(Vd.prototype,"luminance"),Vd.prototype),je(Vd.prototype,"term",[Ld,Fd],Object.getOwnPropertyDescriptor(Vd.prototype,"term"),Vd.prototype),je(Vd.prototype,"size",[kd],Object.getOwnPropertyDescriptor(Vd.prototype,"size"),Vd.prototype),je(Vd.prototype,"range",[Nd],Object.getOwnPropertyDescriptor(Vd.prototype,"range"),Vd.prototype),je(Vd.prototype,"spotAngle",[Yi,Gd,Ud],Object.getOwnPropertyDescriptor(Vd.prototype,"spotAngle"),Vd.prototype),zd=Vd))||zd)||zd)||zd)||zd));Xe.LightComponent=Qd,di.setClassAlias(Qd,"cc.LightComponent"),Xe.DirectionalLightComponent=$d,di.setClassAlias($d,"cc.DirectionalLightComponent"),Xe.SphereLightComponent=tf,di.setClassAlias(tf,"cc.SphereLightComponent"),Xe.SpotLightComponent=ef,di.setClassAlias(ef,"cc.SpotLightComponent");var rf=function(t,e,i){t[e+0]=i.m00,t[e+1]=i.m01,t[e+2]=i.m02,t[e+3]=i.m12,t[e+4]=i.m04,t[e+5]=i.m05,t[e+6]=i.m06,t[e+7]=i.m13,t[e+8]=i.m08,t[e+9]=i.m09,t[e+10]=i.m10,t[e+11]=i.m14};function nf(t,e){var i=4/Math.sqrt(e);return 12*Math.ceil(Math.max(480*i,t)/12)}new ur,new ur,new Si,new ur,new Si;var sf=Dr([A.POINT,A.POINT,A.NONE,E.CLAMP,E.CLAMP,E.CLAMP]),af=new Si,of=new Si,lf=new Si,hf=new Si,uf=new gi,cf=new gi,pf=new Ti,df=Number.MAX_SAFE_INTEGER,ff=function(){function t(t){this._device=void 0,this._pool=void 0,this._textureBuffers=new Map,this._formatSize=void 0,this._pixelsPerJoint=void 0,this._customPool=void 0,this._chunkIdxMap=new Map,this._device=t;var e=function(t){return t.hasFeature(c.TEXTURE_FLOAT)?p.RGBA32F:p.RGBA8}(this._device);this._formatSize=Xt[e].size,this._pixelsPerJoint=48/this._formatSize,this._pool=new Ir(t),this._pool.initialize({format:e,roundUpFn:nf}),this._customPool=new Ir(t),this._customPool.initialize({format:e,roundUpFn:nf})}var e=t.prototype;return e.clear=function(){this._pool.destroy(),this._textureBuffers.clear()},e.registerCustomTextureLayouts=function(t){for(var e=0;e<t.length;e++)for(var i=t[e],r=this._customPool.createChunk(i.textureLength),n=0;n<i.contents.length;n++){var s=i.contents[n],a=s.skeleton;this._chunkIdxMap.set(a,r);for(var o=0;o<s.clips.length;o++){var l=s.clips[o];this._chunkIdxMap.set(a^l,r)}}},e.getDefaultPoseTexture=function(t,e,i){var r=0^t.hash,n=this._textureBuffers.get(r)||null;if(n&&n.bounds.has(e.hash))return n.refCount++,n;var s=t.joints,a=t.bindposes,o=null,l=!1,h=s.length;if(n)n.refCount++;else{var u=12*h,c=this._chunkIdxMap.get(r),p=void 0!==c?this._customPool.alloc(u*Float32Array.BYTES_PER_ELEMENT,c):this._pool.alloc(u*Float32Array.BYTES_PER_ELEMENT);if(!p)return n;n={pixelOffset:p.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:p},o=new Float32Array(u),l=!0}Si.set(lf,df,df,df),Si.set(hf,-df,-df,-df);for(var d=e.getBoneSpaceBounds(t),f=0,_=0;f<h;f++,_+=12){var g=i.getChildByPath(s[f]),m=g?Mr(g,i,uf):t.inverseBindposes[f],y=d[f];y&&(Ti.transform(pf,y,m),pf.getBoundary(af,of),Si.min(lf,lf,af),Si.max(hf,hf,of)),l&&(g&&gi.multiply(m,m,a[f]),rf(o,_,g?m:gi.IDENTITY))}var v=[new Ti];return n.bounds.set(e.hash,v),Ti.fromPoints(v[0],lf,hf),l&&(this._pool.update(n.handle,o.buffer),this._textureBuffers.set(r,n)),n},e.getSequencePoseTexture=function(t,e,i,r){var n=t.hash^e.hash,s=this._textureBuffers.get(n)||null;if(s&&s.bounds.has(i.hash))return s.refCount++,s;var a=t.joints,o=t.bindposes,l=Br.getOrExtract(e).info.frames,h=null,u=!1,c=a.length;if(s)s.refCount++;else{var p=12*c*l,d=this._chunkIdxMap.get(n),f=void 0!==d?this._customPool.alloc(p*Float32Array.BYTES_PER_ELEMENT,d):this._pool.alloc(p*Float32Array.BYTES_PER_ELEMENT);if(!f)return null;var _=this._createAnimInfos(t,e,r);s={pixelOffset:f.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:e.hash,readyToBeDeleted:!1,handle:f,animInfos:_},h=new Float32Array(p),u=!0}var g=i.getBoneSpaceBounds(t),m=[];s.bounds.set(i.hash,m);for(var y=0;y<l;y++)m.push(new Ti(df,df,df,-df,-df,-df));for(var v=0,b=0;v<l;v++){for(var S=m[v],T=0;T<c;T++,b+=12){var A=s.animInfos[T],E=A.curveData,C=A.downstream,R=A.bindposeIdx,w=A.bindposeCorrection,x=void 0,O=!0;E&&C?x=gi.multiply(uf,E[v],C):E?x=E[v]:C?x=C:(x=t.inverseBindposes[R],O=!1);var P=g[T];if(P){var D=w?gi.multiply(cf,x,w):x;Ti.transform(pf,P,D),pf.getBoundary(af,of),Si.min(S.center,S.center,af),Si.max(S.halfExtents,S.halfExtents,of)}u&&(O&&gi.multiply(uf,x,o[R]),rf(h,b,O?uf:gi.IDENTITY))}Ti.fromPoints(S,S.center,S.halfExtents)}return u&&(this._pool.update(s.handle,h.buffer),this._textureBuffers.set(n,s)),s},e.releaseHandle=function(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){var e=t.skeletonHash^t.clipHash;(void 0!==this._chunkIdxMap.get(e)?this._customPool:this._pool).free(t.handle),this._textureBuffers.get(e)===t&&this._textureBuffers.delete(e)}},e.releaseSkeleton=function(t){for(var e=this._textureBuffers.values(),i=e.next();!i.done;){var r=i.value;r.skeletonHash===t.hash&&(r.readyToBeDeleted=!0,r.refCount?this._textureBuffers.delete(r.skeletonHash^r.clipHash):this.releaseHandle(r)),i=e.next()}},e.releaseAnimationClip=function(t){for(var e=this._textureBuffers.values(),i=e.next();!i.done;){var r=i.value;r.clipHash===t.hash&&(r.readyToBeDeleted=!0,r.refCount?this._textureBuffers.delete(r.skeletonHash^r.clipHash):this.releaseHandle(r)),i=e.next()}},e._createAnimInfos=function(t,e,i){for(var r=[],n=t.joints,s=t.bindposes,a=n.length,o=Br.getOrExtract(e),l=0;l<a;l++){for(var h=n[l],u=o.data[h],c=i.getChildByPath(h),p=void 0,d=void 0;!u;){var f=h.lastIndexOf("/");if(h=h.substring(0,f),u=o.data[h],c?(p||(p=new gi),gi.fromRTS(uf,c.rotation,c.position,c.scale),gi.multiply(p,uf,p),c=c.parent):d=h,f<0)break}var _=l,g=void 0;if(void 0!==d&&u){_=l-1;for(var m=0;m<a;m++)if(n[m]===d){_=m,g=new gi,gi.multiply(g,s[m],t.inverseBindposes[l]);break}}r.push({curveData:u&&u.worldMatrix.values,downstream:p,bindposeIdx:_,bindposeCorrection:g})}return r},Be(t,[{key:"pixelsPerJoint",get:function(){return this._pixelsPerJoint}}]),t}(),_f=function(){function t(t){this._pool=new Map,this._device=void 0,this._device=t}var e=t.prototype;return e.getData=function(t){void 0===t&&(t="-1");var e=this._pool.get(t);if(e)return e;var i=this._device.createBuffer(new nt(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,Lr.SIZE,Lr.SIZE)),r=new Float32Array([0,0,0,0]);i.update(r);var n={buffer:i,data:r,dirty:!1};return this._pool.set(t,n),n},e.destroy=function(t){var e=this._pool.get(t);e&&(e.buffer.destroy(),this._pool.delete(t))},e.switchClip=function(t){return t.data[0]=0,t.buffer.update(t.data),t.dirty=!1,t},e.clear=function(){for(var t,e=ke(this._pool.values());!(t=e()).done;)t.value.buffer.destroy();this._pool.clear()},t}(),gf=function(){function t(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new ff(t),this.jointAnimationInfo=new _f(t)}var e=t.prototype;return e.releaseSkeleton=function(t){this.jointTexturePool.releaseSkeleton(t)},e.releaseAnimationClip=function(t){this.jointTexturePool.releaseAnimationClip(t)},e.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},t}();Xe.internal.DataPoolManager=gf;var mf=[{name:"CC_USE_SKINNING",value:!0}];function yf(t,e,i,r){for(var n=0;n<i.length;n++){for(var s=i[n],a=-1,o=0;o<s.length;o++)if(s[o]===r){a=o;break}a>=0&&(e.push(n),t.push(a))}}var vf,bf,Sf,Tf,Af,Ef,Cf,Rf,wf,xf,Of,Pf,Df,Mf,Bf,If,Lf,Ff,kf,Nf,Gf,Uf,zf,Vf,Hf,Wf,Xf,Yf,jf,Kf,qf,Zf,Jf,Qf,$f,t_,e_,i_,r_,n_,s_,a_,o_,l_,h_,u_=new Si,c_=new Si,p_=new Si,d_=new Si,f_=new gi,__=new Ti,g_=function(t){function e(){var e;return(e=t.call(this)||this).uploadAnimation=null,e._buffers=[],e._dataArray=[],e._joints=[],e._bufferIndices=null,e.type=Vr.SKINNING,e}Me(e,t);var i=e.prototype;return i.destroy=function(){if(this.bindSkeleton(),this._buffers.length){for(var e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers.length=0}t.prototype.destroy.call(this)},i.bindSkeleton=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null);for(var r=0;r<this._joints.length;r++)Fr(this._joints[r].target);if(this._bufferIndices=null,this._joints.length=0,t&&e&&i){this.transform=e;var n=i.getBoneSpaceBounds(t),s=i.struct.jointMaps;this._ensureEnoughBuffers(s&&s.length||1),this._bufferIndices=i.jointBufferIndices;for(var a=0;a<t.joints.length;a++){var o=n[a],l=e.getChildByPath(t.joints[a]);if(o&&l){var h=kr(l,e),u=t.bindposes[a],c=[],p=[];s?yf(c,p,s,a):(c.push(a),p.push(0)),this._joints.push({indices:c,buffers:p,bound:o,target:l,bindpose:u,transform:h})}}}},i.updateTransform=function(t){var e=this.transform;(e.hasChangedFlags||e._dirtyFlags)&&(e.updateWorldTransform(),this._transformUpdated=!0),Si.set(u_,1/0,1/0,1/0),Si.set(c_,-1/0,-1/0,-1/0);for(var i=0;i<this._joints.length;i++){var r=this._joints[i],n=r.bound,s=r.transform,a=Nr(s,t);Ti.transform(__,n,a),__.getBoundary(p_,d_),Si.min(u_,u_,p_),Si.max(c_,c_,d_)}var o=this._worldBounds;this._modelBounds&&o&&(Ti.fromPoints(this._modelBounds,u_,c_),this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,this._worldBounds),Gr.setVec3(this._hWorldBounds,Ur.CENTER,o.center),Gr.setVec3(this._hWorldBounds,Ur.HALF_EXTENSION,o.halfExtents))},i.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);for(var i=0;i<this._joints.length;i++){var r=this._joints[i],n=r.indices,s=r.buffers,a=r.transform,o=r.bindpose;gi.multiply(f_,a.world,o);for(var l=0;l<s.length;l++)rf(this._dataArray[s[l]],12*n[l],f_)}for(var h=0;h<this._buffers.length;h++)this._buffers[h].update(this._dataArray[h]);return!0},i.initSubModel=function(e,i,r){var n=i.vertexBuffers,s=i.iaInfo;s.vertexBuffers=i.jointMappedBuffers,t.prototype.initSubModel.call(this,e,i,r),s.vertexBuffers=n},i.getMacroPatches=function(e){var i=t.prototype.getMacroPatches.call(this,e);return i?mf.concat(i):mf},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i);var r=this._buffers[this._bufferIndices[e]];r&&i.bindBuffer(zr.BINDING,r)},i._ensureEnoughBuffers=function(t){for(var e=0;e<t;e++)this._buffers[e]||(this._buffers[e]=this._device.createBuffer(new nt(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,zr.SIZE,zr.SIZE))),this._dataArray[e]||(this._dataArray[e]=new Float32Array(zr.COUNT))},e}(wp),m_=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],y_=function(t){function e(){var e;(e=t.call(this)||this).uploadedAnim=void 0,e._jointsMedium=void 0,e._skeleton=null,e._mesh=null,e._dataPoolManager=void 0,e._instAnimInfoIdx=-1,e.type=Vr.BAKED_SKINNING,e._dataPoolManager=Xe.director.root.dataPoolManager;var i=new Float32Array(4),r=e._dataPoolManager.jointAnimationInfo.getData();return e._jointsMedium={buffer:null,jointTextureInfo:i,animInfo:r,texture:null,boundsInfo:null},e}Me(e,t);var i=e.prototype;return i.destroy=function(){this.uploadedAnim=void 0,this._jointsMedium.boundsInfo=null,this._jointsMedium.buffer&&(this._jointsMedium.buffer.destroy(),this._jointsMedium.buffer=null),this._applyJointTexture(),t.prototype.destroy.call(this)},i.bindSkeleton=function(t,e,i){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),this._skeleton=t,this._mesh=i,t&&e&&i){this.transform=e;var r=this._dataPoolManager;this._jointsMedium.animInfo=r.jointAnimationInfo.getData(e.uuid),this._jointsMedium.buffer||(this._jointsMedium.buffer=this._device.createBuffer(new nt(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,Hr.SIZE,Hr.SIZE)))}},i.updateTransform=function(e){if(t.prototype.updateTransform.call(this,e),this.uploadedAnim){var i=this._jointsMedium,r=i.animInfo,n=i.boundsInfo[r.data[0]],s=this._worldBounds;if(s&&n){var a=this.transform;n.transform(a._mat,a._pos,a._rot,a._scale,s),Gr.setVec3(this._hWorldBounds,Ur.CENTER,s.center),Gr.setVec3(this._hWorldBounds,Ur.HALF_EXTENSION,s.halfExtents)}}},i.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);var i=this._jointsMedium.animInfo,r=this._instAnimInfoIdx;return r>=0?this.instancedAttributes.views[r][0]=i.data[0]:i.dirty&&(i.buffer.update(i.data),i.dirty=!1),!0},i.uploadAnimation=function(t){if(this._skeleton&&this._mesh&&this.uploadedAnim!==t){this.uploadedAnim=t;var e=this._dataPoolManager,i=null;t?(i=e.jointTexturePool.getSequencePoseTexture(this._skeleton,t,this._mesh,this.transform),this._jointsMedium.boundsInfo=i&&i.bounds.get(this._mesh.hash),this._modelBounds=null):(i=e.jointTexturePool.getDefaultPoseTexture(this._skeleton,this._mesh,this.transform),this._jointsMedium.boundsInfo=null,this._modelBounds=i&&i.bounds.get(this._mesh.hash)[0]),this._applyJointTexture(i)}},i._applyJointTexture=function(t){void 0===t&&(t=null);var e=this._jointsMedium.texture;if(e&&e!==t&&this._dataPoolManager.jointTexturePool.releaseHandle(e),this._jointsMedium.texture=t,t){var i=this._jointsMedium,r=i.buffer,n=i.jointTextureInfo;n[0]=t.handle.texture.width,n[1]=this._skeleton.joints.length,n[2]=t.pixelOffset+.1,n[3]=1/n[0],this.updateInstancedJointTextureInfo(),r&&r.update(n);for(var s=t.handle.texture,a=0;a<this._subModels.length;++a)this._subModels[a].descriptorSet.bindTexture(Wr,s)}},i.getMacroPatches=function(e){var i=t.prototype.getMacroPatches.call(this,e);return i?i.concat(m_):m_},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i);var r=this._jointsMedium,n=r.buffer,s=r.texture,a=r.animInfo;if(i.bindBuffer(Hr.BINDING,n),i.bindBuffer(Lr.BINDING,a.buffer),s){var o=rr.getSampler(this._device,sf);i.bindTexture(Wr,s.handle.texture),i.bindSampler(Wr,o)}},i._updateInstancedAttributes=function(e,i){t.prototype._updateInstancedAttributes.call(this,e,i),this._instAnimInfoIdx=this._getInstancedAttributeIndex(Xr),this.updateInstancedJointTextureInfo()},i.updateInstancedJointTextureInfo=function(){var t=this._jointsMedium,e=t.jointTextureInfo,i=t.animInfo,r=this._instAnimInfoIdx;if(r>=0){var n=this.instancedAttributes.views[r];n[0]=i.data[0],n[1]=e[1],n[2]=e[2]}},e}(wp),v_=function(e){return t({SkinnedMeshRenderer:e,SkinningModelComponent:e}),e}((vf=Ze("cc.SkinnedMeshRenderer"),bf=ai(),Sf=Ci(100),Tf=oi(),Af=si(td),Ef=si(Yr),Cf=si(td),Rf=si(Yr),wf=li(),vf(xf=bf(xf=Sf(xf=vi(xf=Tf((Mf=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_skeleton",Pf,ti(e)),$e(e,"_skinningRoot",Df,ti(e)),e._clip=null,e._modelType=y_,e}Me(e,t);var i=e.prototype;return i.__preload=function(){this._updateModelType()},i.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},i.setUseBakedAnimation=function(t){void 0===t&&(t=!0);var e=t?y_:g_;this._modelType!==e&&(this._modelType=e,this._model&&(Xe.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this.enabledInHierarchy&&this._attachToScene()))},i.setMaterial=function(e,i){t.prototype.setMaterial.call(this,e,i),this._modelType===g_&&this.getMaterialInstance(i)},i._updateModelParams=function(){this._update(),t.prototype._updateModelParams.call(this)},i._updateModelType=function(){if(this._skinningRoot){var t=this._skinningRoot.getComponent("cc.SkeletalAnimation");t?this.setUseBakedAnimation(t.useBakedAnimation):this.setUseBakedAnimation(!1)}},i._update=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},Be(e,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this._update())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){t!==this._skinningRoot&&(this._skinningRoot=t,this._updateModelType(),this._update())}},{key:"model",get:function(){return this._model}}]),e}(Dp),Pf=je((Of=Mf).prototype,"_skeleton",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Df=je(Of.prototype,"_skinningRoot",[Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(Of.prototype,"skeleton",[Cf],Object.getOwnPropertyDescriptor(Of.prototype,"skeleton"),Of.prototype),je(Of.prototype,"skinningRoot",[Rf,wf],Object.getOwnPropertyDescriptor(Of.prototype,"skinningRoot"),Of.prototype),xf=Of))||xf)||xf)||xf)||xf)||xf)),b_=new St(Wt.ATTR_BATCH_ID,p.R32F),S_=new St(Wt.ATTR_BATCH_UV,p.RG32F),T_=Xt[b_.format].size+Xt[S_.format].size,A_=function(e){return t({SkinnedMeshUnit:e,SkinningModelUnit:e}),e}((Bf=Ze("cc.SkinnedMeshUnit"),If=si(Dc),Lf=si(td),Ff=si(Fi),kf=si(v_),Bf((Yf=function(){function t(){$e(this,"mesh",Uf,this),$e(this,"skeleton",zf,this),$e(this,"material",Vf,this),$e(this,"_localTransform",Hf,this),$e(this,"_offset",Wf,this),$e(this,"_size",Xf,this)}return Be(t,[{key:"offset",get:function(){return this._offset},set:function(t){_i.copy(this._offset,t)}},{key:"size",get:function(){return this._size},set:function(t){_i.copy(this._size,t)}},{key:"copyFrom",get:function(){return null},set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getMaterial(0),t.skinningRoot&&Mr(t.node,t.skinningRoot,this._localTransform))}}]),t}(),Uf=je((Gf=Yf).prototype,"mesh",[If],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zf=je(Gf.prototype,"skeleton",[Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vf=je(Gf.prototype,"material",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hf=je(Gf.prototype,"_localTransform",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gi}}),Wf=je(Gf.prototype,"_offset",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,0)}}),Xf=je(Gf.prototype,"_size",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(1,1)}}),je(Gf.prototype,"offset",[yr],Object.getOwnPropertyDescriptor(Gf.prototype,"offset"),Gf.prototype),je(Gf.prototype,"size",[yr],Object.getOwnPropertyDescriptor(Gf.prototype,"size"),Gf.prototype),je(Gf.prototype,"copyFrom",[kf],Object.getOwnPropertyDescriptor(Gf.prototype,"copyFrom"),Gf.prototype),Nf=Gf))||Nf)),E_=new gi,C_=(new gi,new Si),R_=function(e){return t({SkinnedMeshBatchRenderer:e,BatchedSkinningModelComponent:e}),e}((jf=Ze("cc.SkinnedMeshBatchRenderer"),Kf=ai(),qf=Ci(100),Zf=oi(),Jf=li(),Qf=si([Tr]),$f=li(),t_=si([A_]),e_=li(),i_=Ni(),r_=Ni(),jf(n_=Kf(n_=qf(n_=vi(n_=Zf((h_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"atlasSize",a_,ti(e)),$e(e,"batchableTextureNames",o_,ti(e)),$e(e,"units",l_,ti(e)),e._textures={},e._batchMaterial=null,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},i.onDestroy=function(){for(var e in this._textures)this._textures[e].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},i._onMaterialModified=function(e){this.cookMaterials(),t.prototype._onMaterialModified.call(this,e,this.getMaterialInstance(e))},i.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},i.cookMaterials=function(){var t=this;this._batchMaterial||(this._batchMaterial=this.getMaterial(0));var e=this.getMaterialInstance(0);if(e&&this._batchMaterial&&this._batchMaterial.effectAsset){e.copy(this._batchMaterial),this.resizeAtlases();for(var i=e.effectAsset.techniques[e.technique],r=function(r){var n=i.passes[r];if(!n.properties)return"continue";var s=function(i){if(n.properties[i].type>=f.SAMPLER1D){var s=null;t.batchableTextureNames.find((function(t){return t===i}))?((s=t._textures[i])||(s=t.createTexture(i)),t.cookTextures(s,i,r)):t.units.some((function(t){return s=t.material&&t.material.getProperty(i,r)})),s&&e.setProperty(i,s,r)}else{for(var a=[],o=0;o<t.units.length;o++){var l=t.units[o];l.material&&a.push(l.material.getProperty(i.slice(0,-3),r))}e.setProperty(i,a,r)}};for(var a in n.properties)s(a)},n=0;n<i.passes.length;n++)r(n)}else console.warn("incomplete batch material!")},i.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],e=[],i=0;i<this.units.length;i++){var r=this.units[i];if(r&&r.skeleton){var n=r.skeleton;gi.invert(E_,r._localTransform);for(var s=function(i){var r=n.joints[i];if(t.findIndex((function(t){return t===r}))>=0)return"continue";t.push(r),e.push(gi.multiply(new gi,n.bindposes[i]||gi.IDENTITY,E_))},a=0;a<n.joints.length;a++)s(a)}}var o=Array.from(Array(t.length).keys()).sort((function(e,i){return t[e]>t[i]?1:t[e]<t[i]?-1:0})),l=new td;l.joints=t.map((function(t,e,i){return i[o[e]]})),l.bindposes=e.map((function(t,e,i){return i[o[e]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=l}else console.warn("no skinning root specified!")},i.cookMeshes=function(){for(var t=this,e=!1,i=0;i<this.units.length;i++)if(this.units[i].mesh){e=!0;break}if(e&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new Dc;for(var r=0,n=p.UNKNOWN,s=0,a=p.UNKNOWN,o=0,l=p.UNKNOWN,h=0,u=p.UNKNOWN,c=0,d=p.UNKNOWN,f=new Array(this.units.length),_=this.units.length,g=0;g<_;g++){var m=this.units[g];m&&m.skeleton&&(f[g]=m.skeleton.joints.map((function(e){return t._skeleton.joints.findIndex((function(t){return e===t}))})))}for(var y=function(e){var i=t.units[e];if(!i||!i.mesh||!i.mesh.data)return"continue";var _=t._createUnitMesh(e,i.mesh),g=new DataView(_.data.buffer);gi.inverseTranspose(E_,i._localTransform);for(var m=i.offset,y=i.size,v=function(t){var v=_.struct.vertexBundles[t];r=v.view.offset,n=p.UNKNOWN;for(var b=0;b<v.attributes.length;b++){var S=v.attributes[b];if(S.name===Wt.ATTR_POSITION){n=S.format;break}r+=Xt[S.format].size}if(n){for(var T=Qi(g,n,r,v.view.length,v.view.stride),A=0;A<T.length;A+=3)Si.fromArray(C_,T,A),Si.transformMat4(C_,C_,i._localTransform),Si.toArray(T,C_,A);dr(g,T,n,r,v.view.stride)}s=v.view.offset,a=p.UNKNOWN;for(var E=0;E<v.attributes.length;E++){var C=v.attributes[E];if(C.name===Wt.ATTR_NORMAL){a=C.format;break}s+=Xt[C.format].size}if(a){for(var R=Qi(g,a,s,v.view.length,v.view.stride),w=0;w<R.length;w+=3)Si.fromArray(C_,R,w),Si.transformMat4Normal(C_,C_,E_),Si.toArray(R,C_,w);dr(g,R,a,s,v.view.stride)}o=v.view.offset,l=p.UNKNOWN;for(var x=0;x<v.attributes.length;x++){var O=v.attributes[x];if(O.name===Wt.ATTR_TANGENT){l=O.format;break}o+=Xt[O.format].size}if(l){for(var P=Qi(g,l,o,v.view.length,v.view.stride),D=0;D<P.length;D+=3)Si.fromArray(C_,P,D),Si.transformMat4Normal(C_,C_,E_),Si.toArray(P,C_,D);dr(g,P,l,o,v.view.stride)}h=v.view.offset,u=p.UNKNOWN;for(var M=0;M<v.attributes.length;M++){var B=v.attributes[M];if(B.name===Wt.ATTR_BATCH_UV){u=B.format;break}h+=Xt[B.format].size}u&&_r(g,(function(t,e){var i,r=0===e?"x":"y";return(t=(i=t)-Math.floor(i))*y[r]+m[r]}),u,h,v.view.length,v.view.stride,g);var I=f[e];if(!I)return"continue";c=v.view.offset,d=p.UNKNOWN;for(var L=0;L<v.attributes.length;L++){var F=v.attributes[L];if(F.name===Wt.ATTR_JOINTS){d=F.format;break}c+=Xt[F.format].size}d&&_r(g,(function(t){return I[t]}),d,c,v.view.length,v.view.stride,g)},b=0;b<_.struct.vertexBundles.length;b++)v(b);t._mesh.merge(_)},v=0;v<_;v++)y(v);this._onMeshChanged(this._mesh),this._updateModels()}},i.cookTextures=function(t,e,i){for(var r=[],n=[],s=[],a=[],o=0;o<this.units.length;o++){var l=this.units[o];if(l.material){var h=l.material.getProperty(e,i);if(h&&h.image&&h.image.data){var u=new tt;u.texOffset.x=l.offset.x*this.atlasSize,u.texOffset.y=l.offset.y*this.atlasSize,u.texExtent.width=l.size.x*this.atlasSize,u.texExtent.height=l.size.y*this.atlasSize;var c=h.image.data;ArrayBuffer.isView(c)?(s.push(c),a.push(u)):(r.push(c),n.push(u))}}}var p=t.getGFXTexture(),d=Xe.director.root.device;s.length>0&&d.copyBuffersToTexture(s,p,a),r.length>0&&d.copyTexImagesToTexture(r,p,n)},i.createTexture=function(t){var e=new ir;return e.setFilters(jr.LINEAR,jr.LINEAR),e.setMipFilter(jr.NEAREST),e.reset({width:this.atlasSize,height:this.atlasSize,format:Kr.RGBA8888}),e.loaded=!0,this._textures[t]=e,e},i.resizeAtlases=function(){for(var t in this._textures)this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:Kr.RGBA8888})},i._createUnitMesh=function(t,e){for(var i=JSON.parse(JSON.stringify(e.struct)),r={},n=0;n<e.struct.primitives.length;n++){for(var s=e.struct.primitives[n],a=0,o=p.UNKNOWN,l=0;l<s.vertexBundelIndices.length;l++){var h=e.struct.vertexBundles[s.vertexBundelIndices[l]];a=h.view.offset,o=p.UNKNOWN;for(var u=0;u<h.attributes.length;u++){var c=h.attributes[u];if(c.name===Wt.ATTR_TEX_COORD){o=c.format;break}a+=Xt[c.format].size}if(o)break}if(void 0===r[l]){r[l]=[o,a];var d=i.vertexBundles[l];d.attributes.push(b_),d.attributes.push(S_),d.view.offset=0,d.view.length+=d.view.count*T_,d.view.stride+=T_}}for(var f=0,_=0;_<i.vertexBundles.length;_++)f+=i.vertexBundles[_].view.length;for(var g=0;g<i.primitives.length;g++){var m=i.primitives[g];m.indexView&&(m.indexView.offset=f,f+=m.indexView.length)}var y=new Uint8Array(f),v=e.data,b=new DataView(y.buffer),S=new DataView(v.buffer),T=Xe.sys.isLittleEndian;for(var A in r)for(var E=i.vertexBundles[A],C=e.struct.vertexBundles[A],R=r[A],w=R[0],x=R[1],O=Qi(S,w,x,C.view.length,C.view.stride),P=C.view,D=E.view,M=P.stride,B=D.stride,I=P.offset,L=D.offset,F=0;F<D.count;F++){var k=v.subarray(I,I+M);y.set(k,L),b.setFloat32(L+M,t),b.setFloat32(L+M+4,O[2*F],T),b.setFloat32(L+M+8,O[2*F+1],T),L+=B,I+=M}for(var N=0;N<i.primitives.length;N++){var G=e.struct.primitives[N],U=i.primitives[N];if(G.indexView&&U.indexView)for(var z=G.indexView.stride,V=U.indexView.stride,H=G.indexView.offset,W=U.indexView.offset,X=0;X<U.indexView.count;X++){var Y=v.subarray(H,H+z);y.set(Y,W),W+=V,H+=z}}var j=new Dc;return j.reset({struct:i,data:y}),j},Be(e,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),e}(v_),a_=je((s_=h_).prototype,"atlasSize",[ei,Jf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),o_=je(s_.prototype,"batchableTextureNames",[Qf,ei,$f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),l_=je(s_.prototype,"units",[t_,ei,e_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),je(s_.prototype,"mesh",[Qe,i_],Object.getOwnPropertyDescriptor(s_.prototype,"mesh"),s_.prototype),je(s_.prototype,"skeleton",[Qe,r_],Object.getOwnPropertyDescriptor(s_.prototype,"skeleton"),s_.prototype),n_=s_))||n_)||n_)||n_)||n_)||n_));Xe.SkinningModelComponent=v_,di.setClassAlias(v_,"cc.SkinningModelComponent"),Xe.SkinningModelUnit=A_,di.setClassAlias(A_,"cc.SkinningModelUnit"),Xe.BatchedSkinningModelComponent=R_,di.setClassAlias(R_,"cc.BatchedSkinningModelComponent");var w_,x_,O_,P_,D_,M_,B_,I_,L_,F_,k_,N_,G_,U_,z_,V_,H_,W_,X_,Y_,j_=new gi,K_=new gi,q_=[],Z_=t("SkeletalAnimationState",function(t){function e(e,i){var r;return void 0===i&&(i=""),(r=t.call(this,e,i)||this)._frames=1,r._bakedDuration=0,r._animInfo=null,r._sockets=[],r._animInfoMgr=void 0,r._comps=[],r._parent=null,r._curvesInited=!1,r._animInfoMgr=Xe.director.root.dataPoolManager.jointAnimationInfo,r}Me(e,t);var i=e.prototype;return i.initialize=function(e){if(!this._curveLoaded){this._comps.length=0;for(var i=e.getComponentsInChildren(v_),r=0;r<i.length;++r){var n=i[r];n.skinningRoot===e&&this._comps.push(n)}this._parent=e.getComponent("cc.SkeletalAnimation");var s=this._parent.useBakedAnimation;t.prototype.initialize.call(this,e,s?q_:void 0),this._curvesInited=!s;var a=Br.getOrExtract(this.clip).info;this._frames=a.frames-1,this._animInfo=this._animInfoMgr.getData(e.uuid),this._bakedDuration=this._frames/a.sample}},i.onPlay=function(){if(t.prototype.onPlay.call(this),this._parent.useBakedAnimation){this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration,this._animInfoMgr.switchClip(this._animInfo,this.clip);for(var e=0;e<this._comps.length;++e)this._comps[e].uploadAnimation(this.clip)}else this._sampleCurves=t.prototype._sampleCurves,this.duration=this.clip.duration,this._curvesInited||(this._curveLoaded=!1,t.prototype.initialize.call(this,this._targetNode),this._curvesInited=!0)},i.rebuildSocketCurves=function(t){if(this._sockets.length=0,this._targetNode)for(var e=this._targetNode,i=0;i<t.length;++i){var r=t[i],n=e.getChildByPath(r.path);if(r.target){for(var s=Br.getOrExtract(this.clip),a=r.path,o=s.data[a],l=n,h=void 0;!o;){var u=a.lastIndexOf("/");if(a=a.substring(0,u),o=s.data[a],l&&(h||(h=gi.identity(K_)),gi.fromRTS(j_,l.rotation,l.position,l.scale),gi.multiply(h,j_,h),l=l.parent),u<0)break}for(var c=o&&o.worldMatrix.values,p=s.info.frames,d=[],f=0;f<p;f++){var _;_=c&&h?gi.multiply(j_,c[f],h):c?c[f]:h||gi.IDENTITY;var g={pos:new Si,rot:new ur,scale:new Si};gi.toRTS(_,g.rot,g.pos,g.scale),d.push(g)}this._sockets.push({target:r.target,frames:d})}}},i._sampleCurvesBaked=function(t){var e=this._animInfo,i=t*this._frames+.5|0;if(i!==e.data[0]){e.data[0]=i,e.dirty=!0;for(var r=0;r<this._sockets.length;++r){var n=this._sockets[r],s=n.target,a=n.frames[i],o=a.pos,l=a.rot,h=a.scale;s.setRTS(l,o,h)}}},e}(qr)),J_=t("Socket",(w_=Ze("cc.SkeletalAnimation.Socket"),x_=si(Yr),w_((D_=je((P_=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),$e(this,"path",D_,this),$e(this,"target",M_,this),this.path=t,this.target=e}).prototype,"path",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),M_=je(P_.prototype,"target",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O_=P_))||O_));di.setClassAlias(J_,"cc.SkeletalAnimationComponent.Socket");var Q_=new gi,$_=new gi;function tg(t,e,i){void 0===e&&(e=""),void 0===i&&(i=[]);for(var r=0;r<t.children.length;r++){var n=t.children[r];if(n){var s=e?e+"/"+n.name:n.name;i.push(s),tg(n,s,i)}}return i}var eg,ig,rg,ng,sg,ag,og,lg,hg,ug,cg,pg,dg,fg,_g,gg,mg=function(e){return t({SkeletalAnimation:e,SkeletalAnimationComponent:e}),e}((B_=Ze("cc.SkeletalAnimation"),I_=ai(),L_=Ci(99),F_=oi(),k_=si([J_]),N_=li(),G_=li(),U_=si([J_]),B_(z_=I_(z_=L_(z_=vi(z_=F_((Y_=X_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_useBakedAnimation",H_,ti(e)),$e(e,"_sockets",W_,ti(e)),e}Me(e,t);var i=e.prototype;return i.onDestroy=function(){t.prototype.onDestroy.call(this),Xe.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),Xe.director.getAnimationManager().removeSockets(this.node,this._sockets)},i.start=function(){this.sockets=this._sockets,this.useBakedAnimation=this._useBakedAnimation,t.prototype.start.call(this)},i.querySockets=function(){var t=this._defaultClip&&Object.keys(Br.getOrExtract(this._defaultClip).data).sort().reduce((function(t,e){return e.startsWith(t[t.length-1])||t.push(e),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var e=[],i=0;i<t.length;i++){var r=t[i],n=this.node.getChildByPath(r);n&&(e.push(r),tg(n,r,e))}return e},i.rebuildSocketAnimations=function(){for(var t,e=ke(this._sockets);!(t=e()).done;){var i=t.value,r=this.node.getChildByPath(i.path),n=i.target;r&&n&&(n.name=i.path.substring(i.path.lastIndexOf("/")+1)+" Socket",n.parent=this.node,Mr(r,this.node,Q_),gi.fromRTS($_,n.rotation,n.position,n.scale),gi.equals($_,Q_)||(n.matrix=Q_))}for(var s=0,a=Object.keys(this._nameToState);s<a.length;s++){var o=a[s];this._nameToState[o].rebuildSocketCurves(this._sockets)}},i.createSocket=function(t){var e=this._sockets.find((function(e){return e.path===t}));if(e)return e.target;if(!this.node.getChildByPath(t))return console.warn("illegal socket path"),null;var i=new Yr;return i.parent=this.node,this._sockets.push(new J_(t,i)),this.rebuildSocketAnimations(),i},i._createState=function(t,e){return new Z_(t,e)},i._doCreateState=function(e,i){var r=t.prototype._doCreateState.call(this,e,i);return r.rebuildSocketCurves(this._sockets),r},Be(e,[{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedAnimation){var e=Xe.director.getAnimationManager();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){this._useBakedAnimation=t;for(var e=this.node.getComponentsInChildren(v_),i=0;i<e.length;++i){var r=e[i];r.skinningRoot===this.node&&r.setUseBakedAnimation(this._useBakedAnimation)}this._useBakedAnimation?Xe.director.getAnimationManager().removeSockets(this.node,this._sockets):Xe.director.getAnimationManager().addSockets(this.node,this._sockets)}}]),e}(Zr),X_.Socket=J_,je((V_=Y_).prototype,"sockets",[k_,N_],Object.getOwnPropertyDescriptor(V_.prototype,"sockets"),V_.prototype),je(V_.prototype,"useBakedAnimation",[G_],Object.getOwnPropertyDescriptor(V_.prototype,"useBakedAnimation"),V_.prototype),H_=je(V_.prototype,"_useBakedAnimation",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),W_=je(V_.prototype,"_sockets",[U_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),z_=V_))||z_)||z_)||z_)||z_)||z_));Xe.SkeletalAnimationComponent=mg,di.setClassAlias(mg,"cc.SkeletalAnimationComponent"),Xe.utils=Uc;var yg,vg,bg,Sg,Tg,Ag,Eg,Cg,Rg,wg,xg,Og,Pg,Dg,Mg,Bg,Ig,Lg,Fg,kg,Ng,Gg,Ug,zg,Vg,Hg,Wg,Xg,Yg,jg,Kg,qg,Zg=function(e){return t({Billboard:e,BillboardComponent:e}),e}((eg=Ze("cc.Billboard"),ig=ai(),rg=oi(),ng=si(ir),sg=si(ir),ag=li(),og=li(),lg=li(),hg=li(),eg(ug=ig(ug=rg(ug=vi((gg=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_texture",pg,ti(e)),$e(e,"_height",dg,ti(e)),$e(e,"_width",fg,ti(e)),$e(e,"_rotation",_g,ti(e)),e._model=null,e._mesh=null,e._material=null,e._uniform=new Sr(1,1,0,0),e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this.createModel()},i.onEnable=function(){this.attachToScene(),this._model.enabled=!0,this.width=this._width,this.height=this._height,this.rotation=this.rotation,this.texture=this.texture},i.onDisable=function(){this.detachFromScene()},i.attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this.detachFromScene(),this._getRenderScene().addModel(this._model))},i.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i.createModel=function(){this._mesh=Gc({primitiveMode:L.TRIANGLE_LIST,positions:[0,0,0,0,0,0,0,0,0,0,0,0],uvs:[0,0,1,0,0,1,1,1],colors:[Ii.WHITE.r,Ii.WHITE.g,Ii.WHITE.b,Ii.WHITE.a,Ii.WHITE.r,Ii.WHITE.g,Ii.WHITE.b,Ii.WHITE.a,Ii.WHITE.r,Ii.WHITE.g,Ii.WHITE.b,Ii.WHITE.a,Ii.WHITE.r,Ii.WHITE.g,Ii.WHITE.b,Ii.WHITE.a],attributes:[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RG32F),new St(Wt.ATTR_COLOR,p.RGBA8UI,!0)],indices:[0,1,2,1,2,3]},void 0,{calculateBounds:!1});var t=this._model=Xe.director.root.createModel(gr,this.node);t.node=t.transform=this.node,null==this._material&&(this._material=new Fi,this._material.copy(ki.get("default-billboard-material"))),t.initSubModel(0,this._mesh.renderingSubMeshes[0],this._material)},Be(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._material&&this._material.setProperty("mainTexture",t)}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._material&&(this._uniform.y=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._material&&(this._uniform.x=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"rotation",get:function(){return Math.round(100*Jr(this._rotation))/100},set:function(t){this._rotation=Pr(t),this._material&&(this._uniform.z=this._rotation,this._material.setProperty("cc_size_rotation",this._uniform))}}]),e}(ui),pg=je((cg=gg).prototype,"_texture",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(cg.prototype,"texture",[sg,ag],Object.getOwnPropertyDescriptor(cg.prototype,"texture"),cg.prototype),dg=je(cg.prototype,"_height",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(cg.prototype,"height",[og],Object.getOwnPropertyDescriptor(cg.prototype,"height"),cg.prototype),fg=je(cg.prototype,"_width",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(cg.prototype,"width",[lg],Object.getOwnPropertyDescriptor(cg.prototype,"width"),cg.prototype),_g=je(cg.prototype,"_rotation",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(cg.prototype,"rotation",[hg],Object.getOwnPropertyDescriptor(cg.prototype,"rotation"),cg.prototype),ug=cg))||ug)||ug)||ug)||ug)),Jg=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RGBA32F),new St(Wt.ATTR_TEX_COORD1,p.RGB32F),new St(Wt.ATTR_COLOR,p.RGBA8,!0)],Qg=new Si,$g=new Si,tm=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=null,e._vertCount=0,e._indexCount=0,e._material=null,e.type=Vr.LINE,e._capacity=100,e._iaInfo=new lt([new at]),e._iaInfoBuffer=e._device.createBuffer(new nt(_.INDIRECT,y.HOST|y.DEVICE,qt,qt)),e}Me(e,t);var i=e.prototype;return i.setCapacity=function(t){this._capacity=t,this.createBuffer()},i.createBuffer=function(){this._vertSize=0;for(var t,e=ke(Jg);!(t=e()).done;){var i=t.value;i.offset=this._vertSize,this._vertSize+=Xt[i.format].size}this._vertAttrsFloatCount=this._vertSize/4,this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.updateMaterial=function(e){this._material=e,t.prototype.setSubModelMaterial.call(this,0,e)},i.createSubMeshData=function(){this._subMeshData&&this.destroySubMeshData(),this._vertCount=2,this._indexCount=6;var t=this._device.createBuffer(new nt(_.VERTEX|_.TRANSFER_DST,y.HOST|y.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);t.update(e);for(var i=new Uint16Array((this._capacity-1)*this._indexCount),r=0,n=0;n<this._capacity-1;++n){var s=2*n;i[r++]=s,i[r++]=s+1,i[r++]=s+2,i[r++]=s+3,i[r++]=s+2,i[r++]=s+1}var a=this._device.createBuffer(new nt(_.INDEX|_.TRANSFER_DST,y.HOST|y.DEVICE,(this._capacity-1)*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return a.update(i),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=(this._capacity-1)*this._indexCount,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new cr([t],Jg,L.TRIANGLE_LIST,a,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.addLineVertexData=function(t,e,i){if(t.length>1){var r=0;Si.subtract(Qg,t[1],t[0]),this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=0,this._vdataF32[r++]=Qg.x,this._vdataF32[r++]=Qg.y,this._vdataF32[r++]=Qg.z,this._vdataUint32[r++]=i.evaluate(0,1)._val,this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=1,this._vdataF32[r++]=Qg.x,this._vdataF32[r++]=Qg.y,this._vdataF32[r++]=Qg.z,this._vdataUint32[r++]=i.evaluate(0,1)._val;for(var n=1;n<t.length-1;n++){Si.subtract(Qg,t[n-1],t[n]),Si.subtract($g,t[n+1],t[n]),Si.subtract($g,$g,Qg);var s=n/t.length;this._vdataF32[r++]=t[n].x,this._vdataF32[r++]=t[n].y,this._vdataF32[r++]=t[n].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(s,1),this._vdataF32[r++]=s,this._vdataF32[r++]=0,this._vdataF32[r++]=$g.x,this._vdataF32[r++]=$g.y,this._vdataF32[r++]=$g.z,this._vdataUint32[r++]=i.evaluate(s,1)._val,this._vdataF32[r++]=t[n].x,this._vdataF32[r++]=t[n].y,this._vdataF32[r++]=t[n].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(s,1),this._vdataF32[r++]=s,this._vdataF32[r++]=1,this._vdataF32[r++]=$g.x,this._vdataF32[r++]=$g.y,this._vdataF32[r++]=$g.z,this._vdataUint32[r++]=i.evaluate(s,1)._val}Si.subtract(Qg,t[t.length-1],t[t.length-2]),this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=0,this._vdataF32[r++]=Qg.x,this._vdataF32[r++]=Qg.y,this._vdataF32[r++]=Qg.z,this._vdataUint32[r++]=i.evaluate(1,1)._val,this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=1,this._vdataF32[r++]=Qg.x,this._vdataF32[r++]=Qg.y,this._vdataF32[r++]=Qg.z,this._vdataUint32[r++]=i.evaluate(1,1)._val}this.updateIA(Math.max(0,t.length-1))},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},e}(gr),em=tn,im=Oi({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),rm=t("CurveRange",(yg=Ze("cc.CurveRange"),vg=si(im),bg=si(Qr),Sg=si(Qr),Tg=si(Qr),yg((Ig=Bg=function(){function t(){$e(this,"mode",Cg,this),$e(this,"curve",Rg,this),$e(this,"curveMin",wg,this),$e(this,"curveMax",xg,this),$e(this,"constant",Og,this),$e(this,"constantMin",Pg,this),$e(this,"constantMax",Dg,this),$e(this,"multiplier",Mg,this)}var e=t.prototype;return e.evaluate=function(t,e){switch(this.mode){case im.Constant:return this.constant;case im.Curve:return this.curve.evaluate(t)*this.multiplier;case im.TwoCurves:return $r(this.curveMin.evaluate(t),this.curveMax.evaluate(t),e)*this.multiplier;case im.TwoConstants:return $r(this.constantMin,this.constantMax,e)}},e.getMax=function(){switch(this.mode){case im.Constant:return this.constant;case im.Curve:return this.multiplier;case im.TwoConstants:return this.constantMax;case im.TwoCurves:return this.multiplier}return 0},e._onBeforeSerialize=function(){return em[this.mode]},t}(),Bg.Mode=im,Cg=je((Eg=Ig).prototype,"mode",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return im.Constant}}),Rg=je(Eg.prototype,"curve",[bg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qr}}),wg=je(Eg.prototype,"curveMin",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qr}}),xg=je(Eg.prototype,"curveMax",[Tg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qr}}),Og=je(Eg.prototype,"constant",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pg=je(Eg.prototype,"constantMin",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Dg=je(Eg.prototype,"constantMax",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mg=je(Eg.prototype,"multiplier",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ag=Eg))||Ag));function nm(t,e,i){switch(t.mode){case im.Constant:return t.constant;case im.Curve:return t.curve.evaluate(e)*t.multiplier;case im.TwoCurves:return 0===i?t.curveMin.evaluate(e)*t.multiplier:t.curveMax.evaluate(e)*t.multiplier;case im.TwoConstants:return 0===i?t.constantMin:t.constantMax;default:return 0}}function sm(t){switch(t.mode){case im.TwoConstants:case im.TwoCurves:return 2;default:return 1}}function am(t,e,i){var r=new er({width:e,height:i,_data:t,_compressed:!1,format:Kr.RGBA32F}),n=new ir;return n.setFilters(jr.NEAREST,jr.NEAREST),n.setMipFilter(jr.NONE),n.setWrapMode(en.CLAMP_TO_EDGE,en.CLAMP_TO_EDGE,en.CLAMP_TO_EDGE),n.image=r,n}function om(t,e,i,r,n){for(var s=Math.max(sm(e),sm(i),sm(r)),a=new Float32Array(t*s*4),o=[e,i,r],l=1/(t-1),h=0;h<s;h++)for(var u=0;u<3;u++)for(var c=o[u],p=0,d=0,f=0;f<t;f++){var _=nm(c,l*f,h);d=n?_:(p+=_)/(f+1),a[4*f+u]=d}return am(a,t,s)}var lm,hm,um,cm,pm,dm,fm,_m,gm,mm,ym,vm,bm,Sm,Tm,Am,Em,Cm,Rm,wm,xm,Om,Pm,Dm,Mm,Bm,Im,Lm,Fm,km,Nm,Gm,Um,zm,Vm,Hm,Wm,Xm,Ym,jm,Km,qm,Zm,Jm,Qm,$m,ty,ey,iy,ry,ny,sy,ay,oy,ly=Oi({Blend:0,Fixed:1}),hy=(t("ColorKey",Ze("cc.ColorKey")((kg=je((Fg=function(){$e(this,"color",kg,this),$e(this,"time",Ng,this)}).prototype,"color",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),Ng=je(Fg.prototype,"time",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lg=Fg))||Lg),t("AlphaKey",Ze("cc.AlphaKey")((zg=je((Ug=function(){$e(this,"alpha",zg,this),$e(this,"time",Vg,this)}).prototype,"alpha",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Vg=je(Ug.prototype,"time",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gg=Ug))||Gg),t("Gradient",Ze("cc.Gradient")((qg=Kg=function(){function t(){$e(this,"colorKeys",Xg,this),$e(this,"alphaKeys",Yg,this),$e(this,"mode",jg,this),this._color=void 0,this._color=Ii.WHITE.clone()}var e=t.prototype;return e.setKeys=function(t,e){this.colorKeys=t,this.alphaKeys=e},e.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort((function(t,e){return t.time-e.time})),this.alphaKeys.length>1&&this.alphaKeys.sort((function(t,e){return t.time-e.time}))},e.evaluate=function(t){return this.getRGB(t),this._color._set_a_unsafe(this.getAlpha(t)),this._color},e.randomColor=function(){var t=this.colorKeys[Math.trunc(Math.random()*this.colorKeys.length)],e=this.alphaKeys[Math.trunc(Math.random()*this.alphaKeys.length)];return this._color.set(t.color),this._color._set_a_unsafe(e.alpha),this._color},e.getRGB=function(t){if(!(this.colorKeys.length>1))return 1===this.colorKeys.length?(this._color.set(this.colorKeys[0].color),this._color):(this._color.set(Ii.WHITE),this._color);t=rn(t,1);for(var e=1;e<this.colorKeys.length;++e){var i=this.colorKeys[e-1].time,r=this.colorKeys[e].time;if(t>=i&&t<r){if(this.mode===ly.Fixed)return this.colorKeys[e].color;var n=(t-i)/(r-i);return Ii.lerp(this._color,this.colorKeys[e-1].color,this.colorKeys[e].color,n),this._color}}var s=this.colorKeys.length-1;t<this.colorKeys[0].time?Ii.lerp(this._color,Ii.BLACK,this.colorKeys[0].color,t/this.colorKeys[0].time):t>this.colorKeys[s].time&&Ii.lerp(this._color,this.colorKeys[s].color,Ii.BLACK,(t-this.colorKeys[s].time)/(1-this.colorKeys[s].time))},e.getAlpha=function(t){if(!(this.alphaKeys.length>1))return 1===this.alphaKeys.length?this.alphaKeys[0].alpha:255;t=rn(t,1);for(var e=1;e<this.alphaKeys.length;++e){var i=this.alphaKeys[e-1].time,r=this.alphaKeys[e].time;if(t>=i&&t<r){if(this.mode===ly.Fixed)return this.alphaKeys[e].alpha;var n=(t-i)/(r-i);return $r(this.alphaKeys[e-1].alpha,this.alphaKeys[e].alpha,n)}}var s=this.alphaKeys.length-1;return t<this.alphaKeys[0].time?$r(255,this.alphaKeys[0].alpha,t/this.alphaKeys[0].time):t>this.alphaKeys[s].time?$r(this.alphaKeys[s].alpha,255,(t-this.alphaKeys[s].time)/(1-this.alphaKeys[s].time)):void 0},t}(),Kg.Mode=ly,Xg=je((Wg=qg).prototype,"colorKeys",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),Yg=je(Wg.prototype,"alphaKeys",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),jg=je(Wg.prototype,"mode",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ly.Blend}}),Hg=Wg))||Hg)),uy=tn,cy=Oi({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),py=t("GradientRange",(lm=Ze("cc.GradientRange"),hm=si(cy),um=si(hy),cm=si(hy),pm=si(hy),dm=si(cy),lm((Em=Am=function(){function t(){$e(this,"color",gm,this),$e(this,"colorMin",mm,this),$e(this,"colorMax",ym,this),$e(this,"gradient",vm,this),$e(this,"gradientMin",bm,this),$e(this,"gradientMax",Sm,this),$e(this,"_mode",Tm,this),this._color=Ii.WHITE.clone()}var e=t.prototype;return e.evaluate=function(t,e){switch(this._mode){case cy.Color:return this.color;case cy.TwoColors:return Ii.lerp(this._color,this.colorMin,this.colorMax,e),this._color;case cy.RandomColor:return this.gradient.randomColor();case cy.Gradient:return this.gradient.evaluate(t);case cy.TwoGradients:return Ii.lerp(this._color,this.gradientMin.evaluate(t),this.gradientMax.evaluate(t),e),this._color;default:return this.color}},e._onBeforeSerialize=function(){return uy[this._mode]},Be(t,[{key:"mode",get:function(){return this._mode},set:function(t){this._mode=t}}]),t}(),Am.Mode=cy,je((_m=Em).prototype,"mode",[hm],Object.getOwnPropertyDescriptor(_m.prototype,"mode"),_m.prototype),gm=je(_m.prototype,"color",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),mm=je(_m.prototype,"colorMin",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),ym=je(_m.prototype,"colorMax",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),vm=je(_m.prototype,"gradient",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hy}}),bm=je(_m.prototype,"gradientMin",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hy}}),Sm=je(_m.prototype,"gradientMax",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hy}}),Tm=je(_m.prototype,"_mode",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cy.Color}}),fm=_m))||fm));function dy(t,e,i){switch(t.mode){case cy.Color:return t.color;case cy.TwoColors:return 0===i?t.colorMin:t.colorMax;case cy.RandomColor:return t.gradient.randomColor();case cy.Gradient:return t.gradient.evaluate(e);case cy.TwoGradients:return 0===i?t.gradientMin.evaluate(e):t.gradientMax.evaluate(e);default:return t.color}}var fy,_y,gy,my,yy,vy,by,Sy,Ty,Ay,Ey,Cy,Ry,wy,xy,Oy,Py,Dy,My,By,Iy,Ly,Fy,ky,Ny,Gy,Uy,zy,Vy,Hy,Wy,Xy,Yy,jy,Ky={parent:null,owner:null,subModelIdx:0},qy={CC_USE_WORLD_SPACE:!1},Zy=function(e){return t({Line:e,LineComponent:e}),e}((Cm=Ze("cc.Line"),Rm=ai(),wm=oi(),xm=si(ir),Om=si(ir),Pm=Ri(),Dm=li(),Mm=Ri(),Bm=li(),Im=si([Si]),Lm=si([Si]),Fm=Ri(),km=li(),Nm=si(rm),Gm=si(rm),Um=Ri(),zm=li(),Vm=si(_i),Hm=Ri(),Wm=li(),Xm=si(_i),Ym=Ri(),jm=li(),Km=si(py),qm=si(py),Zm=Ri(),Jm=li(),Cm(Qm=Rm(Qm=wm(Qm=vi((oy=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_texture",ty,ti(e)),e._material=null,e._materialInstance=null,$e(e,"_worldSpace",ey,ti(e)),$e(e,"_positions",iy,ti(e)),$e(e,"_width",ry,ti(e)),$e(e,"_tile",ny,ti(e)),$e(e,"_offset",sy,ti(e)),$e(e,"_color",ay,ti(e)),e._model=null,e._tile_offset=new Sr,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._model=Xe.director.root.createModel(tm);t.node=t.transform=this.node,null===this._material&&(this._material=new Fi,this._material.copy(ki.get("default-trail-material")),qy.CC_USE_WORLD_SPACE=this.worldSpace,Ky.parent=this._material,Ky.subModelIdx=0,this._materialInstance=new nn(Ky),this._materialInstance.recompileShaders(qy)),t.updateMaterial(this._materialInstance),t.setCapacity(100)},i.onEnable=function(){this._model&&(this._attachToScene(),this.texture=this._texture,this.tile=this._tile,this.offset=this._offset,this._model.addLineVertexData(this._positions,this._width,this._color))},i.onDisable=function(){this._model&&this._detachFromScene()},i._attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this._detachFromScene(),this._getRenderScene().addModel(this._model))},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},Be(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._materialInstance&&this._materialInstance.setProperty("mainTexture",t)}},{key:"worldSpace",get:function(){return this._worldSpace},set:function(t){this._worldSpace=t,this._materialInstance&&(qy.CC_USE_WORLD_SPACE=this.worldSpace,this._materialInstance.recompileShaders(qy),this._model&&this._model.setSubModelMaterial(0,this._materialInstance))}},{key:"positions",get:function(){return this._positions},set:function(t){this._positions=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"tile",get:function(){return this._tile},set:function(t){this._tile.set(t),this._materialInstance&&(this._tile_offset.x=this._tile.x,this._tile_offset.y=this._tile.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this._materialInstance&&(this._tile_offset.z=this._offset.x,this._tile_offset.w=this._offset.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}}]),e}(ui),ty=je(($m=oy).prototype,"_texture",[xm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je($m.prototype,"texture",[Om,Pm,Dm],Object.getOwnPropertyDescriptor($m.prototype,"texture"),$m.prototype),ey=je($m.prototype,"_worldSpace",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je($m.prototype,"worldSpace",[Mm,Bm],Object.getOwnPropertyDescriptor($m.prototype,"worldSpace"),$m.prototype),iy=je($m.prototype,"_positions",[Im],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),je($m.prototype,"positions",[Lm,Fm,km],Object.getOwnPropertyDescriptor($m.prototype,"positions"),$m.prototype),ry=je($m.prototype,"_width",[Nm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),je($m.prototype,"width",[Gm,Um,zm],Object.getOwnPropertyDescriptor($m.prototype,"width"),$m.prototype),ny=je($m.prototype,"_tile",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(1,1)}}),je($m.prototype,"tile",[Vm,Hm,Wm],Object.getOwnPropertyDescriptor($m.prototype,"tile"),$m.prototype),sy=je($m.prototype,"_offset",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,0)}}),je($m.prototype,"offset",[Xm,Ym,jm],Object.getOwnPropertyDescriptor($m.prototype,"offset"),$m.prototype),ay=je($m.prototype,"_color",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new py}}),je($m.prototype,"color",[qm,Zm,Jm],Object.getOwnPropertyDescriptor($m.prototype,"color"),$m.prototype),Qm=$m))||Qm)||Qm)||Qm)||Qm)),Jy=function(t){this.particleSystem=void 0,this.position=void 0,this.velocity=void 0,this.animatedVelocity=void 0,this.ultimateVelocity=void 0,this.angularVelocity=void 0,this.axisOfRotation=void 0,this.rotation=void 0,this.startSize=void 0,this.size=void 0,this.startColor=void 0,this.color=void 0,this.randomSeed=void 0,this.remainingLifetime=void 0,this.startLifetime=void 0,this.emitAccumulator0=void 0,this.emitAccumulator1=void 0,this.frameIndex=void 0,this.startRow=void 0,this.particleSystem=t,this.position=new Si(0,0,0),this.velocity=new Si(0,0,0),this.animatedVelocity=new Si(0,0,0),this.ultimateVelocity=new Si(0,0,0),this.angularVelocity=new Si(0,0,0),this.axisOfRotation=new Si(0,0,0),this.rotation=new Si(0,0,0),this.startSize=new Si(0,0,0),this.size=new Si(0,0,0),this.startColor=Ii.WHITE.clone(),this.color=Ii.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0,this.startRow=0},Qy="colorModule",$y="rotationModule",tv="sizeModule",ev="textureModule",iv=["sizeModule","colorModule","forceModule","velocityModule","limitModule","rotationModule","textureModule"],rv=["_colorOverLifetimeModule","_shapeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_trailModule"],nv=function(){function t(){this.target=null,this.needUpdate=!1,this.needAnimate=!0,this.name=void 0}var e=t.prototype;return e.bindTarget=function(t){this.target=t},e.update=function(){},t}(),sv=Oi({World:0,Local:1,Custom:2}),av=Oi({Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4}),ov=Oi({Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4}),lv=Oi({Base:0,Edge:1,Shell:2,Volume:3}),hv=Oi({Random:0,Loop:1,PingPong:2}),uv=Oi({Particles:0}),cv=Oi({Stretch:0}),pv=(fy=Ze("cc.ColorOvertimeModule"),_y=Ri(),gy=si(py),my=Ri(),fy((Ty=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_enable",by,ti(e)),$e(e,"color",Sy,ti(e)),e.name=Qy,e}return Me(e,t),e.prototype.animate=function(t){t.color.set(t.startColor),t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,sn(t.randomSeed+91041)))},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(nv),by=je((vy=Ty).prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(vy.prototype,"enable",[_y],Object.getOwnPropertyDescriptor(vy.prototype,"enable"),vy.prototype),Sy=je(vy.prototype,"color",[gy,ei,my],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new py}}),yy=vy))||yy),dv=new Si(0,0,-1);function fv(t,e,i,r){return e!==t?(t===sv.World||gi.invert(i,i),gi.getRotation(r,i),!0):(ur.set(r,0,0,0,1),!1)}function _v(t,e){_i.set(t,Math.cos(e),Math.sin(e))}function gv(t){var e=on(-1,1),i=on(0,2*Math.PI),r=Math.sqrt(1-e*e),n=r*Math.cos(i),s=r*Math.sin(i);Si.set(t,n,s,e)}function mv(t,e,i){gv(t),Si.multiplyScalar(t,t,e+(i-e)*an())}function yv(t,e,i,r){_v(t,r),t.z=0,Si.multiplyScalar(t,t,e+(i-e)*an())}function vv(t){for(var e=0;e<t.length;e++){var i=e+ln(0,t.length-e),r=t[i];t[i]=t[e],t[e]=r}}function bv(){var t=on(-1,1);return 0===t&&t++,hn(t)}var Sv,Tv,Av,Ev,Cv,Rv,wv,xv,Ov,Pv,Dv,Mv,Bv,Iv,Lv,Fv,kv,Nv,Gv,Uv,zv,Vv,Hv,Wv,Xv,Yv,jv,Kv,qv,Zv,Jv,Qv,$v,tb,eb,ib,rb,nb,sb,ab,ob,lb,hb,ub,cb,pb,db,fb,_b,gb,mb,yb,vb,bb,Sb,Tb,Ab,Eb,Cb,Rb,wb=212165,xb=new Si,Ob=(Ay=Ze("cc.ForceOvertimeModule"),Ey=Ri(),Cy=si(rm),Ry=hi(),wy=Ri(),xy=li(),Oy=si(rm),Py=hi(),Dy=Ri(),My=li(),By=si(rm),Iy=hi(),Ly=Ri(),Fy=li(),ky=si(sv),Ny=Ri(),Gy=li(),Ay((jy=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_enable",Vy,ti(e)),$e(e,"x",Hy,ti(e)),$e(e,"y",Wy,ti(e)),$e(e,"z",Xy,ti(e)),$e(e,"space",Yy,ti(e)),e.randomized=!1,e.rotation=void 0,e.needTransform=void 0,e.name="forceModule",e.rotation=new ur,e.needTransform=!1,e.needUpdate=!0,e}Me(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=fv(t,this.space,e,this.rotation)},i.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,r=Si.set(xb,this.x.evaluate(i,sn(t.randomSeed+wb)),this.y.evaluate(i,sn(t.randomSeed+wb)),this.z.evaluate(i,sn(t.randomSeed+wb)));this.needTransform&&Si.transformQuat(r,r,this.rotation),Si.scaleAndAdd(t.velocity,t.velocity,r,e),Si.copy(t.ultimateVelocity,t.velocity)},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(nv),Vy=je((zy=jy).prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(zy.prototype,"enable",[Ey],Object.getOwnPropertyDescriptor(zy.prototype,"enable"),zy.prototype),Hy=je(zy.prototype,"x",[Cy,ei,Ry,wy,xy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Wy=je(zy.prototype,"y",[Oy,ei,Py,Dy,My],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Xy=je(zy.prototype,"z",[By,ei,Iy,Ly,Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Yy=je(zy.prototype,"space",[ky,ei,Ny,Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sv.Local}}),Uy=zy))||Uy),Pb=23541,Db=new Si,Mb=new Si,Bb=(Sv=Ze("cc.LimitVelocityOvertimeModule"),Tv=Ri(),Av=si(rm),Ev=hi(),Cv=Ri(),Rv=li(),wv=si(rm),xv=hi(),Ov=Ri(),Pv=li(),Dv=si(rm),Mv=hi(),Bv=Ri(),Iv=li(),Lv=si(rm),Fv=hi(),kv=Ri(),Nv=li(),Gv=Ri(),Uv=li(),zv=Ri(),Vv=li(),Hv=si(sv),Wv=Ri(),Xv=li(),Sv((ib=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_enable",Kv,ti(e)),$e(e,"limitX",qv,ti(e)),$e(e,"limitY",Zv,ti(e)),$e(e,"limitZ",Jv,ti(e)),$e(e,"limit",Qv,ti(e)),$e(e,"dampen",$v,ti(e)),$e(e,"separateAxes",tb,ti(e)),$e(e,"space",eb,ti(e)),e.drag=null,e.multiplyDragByParticleSize=!1,e.multiplyDragByParticleVelocity=!1,e.name="limitModule",e.rotation=void 0,e.needTransform=void 0,e.rotation=new ur,e.needTransform=!1,e.needUpdate=!0,e}Me(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=fv(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=Db;this.separateAxes?(Si.set(Mb,this.limitX.evaluate(e,sn(t.randomSeed+Pb)),this.limitY.evaluate(e,sn(t.randomSeed+Pb)),this.limitZ.evaluate(e,sn(t.randomSeed+Pb))),this.needTransform&&Si.transformQuat(Mb,Mb,this.rotation),Si.set(i,Ib(t.ultimateVelocity.x,Mb.x,this.dampen),Ib(t.ultimateVelocity.y,Mb.y,this.dampen),Ib(t.ultimateVelocity.z,Mb.z,this.dampen))):(Si.normalize(i,t.ultimateVelocity),Si.multiplyScalar(i,i,Ib(t.ultimateVelocity.length(),this.limit.evaluate(e,sn(t.randomSeed+Pb)),this.dampen))),Si.copy(t.ultimateVelocity,i)},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(nv),Kv=je((jv=ib).prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(jv.prototype,"enable",[Tv],Object.getOwnPropertyDescriptor(jv.prototype,"enable"),jv.prototype),qv=je(jv.prototype,"limitX",[Av,ei,Ev,Cv,Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Zv=je(jv.prototype,"limitY",[wv,ei,xv,Ov,Pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Jv=je(jv.prototype,"limitZ",[Dv,ei,Mv,Bv,Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Qv=je(jv.prototype,"limit",[Lv,ei,Fv,kv,Nv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),$v=je(jv.prototype,"dampen",[ei,Gv,Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),tb=je(jv.prototype,"separateAxes",[ei,zv,Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),eb=je(jv.prototype,"space",[Hv,ei,Wv,Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sv.Local}}),Yv=jv))||Yv);function Ib(t,e,i){var r=Math.sign(t),n=Math.abs(t);return n>e&&(n=$r(n,e,i)),n*r}var Lb,Fb,kb,Nb,Gb,Ub,zb,Vb,Hb,Wb,Xb,Yb,jb,Kb,qb,Zb,Jb,Qb,$b,tS,eS,iS,rS,nS,sS,aS,oS,lS,hS,uS,cS,pS,dS,fS,_S,gS,mS,yS,vS,bS,SS,TS,AS,ES,CS,RS,wS,xS,OS,PS,DS,MS,BS,IS,LS,FS,kS,NS,GS,US,zS,VS,HS,WS,XS,YS,jS,KS,qS,ZS,JS,QS,$S,tT,eT,iT,rT,nT,sT,aT,oT,lT,hT,uT,cT,pT,dT,fT,_T,gT,mT,yT,vT,bT,ST,TT,AT,ET,CT,RT,wT,xT,OT,PT,DT,MT,BT,IT,LT,FT,kT,NT,GT,UT,zT,VT,HT,WT,XT,YT,jT,KT,qT,ZT,JT,QT,$T,tA,eA,iA,rA,nA,sA,aA,oA,lA,hA,uA,cA,pA,dA,fA,_A,gA,mA,yA,vA,bA,SA,TA,AA,EA,CA,RA,wA,xA,OA,PA,DA,MA,BA,IA,LA,FA,kA,NA,GA,UA,zA,VA,HA,WA,XA,YA=125292,jA=(rb=Ze("cc.RotationOvertimeModule"),nb=Ri(),sb=Ri(),ab=li(),ob=si(rm),lb=hi(),hb=Ri(),ub=li(),cb=si(rm),pb=hi(),db=Ri(),fb=li(),_b=si(rm),gb=hi(),mb=Ri(),yb=li(),rb((Rb=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_enable",Sb,ti(e)),$e(e,"_separateAxes",Tb,ti(e)),$e(e,"x",Ab,ti(e)),$e(e,"y",Eb,ti(e)),$e(e,"z",Cb,ti(e)),e.name=$y,e}return Me(e,t),e.prototype.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime;if(this._separateAxes){var r=sn(t.randomSeed+YA);t.rotation.x+=this.x.evaluate(i,r)*e,t.rotation.y+=this.y.evaluate(i,r)*e,t.rotation.z+=this.z.evaluate(i,r)*e}else t.rotation.z+=this.z.evaluate(i,sn(t.randomSeed+YA))*e},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}},{key:"separateAxes",get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}]),e}(nv),Sb=je((bb=Rb).prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(bb.prototype,"enable",[nb],Object.getOwnPropertyDescriptor(bb.prototype,"enable"),bb.prototype),Tb=je(bb.prototype,"_separateAxes",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(bb.prototype,"separateAxes",[sb,ab],Object.getOwnPropertyDescriptor(bb.prototype,"separateAxes"),bb.prototype),Ab=je(bb.prototype,"x",[ob,ei,lb,un,hb,ub],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Eb=je(bb.prototype,"y",[cb,ei,pb,un,db,fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Cb=je(bb.prototype,"z",[_b,ei,gb,un,mb,yb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),vb=bb))||vb),KA=(Lb=Ze("cc.SizeOvertimeModule"),Fb=Ri(),kb=Ri(),Nb=li(),Gb=si(rm),Ub=Ri(),zb=li(),Vb=si(rm),Hb=Ri(),Wb=li(),Xb=si(rm),Yb=Ri(),jb=li(),Kb=si(rm),qb=Ri(),Zb=li(),Lb((sS=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_enable",$b,ti(e)),$e(e,"separateAxes",tS,ti(e)),$e(e,"size",eS,ti(e)),$e(e,"x",iS,ti(e)),$e(e,"y",rS,ti(e)),$e(e,"z",nS,ti(e)),e.name=tv,e}return Me(e,t),e.prototype.animate=function(t){if(this.separateAxes){var e=1-t.remainingLifetime/t.startLifetime,i=sn(t.randomSeed+39825);t.size.x=t.startSize.x*this.x.evaluate(e,i),t.size.y=t.startSize.y*this.y.evaluate(e,i),t.size.z=t.startSize.z*this.z.evaluate(e,i)}else Si.multiplyScalar(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,sn(t.randomSeed+39825)))},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(nv),$b=je((Qb=sS).prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(Qb.prototype,"enable",[Fb],Object.getOwnPropertyDescriptor(Qb.prototype,"enable"),Qb.prototype),tS=je(Qb.prototype,"separateAxes",[ei,kb,Nb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),eS=je(Qb.prototype,"size",[Gb,ei,Ub,zb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),iS=je(Qb.prototype,"x",[Vb,ei,Hb,Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),rS=je(Qb.prototype,"y",[Xb,ei,Yb,jb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),nS=je(Qb.prototype,"z",[Kb,ei,qb,Zb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Jb=Qb))||Jb),qA=90794,ZA=Oi({Grid:0}),JA=Oi({WholeSheet:0,SingleRow:1}),QA=(aS=Ze("cc.TextureAnimationModule"),oS=mr("numTilesX"),lS=mr("numTilesY"),hS=Ri(),uS=si(ZA),cS=si(ZA),pS=Ri(),dS=li(),fS=Ri(),_S=li(),gS=Ri(),mS=li(),yS=si(JA),vS=Ri(),bS=li(),SS=si(rm),TS=Ri(),AS=li(),ES=si(rm),CS=Ri(),RS=li(),wS=Ri(),xS=li(),OS=Ri(),PS=li(),DS=Ri(),MS=li(),aS((KS=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_enable",LS,ti(e)),$e(e,"_numTilesX",FS,ti(e)),$e(e,"_numTilesY",kS,ti(e)),$e(e,"_mode",NS,ti(e)),$e(e,"animation",GS,ti(e)),$e(e,"frameOverTime",US,ti(e)),$e(e,"startFrame",zS,ti(e)),$e(e,"cycleCount",VS,ti(e)),$e(e,"_flipU",HS,ti(e)),$e(e,"_flipV",WS,ti(e)),$e(e,"_uvChannelMask",XS,ti(e)),$e(e,"randomRow",YS,ti(e)),$e(e,"rowIndex",jS,ti(e)),e.name=ev,e}Me(e,t);var i=e.prototype;return i.init=function(t){t.startRow=Math.floor(Math.random()*this.numTilesY)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=this.startFrame.evaluate(e,sn(t.randomSeed+qA))/(this.numTilesX*this.numTilesY);if(this.animation===JA.WholeSheet)t.frameIndex=rn(this.cycleCount*(this.frameOverTime.evaluate(e,sn(t.randomSeed+qA))+i),1);else if(this.animation===JA.SingleRow){var r=1/this.numTilesY;if(this.randomRow){var n=rn(this.cycleCount*(this.frameOverTime.evaluate(e,sn(t.randomSeed+qA))+i),1),s=t.startRow*r,a=s+r;t.frameIndex=$r(s,a,n)}else{var o=this.rowIndex*r,l=o+r;t.frameIndex=$r(o,l,rn(this.cycleCount*(this.frameOverTime.evaluate(e,sn(t.randomSeed+qA))+i),1))}}},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&(this.target.updateMaterialParams(),this.target.enableModule(this.name,t,this)))}},{key:"mode",get:function(){return this._mode},set:function(t){t!==ZA.Grid&&console.error("particle texture animation's sprites is not supported!")}},{key:"numTilesX",get:function(){return this._numTilesX},set:function(t){this._numTilesX!==t&&(this._numTilesX=t,this.target.updateMaterialParams())}},{key:"numTilesY",get:function(){return this._numTilesY},set:function(t){this._numTilesY!==t&&(this._numTilesY=t,this.target.updateMaterialParams())}},{key:"flipU",get:function(){return this._flipU},set:function(){console.error("particle texture animation's flipU is not supported!")}},{key:"flipV",get:function(){return this._flipV},set:function(){console.error("particle texture animation's flipV is not supported!")}},{key:"uvChannelMask",get:function(){return this._uvChannelMask},set:function(){console.error("particle texture animation's uvChannelMask is not supported!")}}]),e}(nv),LS=je((IS=KS).prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FS=je(IS.prototype,"_numTilesX",[oS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kS=je(IS.prototype,"_numTilesY",[lS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(IS.prototype,"enable",[hS],Object.getOwnPropertyDescriptor(IS.prototype,"enable"),IS.prototype),NS=je(IS.prototype,"_mode",[uS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ZA.Grid}}),je(IS.prototype,"mode",[cS,pS,dS],Object.getOwnPropertyDescriptor(IS.prototype,"mode"),IS.prototype),je(IS.prototype,"numTilesX",[fS,_S],Object.getOwnPropertyDescriptor(IS.prototype,"numTilesX"),IS.prototype),je(IS.prototype,"numTilesY",[gS,mS],Object.getOwnPropertyDescriptor(IS.prototype,"numTilesY"),IS.prototype),GS=je(IS.prototype,"animation",[yS,ei,vS,bS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return JA.WholeSheet}}),US=je(IS.prototype,"frameOverTime",[SS,ei,TS,AS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),zS=je(IS.prototype,"startFrame",[ES,ei,CS,RS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),VS=je(IS.prototype,"cycleCount",[ei,wS,xS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),HS=je(IS.prototype,"_flipU",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WS=je(IS.prototype,"_flipV",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XS=je(IS.prototype,"_uvChannelMask",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),YS=je(IS.prototype,"randomRow",[ei,OS,PS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jS=je(IS.prototype,"rowIndex",[ei,DS,MS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),BS=IS))||BS),$A=197866,tE=new Si,eE=(qS=Ze("cc.VelocityOvertimeModule"),ZS=Ri(),JS=si(rm),QS=hi(),$S=Ri(),tT=li(),eT=si(rm),iT=hi(),rT=Ri(),nT=li(),sT=si(rm),aT=hi(),oT=Ri(),lT=li(),hT=si(rm),uT=hi(),cT=Ri(),pT=li(),dT=si(sv),fT=Ri(),_T=li(),qS((ET=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_enable",yT,ti(e)),$e(e,"x",vT,ti(e)),$e(e,"y",bT,ti(e)),$e(e,"z",ST,ti(e)),$e(e,"speedModifier",TT,ti(e)),$e(e,"space",AT,ti(e)),e.rotation=void 0,e.needTransform=void 0,e.name="velocityModule",e.rotation=new ur,e.speedModifier.constant=1,e.needTransform=!1,e.needUpdate=!0,e}Me(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=fv(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=Si.set(tE,this.x.evaluate(e,sn(t.randomSeed^$A)),this.y.evaluate(e,sn(156497^t.randomSeed)),this.z.evaluate(e,sn(984136^t.randomSeed)));this.needTransform&&Si.transformQuat(i,i,this.rotation),Si.add(t.animatedVelocity,t.animatedVelocity,i),Si.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),Si.multiplyScalar(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,sn(t.randomSeed+$A)))},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(nv),yT=je((mT=ET).prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(mT.prototype,"enable",[ZS],Object.getOwnPropertyDescriptor(mT.prototype,"enable"),mT.prototype),vT=je(mT.prototype,"x",[JS,ei,QS,$S,tT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),bT=je(mT.prototype,"y",[eT,ei,iT,rT,nT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),ST=je(mT.prototype,"z",[sT,ei,aT,oT,lT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),TT=je(mT.prototype,"speedModifier",[hT,ei,uT,cT,pT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),AT=je(mT.prototype,"space",[dT,ei,fT,_T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sv.Local}}),gT=mT))||gT),iE=t("Burst",(CT=Ze("cc.Burst"),RT=si(rm),CT((BT=function(){function t(){$e(this,"_time",OT,this),$e(this,"_repeatCount",PT,this),$e(this,"repeatInterval",DT,this),$e(this,"count",MT,this),this._remainingCount=void 0,this._curTime=void 0,this._remainingCount=0,this._curTime=0}var e=t.prototype;return e.update=function(t,e){if(0===this._remainingCount&&(this._remainingCount=this._repeatCount,this._curTime=this._time),this._remainingCount>0){var i=rn(t._time-t.startDelay.evaluate(0,1),t.duration)-e;i=i>0?i:0;var r=rn(t.time-t.startDelay.evaluate(0,1),t.duration);this._curTime>=i&&this._curTime<r&&(t.emit(this.count.evaluate(this._curTime/t.duration,1),e-(r-this._curTime)),this._curTime+=this.repeatInterval,--this._remainingCount)}},e.getMaxCount=function(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)},Be(t,[{key:"time",get:function(){return this._time},set:function(t){this._time=t,this._curTime=t}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this._remainingCount=t}}]),t}(),OT=je((xT=BT).prototype,"_time",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(xT.prototype,"time",[yr],Object.getOwnPropertyDescriptor(xT.prototype,"time"),xT.prototype),PT=je(xT.prototype,"_repeatCount",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),je(xT.prototype,"repeatCount",[yr],Object.getOwnPropertyDescriptor(xT.prototype,"repeatCount"),xT.prototype),DT=je(xT.prototype,"repeatInterval",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),MT=je(xT.prototype,"count",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),wT=xT))||wT)),rE=new Si(0,0,0),nE=[],sE=new Si(.5,.5,.5),aE=(IT=Ze("cc.ShapeModule"),LT=Ri(),FT=li(),kT=Ri(),NT=li(),GT=Ri(),UT=li(),zT=Ri(),VT=li(),HT=Ri(),WT=li(),XT=Ri(),YT=si(ov),jT=mr("shapeType"),KT=Ri(),qT=si(ov),ZT=li(),JT=si(lv),QT=Ri(),$T=li(),tA=Ri(),eA=li(),iA=Ri(),rA=li(),nA=Ri(),sA=li(),aA=Ri(),oA=li(),lA=Ri(),hA=li(),uA=Ri(),cA=li(),pA=si(hv),dA=Ri(),fA=li(),_A=Ri(),gA=li(),mA=si(rm),yA=Ri(),vA=li(),bA=Ri(),SA=li(),TA=Ri(),AA=li(),IT((XA=function(){function t(){$e(this,"_enable",RA,this),$e(this,"_shapeType",wA,this),$e(this,"emitFrom",xA,this),$e(this,"alignToDirection",OA,this),$e(this,"randomDirectionAmount",PA,this),$e(this,"sphericalDirectionAmount",DA,this),$e(this,"randomPositionAmount",MA,this),$e(this,"radius",BA,this),$e(this,"radiusThickness",IA,this),$e(this,"arcMode",LA,this),$e(this,"arcSpread",FA,this),$e(this,"arcSpeed",kA,this),$e(this,"length",NA,this),$e(this,"boxThickness",GA,this),$e(this,"_position",UA,this),$e(this,"_rotation",zA,this),$e(this,"_scale",VA,this),$e(this,"_arc",HA,this),$e(this,"_angle",WA,this),this.mat=void 0,this.quat=void 0,this.particleSystem=void 0,this.lastTime=void 0,this.totalAngle=void 0,this.mat=new gi,this.quat=new ur,this.particleSystem=null,this.lastTime=0,this.totalAngle=0}var e=t.prototype;return e.onInit=function(t){this.particleSystem=t,this.constructMat(),this.lastTime=this.particleSystem._time},e.emit=function(t){switch(this.shapeType){case ov.Box:!function(t,e,i,r){switch(t){case lv.Volume:n=i,s=sE,Si.set(n,on(-s.x,s.x),on(-s.y,s.y),on(-s.z,s.z));break;case lv.Shell:nE.splice(0,nE.length),nE.push(on(-.5,.5)),nE.push(on(-.5,.5)),nE.push(.5*bv()),vv(nE),oE(nE,e),Si.set(i,nE[0],nE[1],nE[2]);break;case lv.Edge:nE.splice(0,nE.length),nE.push(on(-.5,.5)),nE.push(.5*bv()),nE.push(.5*bv()),vv(nE),oE(nE,e),Si.set(i,nE[0],nE[1],nE[2]);break;default:console.warn(t+" is not supported for box emitter.")}var n,s;Si.copy(r,dv)}(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case ov.Circle:e=this.radius,i=this.radiusThickness,r=this.generateArcAngle(),n=t.position,s=t.velocity,yv(n,e*(1-i),e,r),Si.normalize(s,n);break;case ov.Cone:!function(t,e,i,r,n,s,a,o){switch(t){case lv.Base:yv(a,e*(1-i),e,r),_i.multiplyScalar(o,a,Math.sin(n)),o.z=-Math.cos(n)*e,Si.normalize(o,o),a.z=0;break;case lv.Shell:_v(a,r),_i.multiplyScalar(o,a,Math.sin(n)),o.z=-Math.cos(n),Si.normalize(o,o),_i.multiplyScalar(a,a,e),a.z=0;break;case lv.Volume:yv(a,e*(1-i),e,r),_i.multiplyScalar(o,a,Math.sin(n)),o.z=-Math.cos(n)*e,Si.normalize(o,o),a.z=0,Si.add(a,a,Si.multiplyScalar(rE,o,s*an()/-o.z));break;default:console.warn(t+" is not supported for cone emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,this.generateArcAngle(),this._angle,this.length,t.position,t.velocity);break;case ov.Sphere:!function(t,e,i,r,n){switch(t){case lv.Volume:mv(r,e*(1-i),e),Si.normalize(n,r);break;case lv.Shell:gv(r),Si.multiplyScalar(r,r,e),Si.normalize(n,r);break;default:console.warn(t+" is not supported for sphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case ov.Hemisphere:!function(t,e,i,r,n){switch(t){case lv.Volume:mv(r,e*(1-i),e),r.z>0&&(r.z*=-1),Si.normalize(n,r);break;case lv.Shell:gv(r),Si.multiplyScalar(r,r,e),r.z>0&&(r.z*=-1),Si.normalize(n,r);break;default:console.warn(t+" is not supported for hemisphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;default:console.warn(this.shapeType+" shapeType is not supported by ShapeModule.")}var e,i,r,n,s;if(this.randomPositionAmount>0&&(t.position.x+=on(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=on(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=on(-this.randomPositionAmount,this.randomPositionAmount)),Si.transformQuat(t.velocity,t.velocity,this.quat),Si.transformMat4(t.position,t.position,this.mat),this.sphericalDirectionAmount>0){var a=Si.normalize(rE,t.position);Si.lerp(t.velocity,t.velocity,a,this.sphericalDirectionAmount)}this.lastTime=this.particleSystem._time},e.constructMat=function(){ur.fromEuler(this.quat,this._rotation.x,this._rotation.y,this._rotation.z),gi.fromRTS(this.mat,this.quat,this._position,this._scale)},e.generateArcAngle=function(){if(this.arcMode===hv.Random)return on(0,this._arc);var t=this.totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem._time,1)*(this.particleSystem._time-this.lastTime);switch(this.totalAngle=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case hv.Loop:return rn(t,this._arc);case hv.PingPong:return cn(t,this._arc)}},Be(t,[{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.constructMat()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.constructMat()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this.constructMat()}},{key:"arc",get:function(){return Jr(this._arc)},set:function(t){this._arc=Pr(t)}},{key:"angle",get:function(){return Math.round(100*Jr(this._angle))/100},set:function(t){this._angle=Pr(t)}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"shapeType",get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,this._shapeType){case ov.Box:this.emitFrom===lv.Base&&(this.emitFrom=lv.Volume);break;case ov.Cone:this.emitFrom===lv.Edge&&(this.emitFrom=lv.Base);break;case ov.Sphere:case ov.Hemisphere:this.emitFrom!==lv.Base&&this.emitFrom!==lv.Edge||(this.emitFrom=lv.Volume)}}}]),t}(),je((CA=XA).prototype,"position",[LT,FT],Object.getOwnPropertyDescriptor(CA.prototype,"position"),CA.prototype),je(CA.prototype,"rotation",[kT,NT],Object.getOwnPropertyDescriptor(CA.prototype,"rotation"),CA.prototype),je(CA.prototype,"scale",[GT,UT],Object.getOwnPropertyDescriptor(CA.prototype,"scale"),CA.prototype),je(CA.prototype,"arc",[zT,VT],Object.getOwnPropertyDescriptor(CA.prototype,"arc"),CA.prototype),je(CA.prototype,"angle",[HT,WT],Object.getOwnPropertyDescriptor(CA.prototype,"angle"),CA.prototype),RA=je(CA.prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(CA.prototype,"enable",[XT],Object.getOwnPropertyDescriptor(CA.prototype,"enable"),CA.prototype),wA=je(CA.prototype,"_shapeType",[YT,jT,KT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ov.Cone}}),je(CA.prototype,"shapeType",[qT,ZT],Object.getOwnPropertyDescriptor(CA.prototype,"shapeType"),CA.prototype),xA=je(CA.prototype,"emitFrom",[JT,ei,QT,$T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return lv.Volume}}),OA=je(CA.prototype,"alignToDirection",[ei,tA,eA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),PA=je(CA.prototype,"randomDirectionAmount",[ei,iA,rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),DA=je(CA.prototype,"sphericalDirectionAmount",[ei,nA,sA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MA=je(CA.prototype,"randomPositionAmount",[ei,aA,oA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),BA=je(CA.prototype,"radius",[ei,lA,hA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),IA=je(CA.prototype,"radiusThickness",[ei,uA,cA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),LA=je(CA.prototype,"arcMode",[pA,ei,dA,fA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hv.Random}}),FA=je(CA.prototype,"arcSpread",[ei,_A,gA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kA=je(CA.prototype,"arcSpeed",[mA,ei,yA,vA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),NA=je(CA.prototype,"length",[ei,bA,SA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),GA=je(CA.prototype,"boxThickness",[ei,TA,AA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si(0,0,0)}}),UA=je(CA.prototype,"_position",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si(0,0,0)}}),zA=je(CA.prototype,"_rotation",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si(0,0,0)}}),VA=je(CA.prototype,"_scale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si(1,1,1)}}),HA=je(CA.prototype,"_arc",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pr(360)}}),WA=je(CA.prototype,"_angle",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pr(25)}}),EA=CA))||EA);function oE(t,e){e.x>0&&(t[0]+=.5*on(-e.x,e.x),t[0]=Ye(t[0],-.5,.5)),e.y>0&&(t[1]+=.5*on(-e.y,e.y),t[1]=Ye(t[1],-.5,.5)),e.z>0&&(t[2]+=.5*on(-e.z,e.z),t[2]=Ye(t[2],-.5,.5))}var lE,hE,uE,cE,pE,dE,fE,_E,gE,mE,yE,vE,bE,SE,TE,AE,EE,CE,RE,wE,xE,OE,PE,DE,ME,BE,IE,LE,FE,kE=[0,0,1,0,0,1,1,1],NE=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertAttrs=void 0,e._vertSize=void 0,e._vBuffer=void 0,e._vertAttrsFloatCount=void 0,e._vdataF32=void 0,e._vdataUint32=void 0,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=void 0,e._mesh=void 0,e._vertCount=0,e._indexCount=0,e._startTimeOffset=0,e._lifeTimeOffset=0,e._material=null,e.type=Vr.PARTICLE_BATCH,e._capacity=0,e._vertAttrs=null,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=new lt([new at]),e._iaInfoBuffer=e._device.createBuffer(new nt(_.INDIRECT,y.HOST|y.DEVICE,qt,qt)),e._subMeshData=null,e._mesh=null,e}Me(e,t);var i=e.prototype;return i.setCapacity=function(t){var e=this._capacity!==t;this._capacity=t,this._subMeshData&&e&&this.rebuild()},i.setVertexAttributes=function(t,e){if(this._mesh!==t||this._vertAttrs!==e){this._mesh=t,this._vertAttrs=e,this._vertSize=0;for(var i,r=ke(this._vertAttrs);!(i=r()).done;){var n=i.value;n.offset=this._vertSize,this._vertSize+=Xt[n.format].size}this._vertAttrsFloatCount=this._vertSize/4,this.rebuild()}},i.createSubMeshData=function(){this.destroySubMeshData(),this._vertCount=4,this._indexCount=6,this._mesh&&(this._vertCount=this._mesh.struct.vertexBundles[this._mesh.struct.primitives[0].vertexBundelIndices[0]].view.count,this._indexCount=this._mesh.struct.primitives[0].indexView.count);var t=this._device.createBuffer(new nt(_.VERTEX|_.TRANSFER_DST,y.HOST|y.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);if(this._mesh){var i=this._vertAttrs[this._vertAttrs.findIndex((function(t){return t.name===Wt.ATTR_TEX_COORD}))].offset;this._mesh.copyAttribute(0,Wt.ATTR_TEX_COORD,e,this._vertSize,i);var r=this._vertAttrs.findIndex((function(t){return t.name===Wt.ATTR_TEX_COORD3}));if(i=this._vertAttrs[r++].offset,this._mesh.copyAttribute(0,Wt.ATTR_POSITION,e,this._vertSize,i),i=this._vertAttrs[r++].offset,this._mesh.copyAttribute(0,Wt.ATTR_NORMAL,e,this._vertSize,i),i=this._vertAttrs[r++].offset,!this._mesh.copyAttribute(0,Wt.ATTR_COLOR,e,this._vertSize,i))for(var n=new Uint32Array(e),s=0;s<this._vertCount;++s)n[s*this._vertAttrsFloatCount+i/4]=Ii.WHITE._val;for(var a=new Float32Array(e),o=1;o<this._capacity;o++)a.copyWithin(o*this._vertSize*this._vertCount/4,0,this._vertSize*this._vertCount/4)}t.update(e);var l=new Uint16Array(this._capacity*this._indexCount);if(this._mesh){this._mesh.copyIndices(0,l);for(var h=1;h<this._capacity;h++)for(var u=0;u<this._indexCount;u++)l[h*this._indexCount+u]=l[u]+h*this._vertCount}else for(var c=0,p=0;p<this._capacity;++p){var d=4*p;l[c++]=d,l[c++]=d+1,l[c++]=d+2,l[c++]=d+3,l[c++]=d+2,l[c++]=d+1}var f=this._device.createBuffer(new nt(_.INDEX|_.TRANSFER_DST,y.HOST|y.DEVICE,this._capacity*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return f.update(l),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=this._capacity*this._indexCount,this._iaInfoBuffer||(this._iaInfoBuffer=this._device.createBuffer(new nt(_.INDIRECT,y.HOST|y.DEVICE,qt,qt))),this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new cr([t],this._vertAttrs,L.TRIANGLE_LIST,f,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.updateMaterial=function(t){this._material=t,this.setSubModelMaterial(0,t)},i.addParticleVertexData=function(t,e){if(this._mesh)for(var i=0;i<this._vertCount;i++){var r=(t*this._vertCount+i)*this._vertAttrsFloatCount;this._vdataF32[r++]=e[0].x,this._vdataF32[r++]=e[0].y,this._vdataF32[r++]=e[0].z,r+=2,this._vdataF32[r++]=e[1].z,this._vdataF32[r++]=e[2].x,this._vdataF32[r++]=e[2].y,this._vdataF32[r++]=e[2].z,this._vdataF32[r++]=e[3].x,this._vdataF32[r++]=e[3].y,this._vdataF32[r++]=e[3].z,this._vdataUint32[r++]=e[4]}else{var n=t*this._vertAttrsFloatCount;this._vdataF32[n++]=e[0].x,this._vdataF32[n++]=e[0].y,this._vdataF32[n++]=e[0].z,this._vdataF32[n++]=e[1].x,this._vdataF32[n++]=e[1].y,this._vdataF32[n++]=e[1].z,this._vdataF32[n++]=e[2].x,this._vdataF32[n++]=e[2].y,this._vdataF32[n++]=e[2].z,this._vdataF32[n++]=e[3].x,this._vdataF32[n++]=e[3].y,this._vdataF32[n++]=e[3].z,this._vdataUint32[n++]=e[4],e[5]&&(this._vdataF32[n++]=e[5].x,this._vdataF32[n++]=e[5].y,this._vdataF32[n++]=e[5].z)}},i.addGPUParticleVertexData=function(t,e,i){for(var r=e*this._vertAttrsFloatCount*this._vertCount,n=0;n<this._vertCount;n++){var s=r;this._vdataF32[s++]=t.position.x,this._vdataF32[s++]=t.position.y,this._vdataF32[s++]=t.position.z,this._vdataF32[s++]=i,this._vdataF32[s++]=t.startSize.x,this._vdataF32[s++]=t.startSize.y,this._vdataF32[s++]=t.startSize.z,this._vdataF32[s++]=kE[2*n],this._vdataF32[s++]=t.rotation.x,this._vdataF32[s++]=t.rotation.y,this._vdataF32[s++]=t.rotation.z,this._vdataF32[s++]=kE[2*n+1],this._vdataF32[s++]=t.startColor.r/255,this._vdataF32[s++]=t.startColor.g/255,this._vdataF32[s++]=t.startColor.b/255,this._vdataF32[s++]=t.startColor.a/255,this._vdataF32[s++]=t.velocity.x,this._vdataF32[s++]=t.velocity.y,this._vdataF32[s++]=t.velocity.z,this._vdataF32[s++]=t.startLifetime,this._vdataF32[s++]=t.randomSeed,r+=this._vertAttrsFloatCount}},i.updateGPUParticles=function(t,e,i){for(var r=this._vertAttrsFloatCount*this._vertCount,n=0,s=0,a=0,o=0;o<t;++o)n=o*r,s=this._vdataF32[n+this._startTimeOffset],this._vdataF32[n+this._lifeTimeOffset]-(e-s)<i&&(a=--t*r,this._vdataF32.copyWithin(n,a,a+r),o--);return t},i.constructAttributeIndex=function(){if(this._vertAttrs){var t=this._vertAttrs.findIndex((function(t){return"a_position_starttime"===t.name})),e=this._vertAttrs[t].offset;this._startTimeOffset=e/4+3,t=this._vertAttrs.findIndex((function(t){return"a_dir_life"===t.name})),e=this._vertAttrs[t].offset,this._lifeTimeOffset=e/4+3}},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.clear=function(){this._subModels[0].inputAssembler.indexCount=0},i.destroy=function(){t.prototype.destroy.call(this),this._vBuffer=null,this._vdataF32=null,this.destroySubMeshData(),this._iaInfoBuffer&&(this._iaInfoBuffer.destroy(),this._iaInfoBuffer=null)},i.rebuild=function(){this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null,this._iaInfoBuffer=null)},e}(gr),GE=function(){function t(t){this._particleSystem=null,this._model=null,this._renderInfo=null,this._vertAttrs=[],this._renderInfo=t}var e=t.prototype;return e.onInit=function(t){this._particleSystem=t},e.onEnable=function(){if(this._particleSystem){this.attachToScene();var t=this._model;t&&(t.node=t.transform=this._particleSystem.node,t.enabled=this._particleSystem.enabledInHierarchy)}},e.onDisable=function(){this.detachFromScene()},e.onDestroy=function(){this._model&&(Xe.director.root.destroyModel(this._model),this._model=null)},e.attachToScene=function(){this._model&&(this._model.scene&&this.detachFromScene(),this._particleSystem._getRenderScene().addModel(this._model))},e.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e.setVertexAttributes=function(){this._model&&this._model.setVertexAttributes(this._renderInfo.renderMode===av.Mesh?this._renderInfo.mesh:null,this._vertAttrs)},e.clear=function(){this._model&&(this._model.enabled=!1)},e._initModel=function(){this._model||(this._model=Xe.director.root.createModel(NE),this._model.setCapacity(this._particleSystem.capacity),this._model.visFlags=this._particleSystem.visibility)},e.updateTrailMaterial=function(){},e.getDefaultTrailMaterial=function(){return null},t}(),UE=new Si,zE=new gi,VE=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"],HE=[0,0,1,0,0,1,1,1],WE=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RGB32F),new St(Wt.ATTR_TEX_COORD1,p.RGB32F),new St(Wt.ATTR_TEX_COORD2,p.RGB32F),new St(Wt.ATTR_COLOR,p.RGBA8,!0)],XE=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RGB32F),new St(Wt.ATTR_TEX_COORD1,p.RGB32F),new St(Wt.ATTR_TEX_COORD2,p.RGB32F),new St(Wt.ATTR_COLOR,p.RGBA8,!0),new St(Wt.ATTR_COLOR1,p.RGB32F)],YE=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RGB32F),new St(Wt.ATTR_TEX_COORD1,p.RGB32F),new St(Wt.ATTR_TEX_COORD2,p.RGB32F),new St(Wt.ATTR_COLOR,p.RGBA8,!0),new St(Wt.ATTR_TEX_COORD3,p.RGB32F),new St(Wt.ATTR_NORMAL,p.RGB32F),new St(Wt.ATTR_COLOR1,p.RGBA8,!0)],jE={parent:null,owner:null,subModelIdx:0},KE=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._trailDefines=void 0,i._frameTile_velLenScale=void 0,i._defaultMat=null,i._node_scale=void 0,i._attrs=void 0,i._particles=null,i._defaultTrailMat=null,i._updateList=new Map,i._animateList=new Map,i._runAnimateList=new Array,i._fillDataFunc=null,i._uScaleHandle=0,i._uLenHandle=0,i._inited=!1,i._localMat=new gi,i._gravity=new Sr,i._model=null,i._frameTile_velLenScale=new Sr(1,1,0,0),i._node_scale=new Sr,i._attrs=new Array(5),i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1},i._trailDefines={CC_USE_WORLD_SPACE:!0},i}Me(e,t);var r=e.prototype;return r.onInit=function(e){var r=this;t.prototype.onInit.call(this,e),this._particles=new i((function(){return new Jy(r)}),16),this._setVertexAttrib(),this._setFillFunc(),this._initModuleList(),this._initModel(),this.updateMaterialParams(),this.updateTrailMaterial(),this.setVertexAttributes(),this._inited=!0},r.clear=function(){t.prototype.clear.call(this),this._particles.reset(),this._particleSystem._trailModule&&this._particleSystem._trailModule.clear(),this.updateRenderData(),this._model.enabled=!1},r.updateRenderMode=function(){this._setVertexAttrib(),this._setFillFunc(),this.updateMaterialParams(),this.setVertexAttributes()},r.getFreeParticle=function(){return this._particles.length>=this._particleSystem.capacity?null:this._particles.add()},r.getDefaultTrailMaterial=function(){return this._defaultTrailMat},r.setNewParticle=function(){},r._initModuleList=function(){var t=this;VE.forEach((function(e){var i=t._particleSystem[e];i&&i.enable&&(i.needUpdate&&(t._updateList[i.name]=i),i.needAnimate&&(t._animateList[i.name]=i))})),this._runAnimateList.length=0;for(var e=0,i=iv.length;e<i;e++){var r=this._animateList[iv[e]];r&&this._runAnimateList.push(r)}},r.enableModule=function(t,e,i){e?(i.needUpdate&&(this._updateList[i.name]=i),i.needAnimate&&(this._animateList[i.name]=i)):(delete this._animateList[t],delete this._updateList[t]),this._runAnimateList.length=0;for(var r=0,n=iv.length;r<n;r++){var s=this._animateList[iv[r]];s&&this._runAnimateList.push(s)}},r.updateParticles=function(t){var e=this,i=this._particleSystem;if(!i)return this._particles.length;switch(i.node.getWorldMatrix(zE),i.scaleSpace){case sv.Local:i.node.getScale(this._node_scale);break;case sv.World:i.node.getWorldScale(this._node_scale)}(i.getMaterialInstance(0)||this._defaultMat).passes[0].setUniform(this._uScaleHandle,this._node_scale),this._updateList.forEach((function(t){t.update(i._simulationSpace,zE)}));var r=i._trailModule,n=r&&r.enable;if(n&&r.update(),i.simulationSpace===sv.Local){var s=i.node.getRotation();gi.fromQuat(this._localMat,s),this._localMat.transpose()}for(var a=function(s){var a=e._particles.data[s];if(a.remainingLifetime-=t,Si.set(a.animatedVelocity,0,0,0),a.remainingLifetime<0)return n&&r.removeParticle(a),e._particles.removeAt(s),--s,o=s,"continue";if(i.simulationSpace===sv.Local){var l=9.8*-i.gravityModifier.evaluate(1-a.remainingLifetime/a.startLifetime,sn(a.randomSeed))*t;e._gravity.x=0,e._gravity.y=l,e._gravity.z=0,e._gravity.w=1,e._gravity=e._gravity.transformMat4(e._localMat),a.velocity.x+=e._gravity.x,a.velocity.y+=e._gravity.y,a.velocity.z+=e._gravity.z}else a.velocity.y-=9.8*i.gravityModifier.evaluate(1-a.remainingLifetime/a.startLifetime,sn(a.randomSeed))*t;Si.copy(a.ultimateVelocity,a.velocity),e._runAnimateList.forEach((function(e){e.animate(a,t)})),Si.scaleAndAdd(a.position,a.position,a.ultimateVelocity,t),n&&r.animate(a,t),o=s},o=0;o<this._particles.length;++o)a(o);return this._model.enabled=this._particles.length>0,this._particles.length},r.updateRenderData=function(){for(var t=0,e=0;e<this._particles.length;++e){var i=this._particles.data[e],r=0,n=this._particleSystem._textureAnimationModule;n&&n.enable&&(r=i.frameIndex),t=4*e,this._fillDataFunc(i,t,r)}},r.beforeRender=function(){this._model.updateIA(this._particles.length)},r.getParticleCount=function(){return this._particles.length},r.onMaterialModified=function(t){this._inited&&(0===t?this.updateMaterialParams():this.updateTrailMaterial())},r.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e);var i=this._particleSystem._trailModule;i&&i._trailModel&&1===t&&i._trailModel.setSubModelMaterial(0,e)},r._setFillFunc=function(){this._renderInfo.renderMode===av.Mesh?this._fillDataFunc=this._fillMeshData:this._renderInfo.renderMode===av.StrecthedBillboard?this._fillDataFunc=this._fillStrecthedData:this._fillDataFunc=this._fillNormalData},r._fillMeshData=function(t,e,i){var r=e/4,n=0;this._attrs[n++]=t.position,UE.z=i,this._attrs[n++]=UE,this._attrs[n++]=t.size,this._attrs[n++]=t.rotation,this._attrs[n++]=t.color._val,this._model.addParticleVertexData(r,this._attrs)},r._fillStrecthedData=function(t,e,i){for(var r=0,n=0;n<4;++n)r=0,this._attrs[r++]=t.position,UE.x=HE[2*n],UE.y=HE[2*n+1],UE.z=i,this._attrs[r++]=UE,this._attrs[r++]=t.size,this._attrs[r++]=t.rotation,this._attrs[r++]=t.color._val,this._attrs[r++]=t.ultimateVelocity,this._attrs[r++]=t.ultimateVelocity,this._model.addParticleVertexData(e++,this._attrs)},r._fillNormalData=function(t,e,i){for(var r=0,n=0;n<4;++n)r=0,this._attrs[r++]=t.position,UE.x=HE[2*n],UE.y=HE[2*n+1],UE.z=i,this._attrs[r++]=UE,this._attrs[r++]=t.size,this._attrs[r++]=t.rotation,this._attrs[r++]=t.color._val,this._attrs[r++]=null,this._model.addParticleVertexData(e++,this._attrs)},r._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case av.StrecthedBillboard:this._vertAttrs=XE.slice();break;case av.Mesh:this._vertAttrs=YE.slice();break;default:this._vertAttrs=WE.slice()}},r.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!=e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1!==i.indexOf("particle")&&-1===i.indexOf("particle-gpu")||t.setMaterial(null,0)}null==t.sharedMaterial&&null==this._defaultMat&&(jE.parent=ki.get("default-particle-material"),jE.owner=this._particleSystem,jE.subModelIdx=0,this._defaultMat=new nn(jE),null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;t._simulationSpace===sv.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var n=r.passes[0];this._uScaleHandle=n.getHandle("scale"),this._uLenHandle=n.getHandle("frameTile_velLenScale");var s=this._renderInfo.renderMode,a=this._frameTile_velLenScale;s===av.Billboard?this._defines.CC_RENDER_MODE=0:s===av.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,a.z=this._renderInfo.velocityScale,a.w=this._renderInfo.lengthScale):s===av.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:s===av.VerticalBillboard?this._defines.CC_RENDER_MODE=3:s===av.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+s+" not support.");var o=t._textureAnimationModule;o&&o.enable?(_i.set(a,o.numTilesX,o.numTilesY),n.setUniform(this._uLenHandle,a)):n.setUniform(this._uLenHandle,a),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},r.updateTrailMaterial=function(){if(this._particleSystem){var t=this._particleSystem,e=t._trailModule;if(e&&e.enable){t.simulationSpace===sv.World||e.space===sv.World?this._trailDefines.CC_USE_WORLD_SPACE=!0:this._trailDefines.CC_USE_WORLD_SPACE=!1;var i=t.getMaterialInstance(1);null===i&&null===this._defaultTrailMat&&(jE.parent=ki.get("default-trail-material"),jE.owner=this._particleSystem,jE.subModelIdx=1,this._defaultTrailMat=new nn(jE)),(i=i||this._defaultTrailMat).recompileShaders(this._trailDefines),e.updateMaterial()}}},e}(GE),qE=new gi,ZE=new Sr,JE=new ur,QE=32,$E="a_position_starttime",tC="a_size_uv",eC="a_rotation_uv",iC="a_color",rC="a_dir_life",nC="a_rndSeed",sC=[new St($E,p.RGBA32F),new St(tC,p.RGBA32F),new St(eC,p.RGBA32F),new St(iC,p.RGBA32F),new St(rC,p.RGBA32F),new St(nC,p.R32F)],aC=[new St($E,p.RGBA32F),new St(tC,p.RGBA32F),new St(eC,p.RGBA32F),new St(iC,p.RGBA32F),new St(rC,p.RGBA32F),new St(nC,p.R32F),new St(Wt.ATTR_TEX_COORD,p.RGB32F),new St(Wt.ATTR_TEX_COORD3,p.RGB32F),new St(Wt.ATTR_NORMAL,p.RGB32F),new St(Wt.ATTR_COLOR1,p.RGBA8,!0)],oC={parent:null,owner:null,subModelIdx:0},lC=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._frameTile_velLenScale=void 0,i._node_scale=void 0,i._vertAttrs=[],i._defaultMat=null,i._particleNum=0,i._tempParticle=null,i._colorTexture=null,i._forceTexture=null,i._velocityTexture=null,i._rotationTexture=null,i._sizeTexture=null,i._animTexture=null,i._uTimeHandle=0,i._uRotHandle=0,i._inited=!1,i._frameTile_velLenScale=new Sr(1,1,0,0),i._node_scale=new Sr,i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1,COLOR_OVER_TIME_MODULE_ENABLE:!1},i._tempParticle=new Jy(null),i._particleNum=0,i}Me(e,t);var i=e.prototype;return i.onInit=function(e){t.prototype.onInit.call(this,e),this._setVertexAttrib(),this._initModel(),this.updateMaterialParams(),this.setVertexAttributes(),this._inited=!0},i.updateRenderMode=function(){this._setVertexAttrib(),this.updateMaterialParams(),this.setVertexAttributes()},i.setVertexAttributes=function(){t.prototype.setVertexAttributes.call(this),this._model.constructAttributeIndex()},i.clear=function(){t.prototype.clear.call(this),this._particleNum=0,this.updateRenderData()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._forceTexture&&this._forceTexture.destroy(),this._velocityTexture&&this._velocityTexture.destroy(),this._colorTexture&&this._colorTexture.destroy(),this._sizeTexture&&this._sizeTexture.destroy(),this._rotationTexture&&this._rotationTexture.destroy(),this._animTexture&&this._animTexture.destroy()},i.enableModule=function(){var t=this._particleSystem.getMaterialInstance(0)||this._defaultMat;t&&(this.initShaderUniform(t),t.recompileShaders(this._defines),this._model&&this._model.setSubModelMaterial(0,t))},i.getFreeParticle=function(){return this._particleNum>=this._particleSystem._capacity?null:this._tempParticle},i.setNewParticle=function(t){this._model.addGPUParticleVertexData(t,this._particleNum,this._particleSystem._time),this._particleNum++},i.updateParticles=function(t){return this._particleNum=this._model.updateGPUParticles(this._particleNum,this._particleSystem._time,t),this.updateShaderUniform(t),this._model.enabled=this._particleNum>0,this._particleNum},i.updateRenderData=function(){},i.beforeRender=function(){this._model.updateIA(this._particleNum)},i.updateShaderUniform=function(t){var e=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(e){var i=e.passes[0];ZE.x=this._particleSystem._time,ZE.y=t,i.setUniform(this._uTimeHandle,ZE),this._particleSystem.node.getWorldRotation(JE),i.setUniform(this._uRotHandle,JE)}},i.initShaderUniform=function(t){var e=t.passes[0];this._uTimeHandle=e.getHandle("u_timeDelta"),this._uRotHandle=e.getHandle("u_worldRot"),e.setUniform(e.getHandle("scale"),this._node_scale),e.setUniform(e.getHandle("frameTile_velLenScale"),this._frameTile_velLenScale),ZE.x=QE,ZE.y=.03125,e.setUniform(e.getHandle("u_sampleInfo"),ZE);var i=!1,r=this._particleSystem._forceOvertimeModule;if(i=r&&r.enable,this._defines.FORCE_OVER_TIME_MODULE_ENABLE=i,i){this._forceTexture&&this._forceTexture.destroy(),this._forceTexture=om(QE,r.x,r.y,r.z);var n=e.getHandle("force_over_time_tex0"),s=pn.getBindingFromHandle(n);e.bindSampler(s,this._forceTexture.getGFXSampler()),e.bindTexture(s,this._forceTexture.getGFXTexture());var a=e.getHandle("u_force_space");e.setUniform(a,r.space);var o=e.getHandle("u_force_mode");e.setUniform(o,this._forceTexture.height)}var l=this._particleSystem._velocityOvertimeModule;if(i=l&&l.enable,this._defines.VELOCITY_OVER_TIME_MODULE_ENABLE=i,i){this._velocityTexture&&this._velocityTexture.destroy(),this._velocityTexture=function(t,e,i,r,n){for(var s=Math.max(sm(e),sm(i),sm(r),sm(n)),a=new Float32Array(128*s),o=[e,i,r,n],l=0;l<s;l++)for(var h=0;h<4;h++)for(var u=o[h],c=0,p=0,d=0;d<32;d++){var f=nm(u,.03225806451612903*d,l);p=(c+=f)/(d+1),a[4*d+h]=p}return am(a,32,s)}(0,l.x,l.y,l.z,l.speedModifier);var h=e.getHandle("velocity_over_time_tex0"),u=pn.getBindingFromHandle(h);e.bindSampler(u,this._velocityTexture.getGFXSampler()),e.bindTexture(u,this._velocityTexture.getGFXTexture());var c=e.getHandle("u_velocity_space");e.setUniform(c,l.space);var p=e.getHandle("u_velocity_mode");e.setUniform(p,this._velocityTexture.height)}var d=this._particleSystem._colorOverLifetimeModule;if(i=d&&d.enable,this._defines.COLOR_OVER_TIME_MODULE_ENABLE=i,i){this._colorTexture&&this._colorTexture.destroy(),this._colorTexture=function(t,e){for(var i=function(t){switch(t.mode){case cy.TwoColors:case cy.TwoGradients:return 2;default:return 1}}(e),r=new Uint8Array(t*i*4),n=1/(t-1),s=0,a=0;a<i;a++)for(var o=0;o<t;o++){var l=dy(e,n*o,a);r[s]=l.r,r[s+1]=l.g,r[s+2]=l.b,r[s+3]=l.a,s+=4}var h=new ir;return h.create(t,i,Kr.RGBA8888),h.setFilters(jr.LINEAR,jr.LINEAR),h.setWrapMode(en.CLAMP_TO_EDGE,en.CLAMP_TO_EDGE),h.uploadData(r),h}(QE,d.color);var f=e.getHandle("color_over_time_tex0"),_=pn.getBindingFromHandle(f);e.bindSampler(_,this._colorTexture.getGFXSampler()),e.bindTexture(_,this._colorTexture.getGFXTexture());var g=e.getHandle("u_color_mode");e.setUniform(g,this._colorTexture.height)}var m=this._particleSystem._rotationOvertimeModule;if(i=m&&m.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=i,i){this._rotationTexture&&this._rotationTexture.destroy(),m.separateAxes?this._rotationTexture=om(QE,m.x,m.y,m.z):this._rotationTexture=function(t,e){for(var i=sm(e),r=new Float32Array(128*i),n=0,s=0;s<i;s++)for(var a=0;a<32;a++){var o=nm(e,.03225806451612903*a,s);r[n+2]=o,n+=4}return am(r,32,i)}(0,m.z);var y=e.getHandle("rotation_over_time_tex0"),v=pn.getBindingFromHandle(y);e.bindSampler(v,this._rotationTexture.getGFXSampler()),e.bindTexture(v,this._rotationTexture.getGFXTexture());var b=e.getHandle("u_rotation_mode");e.setUniform(b,this._rotationTexture.height)}var S=this._particleSystem._sizeOvertimeModule;if(i=S&&S.enable,this._defines.SIZE_OVER_TIME_MODULE_ENABLE=i,i){this._sizeTexture&&this._sizeTexture.destroy(),S.separateAxes?this._sizeTexture=om(QE,S.x,S.y,S.z,!0):this._sizeTexture=function(t,e){for(var i=sm(e),r=new Float32Array(128*i),n=0,s=0,a=0;a<i;a++){0;for(var o=0;o<32;o++){var l=nm(e,.03225806451612903*o,a);n=l,r[s]=n,r[s+1]=n,r[s+2]=n,s+=4}}return am(r,32,i)}(0,S.size);var T=e.getHandle("size_over_time_tex0"),A=pn.getBindingFromHandle(T);e.bindSampler(A,this._sizeTexture.getGFXSampler()),e.bindTexture(A,this._sizeTexture.getGFXTexture());var E=e.getHandle("u_size_mode");e.setUniform(E,this._sizeTexture.height)}var C=this._particleSystem._textureAnimationModule;if(i=C&&C.enable,this._defines.TEXTURE_ANIMATION_MODULE_ENABLE=i,i){this._animTexture&&this._animTexture.destroy(),this._animTexture=function(t,e,i){for(var r=Math.max(sm(e),sm(i)),n=new Float32Array(128*r),s=[e,i],a=0;a<r;a++)for(var o=0;o<2;o++)for(var l=s[o],h=0,u=0,c=0;c<32;c++){var p=nm(l,.03225806451612903*c,a);u=(h+=p)/(c+1),n[4*c+o]=u}return am(n,32,r)}(0,C.startFrame,C.frameOverTime);var R=e.getHandle("texture_animation_tex0"),w=pn.getBindingFromHandle(R);e.bindSampler(w,this._animTexture.getGFXSampler()),e.bindTexture(w,this._animTexture.getGFXTexture());var x=e.getHandle("u_anim_info");ZE.x=this._animTexture.height,ZE.y=C.numTilesX*C.numTilesY,ZE.z=C.cycleCount,e.setUniform(x,ZE)}},i.getParticleCount=function(){return this._particleNum},i.onMaterialModified=function(){this._inited&&this.updateMaterialParams()},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case av.StrecthedBillboard:this._vertAttrs=sC.slice();break;case av.Mesh:this._vertAttrs=aC.slice();break;default:this._vertAttrs=sC.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!==e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1===i.indexOf("particle-gpu")&&(this._renderInfo.mainTexture=e.getProperty("mainTexture",0),this._particleSystem.setMaterial(null,0))}null==t.sharedMaterial&&null==this._defaultMat&&(oC.parent=ki.get("default-particle-gpu-material"),oC.owner=t,oC.subModelIdx=0,this._defaultMat=new nn(oC),null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;switch(t.node.getWorldMatrix(qE),t.scaleSpace){case sv.Local:t.node.getScale(this._node_scale);break;case sv.World:t.node.getWorldScale(this._node_scale)}t._simulationSpace===sv.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var n=this._renderInfo.renderMode;n===av.Billboard?this._defines.CC_RENDER_MODE=0:n===av.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,this._frameTile_velLenScale.z=this._renderInfo.velocityScale,this._frameTile_velLenScale.w=this._renderInfo.lengthScale):n===av.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:n===av.VerticalBillboard?this._defines.CC_RENDER_MODE=3:n===av.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+n+" not support.");var s=t._textureAnimationModule;s&&s.enable&&_i.set(this._frameTile_velLenScale,s.numTilesX,s.numTilesY),this.initShaderUniform(r),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},e}(GE);function hC(){var t=Ai.root.device;return!!(t.capabilities.maxVertexTextureUnits>=8&&t.hasFeature(c.TEXTURE_FLOAT))||(Xe.warn("Maybe the device has restrictions on vertex textures or does not support float textures."),!1)}var uC,cC,pC,dC,fC,_C,gC,mC,yC,vC,bC,SC,TC,AC,EC,CC,RC,wC,xC,OC,PC,DC,MC,BC,IC,LC,FC,kC,NC,GC,UC,zC,VC,HC,WC,XC,YC,jC,KC,qC,ZC,JC,QC,$C,tR,eR,iR,rR,nR,sR,aR,oR,lR,hR,uR,cR,pR,dR,fR,_R,gR,mR,yR,vR,bR,SR,TR,AR,ER,CR,RR,wR,xR,OR,PR,DR,MR,BR,IR,LR,FR,kR,NR,GR,UR,zR,VR,HR,WR,XR,YR,jR,KR,qR,ZR,JR,QR,$R,tw,ew,iw,rw,nw,sw,aw,ow,lw,hw,uw,cw,pw,dw,fw,_w,gw,mw,yw,vw,bw,Sw,Tw,Aw,Ew,Cw,Rw,ww,xw,Ow,Pw,Dw,Mw,Bw,Iw,Lw,Fw,kw,Nw,Gw,Uw,zw,Vw,Hw,Ww,Xw,Yw,jw,Kw,qw,Zw,Jw,Qw,$w,tx,ex,ix,rx,nx,sx,ax,ox,lx,hx,ux,cx,px,dx,fx,_x,gx,mx,yx,vx,bx,Sx,Tx,Ax,Ex,Cx,Rx,wx,xx,Ox,Px,Dx,Mx,Bx,Ix,Lx,Fx,kx,Nx,Gx,Ux,zx,Vx,Hx,Wx,Xx,Yx,jx,Kx,qx,Zx,Jx=(lE=Ze("cc.ParticleSystemRenderer"),hE=si(av),uE=Ri(),cE=li(),pE=Ri(),dE=li(),fE=Ri(),_E=li(),gE=si(av),mE=si(Dc),yE=Ri(),vE=li(),bE=si(Fi),SE=Ri(),TE=li(),AE=si(Fi),EE=Ri(),CE=li(),RE=Ri(),wE=li(),lE((FE=function(){function t(){$e(this,"_renderMode",PE,this),$e(this,"_velocityScale",DE,this),$e(this,"_lengthScale",ME,this),$e(this,"_mesh",BE,this),$e(this,"_mainTexture",IE,this),$e(this,"_useGPU",LE,this),this._particleSystem=null}var e=t.prototype;return e.create=function(t){null===this._particleSystem?this._particleSystem=t:this._particleSystem!==t&&Ie(6033)},e.onInit=function(t){if(this.create(t),this._particleSystem.processor)Ie(6034);else{var e=this._useGPU&&hC();this._particleSystem.processor=e?new lC(this):new KE(this),this._particleSystem.processor.onInit(t)}},e._switchProcessor=function(){this._particleSystem&&(this._particleSystem.processor&&(this._particleSystem.processor.detachFromScene(),this._particleSystem.processor.clear(),this._particleSystem.processor=null),this._particleSystem.processor=this._useGPU?new lC(this):new KE(this),this._particleSystem.processor.onInit(this._particleSystem),this._particleSystem.processor.onEnable(),this._particleSystem.bindModule())},Be(t,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t,this._particleSystem&&this._particleSystem.processor.updateRenderMode())}},{key:"velocityScale",get:function(){return this._velocityScale},set:function(t){this._velocityScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}},{key:"lengthScale",get:function(){return this._lengthScale},set:function(t){this._lengthScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}},{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this._particleSystem&&this._particleSystem.processor.setVertexAttributes()}},{key:"particleMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(0):null},set:function(t){this._particleSystem&&this._particleSystem.setMaterial(t,0)}},{key:"trailMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(1):null},set:function(t){this._particleSystem&&this._particleSystem.setMaterial(t,1)}},{key:"mainTexture",get:function(){return this._mainTexture},set:function(t){this._mainTexture=t}},{key:"useGPU",get:function(){return this._useGPU},set:function(t){this._useGPU!==t&&(hC()?this._useGPU=t:this._useGPU=!1,this._switchProcessor())}}]),t}(),je((OE=FE).prototype,"renderMode",[hE,uE,cE],Object.getOwnPropertyDescriptor(OE.prototype,"renderMode"),OE.prototype),je(OE.prototype,"velocityScale",[pE,dE],Object.getOwnPropertyDescriptor(OE.prototype,"velocityScale"),OE.prototype),je(OE.prototype,"lengthScale",[fE,_E],Object.getOwnPropertyDescriptor(OE.prototype,"lengthScale"),OE.prototype),PE=je(OE.prototype,"_renderMode",[gE,ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return av.Billboard}}),DE=je(OE.prototype,"_velocityScale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ME=je(OE.prototype,"_lengthScale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),BE=je(OE.prototype,"_mesh",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(OE.prototype,"mesh",[mE,yE,vE],Object.getOwnPropertyDescriptor(OE.prototype,"mesh"),OE.prototype),je(OE.prototype,"particleMaterial",[bE,SE,TE],Object.getOwnPropertyDescriptor(OE.prototype,"particleMaterial"),OE.prototype),je(OE.prototype,"trailMaterial",[AE,EE,CE],Object.getOwnPropertyDescriptor(OE.prototype,"trailMaterial"),OE.prototype),IE=je(OE.prototype,"_mainTexture",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LE=je(OE.prototype,"_useGPU",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(OE.prototype,"useGPU",[RE,wE],Object.getOwnPropertyDescriptor(OE.prototype,"useGPU"),OE.prototype),xE=OE))||xE),Qx=Math.cos(Pr(100)),$x={position:new Si,velocity:new Si},tO=new ur,eO=new gi,iO=new Si,rO=new Si,nO=new Ii,sO=function(){function t(t){for(this.start=void 0,this.end=void 0,this.trailElements=void 0,this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:new Si,lifetime:0,width:0,velocity:new Si,direction:0,color:new Ii})}var e=t.prototype;return e.getElement=function(t){return-1===this.start?null:(t<0&&(t=(t+this.trailElements.length)%this.trailElements.length),t>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])},e.addElement=function(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:new Si,lifetime:0,width:0,velocity:new Si,direction:0,color:new Ii}),this.start++,this.start%=this.trailElements.length);var t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]},e.iterateElement=function(t,e,i,r){for(var n=this.start>=this.end?this.end+this.trailElements.length:this.end,s=this.start;s<n;s++)e(t,this.trailElements[s%this.trailElements.length],i,r)&&(this.start++,this.start%=this.trailElements.length);this.start===n&&(this.start=-1,this.end=-1)},e.count=function(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start},e.clear=function(){this.start=-1,this.end=-1},t}(),aO=(uC=Ze("cc.TrailModule"),cC=Ri(),pC=si(uv),dC=Ri(),fC=li(),_C=si(rm),gC=Ri(),mC=li(),yC=Ri(),vC=li(),bC=si(sv),SC=Ri(),TC=li(),AC=si(cv),EC=Ri(),CC=li(),RC=Ri(),wC=li(),xC=si(rm),OC=Ri(),PC=li(),DC=Ri(),MC=li(),BC=si(py),IC=Ri(),LC=li(),FC=si(py),kC=Ri(),NC=li(),GC=si(sv),uC((eR=function(){function t(){$e(this,"_enable",VC,this),$e(this,"mode",HC,this),$e(this,"lifeTime",WC,this),$e(this,"_minParticleDistance",XC,this),$e(this,"existWithParticles",YC,this),$e(this,"textureMode",jC,this),$e(this,"widthFromParticle",KC,this),$e(this,"widthRatio",qC,this),$e(this,"colorFromParticle",ZC,this),$e(this,"colorOverTrail",JC,this),$e(this,"colorOvertime",QC,this),$e(this,"_space",$C,this),$e(this,"_particleSystem",tR,this),this._minSquaredDistance=0,this._vertSize=void 0,this._trailNum=0,this._trailLifetime=0,this.vbOffset=0,this.ibOffset=0,this._trailSegments=null,this._particleTrail=void 0,this._trailModel=null,this._iaInfo=void 0,this._iaInfoBuffer=null,this._subMeshData=null,this._vertAttrs=void 0,this._vbF32=null,this._vbUint32=null,this._iBuffer=null,this._needTransform=!1,this._material=null,this._iaInfo=new lt([new at]),this._vertAttrs=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RGBA32F),new St(Wt.ATTR_TEX_COORD1,p.RGB32F),new St(Wt.ATTR_COLOR,p.RGBA8,!0)],this._vertSize=0;for(var t,e=ke(this._vertAttrs);!(t=e()).done;){var i=t.value;this._vertSize+=Xt[i.format].size}this._particleTrail=new Map}var i=t.prototype;return i.onInit=function(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;for(var i=0,r=t.startLifetime.getMax(),n=t.rateOverTime.getMax(),s=t.duration,a=0,o=t.bursts.length;a<o;a++)i+=t.bursts[a].getMaxCount(t)*Math.ceil(r/s);this._trailNum=Math.ceil(r*this.lifeTime.getMax()*60*(n*s+i)),this._trailSegments=new e((function(){return new sO(10)}),Math.ceil(n*s)),this._enable&&(this.enable=this._enable)},i.onEnable=function(){this._attachToScene()},i.onDisable=function(){this._particleTrail.clear(),this._detachFromScene()},i._attachToScene=function(){this._trailModel&&(this._trailModel.scene&&this._detachFromScene(),this._particleSystem._getRenderScene().addModel(this._trailModel))},i._detachFromScene=function(){this._trailModel&&this._trailModel.scene&&this._trailModel.scene.removeModel(this._trailModel)},i.destroy=function(){this.destroySubMeshData(),this._trailModel&&(Ai.root.destroyModel(this._trailModel),this._trailModel=null),this._trailSegments&&(this._trailSegments.destroy((function(t){t.trailElements.length=0})),this._trailSegments=null)},i.play=function(){this._trailModel&&this._enable&&(this._trailModel.enabled=!0)},i.clear=function(){if(this.enable){for(var t=this._particleTrail.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this._particleTrail.clear(),this.updateRenderData(),this._trailModel&&(this._trailModel.enabled=!1)}},i.updateMaterial=function(){this._particleSystem&&(this._material=this._particleSystem.getMaterialInstance(1)||this._particleSystem.processor._defaultTrailMat,this._trailModel&&this._trailModel.setSubModelMaterial(0,this._material))},i.update=function(){this._trailLifetime=this.lifeTime.evaluate(this._particleSystem._time,1),this.space===sv.World&&this._particleSystem._simulationSpace===sv.Local?(this._needTransform=!0,this._particleSystem.node.getWorldMatrix(eO),this._particleSystem.node.getWorldRotation(tO)):this._needTransform=!1},i.animate=function(t,e){if(this._trailSegments){var i=this._particleTrail.get(t);if(!i)return i=this._trailSegments.alloc(),void this._particleTrail.set(t,i);var r=i.getElement(i.end-1);if(this._needTransform?Si.transformMat4(iO,t.position,eO):Si.copy(iO,t.position),!(r&&(i.iterateElement(this,this._updateTrailElement,t,e),Si.squaredDistance(r.position,iO)<this._minSquaredDistance))&&(r=i.addElement())){Si.copy(r.position,iO),r.lifetime=0,this.widthFromParticle?r.width=t.size.x*this.widthRatio.evaluate(0,1):r.width=this.widthRatio.evaluate(0,1);var n=i.count();if(2===n){var s=i.getElement(i.end-2);Si.subtract(s.velocity,r.position,s.position)}else if(n>2){var a=i.getElement(i.end-2),o=i.getElement(i.end-3);Si.subtract(iO,o.position,a.position),Si.subtract(rO,r.position,a.position),Si.subtract(a.velocity,rO,iO),Si.equals(Si.ZERO,a.velocity)&&Si.copy(a.velocity,iO),Si.normalize(a.velocity,a.velocity),this._checkDirectionReverse(a,o)}this.colorFromParticle?r.color.set(t.color):r.color.set(this.colorOvertime.evaluate(0,1))}}},i.removeParticle=function(t){var e=this._particleTrail.get(t);e&&this._trailSegments&&(e.clear(),this._trailSegments.free(e),this._particleTrail.delete(t))},i.updateRenderData=function(){this.vbOffset=0,this.ibOffset=0;for(var t,e=ke(this._particleTrail.keys());!(t=e()).done;){var i=t.value,r=this._particleTrail.get(i);if(-1!==r.start){var n=4*this.vbOffset/this._vertSize,s=r.start>=r.end?r.end+r.trailElements.length:r.end,a=s-r.start,o=1/a,l=r.trailElements[r.start];this._fillVertexBuffer(l,this.colorOverTrail.evaluate(1,1),n,1,0,4);for(var h=r.start+1;h<s;h++){var u=r.trailElements[h%r.trailElements.length],c=h-r.start;this._fillVertexBuffer(u,this.colorOverTrail.evaluate(1-c/a,1),n,1-c*o,c,5)}if(this._needTransform?Si.transformMat4($x.position,i.position,eO):Si.copy($x.position,i.position),1===a||2===a){var p=r.getElement(r.end-1);Si.subtract(p.velocity,$x.position,p.position),this._vbF32[this.vbOffset-this._vertSize/4-4]=p.velocity.x,this._vbF32[this.vbOffset-this._vertSize/4-3]=p.velocity.y,this._vbF32[this.vbOffset-this._vertSize/4-2]=p.velocity.z,this._vbF32[this.vbOffset-4]=p.velocity.x,this._vbF32[this.vbOffset-3]=p.velocity.y,this._vbF32[this.vbOffset-2]=p.velocity.z,Si.subtract($x.velocity,$x.position,p.position),this._checkDirectionReverse($x,p)}else if(a>2){var d=r.getElement(r.end-1),f=r.getElement(r.end-2);Si.subtract(iO,f.position,d.position),Si.subtract(rO,$x.position,d.position),Si.normalize(iO,iO),Si.normalize(rO,rO),Si.subtract(d.velocity,rO,iO),Si.normalize(d.velocity,d.velocity),this._checkDirectionReverse(d,f),this.vbOffset-=this._vertSize/4*2,this.ibOffset-=6,this._fillVertexBuffer(d,this.colorOverTrail.evaluate(o,1),n,o,a-1,5),Si.subtract($x.velocity,$x.position,d.position),Si.normalize($x.velocity,$x.velocity),this._checkDirectionReverse($x,d)}this.widthFromParticle?$x.width=i.size.x*this.widthRatio.evaluate(0,1):$x.width=this.widthRatio.evaluate(0,1),$x.color=i.color,Si.equals($x.velocity,Si.ZERO)?this.ibOffset-=3:this._fillVertexBuffer($x,this.colorOverTrail.evaluate(0,1),n,0,a,1)}}this._trailModel.enabled=this.ibOffset>0},i.updateIA=function(t){var e=this._trailModel&&this._trailModel.subModels;if(e&&e.length>0){var i=e[0];i.inputAssembler.vertexBuffers[0].update(this._vbF32),i.inputAssembler.indexBuffer.update(this._iBuffer),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=t,this._iaInfoBuffer.update(this._iaInfo)}},i.beforeRender=function(){this.updateIA(this.ibOffset)},i._createModel=function(){this._trailModel||(this._trailModel=Xe.director.root.createModel(gr))},i.rebuild=function(){var t=Ai.root.device,e=t.createBuffer(new nt(_.VERTEX|_.TRANSFER_DST,y.HOST|y.DEVICE,this._vertSize*(this._trailNum+1)*2,this._vertSize)),i=new ArrayBuffer(this._vertSize*(this._trailNum+1)*2);this._vbF32=new Float32Array(i),this._vbUint32=new Uint32Array(i),e.update(i);var r=t.createBuffer(new nt(_.INDEX|_.TRANSFER_DST,y.HOST|y.DEVICE,6*this._trailNum*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));this._iBuffer=new Uint16Array(6*this._trailNum),r.update(this._iBuffer),this._iaInfoBuffer=t.createBuffer(new nt(_.INDIRECT,y.HOST|y.DEVICE,qt,qt)),this._iaInfo.drawInfos[0].vertexCount=2*(this._trailNum+1),this._iaInfo.drawInfos[0].indexCount=6*this._trailNum,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new cr([e],this._vertAttrs,L.TRIANGLE_LIST,r,this._iaInfoBuffer);var n=this._trailModel;n&&(n.node=n.transform=this._particleSystem.node,n.visFlags=this._particleSystem.visibility,n.initSubModel(0,this._subMeshData,this._material),n.enabled=!0)},i._updateTrailElement=function(t,e,i,r){return e.lifetime+=r,t.colorFromParticle?(e.color.set(i.color),e.color.multiply(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1))):e.color.set(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1)),t.widthFromParticle?e.width=i.size.x*t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1):e.width=t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1),e.lifetime>t._trailLifetime},i._fillVertexBuffer=function(t,e,i,r,n,s){this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,nO.set(t.color),nO.multiply(e),this._vbUint32[this.vbOffset++]=nO._val,this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=1-t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,this._vbUint32[this.vbOffset++]=nO._val,1&s&&(this._iBuffer[this.ibOffset++]=i+2*n,this._iBuffer[this.ibOffset++]=i+2*n-1,this._iBuffer[this.ibOffset++]=i+2*n+1),4&s&&(this._iBuffer[this.ibOffset++]=i+2*n,this._iBuffer[this.ibOffset++]=i+2*n+1,this._iBuffer[this.ibOffset++]=i+2*n+2)},i._checkDirectionReverse=function(t,e){Si.dot(t.velocity,e.velocity)<Qx?t.direction=1-e.direction:t.direction=e.direction},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},Be(t,[{key:"enable",get:function(){return this._enable},set:function(t){t===this._enable&&this._trailModel||(t&&!this._enable&&(this._enable=t,this._particleSystem.processor&&this._particleSystem.processor.updateTrailMaterial()),t&&!this._trailModel&&(this._createModel(),this.rebuild()),this._enable=t,this._trailModel&&(this._trailModel.enabled=t),t?this.onEnable():this.onDisable())}},{key:"minParticleDistance",get:function(){return this._minParticleDistance},set:function(t){this._minParticleDistance=t,this._minSquaredDistance=t*t}},{key:"space",get:function(){return this._space},set:function(t){this._space=t;var e=this._particleSystem;e&&e.processor&&e.processor.updateTrailMaterial()}}]),t}(),je((zC=eR).prototype,"enable",[cC],Object.getOwnPropertyDescriptor(zC.prototype,"enable"),zC.prototype),VC=je(zC.prototype,"_enable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),HC=je(zC.prototype,"mode",[pC,ei,dC,fC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uv.Particles}}),WC=je(zC.prototype,"lifeTime",[_C,ei,gC,mC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),XC=je(zC.prototype,"_minParticleDistance",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),je(zC.prototype,"minParticleDistance",[yC,vC],Object.getOwnPropertyDescriptor(zC.prototype,"minParticleDistance"),zC.prototype),je(zC.prototype,"space",[bC,SC,TC],Object.getOwnPropertyDescriptor(zC.prototype,"space"),zC.prototype),YC=je(zC.prototype,"existWithParticles",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),jC=je(zC.prototype,"textureMode",[AC,ei,EC,CC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cv.Stretch}}),KC=je(zC.prototype,"widthFromParticle",[ei,RC,wC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),qC=je(zC.prototype,"widthRatio",[xC,ei,OC,PC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),ZC=je(zC.prototype,"colorFromParticle",[ei,DC,MC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),JC=je(zC.prototype,"colorOverTrail",[BC,ei,IC,LC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new py}}),QC=je(zC.prototype,"colorOvertime",[FC,ei,kC,NC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new py}}),$C=je(zC.prototype,"_space",[GC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sv.World}}),tR=je(zC.prototype,"_particleSystem",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UC=zC))||UC),oO=new gi,lO=new ur,hO=Object.getOwnPropertyDescriptor(Ui.prototype,"sharedMaterials"),uO=function(e){return t({ParticleSystem:e,ParticleSystemComponent:e}),e}((iR=Ze("cc.ParticleSystem"),rR=ai(),nR=oi(),sR=Ci(99),aR=Ri(),oR=li(),lR=si(py),hR=Ri(),uR=li(),cR=si(sv),pR=Ri(),dR=li(),fR=Ri(),_R=li(),gR=mr("startSize"),mR=si(rm),yR=Ri(),vR=li(),bR=si(rm),SR=Ri(),TR=li(),AR=si(rm),ER=Ri(),CR=li(),RR=si(rm),wR=hi(),xR=Ri(),OR=li(),PR=Ri(),DR=li(),MR=si(rm),BR=hi(),IR=Ri(),LR=li(),FR=si(rm),kR=hi(),NR=Ri(),GR=li(),UR=si(rm),zR=mr("startRotation"),VR=hi(),HR=Ri(),WR=li(),XR=si(rm),YR=Ri(),jR=li(),KR=si(rm),qR=Ri(),ZR=li(),JR=Ri(),QR=li(),$R=Ri(),tw=li(),ew=Ri(),iw=li(),rw=si(sv),nw=Ri(),sw=li(),aw=Ri(),ow=li(),lw=Ri(),hw=li(),uw=si(rm),cw=hi(),pw=Ri(),dw=li(),fw=si(rm),_w=Ri(),gw=li(),mw=si(rm),yw=Ri(),vw=li(),bw=si([iE]),Sw=Ri(),Tw=li(),Aw=Ni(),Ew=si(Fi),Cw=Gi(),Rw=si(pv),ww=si(pv),xw=Ri(),Ow=li(),Pw=si(aE),Dw=si(aE),Mw=Ri(),Bw=li(),Iw=si(KA),Lw=si(KA),Fw=Ri(),kw=li(),Nw=si(eE),Gw=si(eE),Uw=Ri(),zw=li(),Vw=si(Ob),Hw=si(Ob),Ww=Ri(),Xw=li(),Yw=si(Bb),jw=si(Bb),Kw=Ri(),qw=li(),Zw=si(jA),Jw=si(jA),Qw=Ri(),$w=li(),tx=si(QA),ex=si(QA),ix=Ri(),rx=li(),nx=si(aO),sx=si(aO),ax=Ri(),ox=li(),lx=si(Jx),hx=Ri(),ux=li(),cx=Ri(),px=li(),iR(dx=rR(dx=nR(dx=sR(dx=vi((Zx=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"startColor",_x,ti(e)),$e(e,"scaleSpace",gx,ti(e)),$e(e,"startSize3D",mx,ti(e)),$e(e,"startSizeX",yx,ti(e)),$e(e,"startSizeY",vx,ti(e)),$e(e,"startSizeZ",bx,ti(e)),$e(e,"startSpeed",Sx,ti(e)),$e(e,"startRotation3D",Tx,ti(e)),$e(e,"startRotationX",Ax,ti(e)),$e(e,"startRotationY",Ex,ti(e)),$e(e,"startRotationZ",Cx,ti(e)),$e(e,"startDelay",Rx,ti(e)),$e(e,"startLifetime",wx,ti(e)),$e(e,"duration",xx,ti(e)),$e(e,"loop",Ox,ti(e)),$e(e,"simulationSpeed",Px,ti(e)),$e(e,"playOnAwake",Dx,ti(e)),$e(e,"gravityModifier",Mx,ti(e)),$e(e,"rateOverTime",Bx,ti(e)),$e(e,"rateOverDistance",Ix,ti(e)),$e(e,"bursts",Lx,ti(e)),$e(e,"_colorOverLifetimeModule",Fx,ti(e)),$e(e,"_shapeModule",kx,ti(e)),$e(e,"_sizeOvertimeModule",Nx,ti(e)),$e(e,"_velocityOvertimeModule",Gx,ti(e)),$e(e,"_forceOvertimeModule",Ux,ti(e)),$e(e,"_limitVelocityOvertimeModule",zx,ti(e)),$e(e,"_rotationOvertimeModule",Vx,ti(e)),$e(e,"_textureAnimationModule",Hx,ti(e)),$e(e,"_trailModule",Wx,ti(e)),$e(e,"renderer",Xx,ti(e)),$e(e,"enableCulling",Yx,ti(e)),e._isPlaying=void 0,e._isPaused=void 0,e._isStopped=void 0,e._isEmitting=void 0,e._needRefresh=void 0,e._time=void 0,e._emitRateTimeCounter=void 0,e._emitRateDistanceCounter=void 0,e._oldWPos=void 0,e._curWPos=void 0,e._customData1=void 0,e._customData2=void 0,e._subEmitters=void 0,$e(e,"_prewarm",jx,ti(e)),$e(e,"_capacity",Kx,ti(e)),$e(e,"_simulationSpace",qx,ti(e)),e.processor=null,e.rateOverTime.constant=10,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e._isPlaying=!1,e._isPaused=!1,e._isStopped=!0,e._isEmitting=!1,e._needRefresh=!1,e._time=0,e._emitRateTimeCounter=0,e._emitRateDistanceCounter=0,e._oldWPos=new Si,e._curWPos=new Si,e._customData1=new _i,e._customData2=new _i,e._subEmitters=[],e}Me(e,t);var i=e.prototype;return i.onFocusInEditor=function(){this.renderer.create(this)},i.onLoad=function(){this.renderer.onInit(this),this._shapeModule&&this._shapeModule.onInit(this),this._trailModule&&this._trailModule.onInit(this),this.bindModule(),this._resetPosition()},i._onMaterialModified=function(t,e){null!==this.processor&&this.processor.onMaterialModified(t,e)},i._onRebuildPSO=function(t,e){this.processor.onRebuildPSO(t,e)},i._collectModels=function(){return this._models.length=0,this._models.push(this.processor._model),this._trailModule&&this._trailModule.enable&&this._trailModule._trailModel&&this._models.push(this._trailModule._trailModel),this._models},i._attachToScene=function(){this.processor.attachToScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._attachToScene()},i._detachFromScene=function(){this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene()},i.bindModule=function(){this._colorOverLifetimeModule&&this._colorOverLifetimeModule.bindTarget(this.processor),this._sizeOvertimeModule&&this._sizeOvertimeModule.bindTarget(this.processor),this._rotationOvertimeModule&&this._rotationOvertimeModule.bindTarget(this.processor),this._forceOvertimeModule&&this._forceOvertimeModule.bindTarget(this.processor),this._limitVelocityOvertimeModule&&this._limitVelocityOvertimeModule.bindTarget(this.processor),this._velocityOvertimeModule&&this._velocityOvertimeModule.bindTarget(this.processor),this._textureAnimationModule&&this._textureAnimationModule.bindTarget(this.processor)},i.play=function(){this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this._isPlaying=!0,this._isEmitting=!0,this._resetPosition(),this._prewarm&&this._prewarmSystem(),this._trailModule&&this._trailModule.play()},i.pause=function(){this._isStopped?console.warn("pause(): particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0)},i.stop=function(){(this._isPlaying||this._isPaused)&&this.clear(),this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this._time=0,this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this._isStopped=!0,this._needRefresh=!0},i.clear=function(){this.enabledInHierarchy&&(this.processor.clear(),this._trailModule&&this._trailModule.clear())},i.getParticleCount=function(){return this.processor.getParticleCount()},i.setCustomData1=function(t,e){_i.set(this._customData1,t,e)},i.setCustomData2=function(t,e){_i.set(this._customData2,t,e)},i.onDestroy=function(){Xe.director.off(Xe.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.processor.onDestroy(),this._trailModule&&this._trailModule.destroy()},i.onEnable=function(){Xe.director.on(Xe.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.playOnAwake&&this.play(),this.processor.onEnable(),this._trailModule&&this._trailModule.onEnable()},i.onDisable=function(){Xe.director.off(Xe.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.processor.onDisable(),this._trailModule&&this._trailModule.onDisable()},i.update=function(t){var e=t*this.simulationSpeed;this._isPlaying&&(this._time+=e,this._emit(e),0!==this.processor.updateParticles(e)||this._isEmitting||this.stop()),this.processor.updateRenderData(),this._trailModule&&this._trailModule.enable&&this._trailModule.updateRenderData()},i.beforeRender=function(){this._isPlaying&&(this.processor.beforeRender(),this._trailModule&&this._trailModule.enable&&this._trailModule.beforeRender())},i._onVisibilityChange=function(t){this.processor._model&&(this.processor._model.visFlags=t)},i.emit=function(t,e){var i=this._time/this.duration;this._simulationSpace===sv.World&&(this.node.getWorldMatrix(oO),this.node.getWorldRotation(lO));for(var r=0;r<t;++r){var n=this.processor.getFreeParticle();if(null===n)return;var s=sn(ln(0,dn));this._shapeModule&&this._shapeModule.enable?this._shapeModule.emit(n):(Si.set(n.position,0,0,0),Si.copy(n.velocity,dv)),this._textureAnimationModule&&this._textureAnimationModule.enable&&this._textureAnimationModule.init(n);var a=this.startSpeed.evaluate(i,s);if(this.startSpeed.mode===im.Curve){var o=this._time%this.duration;a=this.startSpeed.evaluate(o/this.duration,s)}Si.multiplyScalar(n.velocity,n.velocity,a),this._simulationSpace===sv.World&&(Si.transformMat4(n.position,n.position,oO),Si.transformQuat(n.velocity,n.velocity,lO)),Si.copy(n.ultimateVelocity,n.velocity),this.startRotation3D?Si.set(n.rotation,this.startRotationX.evaluate(i,s),this.startRotationY.evaluate(i,s),this.startRotationZ.evaluate(i,s)):Si.set(n.rotation,0,0,this.startRotationZ.evaluate(i,s)),this.startSize3D?Si.set(n.startSize,this.startSizeX.evaluate(i,s),this.startSizeY.evaluate(i,s),this.startSizeZ.evaluate(i,s)):(Si.set(n.startSize,this.startSizeX.evaluate(i,s),1,1),n.startSize.y=n.startSize.x),Si.copy(n.size,n.startSize),n.startColor.set(this.startColor.evaluate(i,s)),n.color.set(n.startColor),n.startLifetime=this.startLifetime.evaluate(i,s)+e,n.remainingLifetime=n.startLifetime,n.randomSeed=ln(0,233280),this.processor.setNewParticle(n)}},i._prewarmSystem=function(){this.startDelay.mode=im.Constant,this.startDelay.constant=0;for(var t=this.duration/1,e=0;e<t;++e)this._time+=1,this._emit(1),this.processor.updateParticles(1)},i._emit=function(t){var e=this.startDelay.evaluate(0,1);if(this._time>e){if(this._time>this.duration+e&&!this.loop)return void(this._isEmitting=!1);if(this._emitRateTimeCounter+=this.rateOverTime.evaluate(this._time/this.duration,1)*t,this._emitRateTimeCounter>1&&this._isEmitting){var i=Math.floor(this._emitRateTimeCounter);this._emitRateTimeCounter-=i,this._needRefresh&&(this.node.invalidateChildren(vr.POSITION),this._needRefresh=!1),this.emit(i,t)}this.node.getWorldPosition(this._curWPos);var r=Si.distance(this._curWPos,this._oldWPos);if(Si.copy(this._oldWPos,this._curWPos),this._emitRateDistanceCounter+=r*this.rateOverDistance.evaluate(this._time/this.duration,1),this._emitRateDistanceCounter>1&&this._isEmitting){var n=Math.floor(this._emitRateDistanceCounter);this._emitRateDistanceCounter-=n,this.emit(n,t)}for(var s,a=ke(this.bursts);!(s=a()).done;)s.value.update(this,t)}},i._resetPosition=function(){this.node.getWorldPosition(this._oldWPos),Si.copy(this._curWPos,this._oldWPos)},i.addSubEmitter=function(t){this._subEmitters.push(t)},i.removeSubEmitter=function(t){this._subEmitters.splice(this._subEmitters.indexOf(t),1)},i.addBurst=function(t){this.bursts.push(t)},i.removeBurst=function(t){this.bursts.splice(this.bursts.indexOf(t),1)},i._onBeforeSerialize=function(t){var e=this;return this.enableCulling?t.filter((function(t){return!rv.includes(t)||e[t]&&e[t].enable})):t},Be(e,[{key:"capacity",get:function(){return this._capacity},set:function(t){this._capacity=Math.floor(t),this.processor&&this.processor._model&&this.processor._model.setCapacity(this._capacity)}},{key:"prewarm",get:function(){return this._prewarm},set:function(t){!0===t&&this.loop,this._prewarm=t}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(t){t!==this._simulationSpace&&(this._simulationSpace=t,this.processor&&(this.processor.updateMaterialParams(),this.processor.updateTrailMaterial()))}},{key:"sharedMaterials",get:function(){return hO.get.call(this)},set:function(t){hO.set.call(this,t)}},{key:"colorOverLifetimeModule",get:function(){return this._colorOverLifetimeModule},set:function(t){t&&(this._colorOverLifetimeModule=t)}},{key:"shapeModule",get:function(){return this._shapeModule},set:function(t){t&&(this._shapeModule=t)}},{key:"sizeOvertimeModule",get:function(){return this._sizeOvertimeModule},set:function(t){t&&(this._sizeOvertimeModule=t)}},{key:"velocityOvertimeModule",get:function(){return this._velocityOvertimeModule},set:function(t){t&&(this._velocityOvertimeModule=t)}},{key:"forceOvertimeModule",get:function(){return this._forceOvertimeModule},set:function(t){t&&(this._forceOvertimeModule=t)}},{key:"limitVelocityOvertimeModule",get:function(){return this._limitVelocityOvertimeModule},set:function(t){t&&(this._limitVelocityOvertimeModule=t)}},{key:"rotationOvertimeModule",get:function(){return this._rotationOvertimeModule},set:function(t){t&&(this._rotationOvertimeModule=t)}},{key:"textureAnimationModule",get:function(){return this._textureAnimationModule},set:function(t){t&&(this._textureAnimationModule=t)}},{key:"trailModule",get:function(){return this._trailModule},set:function(t){t&&(this._trailModule=t)}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isStopped",get:function(){return this._isStopped}},{key:"isEmitting",get:function(){return this._isEmitting}},{key:"time",get:function(){return this._time}}]),e}(Ui),je((fx=Zx).prototype,"capacity",[aR,oR],Object.getOwnPropertyDescriptor(fx.prototype,"capacity"),fx.prototype),_x=je(fx.prototype,"startColor",[lR,ei,hR,uR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new py}}),gx=je(fx.prototype,"scaleSpace",[cR,ei,pR,dR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sv.Local}}),mx=je(fx.prototype,"startSize3D",[ei,fR,_R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yx=je(fx.prototype,"startSizeX",[gR,mR,yR,vR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),vx=je(fx.prototype,"startSizeY",[bR,ei,SR,TR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),bx=je(fx.prototype,"startSizeZ",[AR,ei,ER,CR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Sx=je(fx.prototype,"startSpeed",[RR,ei,wR,xR,OR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Tx=je(fx.prototype,"startRotation3D",[ei,PR,DR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ax=je(fx.prototype,"startRotationX",[MR,ei,BR,un,IR,LR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Ex=je(fx.prototype,"startRotationY",[FR,ei,kR,un,NR,GR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Cx=je(fx.prototype,"startRotationZ",[UR,zR,VR,un,HR,WR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Rx=je(fx.prototype,"startDelay",[XR,ei,YR,jR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),wx=je(fx.prototype,"startLifetime",[KR,ei,qR,ZR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),xx=je(fx.prototype,"duration",[ei,JR,QR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Ox=je(fx.prototype,"loop",[ei,$R,tw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),je(fx.prototype,"prewarm",[ew,iw],Object.getOwnPropertyDescriptor(fx.prototype,"prewarm"),fx.prototype),je(fx.prototype,"simulationSpace",[rw,ei,nw,sw],Object.getOwnPropertyDescriptor(fx.prototype,"simulationSpace"),fx.prototype),Px=je(fx.prototype,"simulationSpeed",[ei,aw,ow],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Dx=je(fx.prototype,"playOnAwake",[ei,lw,hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Mx=je(fx.prototype,"gravityModifier",[uw,ei,cw,pw,dw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Bx=je(fx.prototype,"rateOverTime",[fw,ei,_w,gw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Ix=je(fx.prototype,"rateOverDistance",[mw,ei,yw,vw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rm}}),Lx=je(fx.prototype,"bursts",[bw,ei,Sw,Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),je(fx.prototype,"sharedMaterials",[Qe,Aw,Ew,ei,Cw],Object.getOwnPropertyDescriptor(fx.prototype,"sharedMaterials"),fx.prototype),Fx=je(fx.prototype,"_colorOverLifetimeModule",[Rw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"colorOverLifetimeModule",[ww,xw,Ow],Object.getOwnPropertyDescriptor(fx.prototype,"colorOverLifetimeModule"),fx.prototype),kx=je(fx.prototype,"_shapeModule",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"shapeModule",[Dw,Mw,Bw],Object.getOwnPropertyDescriptor(fx.prototype,"shapeModule"),fx.prototype),Nx=je(fx.prototype,"_sizeOvertimeModule",[Iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"sizeOvertimeModule",[Lw,Fw,kw],Object.getOwnPropertyDescriptor(fx.prototype,"sizeOvertimeModule"),fx.prototype),Gx=je(fx.prototype,"_velocityOvertimeModule",[Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"velocityOvertimeModule",[Gw,Uw,zw],Object.getOwnPropertyDescriptor(fx.prototype,"velocityOvertimeModule"),fx.prototype),Ux=je(fx.prototype,"_forceOvertimeModule",[Vw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"forceOvertimeModule",[Hw,Ww,Xw],Object.getOwnPropertyDescriptor(fx.prototype,"forceOvertimeModule"),fx.prototype),zx=je(fx.prototype,"_limitVelocityOvertimeModule",[Yw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"limitVelocityOvertimeModule",[jw,Kw,qw],Object.getOwnPropertyDescriptor(fx.prototype,"limitVelocityOvertimeModule"),fx.prototype),Vx=je(fx.prototype,"_rotationOvertimeModule",[Zw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"rotationOvertimeModule",[Jw,Qw,$w],Object.getOwnPropertyDescriptor(fx.prototype,"rotationOvertimeModule"),fx.prototype),Hx=je(fx.prototype,"_textureAnimationModule",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"textureAnimationModule",[ex,ix,rx],Object.getOwnPropertyDescriptor(fx.prototype,"textureAnimationModule"),fx.prototype),Wx=je(fx.prototype,"_trailModule",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(fx.prototype,"trailModule",[sx,ax,ox],Object.getOwnPropertyDescriptor(fx.prototype,"trailModule"),fx.prototype),Xx=je(fx.prototype,"renderer",[lx,ei,hx,ux],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jx}}),Yx=je(fx.prototype,"enableCulling",[ei,cx,px],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jx=je(fx.prototype,"_prewarm",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Kx=je(fx.prototype,"_capacity",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),qx=je(fx.prototype,"_simulationSpace",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sv.Local}}),dx=fx))||dx)||dx)||dx)||dx)||dx)),cO=t("ParticleUtils",function(){function t(){}return t.instantiate=function(t){return this.registeredSceneEvent||(Ai.on(Ei.EVENT_BEFORE_SCENE_LAUNCH,this.onSceneUnload,this),this.registeredSceneEvent=!0),this.particleSystemPool.has(t._uuid)||this.particleSystemPool.set(t._uuid,new e((function(){return fn(t)||new Yr}),1)),this.particleSystemPool.get(t._uuid).alloc()},t.destroy=function(t){this.particleSystemPool.has(t._prefab.asset._uuid)&&(this.stop(t),this.particleSystemPool.get(t._prefab.asset._uuid).free(t))},t.play=function(t){for(var e,i=ke(t.getComponentsInChildren(uO));!(e=i()).done;)e.value.play()},t.stop=function(t){for(var e,i=ke(t.getComponentsInChildren(uO));!(e=i()).done;)e.value.stop()},t.onSceneUnload=function(){this.particleSystemPool.forEach((function(t){t.destroy((function(t){t.destroy()}))})),this.particleSystemPool.clear()},t}());cO.particleSystemPool=new Map,cO.registeredSceneEvent=!1,zi(iE.prototype,"Burst.prototype",[{name:"minCount"},{name:"maxCount"}]),Xe.ParticleSystemComponent=uO,di.setClassAlias(uO,"cc.ParticleSystemComponent"),Xe.BillboardComponent=Zg,di.setClassAlias(Zg,"cc.BillboardComponent"),Xe.LineComponent=Zy,di.setClassAlias(Zy,"cc.LineComponent"),Xe.ParticleUtils=cO;var pO,dO,fO,_O,gO,mO,yO={id:"",select:function(t,e){Xe._global.CC_PHYSICS_BUILTIN="builtin"===t,Xe._global.CC_PHYSICS_CANNON="cannon.js"===t,Xe._global.CC_PHYSICS_AMMO="ammo.js"===t,We("[PHYSICS]: Using "+t),yO.id=t,yO.wrapper=e,null!=t&&(yO.backend[t]=e)},wrapper:{},backend:{}};function vO(t,e){return t.setValue(e.x,e.y,e.z),t}function bO(t,e){return t.x=e.x(),t.y=e.y(),t.z=e.z(),t}function SO(t,e){return t.setValue(e.x,e.y,e.z,e.w),t}function TO(t,e){return t.x=e.x(),t.y=e.y(),t.z=e.z(),t.w=e.w(),t}function AO(t,e){delete _n.getCache(e)[_n.getPointer(t)]}function EO(t,e){for(var i=e.renderingSubMeshes.length,r=0;r<i;r++){var n=e.renderingSubMeshes[r],s=n.geometricInfo;if(s){var a=n.primitiveMode,o=s.positions,l=s.indices,h=new _n.btVector3,u=new _n.btVector3,c=new _n.btVector3;if(a===L.TRIANGLE_LIST)for(var p=l.length,d=0;d<p;d+=3){var f=3*l[d],_=3*l[d+1],g=3*l[d+2];h.setValue(o[f],o[f+1],o[f+2]),u.setValue(o[_],o[_+1],o[_+2]),c.setValue(o[g],o[g+1],o[g+2]),t.addTriangle(h,u,c)}else if(a===L.TRIANGLE_STRIP)for(var m=l.length-2,y=0,v=0;v<m;v+=1){var b=3*l[v-y],S=3*l[v+y+1],T=3*l[v+2];y=~y,h.setValue(o[b],o[b+1],o[b+2]),u.setValue(o[S],o[S+1],o[S+2]),c.setValue(o[T],o[T+1],o[T+2]),t.addTriangle(h,u,c)}else if(a===L.TRIANGLE_FAN){var A=l.length-1,E=3*l[0];h.setValue(o[E],o[E+1],o[E+2]);for(var C=1;C<A;C+=1){var R=3*l[C],w=3*l[C+1];u.setValue(o[R],o[R+1],o[R+2]),c.setValue(o[w],o[w+1],o[w+2]),t.addTriangle(h,u,c)}}_n.destroy(h),_n.destroy(u),_n.destroy(c)}}return t}!function(t){t[t.DYNAMIC=1]="DYNAMIC",t[t.STATIC=2]="STATIC",t[t.KINEMATIC=4]="KINEMATIC"}(pO||(pO=t("ERigidBodyType",{}))),Oi(pO),function(t){t[t.X_AXIS=0]="X_AXIS",t[t.Y_AXIS=1]="Y_AXIS",t[t.Z_AXIS=2]="Z_AXIS"}(dO||(dO=t("EAxisDirection",{}))),Oi(dO),function(t){t[t.VERTEX=1]="VERTEX",t[t.LINE=2]="LINE",t[t.TRIANGLE=3]="TRIANGLE",t[t.TETRAHEDRON=4]="TETRAHEDRON"}(fO||(fO={})),Oi(fO),function(t){t[t.BOX=0]="BOX",t[t.SPHERE=1]="SPHERE",t[t.CAPSULE=2]="CAPSULE",t[t.CYLINDER=3]="CYLINDER",t[t.CONE=4]="CONE",t[t.MESH=5]="MESH",t[t.PLANE=6]="PLANE",t[t.SIMPLEX=7]="SIMPLEX",t[t.TERRAIN=8]="TERRAIN"}(_O||(_O={})),Oi(_O),function(t){t[t.POINT_TO_POINT=0]="POINT_TO_POINT",t[t.HINGE=1]="HINGE",t[t.CONE_TWIST=2]="CONE_TWIST"}(gO||(gO={})),Oi(gO),function(t){t[t.DEFAULT=1]="DEFAULT"}(mO||(mO={})),Oi(mO);var CO,RO=function(){return 0},wO={impl:null,setGravity:RO,setAllowSleep:RO,setDefaultMaterial:RO,step:RO,syncAfterEvents:RO,syncSceneToPhysics:RO,raycast:RO,raycastClosest:RO,emitEvents:RO,destroy:RO};function xO(t,e){return!Xe.GAME_VIEW&&null==t&&(yO.id?We(yO.id+" physics does not support "+CO[e]):Ie(9600),!0)}!function(t){t[t.World=0]="World",t[t.RigidBody=1]="RigidBody",t[t.BoxCollider=2]="BoxCollider",t[t.SphereCollider=3]="SphereCollider",t[t.CapsuleCollider=4]="CapsuleCollider",t[t.MeshCollider=5]="MeshCollider",t[t.CylinderCollider=6]="CylinderCollider",t[t.ConeCollider=7]="ConeCollider",t[t.TerrainCollider=8]="TerrainCollider",t[t.SimplexCollider=9]="SimplexCollider",t[t.PlaneCollider=10]="PlaneCollider",t[t.PointToPointConstraint=11]="PointToPointConstraint",t[t.HingeConstraint=12]="HingeConstraint",t[t.ConeTwistConstraint=13]="ConeTwistConstraint"}(CO||(CO={}));var OO={impl:null,rigidBody:null,isAwake:!1,isSleepy:!1,isSleeping:!1,initialize:RO,onEnable:RO,onDisable:RO,onDestroy:RO,setType:RO,setMass:RO,setLinearDamping:RO,setAngularDamping:RO,useGravity:RO,setLinearFactor:RO,setAngularFactor:RO,setAllowSleep:RO,wakeUp:RO,sleep:RO,clearState:RO,clearForces:RO,clearVelocity:RO,setSleepThreshold:RO,getSleepThreshold:RO,getLinearVelocity:RO,setLinearVelocity:RO,getAngularVelocity:RO,setAngularVelocity:RO,applyForce:RO,applyLocalForce:RO,applyImpulse:RO,applyLocalImpulse:RO,applyTorque:RO,applyLocalTorque:RO,setGroup:RO,getGroup:RO,addGroup:RO,removeGroup:RO,setMask:RO,getMask:RO,addMask:RO,removeMask:RO},PO={INITED:!1},DO={impl:null,collider:null,attachedRigidBody:null,initialize:RO,onLoad:RO,onEnable:RO,onDisable:RO,onDestroy:RO,setGroup:RO,getGroup:RO,addGroup:RO,removeGroup:RO,setMask:RO,getMask:RO,addMask:RO,removeMask:RO,setMaterial:RO,setAsTrigger:RO,setCenter:RO,getAABB:RO,getBoundingSphere:RO,setSize:RO,setRadius:RO,setCylinderHeight:RO,setDirection:RO,setHeight:RO,setShapeType:RO,setVertices:RO,setMesh:RO,setTerrain:RO,setNormal:RO,setConstant:RO,updateEventListener:RO};var MO,BO,IO,LO,FO,kO,NO,GO,UO={INITED:!1},zO={impl:null,initialize:RO,onLoad:RO,onEnable:RO,onDisable:RO,onDestroy:RO,setEnableCollision:RO,setConnectedBody:RO,setPivotA:RO,setPivotB:RO,setAxis:RO};var VO=function(e){return t({PhysicsMaterial:e,PhysicMaterial:e}),e}(Ze("cc.PhysicsMaterial")((GO=NO=function(t){function e(){var i;return(i=t.call(this)||this).id=void 0,$e(i,"_friction",IO,ti(i)),$e(i,"_rollingFriction",LO,ti(i)),$e(i,"_spinningFriction",FO,ti(i)),$e(i,"_restitution",kO,ti(i)),e.allMaterials.push(ti(i)),i.id=e._idCounter++,i._uuid||(i._uuid="pm_"+i.id),i}Me(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return t._friction=this._friction,t._restitution=this._restitution,t._rollingFriction=this._rollingFriction,t._spinningFriction=this._spinningFriction,t},i.destroy=function(){if(t.prototype.destroy.call(this)){var i=e.allMaterials.indexOf(this);return i>=0&&e.allMaterials.splice(i,1),!0}return!1},Be(e,[{key:"friction",get:function(){return this._friction},set:function(t){gn(this._friction,t)||(this._friction=t,this.emit("physics_material_update"))}},{key:"rollingFriction",get:function(){return this._rollingFriction},set:function(t){gn(this._rollingFriction,t)||(this._rollingFriction=t,this.emit("physics_material_update"))}},{key:"spinningFriction",get:function(){return this._spinningFriction},set:function(t){gn(this._spinningFriction,t)||(this._spinningFriction=t,this.emit("physics_material_update"))}},{key:"restitution",get:function(){return this._restitution},set:function(t){gn(this._restitution,t)||(this._restitution=t,this.emit("physics_material_update"))}}]),e}(Je),NO.allMaterials=[],NO._idCounter=0,je((BO=GO).prototype,"friction",[yr],Object.getOwnPropertyDescriptor(BO.prototype,"friction"),BO.prototype),je(BO.prototype,"rollingFriction",[yr],Object.getOwnPropertyDescriptor(BO.prototype,"rollingFriction"),BO.prototype),je(BO.prototype,"spinningFriction",[yr],Object.getOwnPropertyDescriptor(BO.prototype,"spinningFriction"),BO.prototype),je(BO.prototype,"restitution",[yr],Object.getOwnPropertyDescriptor(BO.prototype,"restitution"),BO.prototype),IO=je(BO.prototype,"_friction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.6}}),LO=je(BO.prototype,"_rollingFriction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),FO=je(BO.prototype,"_spinningFriction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),kO=je(BO.prototype,"_restitution",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MO=BO))||MO),HO=t("PhysicsRayResult",function(){function t(){this._hitPoint=new Si,this._hitNormal=new Si,this._distance=0,this._collider=null}var e=t.prototype;return e._assign=function(t,e,i,r){Si.copy(this._hitPoint,t),Si.copy(this._hitNormal,r),this._distance=e,this._collider=i},e.clone=function(){var e=new t;return Si.copy(e._hitPoint,this._hitPoint),Si.copy(e._hitNormal,this._hitNormal),e._distance=this._distance,e._collider=this._collider,e},Be(t,[{key:"hitPoint",get:function(){return this._hitPoint}},{key:"distance",get:function(){return this._distance}},{key:"collider",get:function(){return this._collider}},{key:"hitNormal",get:function(){return this._hitNormal}}]),t}()),WO=function(t){if(1===t){for(var e=this,i=function(t){var i="_"+(1<<t);e[i]=0,e.updateArray=[],Object.defineProperty(e,1<<t,{get:function(){return this[i]},set:function(e){this[i]!==e&&(this[i]=e,this.updateArray.indexOf(t)<0&&this.updateArray.push(t))}})},r=0;r<32;r++)i(r);this._1=mO.DEFAULT}else{for(var n=0;n<32;n++)this[""+(1<<n)]=0;this[1]=mO.DEFAULT}};Xe.internal.PhysicsGroup=mO;var XO,YO,jO,KO,qO,ZO,JO,QO,$O,tP,eP,iP,rP,nP,sP,aP,oP,lP,hP,uP,cP,pP,dP,fP,_P,gP,mP,yP,vP,bP,SP,TP,AP,EP,CP,RP,wP,xP,OP,PP,DP,MP,BP,IP,LP=t("PhysicsSystem",function(t){function e(){var e;(e=t.call(this)||this).physicsWorld=void 0,e.raycastClosestResult=new HO,e.raycastResults=[],e.collisionMatrix=new WO(1),e.useNodeChains=void 0,e._enable=!0,e._allowSleep=!0,e._maxSubSteps=1,e._subStepCount=0,e._fixedTimeStep=1/60,e._autoSimulation=!0,e._accumulator=0,e._sleepThreshold=.1,e._gravity=new Si(0,-10,0),e._material=new VO,e.raycastOptions={group:-1,mask:-1,queryTrigger:!0,maxDistance:1e7},e.raycastResultPool=new i((function(){return new HO}),1);var r=Mi.config?Mi.config.physics:null;if(r&&r.physicsEngine){if(Si.copy(e._gravity,r.gravity),e._allowSleep=r.allowSleep,e._fixedTimeStep=r.fixedTimeStep,e._maxSubSteps=r.maxSubSteps,e._sleepThreshold=r.sleepThreshold,e.autoSimulation=r.autoSimulation,e.useNodeChains=r.useNodeChains,r.defaultMaterial&&(e._material.friction=r.defaultMaterial.friction,e._material.rollingFriction=r.defaultMaterial.rollingFriction,e._material.spinningFriction=r.defaultMaterial.spinningFriction,e._material.restitution=r.defaultMaterial.restitution),r.collisionMatrix)for(var n in r.collisionMatrix){var s=1<<parseInt(n);e.collisionMatrix[""+s]=r.collisionMatrix[n]}}else e.useNodeChains=!1;return e._material.on("physics_material_update",e._updateMaterial,ti(e)),e.physicsWorld=xO(yO.wrapper.PhysicsWorld,CO.World)?wO:new yO.wrapper.PhysicsWorld,e.physicsWorld.setGravity(e._gravity),e.physicsWorld.setAllowSleep(e._allowSleep),e.physicsWorld.setDefaultMaterial(e._material),e}Me(e,t);var r=e.prototype;return r.postUpdate=function(t){if(this._enable){if(this._autoSimulation){for(this._subStepCount=0,this._accumulator+=t,Ai.emit(Ei.EVENT_BEFORE_PHYSICS);this._subStepCount<this._maxSubSteps;){if(!(this._accumulator>this._fixedTimeStep)){this.physicsWorld.syncSceneToPhysics();break}this.physicsWorld.syncSceneToPhysics(),this.physicsWorld.step(this._fixedTimeStep),this._accumulator-=this._fixedTimeStep,this._subStepCount++,this.physicsWorld.emitEvents(),this.physicsWorld.syncAfterEvents()}Ai.emit(Ei.EVENT_AFTER_PHYSICS)}}else this.physicsWorld.syncSceneToPhysics()},r.resetAccumulator=function(t){void 0===t&&(t=0),this._accumulator=t},r.step=function(t,e,i){this.physicsWorld.step(t,e,i)},r.syncSceneToPhysics=function(){this.physicsWorld.syncSceneToPhysics()},r.emitEvents=function(){this.physicsWorld.emitEvents()},r.raycast=function(t,e,i,r){return void 0===e&&(e=4294967295),void 0===i&&(i=1e7),void 0===r&&(r=!0),this.raycastResultPool.reset(),this.raycastResults.length=0,this.raycastOptions.mask=e>>>0,this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=r,this.physicsWorld.raycast(t,this.raycastOptions,this.raycastResultPool,this.raycastResults)},r.raycastClosest=function(t,e,i,r){return void 0===e&&(e=4294967295),void 0===i&&(i=1e7),void 0===r&&(r=!0),this.raycastOptions.mask=e>>>0,this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=r,this.physicsWorld.raycastClosest(t,this.raycastOptions,this.raycastClosestResult)},r._updateMaterial=function(){this.physicsWorld.setDefaultMaterial(this._material)},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this.physicsWorld.setAllowSleep(t)}},{key:"maxSubSteps",get:function(){return this._maxSubSteps},set:function(t){this._maxSubSteps=t}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity.set(t),this.physicsWorld.setGravity(t)}},{key:"sleepThreshold",get:function(){return this._sleepThreshold},set:function(t){this._sleepThreshold=t}},{key:"autoSimulation",get:function(){return this._autoSimulation},set:function(t){this._autoSimulation=t}},{key:"defaultMaterial",get:function(){return this._material}}],[{key:"PHYSICS_NONE",get:function(){return!yO.id}},{key:"PHYSICS_BUILTIN",get:function(){return"builtin"===yO.id}},{key:"PHYSICS_CANNON",get:function(){return"cannon.js"===yO.id}},{key:"PHYSICS_AMMO",get:function(){return"ammo.js"===yO.id}},{key:"PHYSICS_PHYSX",get:function(){return"physx"===yO.id}},{key:"PhysicsGroup",get:function(){return mO}},{key:"instance",get:function(){return e._instance}}]),e}(qi));LP.ID="PHYSICS",LP._instance=void 0,Ai.once(Ei.EVENT_INIT,(function(){!function(){var t=Mi.config.physics;if(t){var e=t.collisionGroups;e instanceof Array&&(e.forEach((function(t){mO[t.name]=1<<t.index})),Oi.update(mO))}var i=LP.instance;i&&(Ai.unregisterSystem(i),i.physicsWorld.destroy());var r=new Xe.PhysicsSystem;Xe.PhysicsSystem._instance=r,Ai.registerSystem(LP.ID,r,0)}()}));var FP,kP,NP,GP,UP,zP,VP,HP,WP,XP,YP,jP,KP,qP,ZP,JP,QP,$P,tD,eD,iD,rD,nD=function(e){return t({RigidBody:e,RigidBodyComponent:e}),e}((XO=Ze("cc.RigidBody"),YO=ai(),jO=oi(),KO=Ci(-1),qO=si(LP.PhysicsGroup),ZO=Ri(),JO=li(),QO=si(pO),$O=Ri(),tP=li(),eP=Ni(),iP=Ri(),rP=li(),nP=Ni(),sP=Ri(),aP=li(),oP=Ni(),lP=Ri(),hP=li(),uP=Ni(),cP=Ri(),pP=li(),dP=Ni(),fP=Ri(),_P=li(),gP=Ni(),mP=Ri(),yP=li(),vP=Ni(),bP=Ri(),SP=li(),XO(TP=YO(TP=jO(TP=vi(TP=yi(TP=KO((IP=BP=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._body=null,$e(e,"_group",EP,ti(e)),$e(e,"_type",CP,ti(e)),$e(e,"_mass",RP,ti(e)),$e(e,"_allowSleep",wP,ti(e)),$e(e,"_linearDamping",xP,ti(e)),$e(e,"_angularDamping",OP,ti(e)),$e(e,"_useGravity",PP,ti(e)),$e(e,"_linearFactor",DP,ti(e)),$e(e,"_angularFactor",MP,ti(e)),e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._body=xO(yO.wrapper.RigidBody,CO.RigidBody)?OO:new yO.wrapper.RigidBody,this._body.initialize(this)},i.onEnable=function(){this._body&&this._body.onEnable()},i.onDisable=function(){this._body&&this._body.onDisable()},i.onDestroy=function(){this._body&&this._body.onDestroy()},i.applyForce=function(t,e){this._assertOnLoadCalled&&this._body.applyForce(t,e)},i.applyLocalForce=function(t,e){this._assertOnLoadCalled&&this._body.applyLocalForce(t,e)},i.applyImpulse=function(t,e){this._assertOnLoadCalled&&this._body.applyImpulse(t,e)},i.applyLocalImpulse=function(t,e){this._assertOnLoadCalled&&this._body.applyLocalImpulse(t,e)},i.applyTorque=function(t){this._assertOnLoadCalled&&this._body.applyTorque(t)},i.applyLocalTorque=function(t){this._assertOnLoadCalled&&this._body.applyLocalTorque(t)},i.wakeUp=function(){this._assertOnLoadCalled&&this._body.wakeUp()},i.sleep=function(){this._assertOnLoadCalled&&this._body.sleep()},i.clearState=function(){this._assertOnLoadCalled&&this._body.clearState()},i.clearForces=function(){this._assertOnLoadCalled&&this._body.clearForces()},i.clearVelocity=function(){this._assertOnLoadCalled&&this._body.clearVelocity()},i.getLinearVelocity=function(t){this._assertOnLoadCalled&&this._body.getLinearVelocity(t)},i.setLinearVelocity=function(t){this._assertOnLoadCalled&&this._body.setLinearVelocity(t)},i.getAngularVelocity=function(t){this._assertOnLoadCalled&&this._body.getAngularVelocity(t)},i.setAngularVelocity=function(t){this._assertOnLoadCalled&&this._body.setAngularVelocity(t)},i.getGroup=function(){return this._assertOnLoadCalled?this._body.getGroup():0},i.setGroup=function(t){this._assertOnLoadCalled&&this._body.setGroup(t)},i.addGroup=function(t){this._assertOnLoadCalled&&this._body.addGroup(t)},i.removeGroup=function(t){this._assertOnLoadCalled&&this._body.removeGroup(t)},i.getMask=function(){return this._assertOnLoadCalled?this._body.getMask():0},i.setMask=function(t){this._assertOnLoadCalled&&this._body.setMask(t)},i.addMask=function(t){this._assertOnLoadCalled&&this._body.addMask(t)},i.removeMask=function(t){this._assertOnLoadCalled&&this._body.removeMask(t)},Be(e,[{key:"group",get:function(){return this.getGroup()},set:function(t){this._group=t,this.getGroup()!==t&&this._body&&this._body.setGroup(t)}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._body&&this._body.setType(t))}},{key:"mass",get:function(){return this._mass},set:function(t){this._mass!==t&&(t=t<=0?1e-4:t,this._mass=t,this._body&&this._body.setMass(t))}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this._body&&this._body.setAllowSleep(t)}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&this._body.setLinearDamping(t)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&this._body.setAngularDamping(t)}},{key:"useGravity",get:function(){return this._useGravity},set:function(t){this._useGravity=t,this._body&&this._body.useGravity(t)}},{key:"linearFactor",get:function(){return this._linearFactor},set:function(t){Si.copy(this._linearFactor,t),this._body&&this._body.setLinearFactor(this._linearFactor)}},{key:"angularFactor",get:function(){return this._angularFactor},set:function(t){Si.copy(this._angularFactor,t),this._body&&this._body.setAngularFactor(this._angularFactor)}},{key:"sleepThreshold",get:function(){return this._assertOnLoadCalled?this._body.getSleepThreshold():0},set:function(t){this._assertOnLoadCalled&&this._body.setSleepThreshold(t)}},{key:"isAwake",get:function(){return!!this._assertOnLoadCalled&&this._body.isAwake}},{key:"isSleepy",get:function(){return!!this._assertOnLoadCalled&&this._body.isSleepy}},{key:"isSleeping",get:function(){return!!this._assertOnLoadCalled&&this._body.isSleeping}},{key:"isStatic",get:function(){return this._type===pO.STATIC},set:function(t){t&&this.isStatic||!t&&!this.isStatic||(this.type=t?pO.STATIC:pO.DYNAMIC)}},{key:"isDynamic",get:function(){return this._type===pO.DYNAMIC},set:function(t){t&&this.isDynamic||!t&&!this.isDynamic||(this.type=t?pO.DYNAMIC:pO.KINEMATIC)}},{key:"isKinematic",get:function(){return this._type===pO.KINEMATIC},set:function(t){t&&this.isKinematic||!t&&!this.isKinematic||(this.type=t?pO.KINEMATIC:pO.DYNAMIC)}},{key:"body",get:function(){return this._body}},{key:"_assertOnLoadCalled",get:function(){var t=0===this._isOnLoadCalled;return t&&Le("[Physics]: Please make sure that the node has been added to the scene"),!t}}]),e}(ui),BP.Type=pO,je((AP=IP).prototype,"group",[qO,ZO,JO],Object.getOwnPropertyDescriptor(AP.prototype,"group"),AP.prototype),je(AP.prototype,"type",[QO,$O,tP],Object.getOwnPropertyDescriptor(AP.prototype,"type"),AP.prototype),je(AP.prototype,"mass",[eP,iP,rP],Object.getOwnPropertyDescriptor(AP.prototype,"mass"),AP.prototype),je(AP.prototype,"allowSleep",[nP,sP,aP],Object.getOwnPropertyDescriptor(AP.prototype,"allowSleep"),AP.prototype),je(AP.prototype,"linearDamping",[oP,lP,hP],Object.getOwnPropertyDescriptor(AP.prototype,"linearDamping"),AP.prototype),je(AP.prototype,"angularDamping",[uP,cP,pP],Object.getOwnPropertyDescriptor(AP.prototype,"angularDamping"),AP.prototype),je(AP.prototype,"useGravity",[dP,fP,_P],Object.getOwnPropertyDescriptor(AP.prototype,"useGravity"),AP.prototype),je(AP.prototype,"linearFactor",[gP,mP,yP],Object.getOwnPropertyDescriptor(AP.prototype,"linearFactor"),AP.prototype),je(AP.prototype,"angularFactor",[vP,bP,SP],Object.getOwnPropertyDescriptor(AP.prototype,"angularFactor"),AP.prototype),EP=je(AP.prototype,"_group",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return LP.PhysicsGroup.DEFAULT}}),CP=je(AP.prototype,"_type",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pO.DYNAMIC}}),RP=je(AP.prototype,"_mass",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),wP=je(AP.prototype,"_allowSleep",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xP=je(AP.prototype,"_linearDamping",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),OP=je(AP.prototype,"_angularDamping",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),PP=je(AP.prototype,"_useGravity",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),DP=je(AP.prototype,"_linearFactor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si(1,1,1)}}),MP=je(AP.prototype,"_angularFactor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si(1,1,1)}}),TP=AP))||TP)||TP)||TP)||TP)||TP)||TP));nD||(nD=function(e){return t({RigidBody:e,RigidBodyComponent:e}),e}({}));var sD,aD,oD,lD,hD,uD,cD,pD,dD,fD=function(e){return t({Collider:e,ColliderComponent:e}),e}((FP=Ze("cc.Collider"),kP=si(nD),NP=Gi(),GP=Ri(),UP=li(),zP=si(VO),VP=Gi(),HP=Ri(),WP=li(),XP=Ri(),YP=li(),jP=si(Si),KP=Ri(),qP=li(),ZP=si(VO),FP((rD=iD=function(t){function e(e){var i;return(i=t.call(this)||this).type=void 0,i._shape=null,i._aabb=null,i._boundingSphere=null,i._isSharedMaterial=!0,i._needTriggerEvent=!1,i._needCollisionEvent=!1,$e(i,"_material",$P,ti(i)),$e(i,"_isTrigger",tD,ti(i)),$e(i,"_center",eD,ti(i)),i.type=e,i}Me(e,t);var i=e.prototype;return i.on=function(e,i,r,n){var s=t.prototype.on.call(this,e,i,r,n);return this._updateNeedEvent(e),s},i.off=function(e,i,r){t.prototype.off.call(this,e,i,r),this._updateNeedEvent()},i.once=function(e,i,r){var n=t.prototype.once.call(this,e,i,r);return this._updateNeedEvent(e),n},i.removeAll=function(e){t.prototype.removeAll.call(this,e),this._updateNeedEvent()},i.getGroup=function(){return this._assertOnLoadCalled?this._shape.getGroup():0},i.setGroup=function(t){this._assertOnLoadCalled&&this._shape.setGroup(t)},i.addGroup=function(t){this._assertOnLoadCalled&&this._shape.addGroup(t)},i.removeGroup=function(t){this._assertOnLoadCalled&&this._shape.removeGroup(t)},i.getMask=function(){return this._assertOnLoadCalled?this._shape.getMask():0},i.setMask=function(t){this._assertOnLoadCalled&&this._shape.setMask(t)},i.addMask=function(t){this._assertOnLoadCalled&&this._shape.addMask(t)},i.removeMask=function(t){this._assertOnLoadCalled&&this._shape.removeMask(t)},i.onLoad=function(){this.sharedMaterial=null==this._material?LP.instance.defaultMaterial:this._material,this._shape=function(t){return PO.INITED||(PO.INITED=!0,PO[_O.BOX]=function(){return xO(yO.wrapper.BoxShape,CO.BoxCollider)?DO:new yO.wrapper.BoxShape},PO[_O.SPHERE]=function(){return xO(yO.wrapper.SphereShape,CO.SphereCollider)?DO:new yO.wrapper.SphereShape},PO[_O.CAPSULE]=function(){return xO(yO.wrapper.CapsuleShape,CO.CapsuleCollider)?DO:new yO.wrapper.CapsuleShape},PO[_O.CYLINDER]=function(){return xO(yO.wrapper.CylinderShape,CO.CylinderCollider)?DO:new yO.wrapper.CylinderShape},PO[_O.CONE]=function(){return xO(yO.wrapper.ConeShape,CO.ConeCollider)?DO:new yO.wrapper.ConeShape},PO[_O.MESH]=function(){return xO(yO.wrapper.TrimeshShape,CO.MeshCollider)?DO:new yO.wrapper.TrimeshShape},PO[_O.TERRAIN]=function(){return xO(yO.wrapper.TerrainShape,CO.TerrainCollider)?DO:new yO.wrapper.TerrainShape},PO[_O.SIMPLEX]=function(){return xO(yO.wrapper.SimplexShape,CO.SimplexCollider)?DO:new yO.wrapper.SimplexShape},PO[_O.PLANE]=function(){return xO(yO.wrapper.PlaneShape,CO.PlaneCollider)?DO:new yO.wrapper.PlaneShape}),PO[t]()}(this.type),this._shape.initialize(this),this._shape.onLoad()},i.onEnable=function(){this._shape&&this._shape.onEnable()},i.onDisable=function(){this._shape&&this._shape.onDisable()},i.onDestroy=function(){this._shape&&(this._material&&this._material.off("physics_material_update",this._updateMaterial,this),this._shape.onDestroy()),this._boundingSphere&&this._boundingSphere.destroy()},i._updateMaterial=function(){this._shape&&this._shape.setMaterial(this._material)},i._updateNeedEvent=function(t){this.isValid&&(void 0!==t?("onCollisionEnter"!==t&&"onCollisionStay"!==t&&"onCollisionExit"!==t||(this._needCollisionEvent=!0),"onTriggerEnter"!==t&&"onTriggerStay"!==t&&"onTriggerExit"!==t||(this._needTriggerEvent=!0)):(this.hasEventListener("onTriggerEnter")||this.hasEventListener("onTriggerStay")||this.hasEventListener("onTriggerExit")||(this._needTriggerEvent=!1),this.hasEventListener("onCollisionEnter")||this.hasEventListener("onCollisionStay")||this.hasEventListener("onCollisionExit")||(this._needCollisionEvent=!1)),this._shape&&this._shape.updateEventListener())},Be(e,[{key:"attachedRigidBody",get:function(){return t=this.node,(e=t.getComponent(nD))&&e.isValid?e:null;var t,e}},{key:"sharedMaterial",get:function(){return this._material},set:function(t){this.material=t}},{key:"material",get:function(){return this._isSharedMaterial&&null!=this._material&&(this._material.off("physics_material_update",this._updateMaterial,this),this._material=this._material.clone(),this._material.on("physics_material_update",this._updateMaterial,this),this._isSharedMaterial=!1),this._material},set:function(t){this._shape?(null!=t&&null!=this._material?this._material.id!==t.id&&(this._material.off("physics_material_update",this._updateMaterial,this),t.on("physics_material_update",this._updateMaterial,this),this._isSharedMaterial=!1,this._material=t):null!=t&&null==this._material?(t.on("physics_material_update",this._updateMaterial,this),this._material=t):null==t&&null!=this._material&&(this._material.off("physics_material_update",this._updateMaterial,this),this._material=t),this._updateMaterial()):this._material=t}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger=t,this._shape&&this._shape.setAsTrigger(this._isTrigger)}},{key:"center",get:function(){return this._center},set:function(t){Si.copy(this._center,t),this._shape&&this._shape.setCenter(this._center)}},{key:"shape",get:function(){return this._shape}},{key:"worldBounds",get:function(){return null==this._aabb&&(this._aabb=new Ti),this._shape&&this._shape.getAABB(this._aabb),this._aabb}},{key:"boundingSphere",get:function(){return null==this._boundingSphere&&(this._boundingSphere=new vn),this._shape&&this._shape.getBoundingSphere(this._boundingSphere),this._boundingSphere}},{key:"needTriggerEvent",get:function(){return this._needTriggerEvent}},{key:"needCollisionEvent",get:function(){return this._needCollisionEvent}},{key:"_assertOnLoadCalled",get:function(){var t=0===this._isOnLoadCalled;return t&&Le("[Physics]: Please make sure that the node has been added to the scene"),!t}}]),e}(mn(ui)),iD.Type=_O,iD.Axis=dO,je((QP=rD).prototype,"attachedRigidBody",[kP,yn,NP,GP,UP],Object.getOwnPropertyDescriptor(QP.prototype,"attachedRigidBody"),QP.prototype),je(QP.prototype,"sharedMaterial",[zP,VP,HP,WP],Object.getOwnPropertyDescriptor(QP.prototype,"sharedMaterial"),QP.prototype),je(QP.prototype,"isTrigger",[XP,YP],Object.getOwnPropertyDescriptor(QP.prototype,"isTrigger"),QP.prototype),je(QP.prototype,"center",[jP,KP,qP],Object.getOwnPropertyDescriptor(QP.prototype,"center"),QP.prototype),$P=je(QP.prototype,"_material",[ZP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tD=je(QP.prototype,"_isTrigger",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),eD=je(QP.prototype,"_center",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),JP=QP))||JP));fD||(fD=function(e){return t({Collider:e,ColliderComponent:e}),e}({}));var _D,gD,mD,yD,vD,bD,SD,TD,AD,ED,CD,RD,wD,xD,OD,PD,DD,MD,BD,ID,LD,FD,kD,ND,GD,UD,zD,VD,HD,WD,XD,YD,jD,KD,qD,ZD,JD,QD,$D,tM,eM,iM,rM,nM,sM,aM,oM,lM,hM,uM,cM,pM,dM,fM,_M,gM,mM,yM,vM,bM,SM,TM,AM,EM,CM,RM,wM,xM,OM,PM,DM,MM,BM,IM,LM,FM,kM,NM,GM,UM,zM,VM,HM,WM,XM,YM,jM,KM,qM,ZM,JM,QM,$M,tB,eB,iB,rB,nB,sB,aB,oB,lB,hB,uB,cB,pB,dB,fB,_B,gB,mB,yB,vB,bB,SB,TB,AB,EB,CB,RB,wB,xB,OB,PB,DB,MB,BB,IB=function(e){return t({BoxCollider:e,BoxColliderComponent:e}),e}((sD=Ze("cc.BoxCollider"),aD=ai(),oD=oi(),lD=si(Si),hD=li(),sD(uD=aD(uD=oD(uD=vi((dD=function(t){function e(){var e;return e=t.call(this,_O.BOX)||this,$e(e,"_size",pD,ti(e)),e}return Me(e,t),Be(e,[{key:"size",get:function(){return this._size},set:function(t){Si.copy(this._size,t),this._shape&&this.shape.setSize(this._size)}},{key:"shape",get:function(){return this._shape}}]),e}(fD),je((cD=dD).prototype,"size",[lD,hD],Object.getOwnPropertyDescriptor(cD.prototype,"size"),cD.prototype),pD=je(cD.prototype,"_size",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si(1,1,1)}}),uD=cD))||uD)||uD)||uD)||uD)),LB=function(e){return t({SphereCollider:e,SphereColliderComponent:e}),e}((_D=Ze("cc.SphereCollider"),gD=ai(),mD=oi(),yD=li(),_D(vD=gD(vD=mD(vD=vi((TD=function(t){function e(){var e;return e=t.call(this,_O.SPHERE)||this,$e(e,"_radius",SD,ti(e)),e}return Me(e,t),Be(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t,this.shape.setRadius(this._radius)}},{key:"shape",get:function(){return this._shape}}]),e}(fD),je((bD=TD).prototype,"radius",[yD],Object.getOwnPropertyDescriptor(bD.prototype,"radius"),bD.prototype),SD=je(bD.prototype,"_radius",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),vD=bD))||vD)||vD)||vD)||vD)),FB=function(e){return t({CapsuleCollider:e,CapsuleColliderComponent:e}),e}((AD=Ze("cc.CapsuleCollider"),ED=ai(),CD=oi(),RD=li(),wD=li(),xD=si(dO),OD=li(),AD(PD=ED(PD=CD(PD=vi((LD=function(t){function e(){var e;return e=t.call(this,_O.CAPSULE)||this,$e(e,"_radius",MD,ti(e)),$e(e,"_cylinderHeight",BD,ti(e)),$e(e,"_direction",ID,ti(e)),e}Me(e,t);var i=e.prototype;return i._getRadiusScale=function(){if(null==this.node)return 1;var t=this.node.worldScale;return this._direction===dO.Y_AXIS?Math.abs(bn(t.x,t.z)):this._direction===dO.X_AXIS?Math.abs(bn(t.y,t.z)):Math.abs(bn(t.x,t.y))},i._getHeightScale=function(){if(null==this.node)return 1;var t=this.node.worldScale;return this._direction===dO.Y_AXIS?Math.abs(t.y):this._direction===dO.X_AXIS?Math.abs(t.x):Math.abs(t.z)},Be(e,[{key:"radius",get:function(){return this._radius},set:function(t){t<0&&(t=0),this._radius=t,this.shape.setRadius(t)}},{key:"cylinderHeight",get:function(){return this._cylinderHeight},set:function(t){t<0&&(t=0),this._cylinderHeight=t,this.shape.setCylinderHeight(t)}},{key:"direction",get:function(){return this._direction},set:function(t){(t=Math.floor(t))<dO.X_AXIS||t>dO.Z_AXIS||(this._direction=t,this.shape.setDirection(t))}},{key:"height",get:function(){return 2*this._radius+this._cylinderHeight},set:function(t){var e=t-2*this._radius;e<0&&(e=0),this.cylinderHeight=e}},{key:"worldHeight",get:function(){return 2*this._radius*this._getRadiusScale()+this._cylinderHeight*this._getHeightScale()}},{key:"shape",get:function(){return this._shape}}]),e}(fD),je((DD=LD).prototype,"radius",[RD],Object.getOwnPropertyDescriptor(DD.prototype,"radius"),DD.prototype),je(DD.prototype,"cylinderHeight",[wD],Object.getOwnPropertyDescriptor(DD.prototype,"cylinderHeight"),DD.prototype),je(DD.prototype,"direction",[xD,OD],Object.getOwnPropertyDescriptor(DD.prototype,"direction"),DD.prototype),MD=je(DD.prototype,"_radius",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),BD=je(DD.prototype,"_cylinderHeight",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ID=je(DD.prototype,"_direction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dO.Y_AXIS}}),PD=DD))||PD)||PD)||PD)||PD)),kB=function(e){return t({CylinderCollider:e,CylinderColliderComponent:e}),e}((FD=Ze("cc.CylinderCollider"),kD=ai(),ND=oi(),GD=li(),UD=li(),zD=si(dO),VD=li(),FD(HD=kD(HD=ND(HD=vi((KD=function(t){function e(){var e;return e=t.call(this,_O.CYLINDER)||this,$e(e,"_radius",XD,ti(e)),$e(e,"_height",YD,ti(e)),$e(e,"_direction",jD,ti(e)),e}return Me(e,t),Be(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(t<0&&(t=0),this._radius=t,this.shape.setRadius(t))}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(t<0&&(t=0),this._height=t,this.shape.setHeight(t))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(t<dO.X_AXIS||t>dO.Z_AXIS||(this._direction=t,this.shape.setDirection(t)))}},{key:"shape",get:function(){return this._shape}}]),e}(fD),je((WD=KD).prototype,"radius",[GD],Object.getOwnPropertyDescriptor(WD.prototype,"radius"),WD.prototype),je(WD.prototype,"height",[UD],Object.getOwnPropertyDescriptor(WD.prototype,"height"),WD.prototype),je(WD.prototype,"direction",[zD,VD],Object.getOwnPropertyDescriptor(WD.prototype,"direction"),WD.prototype),XD=je(WD.prototype,"_radius",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),YD=je(WD.prototype,"_height",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),jD=je(WD.prototype,"_direction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dO.Y_AXIS}}),HD=WD))||HD)||HD)||HD)||HD)),NB=t("ConeCollider",(qD=Ze("cc.ConeCollider"),ZD=ai(),JD=oi(),QD=li(),$D=li(),tM=si(dO),eM=li(),qD(iM=ZD(iM=JD(iM=vi((oM=function(t){function e(){var e;return e=t.call(this,_O.CONE)||this,$e(e,"_radius",nM,ti(e)),$e(e,"_height",sM,ti(e)),$e(e,"_direction",aM,ti(e)),e}return Me(e,t),Be(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(t<0&&(t=0),this._radius=t,this.shape.setRadius(t))}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(t<0&&(t=0),this._height=t,this.shape.setHeight(t))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(t<dO.X_AXIS||t>dO.Z_AXIS||(this._direction=t,this.shape.setDirection(t)))}},{key:"shape",get:function(){return this._shape}}]),e}(fD),je((rM=oM).prototype,"radius",[QD],Object.getOwnPropertyDescriptor(rM.prototype,"radius"),rM.prototype),je(rM.prototype,"height",[$D],Object.getOwnPropertyDescriptor(rM.prototype,"height"),rM.prototype),je(rM.prototype,"direction",[tM,eM],Object.getOwnPropertyDescriptor(rM.prototype,"direction"),rM.prototype),nM=je(rM.prototype,"_radius",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),sM=je(rM.prototype,"_height",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),aM=je(rM.prototype,"_direction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dO.Y_AXIS}}),iM=rM))||iM)||iM)||iM)||iM)),GB=function(e){return t({MeshCollider:e,MeshColliderComponent:e}),e}((lM=Ze("cc.MeshCollider"),hM=ai(),uM=oi(),cM=si(Dc),pM=li(),dM=li(),lM(fM=hM(fM=uM(fM=vi((yM=function(t){function e(){var e;return e=t.call(this,_O.MESH)||this,$e(e,"_mesh",gM,ti(e)),$e(e,"_convex",mM,ti(e)),e}return Me(e,t),Be(e,[{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh=t,this.shape.setMesh(this._mesh))}},{key:"convex",get:function(){return this._convex},set:function(t){this._convex!==t&&(this._convex=t)}},{key:"shape",get:function(){return this._shape}}]),e}(fD),je((_M=yM).prototype,"mesh",[cM,pM],Object.getOwnPropertyDescriptor(_M.prototype,"mesh"),_M.prototype),je(_M.prototype,"convex",[yr,dM],Object.getOwnPropertyDescriptor(_M.prototype,"convex"),_M.prototype),gM=je(_M.prototype,"_mesh",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mM=je(_M.prototype,"_convex",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fM=_M))||fM)||fM)||fM)||fM)),UB=t("ConstantForce",(vM=Ze("cc.ConstantForce"),bM=ai(),SM=xi(nD),TM=oi(),AM=Ri(),EM=li(),CM=Ri(),RM=li(),wM=Ri(),xM=li(),OM=Ri(),PM=li(),vM(DM=bM(DM=SM(DM=TM(DM=yi(DM=vi((kM=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._rigidBody=null,$e(e,"_force",BM,ti(e)),$e(e,"_localForce",IM,ti(e)),$e(e,"_torque",LM,ti(e)),$e(e,"_localTorque",FM,ti(e)),e._mask=0,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._rigidBody=this.node.getComponent(nD),this._maskUpdate(this._force,1),this._maskUpdate(this._localForce,2),this._maskUpdate(this._torque,4),this._maskUpdate(this._localTorque,8)},i.lateUpdate=function(){null!=this._rigidBody&&0!==this._mask&&(1&this._mask&&this._rigidBody.applyForce(this._force),2&this._mask&&this._rigidBody.applyLocalForce(this.localForce),4&this._mask&&this._rigidBody.applyTorque(this._torque),8&this._mask&&this._rigidBody.applyLocalTorque(this._localTorque))},i._maskUpdate=function(t,e){t.strictEquals(Si.ZERO)?this._mask&=~e:this._mask|=e},Be(e,[{key:"force",get:function(){return this._force},set:function(t){Si.copy(this._force,t),this._maskUpdate(this._force,1)}},{key:"localForce",get:function(){return this._localForce},set:function(t){Si.copy(this._localForce,t),this._maskUpdate(this.localForce,2)}},{key:"torque",get:function(){return this._torque},set:function(t){Si.copy(this._torque,t),this._maskUpdate(this._torque,4)}},{key:"localTorque",get:function(){return this._localTorque},set:function(t){Si.copy(this._localTorque,t),this._maskUpdate(this._localTorque,8)}}]),e}(ui),BM=je((MM=kM).prototype,"_force",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),IM=je(MM.prototype,"_localForce",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),LM=je(MM.prototype,"_torque",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),FM=je(MM.prototype,"_localTorque",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),je(MM.prototype,"force",[AM,EM],Object.getOwnPropertyDescriptor(MM.prototype,"force"),MM.prototype),je(MM.prototype,"localForce",[CM,RM],Object.getOwnPropertyDescriptor(MM.prototype,"localForce"),MM.prototype),je(MM.prototype,"torque",[wM,xM],Object.getOwnPropertyDescriptor(MM.prototype,"torque"),MM.prototype),je(MM.prototype,"localTorque",[OM,PM],Object.getOwnPropertyDescriptor(MM.prototype,"localTorque"),MM.prototype),DM=MM))||DM)||DM)||DM)||DM)||DM)||DM)),zB=16842754,VB=16842755,HB=16842756,WB=16842757,XB=16843025,YB=function(){function t(){this.length=0,this.buffer=new Uint8Array(2048),this._buffView=new DataView(this.buffer.buffer),this._seekPos=0}var e=t.prototype;return e.reserve=function(t){if(!(this.buffer.byteLength>t)){for(var e=this.buffer.byteLength;e<t;)e+=e;for(var i=new Uint8Array(e),r=0;r<this.length;++r)i[r]=this.buffer[r];this.buffer=i,this._buffView=new DataView(this.buffer.buffer)}},e.assign=function(t){this.buffer=t,this.length=t.length,this._seekPos=t.byteOffset,this._buffView=new DataView(t.buffer)},e.writeInt8=function(t){this.reserve(this.length+1),this._buffView.setInt8(this.length,t),this.length+=1},e.writeInt16=function(t){this.reserve(this.length+2),this._buffView.setInt16(this.length,t,!0),this.length+=2},e.writeInt32=function(t){this.reserve(this.length+4),this._buffView.setInt32(this.length,t,!0),this.length+=4},e.writeIntArray=function(t){this.reserve(this.length+4*t.length);for(var e=0;e<t.length;++e)this._buffView.setInt32(this.length+4*e,t[e],!0);this.length+=4*t.length},e.writeFloat=function(t){this.reserve(this.length+4),this._buffView.setFloat32(this.length,t,!0),this.length+=4},e.writeFloatArray=function(t){this.reserve(this.length+4*t.length);for(var e=0;e<t.length;++e)this._buffView.setFloat32(this.length+4*e,t[e],!0);this.length+=4*t.length},e.writeString=function(t){this.reserve(this.length+t.length+4),this._buffView.setInt32(this.length,t.length,!0);for(var e=0;e<t.length;++e)this._buffView.setInt8(this.length+4+e,t.charCodeAt(e));this.length+=t.length+4},e.readInt8=function(){var t=this._buffView.getInt8(this._seekPos);return this._seekPos+=1,t},e.readInt16=function(){var t=this._buffView.getInt16(this._seekPos,!0);return this._seekPos+=2,t},e.readInt=function(){var t=this._buffView.getInt32(this._seekPos,!0);return this._seekPos+=4,t},e.readIntArray=function(t){for(var e=0;e<t.length;++e)t[e]=this._buffView.getInt32(this._seekPos+4*e,!0);return this._seekPos+=4*t.length,t},e.readFloat=function(){var t=this._buffView.getFloat32(this._seekPos,!0);return this._seekPos+=4,t},e.readFloatArray=function(t){for(var e=0;e<t.length;++e)t[e]=this._buffView.getFloat32(this._seekPos+4*e,!0);return this._seekPos+=4*t.length,t},e.readString=function(){for(var t=this.readInt(),e="",i=0;i<t;++i)e+=String.fromCharCode(this.readInt8());return e},t}(),jB=(Ze("cc.TerrainLayerInfo")((GM=je((NM=function(){$e(this,"slot",GM,this),$e(this,"tileSize",UM,this),$e(this,"detailMap",zM,this),$e(this,"normalMap",VM,this),$e(this,"roughness",HM,this),$e(this,"metallic",WM,this)}).prototype,"slot",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UM=je(NM.prototype,"tileSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),zM=je(NM.prototype,"detailMap",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VM=je(NM.prototype,"normalMap",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HM=je(NM.prototype,"roughness",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),WM=je(NM.prototype,"metallic",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NM)),Ze("cc.TerrainLayerBinaryInfo")(XM=function(){this.slot=0,this.tileSize=1,this.roughness=1,this.metallic=0,this.detailMapId="",this.normalMapId=""})||XM),KB=Ze("cc.TerrainAsset")((qM=function(t){function e(){var e;return(e=t.call(this)||this)._version=0,e._data=null,e._tileSize=1,e._blockCount=[1,1],e._weightMapSize=128,e._lightMapSize=128,e._heights=new Uint16Array,e._weights=new Uint8Array,e._layerBuffer=[-1,-1,-1,-1],e._layerBinaryInfos=[],$e(e,"_layerInfos",KM,ti(e)),e.loaded=!1,e}Me(e,t);var i=e.prototype;return i.getLayer=function(t,e,i){var r=4*(e*this.blockCount[0]+t)+i;return t<this.blockCount[0]&&e<this.blockCount[1]&&r<this._layerBuffer.length?this._layerBuffer[r]:-1},i.getHeight=function(t,e){var i=32*this._blockCount[0]+1;return.001953125*(this._heights[e*i+t]-32768)},i.getVertexCountI=function(){return this._blockCount.length<1?0:32*this._blockCount[0]+1},i.getVertexCountJ=function(){return this._blockCount.length<2?0:32*this._blockCount[1]+1},i._setNativeData=function(t){this._data=t},i._loadNativeData=function(t){if(!t||0===t.length)return!1;var e=new YB;if(e.assign(t),this._version=e.readInt(),this._version===XB)return!0;if(16842753!==this._version&&this._version!==zB&&this._version!==VB&&this._version!==HB&&this._version!==WB)return!1;this.tileSize=e.readFloat(),e.readIntArray(this._blockCount),this.weightMapSize=e.readInt16(),this.lightMapSize=e.readInt16();var i=e.readInt();this.heights=new Uint16Array(i);for(var r=0;r<this.heights.length;++r)this.heights[r]=e.readInt16();var n=e.readInt();this.weights=new Uint8Array(n);for(var s=0;s<this.weights.length;++s)this.weights[s]=e.readInt8();if(this._version>=zB){var a=e.readInt();this.layerBuffer=new Array(a);for(var o=0;o<this.layerBuffer.length;++o)this.layerBuffer[o]=e.readInt16()}if(this._version>=VB){var l=e.readInt();this._layerBinaryInfos=new Array(l);for(var h=0;h<this._layerBinaryInfos.length;++h)this._layerBinaryInfos[h]=new jB,this._layerBinaryInfos[h].slot=e.readInt(),this._layerBinaryInfos[h].tileSize=e.readFloat(),this._layerBinaryInfos[h].detailMapId=e.readString(),this._version>=HB&&(this._layerBinaryInfos[h].normalMapId=e.readString(),this._layerBinaryInfos[h].roughness=e.readFloat(),this._layerBinaryInfos[h].metallic=e.readFloat())}return!0},i._exportNativeData=function(){var t=new YB;t.writeInt32(WB),t.writeFloat(this.tileSize),t.writeIntArray(this._blockCount),t.writeInt16(this.weightMapSize),t.writeInt16(this.lightMapSize),t.writeInt32(this.heights.length);for(var e=0;e<this.heights.length;++e)t.writeInt16(this.heights[e]);t.writeInt32(this.weights.length);for(var i=0;i<this.weights.length;++i)t.writeInt8(this.weights[i]);t.writeInt32(this.layerBuffer.length);for(var r=0;r<this.layerBuffer.length;++r)t.writeInt16(this.layerBuffer[r]);var n=[];n.length=this.layerInfos.length;for(var s=0;s<n.length;++s){var a=this.layerInfos[s],o=new jB;o.slot=s,o.tileSize=a.tileSize,o.detailMapId=a.detailMap?a.detailMap._uuid:"",o.normalMapId=a.normalMap?a.normalMap._uuid:"",o.metallic=a.metallic,o.roughness=a.roughness,n[s]=o}t.writeInt32(n.length);for(var l=0;l<n.length;++l)t.writeInt32(n[l].slot),t.writeFloat(n[l].tileSize),t.writeString(n[l].detailMapId),t.writeString(n[l].normalMapId),t.writeFloat(n[l].roughness),t.writeFloat(n[l].metallic);return t.buffer},i._exportDefaultNativeData=function(){var t=new YB;return t.writeInt32(XB),t.buffer},Be(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data&&this._data.byteLength===t.byteLength?this._data.set(new Uint8Array(t)):this._data=new Uint8Array(t),this._loadNativeData(this._data),this.loaded=!0,this.emit("load")}},{key:"version",get:function(){return this._version}},{key:"tileSize",get:function(){return this._tileSize},set:function(t){this._tileSize=t}},{key:"blockCount",get:function(){return this._blockCount},set:function(t){this._blockCount=t}},{key:"lightMapSize",get:function(){return this._lightMapSize},set:function(t){this._lightMapSize=t}},{key:"weightMapSize",get:function(){return this._weightMapSize},set:function(t){this._weightMapSize=t}},{key:"heights",get:function(){return this._heights},set:function(t){this._heights=t}},{key:"weights",get:function(){return this._weights},set:function(t){this._weights=t}},{key:"layerBuffer",get:function(){return this._layerBuffer},set:function(t){this._layerBuffer=t}},{key:"layerInfos",get:function(){return this._layerInfos},set:function(t){this._layerInfos=t}},{key:"layerBinaryInfos",get:function(){return this._layerBinaryInfos}}]),e}(Je),KM=je((jM=qM).prototype,"_layerInfos",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YM=jM))||YM,qB=t("TerrainCollider",(ZM=Ze("cc.TerrainCollider"),JM=ai(),QM=oi(),$M=si(KB),tB=li(),ZM(eB=JM(eB=QM(eB=vi((nB=function(t){function e(){var e;return e=t.call(this,_O.TERRAIN)||this,$e(e,"_terrain",rB,ti(e)),e}return Me(e,t),Be(e,[{key:"terrain",get:function(){return this._terrain},set:function(t){this._terrain=t,this.shape.setTerrain(this._terrain)}},{key:"shape",get:function(){return this._shape}}]),e}(fD),je((iB=nB).prototype,"terrain",[$M,tB],Object.getOwnPropertyDescriptor(iB.prototype,"terrain"),iB.prototype),rB=je(iB.prototype,"_terrain",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eB=iB))||eB)||eB)||eB)||eB)),ZB=t("SimplexCollider",(sB=Ze("cc.SimplexCollider"),aB=ai(),oB=oi(),lB=si(fO),hB=li(),uB=li(),cB=Ni(),pB=li(),dB=Ni(),fB=li(),_B=Ni(),gB=li(),sB(mB=aB(mB=oB(mB=vi((TB=SB=function(t){function e(){var e;return e=t.call(this,_O.SIMPLEX)||this,$e(e,"_shapeType",vB,ti(e)),$e(e,"_vertices",bB,ti(e)),e}return Me(e,t),e.prototype.updateVertices=function(){this.shape.setVertices(this._vertices)},Be(e,[{key:"shapeType",get:function(){return this._shapeType},set:function(t){this._shapeType=t,this.shape.setShapeType(t)}},{key:"vertex0",get:function(){return this._vertices[0]},set:function(t){Si.copy(this._vertices[0],t),this.updateVertices()}},{key:"vertex1",get:function(){return this._vertices[1]},set:function(t){Si.copy(this._vertices[1],t),this.updateVertices()}},{key:"vertex2",get:function(){return this._vertices[2]},set:function(t){Si.copy(this._vertices[2],t),this.updateVertices()}},{key:"vertex3",get:function(){return this._vertices[3]},set:function(t){Si.copy(this._vertices[3],t),this.updateVertices()}},{key:"shape",get:function(){return this._shape}},{key:"vertices",get:function(){return this._vertices}}]),e}(fD),SB.ESimplexType=fO,je((yB=TB).prototype,"shapeType",[lB,hB],Object.getOwnPropertyDescriptor(yB.prototype,"shapeType"),yB.prototype),je(yB.prototype,"vertex0",[yr,uB],Object.getOwnPropertyDescriptor(yB.prototype,"vertex0"),yB.prototype),je(yB.prototype,"vertex1",[cB,pB],Object.getOwnPropertyDescriptor(yB.prototype,"vertex1"),yB.prototype),je(yB.prototype,"vertex2",[dB,fB],Object.getOwnPropertyDescriptor(yB.prototype,"vertex2"),yB.prototype),je(yB.prototype,"vertex3",[_B,gB],Object.getOwnPropertyDescriptor(yB.prototype,"vertex3"),yB.prototype),vB=je(yB.prototype,"_shapeType",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fO.TETRAHEDRON}}),bB=je(yB.prototype,"_vertices",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new Si(0,0,0),new Si(0,0,1),new Si(1,0,0),new Si(0,1,0)]}}),mB=yB))||mB)||mB)||mB)||mB));ZB||(ZB=t("SimplexCollider",{}));var JB,QB,$B,tI,eI,iI,rI,nI,sI,aI,oI,lI,hI,uI,cI,pI,dI,fI,_I,gI,mI,yI,vI,bI,SI,TI,AI,EI,CI,RI=t("PlaneCollider",(AB=Ze("cc.PlaneCollider"),EB=ai(),CB=oi(),RB=si(Si),wB=li(),xB=li(),AB(OB=EB(OB=CB(OB=vi((BB=function(t){function e(){var e;return e=t.call(this,_O.PLANE)||this,$e(e,"_normal",DB,ti(e)),$e(e,"_constant",MB,ti(e)),e}return Me(e,t),Be(e,[{key:"normal",get:function(){return this._normal},set:function(t){Si.copy(this._normal,t),this.shape.setNormal(this._normal)}},{key:"constant",get:function(){return this._constant},set:function(t){this._constant=t,this.shape.setConstant(this._constant)}},{key:"shape",get:function(){return this._shape}}]),e}(fD),je((PB=BB).prototype,"normal",[RB,wB],Object.getOwnPropertyDescriptor(PB.prototype,"normal"),PB.prototype),je(PB.prototype,"constant",[yr,xB],Object.getOwnPropertyDescriptor(PB.prototype,"constant"),PB.prototype),DB=je(PB.prototype,"_normal",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si(0,1,0)}}),MB=je(PB.prototype,"_constant",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),OB=PB))||OB)||OB)||OB)||OB)),wI=t("Constraint",(JB=Ze("cc.Constraint"),QB=xi(nD),$B=si(nD),tI=Ri(),eI=si(nD),iI=Ri(),rI=Ri(),nI=si(nD),JB(sI=QB((uI=hI=function(t){function e(e){var i;return(i=t.call(this)||this).TYPE=void 0,$e(i,"_enableCollision",oI,ti(i)),$e(i,"_connectedBody",lI,ti(i)),i._constraint=null,i.TYPE=e,i}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._constraint=function(t){return UO.INITED||(UO.INITED=!0,UO[gO.POINT_TO_POINT]=function(){return xO(yO.wrapper.PointToPointConstraint,CO.PointToPointConstraint)?zO:new yO.wrapper.PointToPointConstraint},UO[gO.HINGE]=function(){return xO(yO.wrapper.HingeConstraint,CO.HingeConstraint)?zO:new yO.wrapper.HingeConstraint},UO[gO.CONE_TWIST]=function(){return xO(yO.wrapper.ConeTwistConstraint,CO.ConeTwistConstraint)?zO:new yO.wrapper.ConeTwistConstraint}),UO[t]()}(this.TYPE),this._constraint.initialize(this)},i.onEnable=function(){this._constraint&&this._constraint.onEnable()},i.onDisable=function(){this._constraint&&this._constraint.onDisable()},i.onDestroy=function(){this._constraint&&this._constraint.onDestroy()},Be(e,[{key:"attachedBody",get:function(){return this.getComponent(nD)}},{key:"connectedBody",get:function(){return this._connectedBody},set:function(t){this._connectedBody=t,this._constraint&&this._constraint.setConnectedBody(t)}},{key:"enableCollision",get:function(){return this._enableCollision},set:function(t){this._enableCollision=t,this._constraint&&this._constraint.setEnableCollision(t)}}]),e}(mn(ui)),hI.Type=gO,je((aI=uI).prototype,"attachedBody",[$B,yn,tI],Object.getOwnPropertyDescriptor(aI.prototype,"attachedBody"),aI.prototype),je(aI.prototype,"connectedBody",[eI,iI],Object.getOwnPropertyDescriptor(aI.prototype,"connectedBody"),aI.prototype),je(aI.prototype,"enableCollision",[rI],Object.getOwnPropertyDescriptor(aI.prototype,"enableCollision"),aI.prototype),oI=je(aI.prototype,"_enableCollision",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lI=je(aI.prototype,"_connectedBody",[nI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sI=aI))||sI)||sI));wI||(wI=t("Constraint",{}));var xI,OI,PI,DI,MI,BI,II,LI,FI,kI,NI=t("HingeConstraint",(cI=Ze("cc.HingeConstraint"),pI=ai(),dI=oi(),fI=si(Si),_I=si(Si),gI=si(Si),mI=mr("axisA"),yI=mr("pivotA"),vI=mr("pivotB"),cI(bI=pI(bI=dI((CI=function(t){function e(){var e;return e=t.call(this,gO.HINGE)||this,$e(e,"_axis",TI,ti(e)),$e(e,"_pivotA",AI,ti(e)),$e(e,"_pivotB",EI,ti(e)),e}return Me(e,t),Be(e,[{key:"pivotA",get:function(){return this._pivotA},set:function(t){Si.copy(this._pivotA,t),this.constraint.setPivotA(this._pivotA)}},{key:"pivotB",get:function(){return this._pivotB},set:function(t){Si.copy(this._pivotB,t),this.constraint.setPivotB(this._pivotB)}},{key:"axis",get:function(){return this._axis},set:function(t){Si.copy(this._axis,t),this.constraint.setAxis(this._axis)}},{key:"constraint",get:function(){return this._constraint}}]),e}(wI),je((SI=CI).prototype,"pivotA",[fI],Object.getOwnPropertyDescriptor(SI.prototype,"pivotA"),SI.prototype),je(SI.prototype,"pivotB",[_I],Object.getOwnPropertyDescriptor(SI.prototype,"pivotB"),SI.prototype),je(SI.prototype,"axis",[gI],Object.getOwnPropertyDescriptor(SI.prototype,"axis"),SI.prototype),TI=je(SI.prototype,"_axis",[ei,mI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),AI=je(SI.prototype,"_pivotA",[ei,yI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),EI=je(SI.prototype,"_pivotB",[ei,vI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),bI=SI))||bI)||bI)||bI)),GI=t("PointToPointConstraint",(xI=Ze("cc.PointToPointConstraint"),OI=ai(),PI=oi(),DI=si(Si),MI=si(Si),xI(BI=OI(BI=PI((kI=function(t){function e(){var e;return e=t.call(this,gO.POINT_TO_POINT)||this,$e(e,"_pivotA",LI,ti(e)),$e(e,"_pivotB",FI,ti(e)),e}return Me(e,t),Be(e,[{key:"pivotA",get:function(){return this._pivotA},set:function(t){Si.copy(this._pivotA,t),this.constraint.setPivotA(this._pivotA)}},{key:"pivotB",get:function(){return this._pivotB},set:function(t){Si.copy(this._pivotB,t),this.constraint.setPivotB(this._pivotB)}},{key:"constraint",get:function(){return this._constraint}}]),e}(wI),je((II=kI).prototype,"pivotA",[DI],Object.getOwnPropertyDescriptor(II.prototype,"pivotA"),II.prototype),je(II.prototype,"pivotB",[MI],Object.getOwnPropertyDescriptor(II.prototype,"pivotB"),II.prototype),LI=je(II.prototype,"_pivotA",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),FI=je(II.prototype,"_pivotB",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Si}}),BI=II))||BI)||BI)||BI)),UI=(new Si,new Si,new Si,new Si,new Si,new Si,new Si,new Si,new Si,new Si,new Si,new Si,new Si(0,0,0)),zI=new Si(0,0,0);new Si(0,0,0),new Si(0,0,0),new Si(0,0,0),new Si(0,0,0),new Si(0,0,0),new Si(0,0,0),new Si(0,0,0),new Si(0,0,0),new Si(0,0,0);var VI=new Si,HI=Object.freeze({__proto__:null,setWrap:function(t,e){t.__cc_wrapper__=e},getWrap:function(t){return t.__cc_wrapper__},maxComponent:function(t){return Math.max(t.x,Math.max(t.y,t.z))},VEC3_0:VI,TriggerEventObject:{type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:null},CollisionEventObject:{type:"onCollisionEnter",selfCollider:null,otherCollider:null,contacts:[],impl:null},shrinkPositions:function(t){var e=[];if(t.length>=3){e[0]=t[0],e[1]=t[1],e[2]=t[2];for(var i=t.length,r=3;r<i;r+=3){for(var n=t[r],s=t[r+1],a=t[r+2],o=e.length,l=!0,h=0;h<o;h+=3)if(gn(n,e[h])&&gn(s,e[h+1])&&gn(a,e[h+2])){l=!1;break}l&&(e.push(n),e.push(s),e.push(a))}}return e},cylinder:function(t,e,i,r){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=2),void 0===r&&(r={});var n=.5*i,s=r.radialSegments||32,a=r.heightSegments||1,o=void 0===r.capped||r.capped,l=r.arc||2*Math.PI,h=0;o||(t>0&&h++,e>0&&h++);var u=(s+1)*(a+1);o&&(u+=(s+1)*h+s*h);var c=s*a*6;o&&(c+=s*h*3);var p=new Array(c),d=new Array(3*u),f=new Array(3*u),_=new Array(2*u),g=Math.max(t,e),m=new Si(-g,-n,-g),y=new Si(g,n,g),v=Math.sqrt(g*g+n*n),b=0,S=0;return function(){for(var r=[],o=t-e,h=o*o/i*Math.sign(o),u=0;u<=a;u++){for(var c=[],g=u/a,m=g*o+e,y=0;y<=s;++y){var v=y/s,T=v*l,A=Math.sin(T),E=Math.cos(T);d[3*b]=m*A,d[3*b+1]=g*i-n,d[3*b+2]=m*E,Si.normalize(UI,Si.set(zI,A,-h,E)),f[3*b]=UI.x,f[3*b+1]=UI.y,f[3*b+2]=UI.z,_[2*b]=2*(1-v)%1,_[2*b+1]=g,c.push(b),++b}r.push(c)}for(var C=0;C<a;++C)for(var R=0;R<s;++R){var w=r[C][R],x=r[C+1][R],O=r[C+1][R+1],P=r[C][R+1];p[S]=w,++S,p[S]=P,++S,p[S]=x,++S,p[S]=P,++S,p[S]=O,++S,p[S]=x,++S}}(),o&&(e>0&&T(!1),t>0&&T(!0)),{positions:d,normals:f,uvs:_,indices:p,minPos:m,maxPos:y,boundingRadius:v};function T(i){for(var r=i?t:e,a=i?1:-1,o=b,h=1;h<=s;++h)d[3*b]=0,d[3*b+1]=n*a,d[3*b+2]=0,f[3*b]=0,f[3*b+1]=a,f[3*b+2]=0,_[2*b]=.5,_[2*b+1]=.5,++b;for(var u=b,c=0;c<=s;++c){var g=c/s*l,m=Math.cos(g),y=Math.sin(g);d[3*b]=r*y,d[3*b+1]=n*a,d[3*b+2]=r*m,f[3*b]=0,f[3*b+1]=a,f[3*b+2]=0,_[2*b]=.5-.5*y*a,_[2*b+1]=.5+.5*m,++b}for(var v=0;v<s;++v){var T=o+v,A=u+v;i?(p[S]=A+1,++S,p[S]=T,++S,p[S]=A,++S):(p[S]=T,++S,p[S]=A+1,++S,p[S]=A,++S)}}}});Xe.PhysicsSystem=LP,Xe.PhysicsMaterial=VO,Xe.PhysicsRayResult=HO,Xe.ConstantForce=UB;var WI,XI,YI,jI,KI,qI,ZI,JI,QI,$I=Object.freeze({__proto__:null,PhysicsSystem:LP,PhysicsRayResult:HO,get Collider(){return fD},BoxCollider:IB,SphereCollider:LB,CapsuleCollider:FB,MeshCollider:GB,CylinderCollider:kB,ConeCollider:NB,TerrainCollider:qB,get SimplexCollider(){return ZB},PlaneCollider:RI,get Constraint(){return wI},HingeConstraint:NI,PointToPointConstraint:GI,get RigidBody(){return nD},PhysicsMaterial:VO,ConstantForce:UB,selector:yO,utils:HI,get ERigidBodyType(){return pO},get EAxisDirection(){return dO},get ESimplexType(){return fO},get EColliderType(){return _O},get EConstraintType(){return gO},get PhysicsGroup(){return mO}});t("physics",$I),ci(LP,"PhysicsSystem",[{name:"ins",newName:"instance"}]),ci(LP.prototype,"PhysicsSystem.prototype",[{name:"deltaTime",newName:"fixedTimeStep"},{name:"maxSubStep",newName:"maxSubSteps"}]),zi(LP.prototype,"PhysicsSystem.prototype",[{name:"useFixedTime"},{name:"useCollisionMatrix"},{name:"updateCollisionMatrix"},{name:"resetCollisionMatrix"},{name:"isCollisionGroup"},{name:"setCollisionGroup"}]),ci(fD.prototype,"Collider.prototype",[{name:"attachedRigidbody",newName:"attachedRigidBody"},{name:"TYPE",newName:"type"}]),ci(fD,"Collider",[{name:"EColliderType",newName:"Type"},{name:"EAxisDirection",newName:"Axis"}]),ci(wI,"Constraint",[{name:"EConstraintType",newName:"Type"}]),ci(IB.prototype,"BoxCollider.prototype",[{name:"boxShape",newName:"shape"}]),ci(LB.prototype,"SphereCollider.prototype",[{name:"sphereShape",newName:"shape"}]),ci(FB.prototype,"CapsuleCollider.prototype",[{name:"capsuleShape",newName:"shape"}]),ci(nD.prototype,"RigidBody.prototype",[{name:"rigidBody",newName:"body"}]),ci(nD,"RigidBody",[{name:"ERigidBodyType",newName:"Type"}]),zi(nD.prototype,"RigidBody.prototype",[{name:"fixedRotation"}]),Xe.RigidBodyComponent=nD,di.setClassAlias(nD,"cc.RigidBodyComponent"),Xe.ColliderComponent=fD,di.setClassAlias(fD,"cc.ColliderComponent"),Xe.BoxColliderComponent=IB,di.setClassAlias(IB,"cc.BoxColliderComponent"),Xe.SphereColliderComponent=LB,di.setClassAlias(LB,"cc.SphereColliderComponent"),di.setClassAlias(FB,"cc.CapsuleColliderComponent"),di.setClassAlias(GB,"cc.MeshColliderComponent"),di.setClassAlias(kB,"cc.CylinderColliderComponent"),Xe.PhysicMaterial=VO,di.setClassAlias(VO,"cc.PhysicMaterial"),Xe.physics=$I,function(t){t[t.BODY_RE_ADD=1]="BODY_RE_ADD",t[t.GHOST_RE_ADD=2]="GHOST_RE_ADD"}(WI||(WI={})),function(t){t[t.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",t[t.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",t[t.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",t[t.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",t[t.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",t[t.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",t[t.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING"}(XI||(XI={})),_n.AmmoCollisionFlags=XI,function(t){t[t.CO_COLLISION_OBJECT=1]="CO_COLLISION_OBJECT",t[t.CO_RIGID_BODY=2]="CO_RIGID_BODY",t[t.CO_GHOST_OBJECT=4]="CO_GHOST_OBJECT",t[t.CO_SOFT_BODY=8]="CO_SOFT_BODY",t[t.CO_HF_FLUID=16]="CO_HF_FLUID",t[t.CO_USER_TYPE=32]="CO_USER_TYPE",t[t.CO_FEATHERSTONE_LINK=64]="CO_FEATHERSTONE_LINK"}(YI||(YI={})),_n.AmmoCollisionObjectTypes=YI,function(t){t[t.ACTIVE_TAG=1]="ACTIVE_TAG",t[t.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",t[t.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",t[t.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",t[t.DISABLE_SIMULATION=5]="DISABLE_SIMULATION"}(jI||(jI={})),function(t){t[t.CF_ANISOTROPIC_FRICTION_DISABLED=0]="CF_ANISOTROPIC_FRICTION_DISABLED",t[t.CF_ANISOTROPIC_FRICTION=1]="CF_ANISOTROPIC_FRICTION",t[t.CF_ANISOTROPIC_ROLLING_FRICTION=2]="CF_ANISOTROPIC_ROLLING_FRICTION"}(KI||(KI={})),_n.AmmoAnisotropicFrictionFlags=KI,function(t){t[t.BT_DISABLE_WORLD_GRAVITY=1]="BT_DISABLE_WORLD_GRAVITY",t[t.BT_ENABLE_GYROPSCOPIC_FORCE=2]="BT_ENABLE_GYROPSCOPIC_FORCE"}(qI||(qI={})),_n.AmmoRigidBodyFlags=qI,function(t){t[t.BOX_SHAPE_PROXYTYPE=0]="BOX_SHAPE_PROXYTYPE",t[t.TRIANGLE_SHAPE_PROXYTYPE=1]="TRIANGLE_SHAPE_PROXYTYPE",t[t.TETRAHEDRAL_SHAPE_PROXYTYPE=2]="TETRAHEDRAL_SHAPE_PROXYTYPE",t[t.CONVEX_TRIANGLEMESH_SHAPE_PROXYTYPE=3]="CONVEX_TRIANGLEMESH_SHAPE_PROXYTYPE",t[t.CONVEX_HULL_SHAPE_PROXYTYPE=4]="CONVEX_HULL_SHAPE_PROXYTYPE",t[t.CONVEX_POINT_CLOUD_SHAPE_PROXYTYPE=5]="CONVEX_POINT_CLOUD_SHAPE_PROXYTYPE",t[t.CUSTOM_POLYHEDRAL_SHAPE_TYPE=6]="CUSTOM_POLYHEDRAL_SHAPE_TYPE",t[t.IMPLICIT_CONVEX_SHAPES_START_HERE=7]="IMPLICIT_CONVEX_SHAPES_START_HERE",t[t.SPHERE_SHAPE_PROXYTYPE=8]="SPHERE_SHAPE_PROXYTYPE",t[t.MULTI_SPHERE_SHAPE_PROXYTYPE=9]="MULTI_SPHERE_SHAPE_PROXYTYPE",t[t.CAPSULE_SHAPE_PROXYTYPE=10]="CAPSULE_SHAPE_PROXYTYPE",t[t.CONE_SHAPE_PROXYTYPE=11]="CONE_SHAPE_PROXYTYPE",t[t.CONVEX_SHAPE_PROXYTYPE=12]="CONVEX_SHAPE_PROXYTYPE",t[t.CYLINDER_SHAPE_PROXYTYPE=13]="CYLINDER_SHAPE_PROXYTYPE",t[t.UNIFORM_SCALING_SHAPE_PROXYTYPE=14]="UNIFORM_SCALING_SHAPE_PROXYTYPE",t[t.MINKOWSKI_SUM_SHAPE_PROXYTYPE=15]="MINKOWSKI_SUM_SHAPE_PROXYTYPE",t[t.MINKOWSKI_DIFFERENCE_SHAPE_PROXYTYPE=16]="MINKOWSKI_DIFFERENCE_SHAPE_PROXYTYPE",t[t.BOX_2D_SHAPE_PROXYTYPE=17]="BOX_2D_SHAPE_PROXYTYPE",t[t.CONVEX_2D_SHAPE_PROXYTYPE=18]="CONVEX_2D_SHAPE_PROXYTYPE",t[t.CUSTOM_CONVEX_SHAPE_TYPE=19]="CUSTOM_CONVEX_SHAPE_TYPE",t[t.CONCAVE_SHAPES_START_HERE=20]="CONCAVE_SHAPES_START_HERE",t[t.TRIANGLE_MESH_SHAPE_PROXYTYPE=21]="TRIANGLE_MESH_SHAPE_PROXYTYPE",t[t.SCALED_TRIANGLE_MESH_SHAPE_PROXYTYPE=22]="SCALED_TRIANGLE_MESH_SHAPE_PROXYTYPE",t[t.FAST_CONCAVE_MESH_PROXYTYPE=23]="FAST_CONCAVE_MESH_PROXYTYPE",t[t.TERRAIN_SHAPE_PROXYTYPE=24]="TERRAIN_SHAPE_PROXYTYPE",t[t.GIMPACT_SHAPE_PROXYTYPE=25]="GIMPACT_SHAPE_PROXYTYPE",t[t.MULTIMATERIAL_TRIANGLE_MESH_PROXYTYPE=26]="MULTIMATERIAL_TRIANGLE_MESH_PROXYTYPE",t[t.EMPTY_SHAPE_PROXYTYPE=27]="EMPTY_SHAPE_PROXYTYPE",t[t.STATIC_PLANE_PROXYTYPE=28]="STATIC_PLANE_PROXYTYPE",t[t.CUSTOM_CONCAVE_SHAPE_TYPE=29]="CUSTOM_CONCAVE_SHAPE_TYPE",t[t.CONCAVE_SHAPES_END_HERE=30]="CONCAVE_SHAPES_END_HERE",t[t.COMPOUND_SHAPE_PROXYTYPE=31]="COMPOUND_SHAPE_PROXYTYPE",t[t.SOFTBODY_SHAPE_PROXYTYPE=32]="SOFTBODY_SHAPE_PROXYTYPE",t[t.HFFLUID_SHAPE_PROXYTYPE=33]="HFFLUID_SHAPE_PROXYTYPE",t[t.HFFLUID_BUOYANT_CONVEX_SHAPE_PROXYTYPE=34]="HFFLUID_BUOYANT_CONVEX_SHAPE_PROXYTYPE",t[t.INVALID_SHAPE_PROXYTYPE=35]="INVALID_SHAPE_PROXYTYPE",t[t.MAX_BROADPHASE_COLLISION_TYPES=36]="MAX_BROADPHASE_COLLISION_TYPES"}(ZI||(ZI={})),_n.AmmoBroadphaseNativeTypes=ZI,function(t){t[t.DefaultFilter=1]="DefaultFilter",t[t.StaticFilter=2]="StaticFilter",t[t.KinematicFilter=4]="KinematicFilter",t[t.DebrisFilter=8]="DebrisFilter",t[t.SensorTrigger=16]="SensorTrigger",t[t.CharacterFilter=32]="CharacterFilter",t[t.AllFilter=-1]="AllFilter"}(JI||(JI={})),_n.AmmoCollisionFilterGroups=JI,function(t){t[t.CD_STATIC_STATIC_REPORTED=1]="CD_STATIC_STATIC_REPORTED",t[t.CD_USE_RELATIVE_CONTACT_BREAKING_THRESHOLD=2]="CD_USE_RELATIVE_CONTACT_BREAKING_THRESHOLD",t[t.CD_DISABLE_CONTACTPOOL_DYNAMIC_ALLOCATION=4]="CD_DISABLE_CONTACTPOOL_DYNAMIC_ALLOCATION"}(QI||(QI={})),_n.AmmoDispatcherFlags=QI;var tL={type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:null},eL={type:"onCollisionEnter",selfCollider:null,otherCollider:null,contacts:[],impl:null},iL=function(){function t(){this.EMPTY_SHAPE=new _n.btEmptyShape,this.TRANSFORM=new _n.btTransform,this.TRANSFORM_1=new _n.btTransform,this.VECTOR3_0=new _n.btVector3,this.VECTOR3_1=new _n.btVector3,this.QUAT_0=new _n.btQuaternion}return Be(t,null,[{key:"instance",get:function(){return null==t._instance&&(t._instance=new t),t._instance}}]),t}();iL._instance=void 0;var rL=new Si,nL=new Si,sL=new ur,aL=rL,oL=nL,lL=function(){var t=e.prototype;function e(){this.id=void 0,this._isEnabled=!1,this.id=e.idCounter++}return t.setMass=function(t){if(this._rigidBody.isDynamic){var e=this._sharedBody.bodyStruct.localInertia;e.setValue(1.6666666269302368,1.6666666269302368,1.6666666269302368);var i=this.impl.getCollisionShape();i.isCompound()?this._sharedBody.bodyCompoundShape.getNumChildShapes()>0&&i.calculateLocalInertia(this._rigidBody.mass,e):i.calculateLocalInertia(this._rigidBody.mass,e),this.impl.setMassProps(t,e),this._wakeUpIfSleep(),this._sharedBody.dirty|=WI.BODY_RE_ADD}},t.setType=function(t){this._sharedBody.setType(t)},t.setLinearDamping=function(){this.impl.setDamping(this._rigidBody.linearDamping,this._rigidBody.angularDamping)},t.setAngularDamping=function(){this.impl.setDamping(this._rigidBody.linearDamping,this._rigidBody.angularDamping)},t.useGravity=function(t){if(this._rigidBody.isDynamic){var e=this.impl.getFlags();t?e&=~qI.BT_DISABLE_WORLD_GRAVITY:(this.impl.setGravity(vO(iL.instance.VECTOR3_0,Si.ZERO)),e|=qI.BT_DISABLE_WORLD_GRAVITY),this.impl.setFlags(e),this._wakeUpIfSleep(),this._sharedBody.dirty|=WI.BODY_RE_ADD}},t.setLinearFactor=function(t){this.impl.setLinearFactor(vO(iL.instance.VECTOR3_0,t)),this._wakeUpIfSleep()},t.setAngularFactor=function(t){this.impl.setAngularFactor(vO(iL.instance.VECTOR3_0,t)),this._wakeUpIfSleep()},t.setAllowSleep=function(t){this._rigidBody.isDynamic&&(t?this.impl.forceActivationState(jI.ACTIVE_TAG):this.impl.forceActivationState(jI.DISABLE_DEACTIVATION),this._wakeUpIfSleep())},t.clearState=function(){this.impl.clearState()},t.clearVelocity=function(){this.setLinearVelocity(Si.ZERO),this.setAngularVelocity(Si.ZERO)},t.clearForces=function(){this.impl.clearForces()},t.initialize=function(t){this._rigidBody=t,this._sharedBody=LP.instance.physicsWorld.getSharedBody(this._rigidBody.node,this),this._sharedBody.reference=!0},t.onEnable=function(){this._isEnabled=!0,this.setMass(this._rigidBody.mass),this.setAllowSleep(this._rigidBody.allowSleep),this.setLinearDamping(this._rigidBody.linearDamping),this.setAngularDamping(this._rigidBody.angularDamping),this.setLinearFactor(this._rigidBody.linearFactor),this.setAngularFactor(this._rigidBody.angularFactor),this.useGravity(this._rigidBody.useGravity),this._sharedBody.bodyEnabled=!0},t.onDisable=function(){this._isEnabled=!1,this._sharedBody.bodyEnabled=!1},t.onDestroy=function(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null},t.wakeUp=function(t){void 0===t&&(t=!0),this.impl.activate(t)},t.sleep=function(){return this.impl.wantsSleeping()},t.setSleepThreshold=function(t){this._wakeUpIfSleep(),this.impl.setSleepingThresholds(t,t)},t.getSleepThreshold=function(){return this.impl.getLinearSleepingThreshold()},t.getLinearVelocity=function(t){return bO(t,this.impl.getLinearVelocity())},t.setLinearVelocity=function(t){this._wakeUpIfSleep(),vO(this.impl.getLinearVelocity(),t)},t.getAngularVelocity=function(t){return bO(t,this.impl.getAngularVelocity())},t.setAngularVelocity=function(t){this._wakeUpIfSleep(),vO(this.impl.getAngularVelocity(),t)},t.applyLocalForce=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();var i=this._sharedBody.node.worldRotation,r=Si.transformQuat(aL,t,i),n=e?Si.transformQuat(oL,e,i):Si.ZERO;this.impl.applyForce(vO(iL.instance.VECTOR3_0,r),vO(iL.instance.VECTOR3_1,n))},t.applyLocalTorque=function(t){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),Si.transformQuat(aL,t,this._sharedBody.node.worldRotation),this.impl.applyTorque(vO(iL.instance.VECTOR3_0,aL))},t.applyLocalImpulse=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();var i=this._sharedBody.node.worldRotation,r=Si.transformQuat(aL,t,i),n=e?Si.transformQuat(oL,e,i):Si.ZERO;this.impl.applyImpulse(vO(iL.instance.VECTOR3_0,r),vO(iL.instance.VECTOR3_1,n))},t.applyForce=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();var i=e||Si.ZERO;this.impl.applyForce(vO(iL.instance.VECTOR3_0,t),vO(iL.instance.VECTOR3_1,i))},t.applyTorque=function(t){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),this.impl.applyTorque(vO(iL.instance.VECTOR3_0,t))},t.applyImpulse=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();var i=e||Si.ZERO;this.impl.applyImpulse(vO(iL.instance.VECTOR3_0,t),vO(iL.instance.VECTOR3_1,i))},t.getGroup=function(){return this._sharedBody.collisionFilterGroup},t.setGroup=function(t){this._sharedBody.collisionFilterGroup=t},t.addGroup=function(t){this._sharedBody.collisionFilterGroup|=t},t.removeGroup=function(t){this._sharedBody.collisionFilterGroup&=~t},t.getMask=function(){return this._sharedBody.collisionFilterMask},t.setMask=function(t){this._sharedBody.collisionFilterMask=t},t.addMask=function(t){this._sharedBody.collisionFilterMask|=t},t.removeMask=function(t){this._sharedBody.collisionFilterMask&=~t},t._wakeUpIfSleep=function(){this.isAwake||this.impl.activate(!0)},Be(e,[{key:"isAwake",get:function(){var t=this.impl.getActivationState();return t===jI.ACTIVE_TAG||t===jI.DISABLE_DEACTIVATION}},{key:"isSleepy",get:function(){return this.impl.getActivationState()===jI.WANTS_DEACTIVATION}},{key:"isSleeping",get:function(){return this.impl.getActivationState()===jI.ISLAND_SLEEPING}},{key:"isEnabled",get:function(){return this._isEnabled}},{key:"impl",get:function(){return this._sharedBody.body}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"sharedBody",get:function(){return this._sharedBody}}]),e}();lL.idCounter=0;var hL=function(){function t(){}return Be(t,null,[{key:"bodyStructs",get:function(){return this.bodyAndGhosts}},{key:"ghostStructs",get:function(){return this.bodyAndGhosts}}]),t}();hL.bodyAndGhosts={};var uL=rL,cL=sL,pL=0,dL=function(){function t(e,i){this.id=void 0,this.node=void 0,this.wrappedWorld=void 0,this.wrappedJoints0=[],this.wrappedJoints1=[],this.dirty=0,this._collisionFilterGroup=LP.PhysicsGroup.DEFAULT,this._collisionFilterMask=-1,this.ref=0,this.bodyIndex=-1,this.ghostIndex=-1,this._wrappedBody=null,this.id=t.idCounter++,this.wrappedWorld=i,this.node=e}t.getSharedBody=function(e,i,r){var n,s=e.uuid;if(t.sharedBodesMap.has(s))n=t.sharedBodesMap.get(s);else{n=new t(e,i);var a=mO.DEFAULT,o=LP.instance.collisionMatrix[a];n._collisionFilterGroup=a,n._collisionFilterMask=o,t.sharedBodesMap.set(e.uuid,n)}if(r){n._wrappedBody=r;var l=r.rigidBody._group,h=LP.instance.collisionMatrix[l];n._collisionFilterGroup=l,n._collisionFilterMask=h}return n};var e=t.prototype;return e._instantiateBodyStruct=function(){if(!this._bodyStruct){var t=new _n.btTransform;t.setIdentity(),vO(t.getOrigin(),this.node.worldPosition);var e=new _n.btQuaternion;SO(e,this.node.worldRotation),t.setRotation(e);var i=new _n.btDefaultMotionState(t),r=new _n.btVector3(1.6666666269302368,1.6666666269302368,1.6666666269302368),n=new _n.btCompoundShape,s=0;this._wrappedBody&&this._wrappedBody.rigidBody.enabled&&this._wrappedBody.rigidBody.isDynamic&&(s=this._wrappedBody.rigidBody.mass),0===s&&r.setValue(0,0,0);var a=new _n.btRigidBodyConstructionInfo(s,i,iL.instance.EMPTY_SHAPE,r),o=new _n.btRigidBody(a),l=LP.instance.sleepThreshold;o.setSleepingThresholds(l,l),this._bodyStruct={id:pL++,body:o,localInertia:r,motionState:i,startTransform:t,shape:n,rbInfo:a,worldQuat:e,wrappedShapes:[],useCompound:!1},hL.bodyStructs[this._bodyStruct.id]=this._bodyStruct,this.body.setUserIndex2(2),this.body.setUserIndex(this._bodyStruct.id),_n.CC_CONFIG.ignoreSelfBody&&this._ghostStruct&&this.ghost.setIgnoreCollisionCheck(this.body,!0),this.wrappedBody&&this.setBodyType(this.wrappedBody.rigidBody.type)}},e._instantiateGhostStruct=function(){if(!this._ghostStruct){var t=new _n.btCollisionObject,e=new _n.btCompoundShape;t.setCollisionShape(e),t.setCollisionFlags(XI.CF_STATIC_OBJECT|XI.CF_NO_CONTACT_RESPONSE),this._ghostStruct={id:pL++,ghost:t,shape:e,worldQuat:new _n.btQuaternion,wrappedShapes:[]},hL.ghostStructs[this._ghostStruct.id]=this._ghostStruct,this.ghost.setUserIndex2(2),this.ghost.setUserIndex(this._ghostStruct.id),_n.CC_CONFIG.ignoreSelfBody&&this._bodyStruct&&this.ghost.setIgnoreCollisionCheck(this.body,!0),this.wrappedBody&&this.setGhostType(this.wrappedBody.rigidBody.type)}},e.setType=function(t){this.setBodyType(t),this.setGhostType(t)},e.setBodyType=function(t){if(this._bodyStruct&&this._wrappedBody){var e=this._bodyStruct.body,i=this._wrappedBody,r=i.rigidBody,n=e.getCollisionFlags(),s=iL.instance.VECTOR3_0;switch(t){case pO.DYNAMIC:n&=~XI.CF_KINEMATIC_OBJECT,n&=~XI.CF_STATIC_OBJECT,e.setCollisionFlags(n),i.setMass(r.mass),i.useGravity(r.useGravity),i.setAllowSleep(r.allowSleep);break;case pO.KINEMATIC:s.setValue(0,0,0),e.setMassProps(0,s),n|=XI.CF_KINEMATIC_OBJECT,n&=~XI.CF_STATIC_OBJECT,e.setCollisionFlags(n),e.forceActivationState(jI.DISABLE_DEACTIVATION);break;case pO.STATIC:default:s.setValue(0,0,0),e.setMassProps(0,s),n|=XI.CF_STATIC_OBJECT,n&=~XI.CF_KINEMATIC_OBJECT,e.setCollisionFlags(n),e.forceActivationState(jI.ISLAND_SLEEPING)}this.dirty|=WI.BODY_RE_ADD}},e.setGhostType=function(t){if(this._ghostStruct){var e=this._ghostStruct.ghost,i=e.getCollisionFlags();switch(t){case pO.DYNAMIC:case pO.KINEMATIC:i&=~XI.CF_STATIC_OBJECT,i|=XI.CF_KINEMATIC_OBJECT,e.setCollisionFlags(i),e.forceActivationState(jI.DISABLE_DEACTIVATION);break;case pO.STATIC:default:i&=~XI.CF_KINEMATIC_OBJECT,i|=XI.CF_STATIC_OBJECT,e.setCollisionFlags(i),e.forceActivationState(jI.ISLAND_SLEEPING)}this.dirty|=WI.GHOST_RE_ADD}},e.addShape=function(t,e){function i(t,e){t.body.setCollisionShape(e),t.dirty|=WI.BODY_RE_ADD,t._wrappedBody&&t._wrappedBody.isEnabled&&t._wrappedBody.setMass(t._wrappedBody.rigidBody.mass)}if(e)this.ghostStruct.wrappedShapes.indexOf(t)<0&&(this.ghostStruct.wrappedShapes.push(t),t.setCompound(this.ghostCompoundShape),this.ghostEnabled=!0);else if(this.bodyStruct.wrappedShapes.indexOf(t)<0){if(this.bodyStruct.wrappedShapes.push(t),this.bodyStruct.useCompound)t.setCompound(this.bodyCompoundShape);else{var r=this.bodyStruct.wrappedShapes.length;if(1!==r||t.needCompound()){this.bodyStruct.useCompound=!0;for(var n=0;n<r;n++)this.bodyStruct.wrappedShapes[n].setCompound(this.bodyCompoundShape);i(this,this.bodyStruct.shape)}else i(this,t.impl)}this.bodyEnabled=!0}},e.removeShape=function(t,e){if(e){var i=this.ghostStruct.wrappedShapes.indexOf(t);i>=0&&(ni(this.ghostStruct.wrappedShapes,i),t.setCompound(null),this.ghostEnabled=!1)}else{var r=this.bodyStruct.wrappedShapes.indexOf(t);r>=0&&(this.bodyStruct.useCompound?t.setCompound(null):this.body.setCollisionShape(iL.instance.EMPTY_SHAPE),this.body.activate(!0),this.dirty|=WI.BODY_RE_ADD,ni(this.bodyStruct.wrappedShapes,r),this.bodyEnabled=!1)}},e.addJoint=function(t,e){e?this.wrappedJoints1.indexOf(t)<0&&this.wrappedJoints1.push(t):this.wrappedJoints0.indexOf(t)<0&&this.wrappedJoints0.push(t)},e.removeJoint=function(t,e){if(e){var i=this.wrappedJoints1.indexOf(t);i>=0&&ni(this.wrappedJoints1,i)}else{var r=this.wrappedJoints0.indexOf(t);r>=0&&ni(this.wrappedJoints0,r)}},e.updateDirty=function(){this.dirty&&(this.bodyIndex>=0&&this.dirty&WI.BODY_RE_ADD&&this.updateBodyByReAdd(),this.ghostIndex>=0&&this.dirty&WI.GHOST_RE_ADD&&this.updateGhostByReAdd(),this.dirty=0)},e.syncSceneToPhysics=function(){if(this.node.hasChangedFlags){var t=this.body.getWorldTransform();if(vO(t.getOrigin(),this.node.worldPosition),SO(this.bodyStruct.worldQuat,this.node.worldRotation),t.setRotation(this.bodyStruct.worldQuat),this.node.hasChangedFlags&vr.SCALE&&this.syncBodyScale(),this.body.isKinematicObject()){var e=this.body.getMotionState();e&&e.setWorldTransform(t)}else this.isBodySleeping()&&this.body.activate()}},e.syncPhysicsToScene=function(){if(!this.body.isStaticOrKinematicObject()&&!this.isBodySleeping()){var t=this.bodyStruct.startTransform;if(this.body.getMotionState().getWorldTransform(t),this.node.worldPosition=bO(uL,t.getOrigin()),t.getBasis().getRotation(this.bodyStruct.worldQuat),this.node.worldRotation=TO(cL,this.bodyStruct.worldQuat),this._ghostStruct){var e=this.ghost.getWorldTransform();vO(e.getOrigin(),this.node.worldPosition),SO(this.ghostStruct.worldQuat,this.node.worldRotation),e.setRotation(this.ghostStruct.worldQuat)}}},e.syncSceneToGhost=function(){if(this.node.hasChangedFlags){var t=this.ghost.getWorldTransform();vO(t.getOrigin(),this.node.worldPosition),SO(this.ghostStruct.worldQuat,this.node.worldRotation),t.setRotation(this.ghostStruct.worldQuat),this.node.hasChangedFlags&vr.SCALE&&this.syncGhostScale(),this.ghost.activate()}},e.syncInitialBody=function(){var t=this.body.getWorldTransform();vO(t.getOrigin(),this.node.worldPosition),SO(this.bodyStruct.worldQuat,this.node.worldRotation),t.setRotation(this.bodyStruct.worldQuat),this.syncBodyScale(),this.body.activate()},e.syncInitialGhost=function(){var t=this.ghost.getWorldTransform();vO(t.getOrigin(),this.node.worldPosition),SO(this.ghostStruct.worldQuat,this.node.worldRotation),t.setRotation(this.ghostStruct.worldQuat),this.syncGhostScale(),this.ghost.activate()},e.syncBodyScale=function(){for(var t=0;t<this.bodyStruct.wrappedShapes.length;t++)this.bodyStruct.wrappedShapes[t].setScale();for(var e=0;e<this.wrappedJoints0.length;e++)this.wrappedJoints0[e].updateScale0();for(var i=0;i<this.wrappedJoints1.length;i++)this.wrappedJoints1[i].updateScale1()},e.syncGhostScale=function(){for(var t=0;t<this.ghostStruct.wrappedShapes.length;t++)this.ghostStruct.wrappedShapes[t].setScale()},e.updateBodyByReAdd=function(){this.bodyIndex>=0&&(this.wrappedWorld.removeSharedBody(this),this.bodyIndex=this.wrappedWorld.bodies.length,this.wrappedWorld.addSharedBody(this))},e.updateGhostByReAdd=function(){this.ghostIndex>=0&&(this.wrappedWorld.removeGhostObject(this),this.ghostIndex=this.wrappedWorld.ghosts.length,this.wrappedWorld.addGhostObject(this))},e.destroy=function(){if(t.sharedBodesMap.delete(this.node.uuid),this.node=null,this.wrappedWorld=null,this._bodyStruct){var e=this._bodyStruct;_n.destroy(e.localInertia),_n.destroy(e.worldQuat),_n.destroy(e.startTransform),_n.destroy(e.motionState),_n.destroy(e.rbInfo),_n.destroy(e.shape),AO(e.shape,_n.btCollisionShape),_n.castObject(e.body,_n.btRigidBody).wrapped=null,AO(e.body,_n.btRigidBody),AO(e.body,_n.btCollisionObject),delete hL.bodyStructs[e.id],this._bodyStruct=null}if(this._ghostStruct){var i=this._ghostStruct;_n.destroy(i.worldQuat),_n.destroy(i.shape),AO(i.shape,_n.btCollisionShape),_n.destroy(i.ghost),delete hL.bodyStructs[i.id],this._ghostStruct=null}},e.isBodySleeping=function(){return this.body.getActivationState()===jI.ISLAND_SLEEPING},Be(t,[{key:"wrappedBody",get:function(){return this._wrappedBody}},{key:"bodyCompoundShape",get:function(){return this.bodyStruct.shape}},{key:"ghostCompoundShape",get:function(){return this.ghostStruct.shape}},{key:"body",get:function(){return this.bodyStruct.body}},{key:"ghost",get:function(){return this.ghostStruct.ghost}},{key:"collisionFilterGroup",get:function(){return this._collisionFilterGroup},set:function(t){t!==this._collisionFilterGroup&&(this._collisionFilterGroup=t,this.dirty|=WI.BODY_RE_ADD,this.dirty|=WI.GHOST_RE_ADD)}},{key:"collisionFilterMask",get:function(){return this._collisionFilterMask},set:function(t){t!==this._collisionFilterMask&&(this._collisionFilterMask=t,this.dirty|=WI.BODY_RE_ADD,this.dirty|=WI.GHOST_RE_ADD)}},{key:"bodyStruct",get:function(){return this._instantiateBodyStruct(),this._bodyStruct}},{key:"ghostStruct",get:function(){return this._instantiateGhostStruct(),this._ghostStruct}},{key:"bodyEnabled",set:function(t){if(t){if(this.bodyIndex<0){if(0===this.bodyStruct.wrappedShapes.length){if(!this.wrappedBody)return;if(!this.wrappedBody.rigidBody.isDynamic)return}this.bodyIndex=this.wrappedWorld.bodies.length,this.wrappedWorld.addSharedBody(this),this.syncInitialBody()}}else this.bodyIndex>=0&&(0===this.bodyStruct.wrappedShapes.length&&null==this.wrappedBody||0===this.bodyStruct.wrappedShapes.length&&null!=this.wrappedBody&&!this.wrappedBody.isEnabled||0===this.bodyStruct.wrappedShapes.length&&null!=this.wrappedBody&&!this.wrappedBody.rigidBody.enabledInHierarchy)&&(this.body.clearState(),this.bodyIndex=-1,this.wrappedWorld.removeSharedBody(this))}},{key:"ghostEnabled",set:function(t){t?this.ghostIndex<0&&this.ghostStruct.wrappedShapes.length>0&&(this.ghostIndex=1,this.wrappedWorld.addGhostObject(this),this.syncInitialGhost()):this.ghostIndex>=0&&0===this.ghostStruct.wrappedShapes.length&&this.ghost&&(this.ghostIndex=-1,this.wrappedWorld.removeGhostObject(this))}},{key:"reference",set:function(t){t?this.ref++:this.ref--,0===this.ref&&this.destroy()}}]),t}();dL.idCounter=0,dL.sharedBodesMap=new Map;var fL=function(){function t(){this.matrix=[]}var e=t.prototype;return e.get=function(t,e){if(e>t){var i=e;e=t,t=i}return this.matrix[(t*(t+1)>>1)+e-1]},e.set=function(t,e,i){if(e>t){var r=e;e=t,t=r}this.matrix[(t*(t+1)>>1)+e-1]=i?1:0},e.reset=function(){this.matrix.length=0},e.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1},t}(),_L=function(){function t(){this.data=void 0,this.data={keys:[]}}var e=t.prototype;return e.get=function(t,e){if(t>e){var i=e;e=t,t=i}return this.data[t+"-"+e]},e.set=function(t,e,i){if(t>e){var r=e;e=t,t=r}var n=t+"-"+e;if(null==i){var s=this.data.keys.indexOf(n);if(-1!==s)return this.data.keys.splice(s,1),delete this.data[n],i}return this.get(t,e)||this.data.keys.push(n),this.data[n]=i,this.data[n]},e.reset=function(){this.data={keys:[]}},e.getLength=function(){return this.data.keys.length},e.getKeyByIndex=function(t){return this.data.keys[t]},e.getDataByKey=function(t){return this.data[t]},t}(),gL=function(){function t(t){this.impl=null,this.event=void 0,this.event=t}var e=t.prototype;return e.getLocalPointOnA=function(t){this.impl&&bO(t,this.impl.m_localPointA)},e.getLocalPointOnB=function(t){this.impl&&bO(t,this.impl.m_localPointB)},e.getWorldPointOnA=function(t){this.impl&&bO(t,this.impl.m_positionWorldOnA)},e.getWorldPointOnB=function(t){this.impl&&bO(t,this.impl.m_positionWorldOnB)},e.getLocalNormalOnA=function(t){if(this.impl){bO(t,this.impl.m_normalWorldOnB),this.isBodyA||Si.negate(t,t);var e=sL,i=iL.instance.QUAT_0;this.event.impl.getBody0().getWorldTransform().getBasis().getRotation(i),TO(e,i),ur.conjugate(e,e),Si.transformQuat(t,t,e)}},e.getLocalNormalOnB=function(t){if(this.impl){var e=sL,i=iL.instance.QUAT_0;this.event.impl.getBody1().getWorldTransform().getBasis().getRotation(i),TO(e,i),ur.conjugate(e,e),bO(t,this.impl.m_normalWorldOnB),Si.transformQuat(t,t,e)}},e.getWorldNormalOnA=function(t){this.impl&&(bO(t,this.impl.m_normalWorldOnB),this.isBodyA||Si.negate(t,t))},e.getWorldNormalOnB=function(t){this.impl&&bO(t,this.impl.m_normalWorldOnB)},Be(t,[{key:"isBodyA",get:function(){var t=this.event.selfCollider.shape.sharedBody.body,e=this.event.impl.getBody0();return Ammo.compare(e,t)}}]),t}(),mL=[],yL=rL,vL=nL,bL=function(){var t=e.prototype;function e(){this._btWorld=void 0,this._btBroadphase=void 0,this._btSolver=void 0,this._btDispatcher=void 0,this._btCollisionConfiguration=void 0,this.bodies=[],this.ghosts=[],this.constraints=[],this.triggerArrayMat=new fL,this.collisionArrayMat=new fL,this.contactsDic=new _L,this.oldContactsDic=new _L,this._btCollisionConfiguration=new _n.btDefaultCollisionConfiguration,this._btDispatcher=new _n.btCollisionDispatcher(this._btCollisionConfiguration),this._btBroadphase=new _n.btDbvtBroadphase,this._btSolver=new _n.btSequentialImpulseConstraintSolver,this._btWorld=new _n.btDiscreteDynamicsWorld(this._btDispatcher,this._btBroadphase,this._btSolver,this._btCollisionConfiguration),this._btWorld.getPairCache().setOverlapFilterCallback(new _n.ccOverlapFilterCallback);var t=iL.instance.VECTOR3_0;t.setValue(0,-10,0),this._btWorld.setGravity(t),e.closeHitCB||(e.closeHitCB=new _n.ClosestRayResultCallback(t,t)),e.allHitsCB||(e.allHitsCB=new _n.AllHitsRayResultCallback(t,t)),e.closeHitCB.setUseCC(!0),e.allHitsCB.setUseCC(!0)}return t.setAllowSleep=function(){},t.setDefaultMaterial=function(){},t.setGravity=function(t){var e=iL.instance.VECTOR3_0;vO(e,t),this._btWorld.setGravity(e)},t.destroy=function(){(this.constraints.length||this.bodies.length)&&Le("You should destroy all physics component first."),_n.destroy(this._btWorld),_n.destroy(this._btSolver),_n.destroy(this._btBroadphase),_n.destroy(this._btDispatcher),_n.destroy(this._btCollisionConfiguration),this._btCollisionConfiguration=null,this._btDispatcher=null,this._btBroadphase=null,this._btSolver=null,this._btWorld=null,this.bodies=null,this.ghosts=null,this.constraints=null,this.triggerArrayMat=null,this.collisionArrayMat=null,this.contactsDic=null,this.oldContactsDic=null,mL.length=0},t.step=function(t,e,i){if(void 0===i&&(i=0),0!==this.bodies.length||0!==this.ghosts.length){void 0===e&&(e=t),this._btWorld.stepSimulation(e,i,t);for(var r=0;r<this.bodies.length;r++)this.bodies[r].syncPhysicsToScene()}},t.syncSceneToPhysics=function(){for(var t=0;t<this.ghosts.length;t++)this.ghosts[t].updateDirty(),this.ghosts[t].syncSceneToGhost();for(var e=0;e<this.bodies.length;e++)this.bodies[e].updateDirty(),this.bodies[e].syncSceneToPhysics()},t.syncAfterEvents=function(){this.syncSceneToPhysics()},t.raycast=function(t,i,r,n){var s=e.allHitsCB,a=vO(s.m_rayFromWorld,t.o);t.computeHit(yL,i.maxDistance);var o=vO(s.m_rayToWorld,yL);s.m_collisionFilterGroup=-1,s.m_collisionFilterMask=i.mask,s.m_closestHitFraction=1,s.m_shapePart=-1,s.m_collisionObject=null,s.m_shapeParts.clear(),s.m_hitFractions.clear(),s.m_collisionObjects.clear();var l=s.m_hitPointWorld,h=s.m_hitNormalWorld;if(l.clear(),h.clear(),this._btWorld.rayTest(a,o,s),s.hasHit()){for(var u=0,c=s.m_collisionObjects.size();u<c;u++){var p=s.m_collisionObjects.at(u),d=p.getCollisionShape(),f=void 0;if(d.isCompound()){var _=s.m_shapeParts.at(u),g=p.getUserIndex();f=hL.bodyAndGhosts[g].wrappedShapes[_]}else f=d.wrapped;bO(yL,l.at(u)),bO(vL,h.at(u));var m=Si.distance(t.o,yL),y=r.add();y._assign(yL,m,f.collider,vL),n.push(y)}return!0}return!1},t.raycastClosest=function(t,i,r){var n=e.closeHitCB,s=vO(n.m_rayFromWorld,t.o);t.computeHit(yL,i.maxDistance);var a=vO(n.m_rayToWorld,yL);if(n.m_collisionFilterGroup=-1,n.m_collisionFilterMask=i.mask,n.m_closestHitFraction=1,n.m_collisionObject=null,this._btWorld.rayTest(s,a,n),n.hasHit()){var o,l=n.m_collisionObject,h=l.getCollisionShape();if(h.isCompound()){var u=l.getUserIndex(),c=hL.bodyAndGhosts[u],p=n.m_shapePart;o=c.wrappedShapes[p]}else o=h.wrapped;bO(yL,n.m_hitPointWorld),bO(vL,n.m_hitNormalWorld);var d=Si.distance(t.o,yL);return r._assign(yL,d,o.collider,vL),!0}return!1},t.getSharedBody=function(t,e){return dL.getSharedBody(t,this,e)},t.addSharedBody=function(t){this.bodies.indexOf(t)<0&&(this.bodies.push(t),this._btWorld.addRigidBody(t.body,t.collisionFilterGroup,t.collisionFilterMask))},t.removeSharedBody=function(t){var e=this.bodies.indexOf(t);e>=0&&(ni(this.bodies,e),this._btWorld.removeRigidBody(t.body))},t.addGhostObject=function(t){this.ghosts.indexOf(t)<0&&(this.ghosts.push(t),this._btWorld.addCollisionObject(t.ghost,t.collisionFilterGroup,t.collisionFilterMask))},t.removeGhostObject=function(t){var e=this.ghosts.indexOf(t);e>=0&&(ni(this.ghosts,e),this._btWorld.removeCollisionObject(t.ghost))},t.addConstraint=function(t){var e=this.constraints.indexOf(t);e<0&&(this.constraints.push(t),this._btWorld.addConstraint(t.impl,!t.constraint.enableCollision),t.index=e)},t.removeConstraint=function(t){var e=this.constraints.indexOf(t);e>=0&&(this.constraints.splice(e,1),this._btWorld.removeConstraint(t.impl),t.index=-1)},t.emitEvents=function(){for(var t=this._btDispatcher.getNumManifolds(),e=0;e<t;e++){var i=this._btDispatcher.getManifoldByIndexInternal(e),r=i.getBody0(),n=i.getBody1();if(!r.useCharacter&&!n.useCharacter)for(var s=i.getNumContacts(),a=0;a<s;a++){var o=i.getContactPoint(a),l=o.getShape0(),h=o.getShape1(),u=void 0,c=void 0;if(u=l.isCompound()?_n.castObject(l,_n.btCompoundShape).getChildShape(o.m_index0).wrapped:l.wrapped,c=h.isCompound()?_n.castObject(h,_n.btCompoundShape).getChildShape(o.m_index1).wrapped:h.wrapped,u&&c&&(u.collider.needTriggerEvent||c.collider.needTriggerEvent||u.collider.needCollisionEvent||c.collider.needCollisionEvent)){var p=this.contactsDic.get(u.id,c.id);null==p&&(p=this.contactsDic.set(u.id,c.id,{shape0:u,shape1:c,contacts:[],impl:i})),p.contacts.push(o)}}}for(var d=this.contactsDic.getLength();d--;){mL.push.apply(mL,eL.contacts),eL.contacts.length=0;var f=this.contactsDic.getKeyByIndex(d),_=this.contactsDic.getDataByKey(f),g=_.shape0,m=_.shape1;this.oldContactsDic.set(g.id,m.id,_);var y=g.collider,v=m.collider;if(y&&v){if(y.isTrigger||v.isTrigger)this.triggerArrayMat.get(g.id,m.id)?tL.type="onTriggerStay":(tL.type="onTriggerEnter",this.triggerArrayMat.set(g.id,m.id,!0)),tL.impl=_.impl,tL.selfCollider=y,tL.otherCollider=v,y.emit(tL.type,tL),tL.selfCollider=v,tL.otherCollider=y,v.emit(tL.type,tL);else{var b=y.attachedRigidBody,S=v.attachedRigidBody;if(b&&S){if(b.isSleeping&&S.isSleeping)continue}else if(null==b&&S){if(S.isSleeping)continue}else if(null==S&&b&&b.isSleeping)continue;this.collisionArrayMat.get(g.id,m.id)?eL.type="onCollisionStay":(eL.type="onCollisionEnter",this.collisionArrayMat.set(g.id,m.id,!0));for(var T=0;T<_.contacts.length;T++){var A=_.contacts[T];if(mL.length>0){var E=mL.pop();E.impl=A,eL.contacts.push(E)}else{var C=new gL(eL);C.impl=A,eL.contacts.push(C)}}eL.impl=_.impl,eL.selfCollider=y,eL.otherCollider=v,y.emit(eL.type,eL),eL.selfCollider=v,eL.otherCollider=y,v.emit(eL.type,eL)}null==this.oldContactsDic.get(g.id,m.id)&&this.oldContactsDic.set(g.id,m.id,_)}}for(var R=this.oldContactsDic.getLength();R--;){var w=this.oldContactsDic.getKeyByIndex(R),x=this.oldContactsDic.getDataByKey(w),O=x.shape0,P=x.shape1,D=O.collider,M=P.collider;if(D&&M){var B=D.isTrigger||M.isTrigger;null==this.contactsDic.getDataByKey(w)&&(B?this.triggerArrayMat.get(O.id,P.id)&&(tL.type="onTriggerExit",tL.selfCollider=D,tL.otherCollider=M,D.emit(tL.type,tL),tL.selfCollider=M,tL.otherCollider=D,M.emit(tL.type,tL),this.triggerArrayMat.set(O.id,P.id,!1),this.oldContactsDic.set(O.id,P.id,null)):this.collisionArrayMat.get(O.id,P.id)&&(mL.push.apply(mL,eL.contacts),eL.contacts.length=0,eL.type="onCollisionExit",eL.selfCollider=D,eL.otherCollider=M,D.emit(eL.type,eL),eL.selfCollider=M,eL.otherCollider=D,M.emit(eL.type,eL),this.collisionArrayMat.set(O.id,P.id,!1),this.oldContactsDic.set(O.id,P.id,null)))}}this.contactsDic.reset()},Be(e,[{key:"impl",get:function(){return this._btWorld}}]),e}();bL.closeHitCB=void 0,bL.allHitsCB=void 0;var SL=rL,TL=function(){var t=e.prototype;function e(t){this.id=void 0,this.type=void 0,this._index=-1,this._isEnabled=!1,this._isBinding=!1,this._isTrigger=!1,this._btCompound=null,this.transform=void 0,this.quat=void 0,this.scale=void 0,this.type=t,this.id=e.idCounter++,this.quat=new _n.btQuaternion,this.transform=new _n.btTransform,this.transform.setIdentity(),this.scale=new _n.btVector3(1,1,1)}return t.updateEventListener=function(){},t.setMaterial=function(t){!this._isTrigger&&this._isEnabled&&t&&(this._btCompound?this._btCompound.setMaterial(this._index,t.friction,t.restitution,t.rollingFriction,t.spinningFriction,2):(this._sharedBody.body.setFriction(t.friction),this._sharedBody.body.setRestitution(t.restitution),this._sharedBody.body.setRollingFriction(t.rollingFriction),this._sharedBody.body.setSpinningFriction(t.spinningFriction),this._sharedBody.body.setUserIndex2(2)))},t.setCenter=function(t){Si.copy(SL,t),SL.multiply(this._collider.node.worldScale),vO(this.transform.getOrigin(),SL),this.updateCompoundTransform()},t.setAsTrigger=function(t){this._isTrigger!==t&&(this._isEnabled&&(this._sharedBody.removeShape(this,!t),this._sharedBody.addShape(this,t)),this._isTrigger=t)},t.getAABB=function(t){var e=iL.instance.TRANSFORM;e.setIdentity(),e.setRotation(SO(iL.instance.QUAT_0,this._collider.node.worldRotation));var i=iL.instance.VECTOR3_0,r=iL.instance.VECTOR3_1;this._btShape.getAabb(e,i,r),t.halfExtents.set((r.x()-i.x())/2,(r.y()-i.y())/2,(r.z()-i.z())/2),Si.add(t.center,this._collider.node.worldPosition,this._collider.center)},t.getBoundingSphere=function(t){t.radius=this._btShape.getLocalBoundingSphere(),Si.add(t.center,this._collider.node.worldPosition,this._collider.center)},t.initialize=function(t){this._collider=t,this._isBinding=!0,this._sharedBody=LP.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0,this.onComponentSet(),this.setWrapper()},t.onComponentSet=function(){},t.onLoad=function(){this.setCenter(this._collider.center),this.setAsTrigger(this._collider.isTrigger)},t.onEnable=function(){this._isEnabled=!0,this._sharedBody.addShape(this,this._isTrigger),this.setMaterial(this.collider.sharedMaterial)},t.onDisable=function(){this._isEnabled=!1,this._sharedBody.removeShape(this,this._isTrigger)},t.onDestroy=function(){this._sharedBody.reference=!1,this._btCompound=null,this._collider=null,_n.castObject(this._btShape,_n.btCollisionShape).wrapped=null,_n.destroy(this.quat),_n.destroy(this.scale),_n.destroy(this.transform),this._btShape!==iL.instance.EMPTY_SHAPE&&(_n.destroy(this._btShape),AO(this._btShape,_n.btCollisionShape)),this._btShape=null,this.transform=null,this.quat=null,this.scale=null},t.updateByReAdd=function(){this._isEnabled&&(this._sharedBody.removeShape(this,this._isTrigger),this._sharedBody.addShape(this,this._isTrigger))},t.getGroup=function(){return this._sharedBody.collisionFilterGroup},t.setGroup=function(t){this._sharedBody.collisionFilterGroup=t},t.addGroup=function(t){this._sharedBody.collisionFilterGroup|=t},t.removeGroup=function(t){this._sharedBody.collisionFilterGroup&=~t},t.getMask=function(){return this._sharedBody.collisionFilterMask},t.setMask=function(t){this._sharedBody.collisionFilterMask=t},t.addMask=function(t){this._sharedBody.collisionFilterMask|=t},t.removeMask=function(t){this._sharedBody.collisionFilterMask&=~t},t.setCompound=function(t){this._btCompound&&(this._btCompound.removeChildShape(this._btShape),this._index=-1),t&&(this._index=t.getNumChildShapes(),t.addChildShape(this.transform,this._btShape)),this._btCompound=t},t.setWrapper=function(){_n.castObject(this._btShape,_n.btCollisionShape).wrapped=this},t.setScale=function(){this.setCenter(this._collider.center)},t.updateCompoundTransform=function(){this._btCompound?this._btCompound.updateChildTransform(this.index,this.transform,!0):this._isEnabled&&!this._isTrigger&&this._sharedBody&&!this._sharedBody.bodyStruct.useCompound&&(this._sharedBody.dirty|=WI.BODY_RE_ADD)},t.needCompound=function(){return this.type===ZI.TERRAIN_SHAPE_PROXYTYPE||!this._collider.center.equals(Si.ZERO)},t.debugTransform=function(t){var i;null==e._debugTransform&&(e._debugTransform=new _n.btTransform),i=this._isTrigger?this._sharedBody.ghost.getWorldTransform():this._sharedBody.body.getWorldTransform();var r=this.transform;e._debugTransform.setIdentity(),e._debugTransform.op_mul(i).op_mul(r);var n=e._debugTransform.getOrigin();t.worldPosition=new Si(n.x(),n.y(),n.z());var s=e._debugTransform.getRotation();t.worldRotation=new ur(s.x(),s.y(),s.z(),s.w());var a=this.impl.getLocalScaling();t.scale=new Si(a.x(),a.y(),a.z())},Be(e,[{key:"attachedRigidBody",get:function(){return this._sharedBody.wrappedBody?this._sharedBody.wrappedBody.rigidBody:null}},{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"index",get:function(){return this._index}}]),e}();TL.idCounter=0,TL._debugTransform=void 0;var AL=function(t){Me(i,t);var e=i.prototype;function i(){return t.call(this,ZI.BOX_SHAPE_PROXYTYPE)||this}return e.setSize=function(t){var e=rL;Si.multiplyScalar(e,t,.5);var i=iL.instance.VECTOR3_0;vO(i,e),this.impl.setUnscaledHalfExtents(i),this.updateCompoundTransform()},e.onComponentSet=function(){var t=this.collider.size,e=iL.instance.VECTOR3_0;e.setValue(t.x/2,t.y/2,t.z/2),this._btShape=new _n.btBoxShape(e),this.setScale()},e.setScale=function(){t.prototype.setScale.call(this),vO(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this.updateCompoundTransform()},Be(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(TL),EL=function(t){Me(i,t);var e=i.prototype;function i(){return t.call(this,ZI.SPHERE_SHAPE_PROXYTYPE)||this}return e.setRadius=function(t){this.impl.setUnscaledRadius(t),this.updateCompoundTransform()},e.onComponentSet=function(){this._btShape=new _n.btSphereShape(this.collider.radius),this.setScale()},e.setScale=function(){t.prototype.setScale.call(this);var e=rL,i=this._collider.node.worldScale,r=Math.abs(i.x),n=Math.abs(i.y),s=Math.abs(i.z),a=Math.max(Math.max(r,n),s);e.set(a,a,a),vO(this.scale,e),this._btShape.setLocalScaling(this.scale),this.updateCompoundTransform()},Be(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(TL),CL=function(t){Me(i,t);var e=i.prototype;function i(){return t.call(this,ZI.CAPSULE_SHAPE_PROXYTYPE)||this}return e.setCylinderHeight=function(){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)},e.setDirection=function(){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)},e.setRadius=function(){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)},e.onComponentSet=function(){this._btShape=new _n.btCapsuleShape(.5,1),this.setRadius(this.collider.radius)},e.setScale=function(){t.prototype.setScale.call(this),this.setRadius(this.collider.radius)},e.updateProperties=function(t,e,i,r){var n=r,s=i;if(1===s){var a=t*Math.abs(bn(n.x,n.z)),o=e/2*Math.abs(n.y);this.impl.updateProp(a,o,s)}else if(0===s){var l=t*Math.abs(bn(n.y,n.z)),h=e/2*Math.abs(n.x);this.impl.updateProp(l,h,s)}else{var u=t*Math.abs(bn(n.x,n.y)),c=e/2*Math.abs(n.z);this.impl.updateProp(u,c,s)}this.updateCompoundTransform()},Be(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(TL),RL=function(t){Me(i,t);var e=i.prototype;function i(){var e;return(e=t.call(this,ZI.TRIANGLE_MESH_SHAPE_PROXYTYPE)||this).refBtTriangleMesh=null,e}return e.setMesh=function(t){if(this._isBinding)if(null!=this._btShape&&this._btShape!==iL.instance.EMPTY_SHAPE)He(9620);else{var e=t;if(e&&e.renderingSubMeshes.length>0){var i=this._getBtTriangleMesh(e);this.collider.convex?this._btShape=new _n.btConvexTriangleMeshShape(i,!0):this._btShape=new _n.btBvhTriangleMeshShape(i,!0,!0),vO(this.scale,this._collider.node.worldScale),this._btShape.setMargin(.01),this._btShape.setLocalScaling(this.scale),this.setWrapper(),this.setCompound(this._btCompound),this.updateByReAdd()}else this._btShape=iL.instance.EMPTY_SHAPE}},e.onComponentSet=function(){this.setMesh(this.collider.mesh)},e.onDestroy=function(){this.refBtTriangleMesh&&_n.destroy(this.refBtTriangleMesh),t.prototype.onDestroy.call(this)},e.setCompound=function(e){t.prototype.setCompound.call(this,e),this.impl.setUserIndex(this._index)},e.setScale=function(){t.prototype.setScale.call(this),vO(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this.updateCompoundTransform()},e._getBtTriangleMesh=function(t){var e,i=_n.CC_CACHE;if(i.btTriangleMesh.enable){if(null==i.btTriangleMesh[t._uuid]){var r=new _n.btTriangleMesh;i.btTriangleMesh[t._uuid]=r,EO(r,t)}e=i.btTriangleMesh[t._uuid]}else this.refBtTriangleMesh=e=new _n.btTriangleMesh,EO(e,t);return e},Be(i,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._btShape}}]),i}(TL),wL=function(t){Me(i,t);var e=i.prototype;function i(){return t.call(this,ZI.CYLINDER_SHAPE_PROXYTYPE)||this}return e.setHeight=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.setDirection=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.setRadius=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.onComponentSet=function(){var t=iL.instance.VECTOR3_0;t.setValue(.5,1,.5),this._btShape=new _n.btCylinderShape(t),this.setRadius(this.collider.radius)},e.setScale=function(){t.prototype.setScale.call(this),this.setRadius(this.collider.radius)},e.updateProperties=function(t,e,i,r){var n=r,s=i;if(1===s){var a=e*Math.abs(n.y),o=t*Math.abs(bn(n.x,n.z)),l=a/2;this.impl.updateProp(o,l,s)}else if(0===s){var h=e*Math.abs(n.x),u=t*Math.abs(bn(n.y,n.z)),c=h/2;this.impl.updateProp(u,c,s)}else{var p=e*Math.abs(n.z),d=t*Math.abs(bn(n.x,n.y)),f=p/2;this.impl.updateProp(d,f,s)}this.updateCompoundTransform()},Be(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(TL),xL=function(t){Me(i,t);var e=i.prototype;function i(){return t.call(this,ZI.CONE_SHAPE_PROXYTYPE)||this}return e.setHeight=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.setDirection=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.setRadius=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.onComponentSet=function(){this._btShape=new _n.btConeShape(.5,1),this.setRadius(this.collider.radius)},e.setScale=function(){t.prototype.setScale.call(this),this.setRadius(this.collider.radius)},e.updateProperties=function(t,e,i,r){var n=r,s=i;if(1===s){var a=e*Math.abs(n.y),o=t*Math.abs(bn(n.x,n.z));this.impl.setRadius(o),this.impl.setHeight(a)}else if(0===s){var l=e*Math.abs(n.x),h=t*Math.abs(bn(n.y,n.z));this.impl.setRadius(h),this.impl.setHeight(l)}else{var u=e*Math.abs(n.z),c=t*Math.abs(bn(n.x,n.y));this.impl.setRadius(c),this.impl.setHeight(u)}this.impl.setConeUpIndex(s),this.scale.setValue(1,1,1),this.impl.setLocalScaling(this.scale),this.updateCompoundTransform()},Be(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(TL),OL=function(t){Me(i,t);var e=i.prototype;function i(){var e;return(e=t.call(this,ZI.TERRAIN_SHAPE_PROXYTYPE)||this)._terrainID=void 0,e._buffPtr=void 0,e._tileSize=void 0,e._localOffset=void 0,e._terrainID="",e._buffPtr=0,e._tileSize=0,e._localOffset=new Si,e}return e.setTerrain=function(t){if(this._isBinding)if(null!=this._btShape&&this._btShape!==iL.instance.EMPTY_SHAPE)We("[Physics] Ammo change the terrain asset after initialization is not support.");else{var e=t;if(e){this._terrainID=e._uuid,this._tileSize=e.tileSize;var i=e.getVertexCountI(),r=e.getVertexCountJ();this._buffPtr=_n._malloc(4*i*r);for(var n=0,s=Number.MIN_VALUE,a=Number.MAX_VALUE,o=0;o<r;o++)for(var l=0;l<i;l++){var h=e.getHeight(l,o);_n.HEAPF32[this._buffPtr+n>>2]=h,s=s<h?h:s,a=a>h?h:a,n+=4}s+=.1,a-=.1,this._localOffset.set((i-1)/2*this._tileSize,(s+a)/2,(r-1)/2*this._tileSize),this._btShape=new _n.btHeightfieldTerrainShape(i,r,this._buffPtr,1,a,s,1,"PHY_FLOAT",!1),this.scale.setValue(this._tileSize,1,this._tileSize),this._btShape.setLocalScaling(this.scale)}else this._btShape=iL.instance.EMPTY_SHAPE}},e.onComponentSet=function(){this.setTerrain(this.collider.terrain)},e.onDestroy=function(){this._buffPtr&&_n._free(this._buffPtr),t.prototype.onDestroy.call(this)},e.setCompound=function(e){t.prototype.setCompound.call(this,e),this.impl.setUserIndex(this._index)},e.setCenter=function(t){Si.copy(rL,t),rL.add(this._localOffset),vO(this.transform.getOrigin(),rL),this.updateCompoundTransform()},Be(i,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._btShape}}]),i}(TL),PL=function(t){Me(i,t);var e=i.prototype;function i(){var e;return(e=t.call(this,ZI.TETRAHEDRAL_SHAPE_PROXYTYPE)||this).VERTICES=[],e}return e.setShapeType=function(){this._isBinding},e.setVertices=function(t){for(var e=this.VERTICES.length,i=0;i<e;i++)vO(this.VERTICES[i],t[i]);vO(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this._btCompound&&this._btCompound.updateChildTransform(this.index,this.transform,!0)},e.onComponentSet=function(){this._btShape=new _n.btBU_Simplex1to4;for(var t=this.collider.shapeType,e=this.collider.vertices,i=0;i<t;i++)this.VERTICES[i]=new _n.btVector3,vO(this.VERTICES[i],e[i]),this.impl.addVertex(this.VERTICES[i]);vO(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale)},e.onLoad=function(){t.prototype.onLoad.call(this),this.collider.updateVertices()},e.onDestroy=function(){for(var e=this.VERTICES.length,i=0;i<e;i++)_n.destroy(this.VERTICES[i]);this.VERTICES=null,t.prototype.onDestroy.call(this)},e.setScale=function(){t.prototype.setScale.call(this),vO(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this._btCompound&&this._btCompound.updateChildTransform(this.index,this.transform,!0)},Be(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(TL),DL=function(t){Me(i,t);var e=i.prototype;function i(){return t.call(this,ZI.STATIC_PLANE_PROXYTYPE)||this}return e.setNormal=function(t){vO(this.impl.getPlaneNormal(),t),this.updateCompoundTransform()},e.setConstant=function(t){this.impl.setPlaneConstant(t),this.updateCompoundTransform()},e.setScale=function(){t.prototype.setScale.call(this),vO(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this.updateCompoundTransform()},e.onComponentSet=function(){var t=iL.instance.VECTOR3_0;vO(t,this.collider.normal),this._btShape=new _n.btStaticPlaneShape(t,this.collider.constant),this.setScale()},Be(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(TL),ML=function(){function t(){this.dirty=0,this.index=-1,this._collided=!1}var e=t.prototype;return e.setConnectedBody=function(){},e.setEnableCollision=function(t){this._collided!==t&&(this._collided=t,this.updateByReAdd())},e.updateByReAdd=function(){if(this._rigidBody&&this.index>=0){var t=this._rigidBody.body.sharedBody;t.wrappedWorld.removeConstraint(this),t.wrappedWorld.addConstraint(this)}},e.initialize=function(t){this._com=t,this._rigidBody=t.attachedBody,this._collided=t.enableCollision,this.onComponentSet()},e.onComponentSet=function(){},e.updateScale0=function(){},e.updateScale1=function(){},e.onEnable=function(){var t=this._rigidBody.body.sharedBody;t.wrappedWorld.addConstraint(this),t.addJoint(this,0);var e=this.constraint.connectedBody;e&&e.body.sharedBody.addJoint(this,1)},e.onDisable=function(){var t=this._rigidBody.body.sharedBody;t.wrappedWorld.removeConstraint(this),t.removeJoint(this,0);var e=this.constraint.connectedBody;e&&e.body.sharedBody.removeJoint(this,1)},e.onDestroy=function(){_n.destroy(this._impl),this._com=null,this._rigidBody=null,this._impl=null},Be(t,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),t}(),BL=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.setPivotA=function(){var t=iL.instance.VECTOR3_0,e=this.constraint;Si.multiply(rL,e.node.worldScale,e.pivotA),vO(t,rL),this.impl.setPivotA(t),e.connectedBody||this.setPivotB(e.pivotB)},i.setPivotB=function(){var t=this.constraint,e=this._rigidBody.node,i=iL.instance.VECTOR3_0,r=t.connectedBody;r?(Si.multiply(rL,r.node.worldScale,t.pivotB),vO(i,rL)):(Si.multiply(rL,e.worldScale,t.pivotA),Si.add(rL,rL,e.worldPosition),Si.add(rL,rL,t.pivotB),vO(i,rL)),this.impl.setPivotB(i)},i.onComponentSet=function(){var t,e=this._rigidBody.body.impl,i=this.constraint.connectedBody;i&&(t=i.body.impl);var r=iL.instance.VECTOR3_0;if(t){var n=iL.instance.VECTOR3_1;this._impl=new _n.btPoint2PointConstraint(e,t,r,n)}else this._impl=new _n.btPoint2PointConstraint(e,r);this.setPivotA(this.constraint.pivotA),this.setPivotB(this.constraint.pivotB)},i.updateScale0=function(){this.setPivotA(this.constraint.pivotA)},i.updateScale1=function(){this.setPivotB(this.constraint.pivotB)},Be(e,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),e}(ML),IL=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.setPivotA=function(){this.updateFrames()},i.setPivotB=function(){this.updateFrames()},i.setAxis=function(){this.updateFrames()},i.onComponentSet=function(){var t=this._rigidBody.body.sharedBody,e=this.constraint.connectedBody,i=e?e.body.impl:t.wrappedWorld.impl.getFixedBody(),r=iL.instance.TRANSFORM,n=iL.instance.TRANSFORM_1;this._impl=new _n.btHingeConstraint(t.body,i,r,n),this.updateFrames()},i.updateFrames=function(){var t=this.constraint,e=t.node,i=rL,r=sL,n=iL.instance.TRANSFORM;Si.multiply(i,e.worldScale,t.pivotA),vO(n.getOrigin(),i);var s=iL.instance.QUAT_0;ur.rotationTo(r,Si.UNIT_Z,t.axis),n.setRotation(SO(s,r));var a=iL.instance.TRANSFORM_1,o=this.constraint.connectedBody;o?Si.multiply(i,o.node.worldScale,t.pivotB):(Si.multiply(i,e.worldScale,t.pivotA),Si.add(i,i,e.worldPosition),Si.add(i,i,t.pivotB),ur.multiply(r,r,e.worldRotation)),vO(a.getOrigin(),i),a.setRotation(SO(s,r)),this.impl.setFrames(n,a)},i.updateScale0=function(){this.updateFrames()},i.updateScale1=function(){this.updateFrames()},Be(e,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),e}(ML);yO.select("ammo.js",{PhysicsWorld:bL,RigidBody:lL,BoxShape:AL,SphereShape:EL,CapsuleShape:CL,TrimeshShape:RL,CylinderShape:wL,ConeShape:xL,TerrainShape:OL,SimplexShape:PL,PlaneShape:DL,PointToPointConstraint:BL,HingeConstraint:IL}),window.Ammo=_n,_n.CC_CONFIG={ignoreSelfBody:!0},_n.CC_CACHE={btTriangleMesh:{enable:!1}};var LL=new Si,FL=new gi;function kL(t,e,i,r){var n=i.data,s=e.acquireBufferBatch(),a=s.byteOffset>>2,o=i.vertexCount,l=s.indicesOffset,h=s.vertexOffset;s.request(o,i.indicesCount)||(s=e.currBufferBatch,o=0,l=0,h=0);var u=s.vData,c=s.iData;t.getWorldMatrix(FL);for(var p=0;p<o;p++){var d=n[p];Si.set(LL,d.x,d.y,0),Si.transformMat4(LL,LL,FL),u[a++]=LL.x,u[a++]=LL.y,u[a++]=LL.z,u[a++]=d.u,u[a++]=d.v,Ii.toArray(u,r,a),a+=4}for(var f=0,_=o/4;f<_;f++){var g=h+4*f;c[l++]=g,c[l++]=g+1,c[l++]=g+2,c[l++]=g+1,c[l++]=g+3,c[l++]=g+2}}var NL=function(){function t(t,e){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var i=new GL;i.initWithSize(t,e),this._texture=i,this._width=t,this._height=e,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var e=t.prototype;return e.insertSpriteFrame=function(t){var e=t.rect,i=t.texture,r=this._innerTextureInfos[i.getId()],n=e.x,s=e.y;if(r)n+=r.x,s+=r.y;else{var a=i.width,o=i.height;if(this._x+a+2>this._width&&(this._x=2,this._y=this._nexty),this._y+o+2>this._nexty&&(this._nexty=this._y+o+2),this._nexty>this._height)return null;Xe.internal.dynamicAtlasManager.textureBleeding&&((a<=8||o<=8)&&(this._texture.drawTextureAt(i.image,this._x-1,this._y-1),this._texture.drawTextureAt(i.image,this._x-1,this._y+1),this._texture.drawTextureAt(i.image,this._x+1,this._y-1),this._texture.drawTextureAt(i.image,this._x+1,this._y+1)),this._texture.drawTextureAt(i.image,this._x-1,this._y),this._texture.drawTextureAt(i.image,this._x+1,this._y),this._texture.drawTextureAt(i.image,this._x,this._y-1),this._texture.drawTextureAt(i.image,this._x,this._y+1)),this._texture.drawTextureAt(i.image,this._x,this._y),this._innerTextureInfos[i.getId()]={x:this._x,y:this._y,texture:i},this._count++,n+=this._x,s+=this._y,this._x+=a+2}var l={x:n,y:s,texture:this._texture};return this._innerSpriteFrames.push(t),l},e.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},e.isEmpty=function(){return this._count<=0},e.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,i=t.length;e<i;e++){var r=t[e];r.isValid&&r._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},e.destroy=function(){this.reset(),this._texture.destroy()},t}(),GL=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.initWithSize=function(t,e,i){void 0===i&&(i=Kr.RGBA8888),this.reset({width:t,height:e,format:i}),this.loaded=!0,this.emit("load")},i.drawTextureAt=function(t,e,i){var r=this.getGFXTexture();if(t&&r){var n=this._getGFXDevice();if(n){var s=new tt;s.texOffset.x=e,s.texOffset.y=i,s.texExtent.width=t.width,s.texExtent.height=t.height,n.copyTexImagesToTexture([t.data],r,[s])}else console.warn("Unable to get device")}},e}(ir),UL=function(){function t(){this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}var e=t.prototype;return e.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return t||(t=new NL(this._textureSize,this._textureSize),this._atlases.push(t)),t},e.beforeSceneLoad=function(){this.reset()},e.insertSpriteFrame=function(t){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!t||t._original)return null;if(!t.packable)return null;var e=this._atlases[this._atlasIndex];e||(e=this.newAtlas());var i=e.insertSpriteFrame(t);return i||this._atlasIndex===this._maxAtlasCount?i:(e=this.newAtlas()).insertSpriteFrame(t)},e.reset=function(){for(var t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},e.deleteAtlasSpriteFrame=function(t){if(t._original){var e=t._original._texture;this.deleteAtlasTexture(e)}},e.deleteAtlasTexture=function(t){if(t)for(var e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)},e.packToDynamicAtlas=function(t,e){if(!e._original&&e.packable){var i=this.insertSpriteFrame(e);i&&e._setDynamicAtlasFrame(i)}},Be(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(t?(this.reset(),Xe.director.on(Xe.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),Xe.director.off(Xe.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=t)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(t){this._maxAtlasCount=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(t){this._textureBleeding=t}},{key:"textureSize",get:function(){return this._textureSize},set:function(t){this._textureSize=t}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(t){this._maxFrameSize=t}}]),t}();UL.instance=void 0;var zL,VL=t("dynamicAtlasManager",UL.instance=new UL);Xe.internal.dynamicAtlasManager=VL;var HL,WL,XL,YL,jL=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],KL=t("SpriteFrame",Ze("cc.SpriteFrame")(zL=function(t){function e(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.uvHash=0,e.unbiasUV=[],e.uvSliced=[],e._rect=new mi,e._offset=new _i,e._originalSize=new wi,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e._original=null,e._packable=!0,e}Me(e,t),e.createWithImage=function(t){var i=t instanceof er?t:new er(t),r=new ir;r.image=i;var n=new e;return n.texture=r,n};var i=e.prototype;return i.textureLoaded=function(){return this.texture&&this.texture.loaded},i.isRotated=function(){return this._rotated},i.setRotated=function(t){this.rotated=t},i.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},i.setRect=function(t){this.rect=t},i.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},i.setOriginalSize=function(t){this.originalSize=t},i.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},i.setOffset=function(t){this.offset=t},i.getGFXTexture=function(){return this._texture.getGFXTexture()},i.getGFXSampler=function(){return this._texture.getGFXSampler()},i.getHash=function(){return this._texture.getHash()},i.getSamplerHash=function(){return this._texture.getSamplerHash()},i.reset=function(t,e){void 0===e&&(e=!1);var i=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,i=!0),t&&(t.texture&&(this.loaded=!1,this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),i=!0),i&&this.texture&&this._calculateUV()},i.checkRect=function(t){var e=this._rect,i=e.x,r=e.y;return this._rotated?(i+=e.height,r+=e.width):(i+=e.width,r+=e.height),i>t.width?(Ie(3300,this.name+"/"+t.name,i,t.width),!1):!(r>t.height&&(Ie(3301,this.name+"/"+t.name,r,t.height),1))},i.onLoaded=function(){this.loaded=!0,this.emit("load")},i.destroy=function(){return this._packable&&VL&&VL.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},i._calculateSlicedUV=function(){var t=this._rect,e=this.texture,i=e.width,r=e.height,n=this._capInsets[0],s=this._capInsets[2],a=t.width-n-s,o=this._capInsets[1],l=this._capInsets[3],h=t.height-o-l,u=this.uvSliced;if(u.length=0,this._rotated){jL[0].u=t.x/i,jL[1].u=(t.x+l)/i,jL[2].u=(t.x+l+h)/i,jL[3].u=(t.x+t.height)/i,jL[3].v=t.y/r,jL[2].v=(t.y+n)/r,jL[1].v=(t.y+n+a)/r,jL[0].v=(t.y+t.width)/r;for(var c=0;c<4;++c)for(var p=jL[c],d=0;d<4;++d){var f=jL[3-d];u.push({u:p.u,v:f.v})}}else{jL[0].u=t.x/i,jL[1].u=(t.x+n)/i,jL[2].u=(t.x+n+a)/i,jL[3].u=(t.x+t.width)/i,jL[3].v=t.y/r,jL[2].v=(t.y+o)/r,jL[1].v=(t.y+o+h)/r,jL[0].v=(t.y+t.height)/r;for(var _=0;_<4;++_)for(var g=jL[_],m=0;m<4;++m){var y=jL[m];u.push({u:y.u,v:g.v})}}},i._calculateUV=function(){var t=this._rect,e=this.uv,i=this.unbiasUV,r=this.texture,n=r.width,s=r.height;if(this._rotated){var a=0===n?0:t.x/n,o=0===n?1:(t.x+t.height)/n,l=0===s?0:t.y/s,h=0===s?1:(t.y+t.width)/s;this._isFlipUVX&&this._isFlipUVY?(e[0]=o,e[1]=h,e[2]=o,e[3]=l,e[4]=a,e[5]=h,e[6]=a,e[7]=l):this._isFlipUVX?(e[0]=o,e[1]=l,e[2]=o,e[3]=h,e[4]=a,e[5]=l,e[6]=a,e[7]=h):this._isFlipUVY?(e[0]=a,e[1]=h,e[2]=a,e[3]=l,e[4]=o,e[5]=h,e[6]=o,e[7]=l):(e[0]=a,e[1]=l,e[2]=a,e[3]=h,e[4]=o,e[5]=l,e[6]=o,e[7]=h);var u=0===n?0:t.x/n,c=0===n?1:(t.x+t.height)/n,p=0===s?0:t.y/s,d=0===s?1:(t.y+t.width)/s;this._isFlipUVX&&this._isFlipUVY?(i[0]=c,i[1]=d,i[2]=c,i[3]=p,i[4]=u,i[5]=d,i[6]=u,i[7]=p):this._isFlipUVX?(i[0]=c,i[1]=p,i[2]=c,i[3]=d,i[4]=u,i[5]=p,i[6]=u,i[7]=d):this._isFlipUVY?(i[0]=u,i[1]=d,i[2]=u,i[3]=p,i[4]=c,i[5]=d,i[6]=c,i[7]=p):(i[0]=u,i[1]=p,i[2]=u,i[3]=d,i[4]=c,i[5]=p,i[6]=c,i[7]=d)}else{var f=0===n?0:t.x/n,_=0===n?1:(t.x+t.width)/n,g=0===s?1:(t.y+t.height)/s,m=0===s?0:t.y/s;this._isFlipUVX&&this._isFlipUVY?(e[0]=_,e[1]=m,e[2]=f,e[3]=m,e[4]=_,e[5]=g,e[6]=f,e[7]=g):this._isFlipUVX?(e[0]=_,e[1]=g,e[2]=f,e[3]=g,e[4]=_,e[5]=m,e[6]=f,e[7]=m):this._isFlipUVY?(e[0]=f,e[1]=m,e[2]=_,e[3]=m,e[4]=f,e[5]=g,e[6]=_,e[7]=g):(e[0]=f,e[1]=g,e[2]=_,e[3]=g,e[4]=f,e[5]=m,e[6]=_,e[7]=m);var y=0===n?0:t.x/n,v=0===n?1:(t.x+t.width)/n,b=0===s?1:(t.y+t.height)/s,S=0===s?0:t.y/s;this._isFlipUVX&&this._isFlipUVY?(i[0]=v,i[1]=S,i[2]=y,i[3]=S,i[4]=v,i[5]=b,i[6]=y,i[7]=b):this._isFlipUVX?(i[0]=v,i[1]=b,i[2]=y,i[3]=b,i[4]=v,i[5]=S,i[6]=y,i[7]=S):this._isFlipUVY?(i[0]=y,i[1]=S,i[2]=v,i[3]=S,i[4]=y,i[5]=b,i[6]=v,i[7]=b):(i[0]=y,i[1]=b,i[2]=v,i[3]=b,i[4]=y,i[5]=S,i[6]=v,i[7]=S)}for(var T="",A=0;A<e.length;A++)T+=e[A];this.uvHash=pr(T,666);var E=this.vertices;if(E){E.nu.length=0,E.nv.length=0;for(var C=0;C<E.u.length;C++)E.nu[C]=E.u[C]/n,E.nv[C]=E.v[C]/s}this._calculateSlicedUV()},i._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},i._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},i._checkPackable=function(){var t=VL;if(t){var e=this._texture;if(e instanceof ir&&!e.isCompressed){var i=this.width,r=this.height;!e.image||i>t.maxFrameSize||r>t.maxFrameSize?this._packable=!1:e.image&&e.image instanceof HTMLCanvasElement&&(this._packable=!0)}else this._packable=!1}},i._serialize=function(){return null},i._deserialize=function(t){var e=t,i=e.rect;i&&(this._rect=new mi(i.x,i.y,i.width,i.height));var r=e.offset;e.offset&&(this._offset=new _i(r.x,r.y));var n=e.originalSize;e.originalSize&&(this._originalSize=new wi(n.width,n.height)),this._rotated=!!e.rotated,this._name=e.name,this._packable=!!e.packable;var s=e.capInsets;s&&(this._capInsets[0]=s[0],this._capInsets[1]=s[1],this._capInsets[2]=s[2],this._capInsets[3]=s[3]),this.vertices=e.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},i.clone=function(){var t,i,r,n,s,a,o,l,h=new e,u=this.vertices;return h.vertices=u?{x:u.x,y:u.y,triangles:u.triangles,nu:null===(t=u.nu)||void 0===t?void 0:t.slice(0),u:null===(i=u.u)||void 0===i?void 0:i.slice(0),nv:null===(r=u.nv)||void 0===r?void 0:r.slice(0),v:null===(n=u.v)||void 0===n?void 0:n.slice(0)}:null,(s=h.uv).splice.apply(s,[0,h.uv.length].concat(this.uv)),h.uvHash=this.uvHash,(a=h.unbiasUV).splice.apply(a,[0,h.unbiasUV.length].concat(this.unbiasUV)),(o=h.uvSliced).splice.apply(o,[0,h.uvSliced.length].concat(this.uvSliced)),h._rect.set(this._rect),h._offset.set(this._offset),h._originalSize.set(this._originalSize),h._rotated=this._rotated,(l=h._capInsets).splice.apply(l,[0,h._capInsets.length].concat(this._capInsets)),h._atlasUuid=this._atlasUuid,h._texture=this._texture,h._isFlipUVX=this._isFlipUVX,h._isFlipUVY=this._isFlipUVY,h},i._textureLoaded=function(){var t=this._texture,e={},i=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(t)||(e.rect=new mi(0,0,t.width,t.height),i=!0),(0===this._originalSize.width||0===this._originalSize.height||i)&&(e.originalSize=new wi(t.width,t.height),i=!0),i&&(this.reset(e),this.onLoaded()),this._checkPackable()},i._refreshTexture=function(t){this._texture=t,t.loaded?this._textureLoaded():t.once("load",this._textureLoaded,this)},i.initDefault=function(e){t.prototype.initDefault.call(this,e);var i=new ir;i.initDefault(),this._refreshTexture(i),this._calculateUV()},i.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},Be(e,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t)}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?this.reset({texture:t},!0):console.warn("Error Texture in "+this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){window.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}}]),e}(Je))||zL);Xe.SpriteFrame=KL;var qL,ZL=t("SpriteAtlas",Ze("cc.SpriteAtlas")((YL=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"spriteFrames",XL,ti(e)),e}Me(e,t);var i=e.prototype;return i.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var e=this.spriteFrames[t[0]];return e&&e.texture}return null},i.getSpriteFrame=function(t){var e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null},i.getSpriteFrames=function(){for(var t=[],e=this.spriteFrames,i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];t.push(e[n])}return t},i._serialize=function(){},i._deserialize=function(t,e){var i=t;this._name=i.name;var r=i.spriteFrames;this.spriteFrames=Sn();for(var n=0;n<r.length;n+=2)e.result.push(this.spriteFrames,r[n],r[n+1],Tn(KL))},e}(Je),XL=je((WL=YL).prototype,"spriteFrames",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sn()}}),HL=WL))||HL);Xe.SpriteAtlas=ZL;var JL,QL,$L,tF,eF=t("Font",Ze("cc.Font")(qL=function(t){function e(){return t.apply(this,arguments)||this}return Me(e,t),e}(Je))||qL);Xe.Font=eF;var iF,rF,nF,sF,aF,oF,lF,hF,uF,cF=t("TTFFont",Ze("cc.TTFFont")((tF=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_fontFamily",$L,ti(e)),e}return Me(e,t),e.prototype.initDefault=function(e){this._fontFamily="Arial",t.prototype.initDefault.call(this,e)},Be(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:En(this._native),__isNative__:!0}}}]),e}(eF),$L=je((QL=tF).prototype,"_fontFamily",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(QL.prototype,"_nativeAsset",[Qe,An],Object.getOwnPropertyDescriptor(QL.prototype,"_nativeAsset"),QL.prototype),je(QL.prototype,"_nativeDep",[Qe],Object.getOwnPropertyDescriptor(QL.prototype,"_nativeDep"),QL.prototype),JL=QL))||JL);Xe.TTFFont=cF;var pF,dF=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},fF=function(){function t(t){this.letterDefinitions={},this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){for(var t={},e=0,i=Object.keys(this.letterDefinitions);e<i.length;e++){var r=i[e],n=new dF;Cn(n,this.letterDefinitions[r]),t[r]=n}return t},e.getTexture=function(){return this.texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(e)?this.letterDefinitions[e]:null},e.clear=function(){this.letterDefinitions={}},t}(),_F=t("BitmapFont",(iF=Ze("cc.BitmapFont"),rF=si(KL),iF((uF=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"fntDataStr",aF,ti(e)),$e(e,"spriteFrame",oF,ti(e)),$e(e,"fontSize",lF,ti(e)),$e(e,"fntConfig",hF,ti(e)),e}return Me(e,t),e.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new fF(t.texture));var e=this.fntConfig;if(e){var i=e.fontDefDictionary;for(var r in i){var n=new dF,s=i[r].rect;n.offsetX=i[r].xOffset,n.offsetY=i[r].yOffset,n.w=s.width,n.h=s.height,n.u=s.x,n.v=s.y,n.textureID=0,n.valid=!0,n.xAdvance=i[r].xAdvance,this.fontDefDictionary.addLetterDefinitions(r,n)}}else We("The fnt config is not exists!")},e}(eF),aF=je((sF=uF).prototype,"fntDataStr",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),oF=je(sF.prototype,"spriteFrame",[rF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lF=je(sF.prototype,"fontSize",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),hF=je(sF.prototype,"fntConfig",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nF=sF))||nF));Xe.BitmapFont=_F;var gF=t("LabelAtlas",Ze("cc.LabelAtlas")(pF=function(t){function e(){return t.apply(this,arguments)||this}return Me(e,t),e}(_F))||pF);Xe.LabelAtlas=gF;var mF=t("BASELINE_RATIO",.26),yF=t("MIDDLE_RATIO",(mF+1)/2-mF);var vF=new Rn(2);vF.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var bF,SF=new(function(){function t(t){this.count=0,this.limit=0,this.datas={},this.limit=t}var e=t.prototype;return e.moveToHead=function(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t},e.put=function(t,e){var i=vF.get();if(i.key=t,i.value=e,this.count>=this.limit){var r=this.tail;delete this.datas[r.key],this.count--,this.tail=r.prev,this.tail.next=null,r.prev=null,r.next=null,vF.put(r)}this.moveToHead(i)},e.remove=function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},e.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},e.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},e.has=function(t){return!!this.datas[t]},e.delete=function(t){var e=this.datas[t];this.remove(e)},t}())(100),TF=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûа-яА-ЯЁё]+|\S)/,AF=/^[!,.:;'}\]%\?>、‘“》？。，！]/,EF=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁёaáàạảãâấầậẩẫăắằặẳẵiíìịỉĩeéèẹẻẽêếềệểễuúùụủũưứừựửữoóòọỏõôốồộổỗyýỳỵỷỹAÁÀẠẢÃÂẤẦẬẨẪĂẮẰẶẲẴIÍÌỊỈĨEÉÈẸẺẼÊẾỀỆỂỄUÚÙỤỦŨƯỨỪỰỬỮOÓÒỌỎÕÔỐỒỘỔỖYÝỲỴỶỸ]+|\S)$/,CF=/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁёaáàạảãâấầậẩẫăắằặẳẵiíìịỉĩeéèẹẻẽêếềệểễuúùụủũưứừựửữoóòọỏõôốồộổỗyýỳỵỷỹAÁÀẠẢÃÂẤẦẬẨẪĂẮẰẶẲẴIÍÌỊỈĨEÉÈẸẺẼÊẾỀỆỂỄUÚÙỤỦŨƯỨỪỰỬỮOÓÒỌỎÕÔỐỒỘỔỖYÝỲỴỶỸ]+$/,RF=/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁёaáàạảãâấầậẩẫăắằặẳẵiíìịỉĩeéèẹẻẽêếềệểễuúùụủũưứừựửữoóòọỏõôốồộổỗyýỳỵỷỹAÁÀẠẢÃÂẤẦẬẨẪĂẮẰẶẲẴIÍÌỊỈĨEÉÈẸẺẼÊẾỀỆỂỄUÚÙỤỦŨƯỨỪỰỬỮOÓÒỌỎÕÔỐỒỘỔỖYÝỲỴỶỸ]/;function wF(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function xF(t){var e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e}function OF(t,e,i){var r=(i||t.font)+"🎮"+e,n=SF.get(r);if(null!==n)return n;var s=t.measureText(e),a=s&&s.width||0;return SF.put(r,a),a}function PF(t,e,i){var r=e,n=i,s=t[e];if(s>="\udc00"&&s<="\udfff"&&r--,void 0!==i)if(i-1!==e){var a=t[i-1];a>="\ud800"&&a<="\udbff"&&n--}else s>="\ud800"&&s<="\udbff"&&n++;return t.substring(r,n)}function DF(t,e,i,r){var n=[];if(0===t.length||i<0)return n.push(""),n;for(var s=t;e>i&&s.length>1;){for(var a=s.length*(i/e)|0,o=PF(s,a),l=e-r(o),h=o,u=0,c=0;l>i&&c++<10;)a*=i/l,l=e-r(o=PF(s,a|=0));for(c=0;l<=i&&c++<10;){if(o){var p=TF.exec(o);u=p?p[0].length:1,h=o}l=e-r(o=PF(s,a+=u))}0==(a-=u)?(a=1,h=PF(s,1)):1===a&&s[0]>="\ud800"&&s[0]<="\udbff"&&(a=2,h=PF(s,2));var d=PF(s,0,a),f=void 0;AF.test(h||o)&&(0==(a-=(f=EF.exec(d))?f[0].length:0)&&(a=1),h=PF(s,a),d=PF(s,0,a)),RF.test(h)&&(f=CF.exec(d))&&d!==f[0]&&(h=PF(s,a-=f[0].length),d=PF(s,0,a)),(0===n.length||(d=d.trim()).length>0)&&n.push(d),e=r(s=h||o)}return(0===n.length||(s=s.trim()).length>0)&&n.push(s),n}var MF,BF,IF,LF,FF,kF,NF,GF,UF,zF,VF,HF,WF,XF,YF,jF,KF,qF,ZF,JF,QF,$F,tk,ek,ik,rk,nk,sk,ak,ok,lk,hk,uk,ck,pk,dk,fk,_k,gk,mk,yk,vk,bk,Sk,Tk,Ak,Ek,Ck,Rk,wk,xk,Ok,Pk,Dk,Mk,Bk,Ik,Lk,Fk,kk,Nk,Gk,Uk,zk,Vk=t("CanvasPool",function(){function t(){this.pool=[]}t.getInstance=function(){return bF||(bF=new t),bF};var e=t.prototype;return e.get=function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),i=e.getContext("2d");t={canvas:e,context:i}}return t},e.put=function(t){this.pool.length>=Fe.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(t)},t}()),Hk=Ii.WHITE.clone(),Wk=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},Xk="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",Yk=function(){function t(t,e){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=t,this.labelInfo=e,this.hash=t.charCodeAt(0)+e.hash}var e=t.prototype;return e.updateRenderData=function(){this._updateProperties(),this._updateTexture()},e.destroy=function(){this.image=null},e._updateProperties=function(){if(this.data=Vk.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){this.context.font=this.labelInfo.fontDesc;var t=OF(this.context,this.char,this.labelInfo.fontDesc),e=2*this.labelInfo.margin+2;this.width=parseFloat(t.toFixed(2))+e,this.height=(1+mF)*this.labelInfo.fontSize+e,this.offsetY=-this.labelInfo.fontSize*mF/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new er),this.image.reset(this.canvas)},e._updateTexture=function(){if(this.context&&this.canvas){var t=this.context,e=this.labelInfo,i=this.canvas.width,r=this.canvas.height;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,r),t.fillStyle=Xk,t.fillRect(0,0,i,r),t.font=e.fontDesc;var n=e.fontSize,s=i/2,a=r/2+n*yF+0*n,o=e.color;if(t.lineJoin="round",t.fillStyle="rgba("+o.r+", "+o.g+", "+o.b+", 1)",e.isOutlined){var l=e.out||Hk;t.strokeStyle="rgba("+l.r+", "+l.g+", "+l.b+", "+l.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this.char,s,a)}t.fillText(this.char,s,a)}},t}(),jk=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.initWithSize=function(t,e,i){void 0===i&&(i=Kr.RGBA8888),this.reset({width:t,height:e,format:i}),this.loaded=!0,this.emit("load")},i.drawTextureAt=function(t,e,i){var r=this.getGFXTexture();if(t&&r){var n=this._getGFXDevice();if(n){var s=new tt;s.texOffset.x=e,s.texOffset.y=i,s.texExtent.width=t.width,s.texExtent.height=t.height,n.copyTexImagesToTexture([t.data],r,[s])}else console.warn("Unable to get device")}},e}(ir),Kk=function(){function t(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var i=new jk;i.initWithSize(t,e),this.fontDefDictionary=new fF(i),this._halfBleed=1,this._width=t,this._height=e,Ai.on(Ei.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var e=t.prototype;return e.insertLetterTexture=function(t){var e=t.image,i=Ai.root.device;if(!e||!this.fontDefDictionary||!i)return null;var r=e.width,n=e.height;if(this._x+r+0>this._width&&(this._x=0,this._y=this._nextY),this._y+n>this._nextY&&(this._nextY=this._y+n+0),this._nextY>this._height)return He(12100),null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var s=new Wk;return s.u=this._x+this._halfBleed,s.v=this._y+this._halfBleed,s.texture=this.fontDefDictionary.texture,s.valid=!0,s.w=t.width-2,s.h=t.height-2,s.xAdvance=s.w,s.offsetY=t.offsetY,this._x+=r+0,this.fontDefDictionary.addLetterDefinitions(t.hash,s),s},e.update=function(){this._dirty&&(this._dirty=!1)},e.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},e.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},e.getTexture=function(){return this.fontDefDictionary.getTexture()},e.beforeSceneLoad=function(){this.clearAllCache()},e.clearAllCache=function(){this.destroy();var t=new jk;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t},e.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t,e){var i=t.charCodeAt(0)+e.hash,r=this.fontDefDictionary.letterDefinitions[i];if(!r){var n=new Yk(t,e);n.updateRenderData(),r=this.insertLetterTexture(n),n.destroy()}return r},Be(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}(),qk={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:Ii.WHITE.clone(),isOutlined:!1,out:Ii.WHITE.clone(),margin:0};!function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(Nk||(Nk=t("HorizontalTextAlignment",{}))),Li(Nk),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(Gk||(Gk=t("VerticalTextAlignment",{}))),Li(Gk),function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.SHRINK=2]="SHRINK",t[t.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(Uk||(Uk=t("Overflow",{}))),Li(Uk),function(t){t[t.NONE=0]="NONE",t[t.BITMAP=1]="BITMAP",t[t.CHAR=2]="CHAR"}(zk||(zk=t("CacheMode",{}))),Li(zk);var Zk,Jk,Qk,$k=function(e){return t({Label:e,LabelComponent:e}),e}((MF=Ze("cc.Label"),BF=ai(),IF=Ci(110),LF=oi(),FF=Ri(),kF=li(),NF=si(Nk),GF=Ri(),UF=li(),zF=si(Gk),VF=Ri(),HF=li(),WF=Ri(),XF=li(),YF=Ri(),jF=Ni(),KF=li(),qF=Ri(),ZF=li(),JF=si(Uk),QF=Ri(),$F=li(),tk=Ri(),ek=li(),ik=si(eF),rk=Ri(),nk=Ni(),sk=li(),ak=Ri(),ok=li(),lk=si(zk),hk=Ri(),uk=li(),ck=Ri(),pk=li(),dk=Ri(),fk=li(),_k=Ri(),gk=li(),mk=Ni(),MF(yk=BF(yk=IF(yk=LF((kk=Fk=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_string",bk,ti(e)),$e(e,"_horizontalAlign",Sk,ti(e)),$e(e,"_verticalAlign",Tk,ti(e)),$e(e,"_actualFontSize",Ak,ti(e)),$e(e,"_fontSize",Ek,ti(e)),$e(e,"_fontFamily",Ck,ti(e)),$e(e,"_lineHeight",Rk,ti(e)),$e(e,"_overflow",wk,ti(e)),$e(e,"_enableWrapText",xk,ti(e)),$e(e,"_font",Ok,ti(e)),$e(e,"_isSystemFontUsed",Pk,ti(e)),e._spacingX=0,$e(e,"_isItalic",Dk,ti(e)),$e(e,"_isBold",Mk,ti(e)),$e(e,"_isUnderline",Bk,ti(e)),$e(e,"_underlineHeight",Ik,ti(e)),$e(e,"_cacheMode",Lk,ti(e)),e._N$file=null,e._texture=null,e._ttfSpriteFrame=null,e._userDefinedFont=null,e._assemblerData=null,e._fontAtlas=null,e._letterTexture=null,e._ttfSpriteFrame=null,e}Me(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this.updateRenderData(!0)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){if(this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this._ttfSpriteFrame){var e=this._ttfSpriteFrame.texture;if(e&&null===this._ttfSpriteFrame.original){var i=e;i.image&&i.image.destroy(),e.destroy()}this._ttfSpriteFrame=null}this._letterTexture=null,t.prototype.onDestroy.call(this)},i.updateRenderData=function(t){void 0===t&&(t=!1),this.markForUpdateRenderData(),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture())},i._render=function(t){t.commitComp(this,this._texture,this._assembler,null)},i._updateColor=function(){this._font instanceof _F?(this._updateWorldAlpha(),this._colorDirty=!1):(this._updateWorldAlpha(),this._colorDirty?(this.updateRenderData(!1),this._colorDirty=!1):this._cacheAlpha!==this.node._uiProps.opacity&&this._renderFlag&&this._assembler&&this._assembler.updateOpacity&&(this._assembler.updateOpacity(this),this._cacheAlpha=this.node._uiProps.opacity))},i._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var e=this._font;if(e&&e instanceof _F){var i=e.spriteFrame;if(!i||!i.textureLoaded())return!1}return!0},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},i._applyFontTexture=function(){var t=this,e=this._font;if(e instanceof _F){var i=e.spriteFrame,r=function(){t._texture=i,t.changeMaterialForDefine(),t._assembler&&t._assembler.updateRenderData(t)};i&&(i.loaded||i.textureLoaded?r():i.once("load",r,this))}else{if(this.cacheMode===zk.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new KL,this._assemblerData=this._assembler.getAssemblerData();var n=new er(this._assemblerData.canvas)._texture;this._ttfSpriteFrame.texture=n}this.cacheMode!==zk.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this)}},i.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(this.cacheMode!==zk.CHAR){var e=this._texture.texture;if(e instanceof wn){var i=e.getPixelFormat();t=i===Kr.RGBA_ETC1||i===Kr.RGB_A_PVRTC_4BPPV1||i===Kr.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=t?mh.USE_ALPHA_SEPARATED:mh.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},Be(e,[{key:"string",get:function(){return this._string},set:function(t){t+="",this._string!==t&&(this._string=t,this.updateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.updateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.updateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.updateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.updateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.updateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.updateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.updateRenderData())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this._renderData&&(this.destroyRenderData(),this._renderData=null),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._renderData=null,this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this.updateRenderData())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode!==zk.BITMAP||this._font instanceof _F||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),this._cacheMode===zk.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=t,this.updateRenderData(!0))}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.updateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.updateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.updateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.updateRenderData())}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.updateRenderData())}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof _F?this._font.fontSize:-1}}]),e}(Ch),Fk.HorizontalAlign=Nk,Fk.VerticalAlign=Gk,Fk.Overflow=Uk,Fk.CacheMode=zk,Fk._canvasPool=Vk.getInstance(),je((vk=kk).prototype,"string",[FF,kF,xn],Object.getOwnPropertyDescriptor(vk.prototype,"string"),vk.prototype),je(vk.prototype,"horizontalAlign",[NF,GF,UF],Object.getOwnPropertyDescriptor(vk.prototype,"horizontalAlign"),vk.prototype),je(vk.prototype,"verticalAlign",[zF,VF,HF],Object.getOwnPropertyDescriptor(vk.prototype,"verticalAlign"),vk.prototype),je(vk.prototype,"fontSize",[WF,XF],Object.getOwnPropertyDescriptor(vk.prototype,"fontSize"),vk.prototype),je(vk.prototype,"fontFamily",[YF,jF,KF],Object.getOwnPropertyDescriptor(vk.prototype,"fontFamily"),vk.prototype),je(vk.prototype,"lineHeight",[qF,ZF],Object.getOwnPropertyDescriptor(vk.prototype,"lineHeight"),vk.prototype),je(vk.prototype,"overflow",[JF,QF,$F],Object.getOwnPropertyDescriptor(vk.prototype,"overflow"),vk.prototype),je(vk.prototype,"enableWrapText",[tk,ek],Object.getOwnPropertyDescriptor(vk.prototype,"enableWrapText"),vk.prototype),je(vk.prototype,"font",[ik,rk,nk,sk],Object.getOwnPropertyDescriptor(vk.prototype,"font"),vk.prototype),je(vk.prototype,"useSystemFont",[ak,ok],Object.getOwnPropertyDescriptor(vk.prototype,"useSystemFont"),vk.prototype),je(vk.prototype,"cacheMode",[lk,hk,uk],Object.getOwnPropertyDescriptor(vk.prototype,"cacheMode"),vk.prototype),je(vk.prototype,"isBold",[ck,pk],Object.getOwnPropertyDescriptor(vk.prototype,"isBold"),vk.prototype),je(vk.prototype,"isItalic",[dk,fk],Object.getOwnPropertyDescriptor(vk.prototype,"isItalic"),vk.prototype),je(vk.prototype,"isUnderline",[_k,gk],Object.getOwnPropertyDescriptor(vk.prototype,"isUnderline"),vk.prototype),je(vk.prototype,"underlineHeight",[mk,yr],Object.getOwnPropertyDescriptor(vk.prototype,"underlineHeight"),vk.prototype),bk=je(vk.prototype,"_string",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"label"}}),Sk=je(vk.prototype,"_horizontalAlign",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Nk.CENTER}}),Tk=je(vk.prototype,"_verticalAlign",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gk.CENTER}}),Ak=je(vk.prototype,"_actualFontSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ek=je(vk.prototype,"_fontSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Ck=je(vk.prototype,"_fontFamily",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),Rk=je(vk.prototype,"_lineHeight",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),wk=je(vk.prototype,"_overflow",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Uk.NONE}}),xk=je(vk.prototype,"_enableWrapText",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ok=je(vk.prototype,"_font",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pk=je(vk.prototype,"_isSystemFontUsed",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Dk=je(vk.prototype,"_isItalic",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mk=je(vk.prototype,"_isBold",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bk=je(vk.prototype,"_isUnderline",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ik=je(vk.prototype,"_underlineHeight",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Lk=je(vk.prototype,"_cacheMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zk.NONE}}),yk=vk))||yk)||yk)||yk)||yk));!function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(Zk||(Zk={})),Li(Zk),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(Jk||(Jk={})),Li(Jk),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(Qk||(Qk={})),Li(Qk);var tN=Math.PI,eN=Math.min,iN=Math.max,rN=Math.cos,nN=Math.sin,sN=Math.abs,aN=Math.sign,oN=.5522847493;function lN(t,e,i,r,n){t.moveTo(e-r,i),t.bezierCurveTo(e-r,i+n*oN,e-r*oN,i+n,e,i+n),t.bezierCurveTo(e+r*oN,i+n,e+r,i+n*oN,e+r,i),t.bezierCurveTo(e+r,i-n*oN,e+r*oN,i-n,e,i-n),t.bezierCurveTo(e-r*oN,i-n,e-r,i-n*oN,e-r,i),t.close()}function hN(t,e,i,r,n,s,a,o,l,h,u){var c,p,d,f,_,g,m,y,v,b,S,T,A,E,C,R;h>10||(_=.5*(s+o),g=.5*(a+l),m=.5*((c=.5*(e+r))+(d=.5*(r+s))),y=.5*((p=.5*(i+n))+(f=.5*(n+a))),((C=sN((r-o)*(E=l-i)-(n-l)*(A=o-e)))+(R=sN((s-o)*E-(a-l)*A)))*(C+R)<t.tessTol*(A*A+E*E)?t.addPoint(o,l,0===u?u|Qk.PT_BEVEL:u):(hN(t,e,i,c,p,m,y,S=.5*(m+(v=.5*(d+_))),T=.5*(y+(b=.5*(f+g))),h+1,0),hN(t,S,T,v,b,_,g,o,l,h+1,u)))}var uN,cN,pN,dN,fN,_N,gN,mN,yN,vN,bN,SN,TN,AN,EN,CN,RN,wN,xN,ON,PN,DN,MN=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).dx=0,r.dy=0,r.dmx=0,r.dmy=0,r.flags=0,r.len=0,r.reset(),r}return Me(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(_i),BN=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[],this.reset()}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},t}(),IN=function(){function t(){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=Ii.WHITE.clone(),this.lineCap=Zk.BUTT,this.strokeColor=Ii.BLACK.clone(),this.lineJoin=Jk.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,Qk.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,Qk.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,i,r,n,s){var a=this._curPath,o=a.points[a.points.length-1];o&&(o.x!==t||o.y!==e||i!==n||r!==s?(hN(this,o.x,o.y,t,e,i,r,n,s,0,Qk.PT_CORNER),this._commandX=n,this._commandY=s):this.lineTo(n,s))},e.quadraticCurveTo=function(t,e,i,r){var n=this._commandX,s=this._commandY;this.bezierCurveTo(n+2/3*(t-n),s+2/3*(e-s),i+2/3*(t-i),r+2/3*(e-r),i,r)},e.arc=function(t,e,i,r,n,s){!function(t,e,i,r,n,s,a){var o,l,h=0,u=0,c=0,p=0,d=0,f=0,_=0,g=0,m=0,y=0,v=0,b=0,S=0,T=0;if(u=s-n,a=a||!1)if(sN(u)>=2*tN)u=2*tN;else for(;u<0;)u+=2*tN;else if(sN(u)>=2*tN)u=2*-tN;else for(;u>0;)u-=2*tN;for(l=0|iN(1,eN(sN(u)/(.5*tN)+.5,5)),c=sN(4/3*(1-rN(o=u/l/2))/nN(o)),a||(c=-c),T=0;T<=l;T++)f=e+(p=rN(h=n+u*(T/l)))*r,_=i+(d=nN(h))*r,g=-d*r*c,m=p*r*c,0===T?t.moveTo(f,_):t.bezierCurveTo(y+b,v+S,f-g,_-m,f,_),y=f,v=_,b=g,S=m}(this,t,e,i,r,n,s)},e.ellipse=function(t,e,i,r){lN(this,t,e,i,r),this._curPath.complex=!1},e.circle=function(t,e,i){lN(this,t,e,i,i),this._curPath.complex=!1},e.rect=function(t,e,i,r){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+r),this.lineTo(t,e+r),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,i,r,n){!function(t,e,i,r,n,s){if(s<.1)t.rect(e,i,r,n);else{var a=eN(s,.5*sN(r))*aN(r),o=eN(s,.5*sN(n))*aN(n);t.moveTo(e,i+o),t.lineTo(e,i+n-o),t.bezierCurveTo(e,i+n-o*(1-oN),e+a*(1-oN),i+n,e+a,i+n),t.lineTo(e+r-a,i+n),t.bezierCurveTo(e+r-a*(1-oN),i+n,e+r,i+n-o*(1-oN),e+r,i+n-o),t.lineTo(e+r,i+o),t.bezierCurveTo(e+r,i+o*(1-oN),e+r-a*(1-oN),i,e+r-a,i),t.lineTo(e+a,i),t.bezierCurveTo(e+a*(1-oN),i,e,i+o*(1-oN),e,i+o),t.close()}}(this,t,e,i,r,n),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,i=t.length;e<i;e++){var r=t[e];r&&Sh.remove(r)}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=Sh.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,i){var r=this._curPath;if(r){var n=this._points,s=r.points,a=n[this.pointsOffset++];a?(a.x=t,a.y=e):(a=new MN(t,e),n.push(a)),a.flags=i,s.push(a)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new BN,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),LN=[new St(Wt.ATTR_POSITION,p.RGB32F)],FN=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_COLOR,p.RGBA32F)],kN=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RG32F),new St(Wt.ATTR_COLOR,p.RGBA32F)],NN=[new St(Wt.ATTR_POSITION,p.RGB32F),new St(Wt.ATTR_TEX_COORD,p.RG32F),new St(Wt.ATTR_COLOR,p.RGBA32F),new St(Wt.ATTR_COLOR2,p.RGBA32F)];function GN(t){for(var e=0,i=0;i<t.length;i++){var r=t[i];e+=Xt[r.format].count}return e}function UN(t){for(var e=0,i=0;i<t.length;i++){var r=t[i];e+=Xt[r.format].size}return e}Xe.internal.vfmtPosUvColor=kN,Xe.internal.vfmtPosUvTwoColor=NN,t("UIVertexFormat",Object.freeze({__proto__:null,vfmt:LN,vfmtPosColor:FN,vfmtPosUvColor:kN,vfmtPosUvTwoColor:NN,getComponentPerVertex:GN,getAttributeStride:UN}));var zN,VN,HN,WN,XN,YN,jN,KN,qN,ZN,JN,QN,$N,tG,eG,iG,rG,nG,sG,aG,oG,lG,hG,uG,cG,pG,dG=FN.concat([new St("a_dist",p.R32F)]),fG=GN(dG),_G=UN(dG),gG=function(e){return t({Graphics:e,GraphicsComponent:e}),e}((uN=Ze("cc.Graphics"),cN=ai(),pN=Ci(110),dN=oi(),fN=si(Jk),_N=li(),gN=si(Zk),mN=li(),yN=li(),vN=li(),bN=li(),SN=Ni(),uN(TN=cN(TN=pN(TN=dN((DN=PN=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,$e(e,"_lineWidth",EN,ti(e)),$e(e,"_strokeColor",CN,ti(e)),$e(e,"_lineJoin",RN,ti(e)),$e(e,"_lineCap",wN,ti(e)),$e(e,"_fillColor",xN,ti(e)),$e(e,"_miterLimit",ON,ti(e)),e._isDrawing=!1,e._isNeedUploadData=!0,e._graphicsUseSubMeshes=[],e._instanceMaterialType=mh.ADD_COLOR,e.impl=new IN,e}Me(e,t);var i=e.prototype;return i.onRestore=function(){this.impl||this._flushAssembler()},i.onLoad=function(){this.model=Ai.root.createModel(gr),this.model.node=this.model.transform=this.node,this._flushAssembler()},i.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._sceneGetter=null,this.model&&(Ai.root.destroyModel(this.model),this.model=null);var e=this._graphicsUseSubMeshes.length;if(e>0){for(var i=0;i<e;++i)this._graphicsUseSubMeshes[i].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null)},i.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},i.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},i.bezierCurveTo=function(t,e,i,r,n,s){this.impl&&this.impl.bezierCurveTo(t,e,i,r,n,s)},i.quadraticCurveTo=function(t,e,i,r){this.impl&&this.impl.quadraticCurveTo(t,e,i,r)},i.arc=function(t,e,i,r,n,s){this.impl&&this.impl.arc(t,e,i,r,n,s)},i.ellipse=function(t,e,i,r){this.impl&&this.impl.ellipse(t,e,i,r)},i.circle=function(t,e,i){this.impl&&this.impl.circle(t,e,i)},i.rect=function(t,e,i,r){this.impl&&this.impl.rect(t,e,i,r)},i.roundRect=function(t,e,i,r,n){this.impl&&this.impl.roundRect(t,e,i,r,n)},i.fillRect=function(t,e,i,r){this.rect(t,e,i,r),this.fill()},i.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},i.close=function(){this.impl&&this.impl.close()},i.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},i.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},i._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=ki.get("ui-graphics-material"),this.setMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},i.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=Xe.director.root.device,i=e.createBuffer(new nt(_.VERTEX|_.TRANSFER_DST,y.DEVICE,65535*_G,_G)),r=e.createBuffer(new nt(_.INDEX|_.TRANSFER_DST,y.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),n=new cr([i],dG,L.TRIANGLE_LIST,r);n.subMeshIdx=0,this.model.initSubModel(t,n,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(n)}}else He(4500,this.node.name)},i._uploadData=function(t){var e=this.impl;if(e){var i=e&&e.getRenderDataList();if(!(i.length<=0)&&this.model){for(var r=this.model.subModels,n=0;n<i.length;n++){var s=i[n],a=r[n].inputAssembler;if(s.lastFilledVertex!==s.vertexStart){var o=new Float32Array(s.vData.buffer,0,s.vertexStart*fG);a.vertexBuffers[0].update(o),a.vertexCount=s.vertexStart;var l=new Uint16Array(s.iData.buffer,0,s.indicesStart);a.indexBuffer.update(l),a.indexCount=s.indicesStart,s.lastFilledVertex=s.vertexStart,s.lastFilledIndices=s.indicesStart}}t.removeUploadBuffersFunc(this),this._isNeedUploadData=!1}}},i._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),i=this.model.subModels.length;if(e.length>i)for(var r=i;r<e.length;r++)this.activeSubModel(r)}t.addUploadBuffersFunc(this,this._uploadData)}t.commitModel(this,this.model,this.getMaterialInstance(0))},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},i._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},Be(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(){}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(){}}]),e}(Ch),PN.LineJoin=Jk,PN.LineCap=Zk,je((AN=DN).prototype,"lineWidth",[yr],Object.getOwnPropertyDescriptor(AN.prototype,"lineWidth"),AN.prototype),je(AN.prototype,"lineJoin",[fN,_N],Object.getOwnPropertyDescriptor(AN.prototype,"lineJoin"),AN.prototype),je(AN.prototype,"lineCap",[gN,mN],Object.getOwnPropertyDescriptor(AN.prototype,"lineCap"),AN.prototype),je(AN.prototype,"strokeColor",[yN],Object.getOwnPropertyDescriptor(AN.prototype,"strokeColor"),AN.prototype),je(AN.prototype,"fillColor",[vN],Object.getOwnPropertyDescriptor(AN.prototype,"fillColor"),AN.prototype),je(AN.prototype,"miterLimit",[bN],Object.getOwnPropertyDescriptor(AN.prototype,"miterLimit"),AN.prototype),je(AN.prototype,"color",[Qe,SN],Object.getOwnPropertyDescriptor(AN.prototype,"color"),AN.prototype),EN=je(AN.prototype,"_lineWidth",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),CN=je(AN.prototype,"_strokeColor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.BLACK.clone()}}),RN=je(AN.prototype,"_lineJoin",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jk.MITER}}),wN=je(AN.prototype,"_lineCap",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Zk.BUTT}}),xN=je(AN.prototype,"_fillColor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),ON=je(AN.prototype,"_miterLimit",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),TN=AN))||TN)||TN)||TN)||TN)),mG=new gi,yG=new _i,vG=new gi,bG=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(pG||(pG={})),Li(pG);var SG=function(e){return t({Mask:e,MaskComponent:e}),e}((zN=Ze("cc.Mask"),VN=ai(),HN=Ci(110),WN=oi(),XN=si(pG),YN=Ri(),jN=li(),KN=Ri(),qN=li(),ZN=Ni(),JN=si(KL),QN=Ni(),$N=Ni(),tG=hi(),eG=Ni(),iG=Ni(),zN(rG=VN(rG=HN(rG=WN((cG=uG=function(t){function e(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,$e(e,"_type",sG,ti(e)),$e(e,"_inverted",aG,ti(e)),$e(e,"_segments",oG,ti(e)),$e(e,"_spriteFrame",lG,ti(e)),$e(e,"_alphaThreshold",hG,ti(e)),e._graphics=null,e._clearModelMesh=null,e._instanceMaterialType=mh.ADD_COLOR,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},i.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics()},i.onRestore=function(){this._createGraphics(),t.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},i.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearModel&&this._clearModelMesh&&(Ai.root.destroyModel(this._clearModel),this._clearModelMesh.destroy()),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics()},i.isHit=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,r=i.width,n=i.height,s=yG;this.node.getWorldMatrix(mG),gi.invert(vG,mG),_i.transformMat4(s,t,vG);var a=e.anchorPoint;s.x+=a.x*r,s.y+=a.y*n;var o=!1;if(this.type===pG.RECT||this.type===pG.GRAPHICS_STENCIL)o=s.x>=0&&s.y>=0&&s.x<=r&&s.y<=n;else if(this.type===pG.ELLIPSE){var l=r/2,h=n/2,u=s.x-.5*r,c=s.y-.5*n;o=u*u/(l*l)+c*c/(h*h)<1}return this._inverted&&(o=!o),o},i._render=function(t){t.commitComp(this,null,this._assembler,null)},i._postRender=function(t){this._postAssembler&&t.commitComp(this,null,this._postAssembler,null)},i._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},i._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==pG.IMAGE_STENCIL||null!==this._spriteFrame)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this),i=e.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==i&&(this._postAssembler=i),this._useRenderData()},i._createGraphics=function(){if(!this._graphics){var t=this._graphics=new gG;t._objFlags|=Ki.Flags.IsOnLoadCalled,t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=Ii.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},i._updateGraphics=function(){if(this._graphics&&(this._type===pG.RECT||this._type===pG.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,r=i.width,n=i.height,s=t.anchorPoint,a=-r*s.x,o=-n*s.y;if(this._type===pG.RECT)e.rect(a,o,r,n);else if(this._type===pG.ELLIPSE){for(var l=function(t,e,i){bG.length=0;for(var r=2*Math.PI/i,n=0;n<i;++n)bG.push(new Si(e.x*Math.cos(r*n)+t.x,e.y*Math.sin(r*n)+t.y,0));return bG}(new Si(a+r/2,o+n/2,0),new Si(r/2,n/2,0),this._segments),h=0;h<l.length;++h){var u=l[h];0===h?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}e.close()}e.fill()}},i._createClearModel=function(){if(!this._clearModel){var t=ki.get("default-clear-stencil");this._clearStencilMtl=new nn({parent:t,owner:this,subModelIdx:0}),this._clearModel=Ai.root.createModel(gr),this._clearModel.node=this._clearModel.transform=this.node;var e=UN(LN),i=Xe.director.root.device,r=i.createBuffer(new nt(_.VERTEX|_.TRANSFER_DST,y.DEVICE,4*e,e)),n=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);r.update(n);var s=i.createBuffer(new nt(_.INDEX|_.TRANSFER_DST,y.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),a=new Uint16Array([0,1,2,2,1,3]);s.update(a),this._clearModelMesh=new cr([r],LN,L.TRIANGLE_LIST,s),this._clearModelMesh.subMeshIdx=0,this._clearModel.initSubModel(0,this._clearModelMesh,this._clearStencilMtl)}},i._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=Yl.DISABLED,this._type===pG.IMAGE_STENCIL?(t=ki.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=ki.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},i._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},i._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},i._useRenderData=function(){this._type!==pG.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},Be(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==pG.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){Xe.game.renderType!==Pn.RENDER_TYPE_CANVAS?(this._inverted=t,this.stencilStage=Yl.DISABLED,this._graphics&&(this._graphics.stencilStage=Yl.DISABLED)):He(4202)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=Ye(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===pG.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===pG.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]),e}(Ch),uG.Type=pG,je((nG=cG).prototype,"type",[XN,YN,jN],Object.getOwnPropertyDescriptor(nG.prototype,"type"),nG.prototype),je(nG.prototype,"inverted",[KN,qN],Object.getOwnPropertyDescriptor(nG.prototype,"inverted"),nG.prototype),je(nG.prototype,"segments",[ZN],Object.getOwnPropertyDescriptor(nG.prototype,"segments"),nG.prototype),je(nG.prototype,"spriteFrame",[JN,QN],Object.getOwnPropertyDescriptor(nG.prototype,"spriteFrame"),nG.prototype),je(nG.prototype,"alphaThreshold",[$N,tG,Yi],Object.getOwnPropertyDescriptor(nG.prototype,"alphaThreshold"),nG.prototype),je(nG.prototype,"color",[Qe,eG],Object.getOwnPropertyDescriptor(nG.prototype,"color"),nG.prototype),je(nG.prototype,"customMaterial",[Qe,iG],Object.getOwnPropertyDescriptor(nG.prototype,"customMaterial"),nG.prototype),sG=je(nG.prototype,"_type",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pG.RECT}}),aG=je(nG.prototype,"_inverted",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oG=je(nG.prototype,"_segments",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),lG=je(nG.prototype,"_spriteFrame",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hG=je(nG.prototype,"_alphaThreshold",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),rG=nG))||rG)||rG)||rG)||rG));On._comp=SG,Xe.Mask=SG;var TG,AG,EG,CG,RG,wG,xG,OG,PG,DG,MG,BG,IG,LG,FG,kG,NG,GG,UG,zG,VG,HG,WG,XG,YG,jG,KG,qG,ZG,JG,QG,$G,tU,eU,iU,rU,nU,sU,aU,oU,lU,hU,uU,cU,pU,dU,fU,_U,gU,mU,yU,vU,bU,SU,TU,AU=/^(click)(\s)*=|(param)(\s)*=/,EU=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,CU=t("HtmlTextParser",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var r=t.indexOf(">",e),n=-1;if(r>=0&&(n=t.lastIndexOf("<",r))<e-1&&(n=t.indexOf("<",r+1),r=t.indexOf(">",n+1)),n<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var s=t.substring(e,n),a=t.substring(n+1,r);""===a&&(s=t.substring(e,r+1)),this._processResult(s),-1===r?r=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(a),e=r+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),r="",n=0,s="";if(i){if(r=i[0],""===(t=t.substring(r.length).trim()))return e;switch(n=t.indexOf(" "),r[0]){case"c":e.color=n>-1?t.substring(0,n).trim():t;break;case"s":e.size=parseInt(t)}return n>-1&&(s=t.substring(n+1).trim(),e.event=this._processEventHandler(s)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(r=i[0].trim()).startsWith("br")&&"/"===r[r.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var a="";if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(r=i[0].trim()).startsWith("img")&&"/"===r[r.length-1]){var o;i=EU.exec(t);for(var l=!1;i;){if(r=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),o=(n=(a=t.substring(r.length).trim()).indexOf(" "))>-1?a.substr(0,n):a,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=a.substring(n).trim(),o.endsWith("/")&&(o=o.slice(0,-1)),"src"===r){switch(o.charCodeAt(0)){case 34:case 39:l=!0,o=o.slice(1,-1)}e.isImage=!0,e.src=o}else if("height"===r)e.imageHeight=parseInt(o);else if("width"===r)e.imageWidth=parseInt(o);else if("align"===r){switch(o.charCodeAt(0)){case 34:case 39:o=o.slice(1,-1)}e.imageAlign=o.toLowerCase()}else"offset"===r?e.imageOffset=o:"click"===r&&(e.event=this._processEventHandler(r+"="+o));e.event&&"param"===r&&(e.event[r]=o.replace(/^"|"$/g,"")),i=EU.exec(t)}return l&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var h={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var u,c=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=c.exec(t);i;)r=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),u=(n=(a=t.substring(r.length).trim()).indexOf(" "))>-1?a.substr(0,n):a,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=a.substring(n).trim(),"click"===r?e.event=this._processEventHandler(r+"="+u):"color"===r?h.color=u:"width"===r&&(h.width=parseInt(u)),e.event&&"param"===r&&(e.event[r]=u.replace(/^"|"$/g,"")),i=c.exec(t)}e.outline=h}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(r=i[0],t=t.substring(r.length).trim(),r[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e._processEventHandler=function(t){for(var e={},i=0,r=!1,n=AU.exec(t);n;){var s=n[0],a="";if(r=!1,'"'===(t=t.substring(s.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(a=t.substring(1,i).trim(),r=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(a=t.substring(1,i).trim(),r=!0),i++;else{var o=/(\S)+/.exec(t);i=(a=o?o[0]:"").length}r&&(e[s=s.substring(0,s.length-1).trim()]=a),t=t.substring(i).trim(),n=AU.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var r in i)e[r]||(e[r]=i[r]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=ke(this._specialSymbolArray);!(e=i()).done;){var r=e.value,n=r[0],s=r[1];t=t.replace(n,s)}return t},t}()),RU=function(e){return t({LabelOutline:e,LabelOutlineComponent:e}),e}((TG=Ze("cc.LabelOutline"),AG=ai(),EG=Ci(110),CG=oi(),RG=xi($k),wG=li(),xG=li(),TG(OG=AG(OG=EG(OG=CG(OG=RG(OG=vi((BG=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_color",DG,ti(e)),$e(e,"_width",MG,ti(e)),e}Me(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent($k);t&&t.updateRenderData(!0)},Be(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(ui),DG=je((PG=BG).prototype,"_color",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(0,0,0,255)}}),MG=je(PG.prototype,"_width",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),je(PG.prototype,"color",[wG],Object.getOwnPropertyDescriptor(PG.prototype,"color"),PG.prototype),je(PG.prototype,"width",[xG],Object.getOwnPropertyDescriptor(PG.prototype,"width"),PG.prototype),OG=PG))||OG)||OG)||OG)||OG)||OG)||OG));!function(t){t[t.SIMPLE=0]="SIMPLE",t[t.SLICED=1]="SLICED",t[t.TILED=2]="TILED",t[t.FILLED=3]="FILLED"}(vU||(vU={})),Li(vU),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.RADIAL=2]="RADIAL"}(bU||(bU={})),Li(bU),function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TRIMMED=1]="TRIMMED",t[t.RAW=2]="RAW"}(SU||(SU={})),Li(SU),function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(TU||(TU={}));var wU,xU,OU,PU,DU,MU,BU,IU,LU,FU,kU,NU,GU,UU,zU,VU,HU,WU,XU,YU,jU,KU,qU,ZU,JU,QU,$U,tz,ez,iz,rz,nz,sz,az,oz,lz=function(e){return t({Sprite:e,SpriteComponent:e}),e}((IG=Ze("cc.Sprite"),LG=ai(),FG=Ci(110),kG=oi(),NG=si(ZL),GG=Ri(),UG=li(),zG=si(KL),VG=Ri(),HG=li(),WG=si(vU),XG=Ri(),YG=li(),jG=si(bU),KG=li(),qG=li(),ZG=hi(),JG=li(),QG=hi(),$G=li(),tU=Ri(),eU=li(),iU=si(SU),rU=Ri(),nU=li(),IG(sU=LG(sU=FG(sU=kG((yU=mU=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_spriteFrame",oU,ti(e)),$e(e,"_type",lU,ti(e)),$e(e,"_fillType",hU,ti(e)),$e(e,"_sizeMode",uU,ti(e)),$e(e,"_fillCenter",cU,ti(e)),$e(e,"_fillStart",pU,ti(e)),$e(e,"_fillRange",dU,ti(e)),$e(e,"_isTrimmedMode",fU,ti(e)),$e(e,"_useGrayscale",_U,ti(e)),$e(e,"_atlas",gU,ti(e)),e}Me(e,t);var i=e.prototype;return i.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this),this._spriteFrame&&this._spriteFrame.once("load",this._onTextureLoaded,this)},i.onEnable=function(){t.prototype.onEnable.call(this),this._activateMaterial(),this._markForUpdateUvDirty()},i.onDestroy=function(){this.destroyRenderData(),this._spriteFrame&&!this._spriteFrame.loaded&&this._spriteFrame.off("load",this._onTextureLoaded,this),t.prototype.onDestroy.call(this)},i.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}else console.warn("SpriteAtlas is null.")},i.changeMaterialForDefine=function(){var t,e=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);var i=!1;if(t instanceof wn){var r=t.getPixelFormat();i=r===Kr.RGBA_ETC1||r===Kr.RGB_A_PVRTC_4BPPV1||r===Kr.RGB_A_PVRTC_2BPPV1}i&&this.grayscale?this._instanceMaterialType=mh.USE_ALPHA_SEPARATED_AND_GRAY:i?this._instanceMaterialType=mh.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=mh.GRAYSCALE:this._instanceMaterialType=mh.ADD_COLOR_AND_TEXTURE,e!==this._instanceMaterialType&&this.updateMaterial()},i._updateBuiltinMaterial=function(){var e=t.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&this.spriteFrame.texture instanceof Dn){var i=Mn({SAMPLE_FROM_RT:!0},e.passes[0].defines),r=new Fi;r.initialize({effectAsset:e.effectAsset,defines:i}),e=r}return e},i._render=function(t){t.commitComp(this,this._spriteFrame,this._assembler,null)},i._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var e=this._spriteFrame;return!(!e||!e.textureLoaded())},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this._colorDirty=!0,this._updateColor())},i._applySpriteSize=function(){if(this._spriteFrame){if(!this._spriteFrame.isDefault)if(SU.RAW===this._sizeMode){var t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if(SU.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this._activateMaterial()}},i._resized=function(){},i._activateMaterial=function(){var t=this._spriteFrame,e=this.getRenderMaterial(0);Xe.game.renderType!==Xe.game.RENDER_TYPE_CANVAS?(t&&e&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=e)):this.markForUpdateRenderData()},i._onTextureLoaded=function(){this.isValid&&(this.changeMaterialForDefine(),this._applySpriteSize())},i._applySpriteFrame=function(t){var e=this._spriteFrame;this._renderData&&(t&&!t.loaded&&t.off("load",this._onTextureLoaded,this),this._renderData.uvDirty||(this._renderData.uvDirty=!t||!e||t.uvHash!==e.uvHash),this._renderDataFlag=this._renderData.uvDirty);var i=!1;e&&(t&&t.texture===e.texture||(i=!0),e.loaded?i?this._onTextureLoaded():this._applySpriteSize():e.once("load",this._onTextureLoaded,this))},i._markForUpdateUvDirty=function(){this._renderData&&(this._renderData.uvDirty=!0,this._renderDataFlag=!0)},Be(e,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(t===bU.RADIAL||this._fillType===bU.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===vU.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=Ye(t,-1,1),this._type===vU.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=Ye(t,-1,1),this._type===vU.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type===vU.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this._instanceMaterialType=!0===t?mh.GRAYSCALE:mh.ADD_COLOR_AND_TEXTURE,this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,t!==SU.CUSTOM&&this._applySpriteSize())}}]),e}(Ch),mU.FillType=bU,mU.Type=vU,mU.SizeMode=SU,mU.EventType=TU,je((aU=yU).prototype,"spriteAtlas",[NG,GG,UG],Object.getOwnPropertyDescriptor(aU.prototype,"spriteAtlas"),aU.prototype),je(aU.prototype,"spriteFrame",[zG,VG,HG],Object.getOwnPropertyDescriptor(aU.prototype,"spriteFrame"),aU.prototype),je(aU.prototype,"type",[WG,XG,YG],Object.getOwnPropertyDescriptor(aU.prototype,"type"),aU.prototype),je(aU.prototype,"fillType",[jG,KG],Object.getOwnPropertyDescriptor(aU.prototype,"fillType"),aU.prototype),je(aU.prototype,"fillCenter",[qG],Object.getOwnPropertyDescriptor(aU.prototype,"fillCenter"),aU.prototype),je(aU.prototype,"fillStart",[ZG,JG],Object.getOwnPropertyDescriptor(aU.prototype,"fillStart"),aU.prototype),je(aU.prototype,"fillRange",[QG,$G],Object.getOwnPropertyDescriptor(aU.prototype,"fillRange"),aU.prototype),je(aU.prototype,"trim",[tU,eU],Object.getOwnPropertyDescriptor(aU.prototype,"trim"),aU.prototype),je(aU.prototype,"grayscale",[yr],Object.getOwnPropertyDescriptor(aU.prototype,"grayscale"),aU.prototype),je(aU.prototype,"sizeMode",[iU,rU,nU],Object.getOwnPropertyDescriptor(aU.prototype,"sizeMode"),aU.prototype),oU=je(aU.prototype,"_spriteFrame",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lU=je(aU.prototype,"_type",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vU.SIMPLE}}),hU=je(aU.prototype,"_fillType",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bU.HORIZONTAL}}),uU=je(aU.prototype,"_sizeMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return SU.TRIMMED}}),cU=je(aU.prototype,"_fillCenter",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(0,0)}}),pU=je(aU.prototype,"_fillStart",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dU=je(aU.prototype,"_fillRange",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fU=je(aU.prototype,"_isTrimmedMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_U=je(aU.prototype,"_useGrayscale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gU=je(aU.prototype,"_atlas",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sU=aU))||sU)||sU)||sU)||sU)),hz=new CU,uz="RICHTEXT_CHILD",cz="RICHTEXT_Image_CHILD",pz=new Rn((function(t){if(!Xe.isValid(t.node))return!1;var e=t.node.getComponent(RU);return e&&(e.width=0),!0}),20),dz=new Rn((function(t){return Xe.isValid(t.node)}),10);function fz(t){return{node:new Yr(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function _z(t,e){var i;t===uz?i=pz._get():t===cz&&(i=dz._get());var r=(i=i||fz(t)).node;return r||(r=new Yr(t)),r.hideFlags|=Ki.Flags.DontSave|Ki.Flags.HideInHierarchy,t===cz?(i.comp=r.getComponent(lz)||r.addComponent(lz),i.comp.spriteFrame=e,i.comp.type=lz.Type.SLICED,i.comp.sizeMode=lz.SizeMode.CUSTOM):(i.comp=r.getComponent($k)||r.addComponent($k),i.comp.string=e,i.comp.horizontalAlign=Nk.LEFT,i.comp.verticalAlign=Gk.TOP),r.setPosition(0,0,0),r._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=r,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var gz,mz=function(e){return t({RichText:e,RichTextComponent:e}),e}((wU=Ze("cc.RichText"),xU=ai(),OU=Ci(110),PU=oi(),DU=li(),MU=si(Nk),BU=li(),IU=li(),LU=li(),FU=si(eF),kU=li(),NU=li(),GU=si(zk),UU=li(),zU=li(),VU=li(),HU=si(ZL),WU=li(),XU=li(),wU(YU=xU(YU=OU(YU=PU(YU=vi((oz=az=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_lineHeight",KU,ti(e)),$e(e,"_string",qU,ti(e)),$e(e,"_horizontalAlign",ZU,ti(e)),$e(e,"_fontSize",JU,ti(e)),$e(e,"_maxWidth",QU,ti(e)),$e(e,"_fontFamily",$U,ti(e)),$e(e,"_font",tz,ti(e)),$e(e,"_isSystemFontUsed",ez,ti(e)),$e(e,"_userDefinedFont",iz,ti(e)),$e(e,"_cacheMode",rz,ti(e)),$e(e,"_imageAtlas",nz,ti(e)),$e(e,"_handleTouchEvent",sz,ti(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._updateRichTextStatus=e._updateRichText,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this.node.on(bi.LAYER_CHANGED,this._applyLayer,this)},i.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},i.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},i.start=function(){this._onTTFLoaded(),this.node.on(Yr.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this)},i.onRestore=function(){},i.onDestroy=function(){for(var t,e=ke(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),i.type===uz?pz.put(i):i.type===cz&&dz.put(i)}this.node.off(Yr.EventType.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(bi.LAYER_CHANGED,this._applyLayer,this)},i._addEventListeners=function(){this.node.on(Yr.EventType.TOUCH_END,this._onTouchEnded,this)},i._removeEventListeners=function(){this.node.off(Yr.EventType.TOUCH_END,this._onTouchEnded,this)},i._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},i._createFontLabel=function(t){return _z(uz,t)},i._createImage=function(t){return _z(cz,t)},i._onTTFLoaded=function(){var t=this;this._font instanceof cF?this._font._nativeAsset?(this._layoutDirty=!0,this._updateRichText()):Bn.postLoadNative(this._font,(function(){t.isValid&&(t._layoutDirty=!0,t._updateRichText())})):(this._layoutDirty=!0,this._updateRichText())},i._measureText=function(t,e){var i=this,r=function(e){var r;return 0===i._labelSegmentsCache.length?(r=i._createFontLabel(e),i._labelSegmentsCache.push(r)):(r=i._labelSegmentsCache[0]).node.getComponent($k).string=e,r.styleIndex=t,i._applyTextAttribute(r),r.node._uiProps.uiTransformComp.contentSize.width};return e?r(e):r},i._onTouchEnded=function(t){for(var e,i=this,r=this.node.getComponents(ui),n=function(){var n=e.value,s=n.clickHandler,a=n.clickParam;s&&i._containsTouchLocation(n,t.touch.getUILocation())&&(r.forEach((function(e){var i=e[s];e.enabledInHierarchy&&i&&i.call(e,t,a)})),t.propagationStopped=!0)},s=ke(this._segments);!(e=s()).done;)n()},i._containsTouchLocation=function(t,e){var i=t.node.getComponent(Ml);return!!i&&i.getBoundingBoxToWorld().contains(e)},i._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if(i.name===uz||i.name===cz){i.parent===this.node?i.parent=null:t.splice(e,1);var r=fz(i.name);r.node=i,i.name===uz?(r.comp=i.getComponent($k),pz.put(r)):(r.comp=i.getComponent(lz),dz.put(r))}}t.length=0,this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},i._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];i.name!==uz&&i.name!==cz||(i.active=t)}},i._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var r=(i=this._labelSegmentsCache.pop()).node.getComponent($k);r&&(r.string=t)}return i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this._applyTextAttribute(i),this.node.addChild(i.node),this._segments.push(i),i},i._updateRichTextWithMaxWidth=function(t,e,i){var r=e;if(this._lineOffsetX>0&&r+this._lineOffsetX>this._maxWidth)for(var n=0;this._lineOffsetX<=this._maxWidth;){var s=this._getFirstWordLen(t,n,t.length),a=t.substr(n,s),o=this._measureText(i,a);if(!(this._lineOffsetX+o<=this._maxWidth)){if(n>0){var l=t.substr(0,n);this._addLabelSegment(l,i),t=t.substr(n,t.length),r=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=o,n+=s}if(r>this._maxWidth)for(var h=DF(t,r,this._maxWidth,this._measureText(i)),u=0;u<h.length;++u){var c=h[u],p=this._addLabelSegment(c,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=p.width,h.length>1&&u<h.length-1&&this._updateLineInfo()}else this._lineOffsetX+=r,this._addLabelSegment(t,i)},i._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},i._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},i._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],r=t[e];if(i.text!==r.text)return!0;var n=i.style,s=r.style;if(n){if(s){if(!!s.outline!=!!n.outline)return!0;if(n.size!==s.size||n.italic!==s.italic||n.isImage!==s.isImage)return!0;if(n.src!==s.src||n.imageAlign!==s.imageAlign||n.imageHeight!==s.imageHeight||n.imageWidth!==s.imageWidth||n.imageOffset!==s.imageOffset)return!0}else if(n.size||n.italic||n.isImage||n.outline)return!0}else if(s&&(s.size||s.italic||s.isImage||s.outline))return!0}return!1},i._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,r=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(r){var n=this._createImage(r);switch(n.comp,e.imageAlign){case"top":n.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":n.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:n.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}n.node.layer=this.node.layer,this.node.addChild(n.node),this._segments.push(n);var s=r.rect.clone(),a=1,o=s.width,l=s.height,h=e.imageWidth||0,u=e.imageHeight||0;u>0?(o*=a=u/l,l*=a):(o*=a=this._lineHeight/l,l*=a),h>0&&(o=h),this._maxWidth>0?(this._lineOffsetX+o>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=o):(this._lineOffsetX+=o,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),n.node._uiProps.uiTransformComp.setContentSize(o,l),n.lineCount=this._lineCount,n.clickHandler="",n.clickParam="";var c=e.event;c&&(n.clickHandler=c.click,n.clickParam=c.param)}else He(4400)}},i._updateRichText=function(){if(this.enabledInHierarchy){var t=hz.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,r=0;r<this._textArray.length;++r){var n=this._textArray[r],s=n.text;if(void 0!==s){if(""===s){if(n.style&&n.style.isNewLine){this._updateLineInfo();continue}if(n.style&&n.style.isImage&&this._imageAtlas){this._addRichTextImageElement(n);continue}}for(var a=s.split("\n"),o=0;o<a.length;++o){var l=a[o];if(""!==l)if(i=!1,this._maxWidth>0){var h=this._measureText(r,l);this._updateRichTextWithMaxWidth(l,h,r),a.length>1&&o<a.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(l,r),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),a.length>1&&o<a.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(s)&&o===a.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+mF)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},i._getFirstWordLen=function(t,e,i){var r=t.charAt(e);if(wF(r)||xF(r))return 1;for(var n=1,s=e+1;s<i&&!xF(r=t.charAt(s))&&!wF(r);++s)n++;return n},i._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,r=this.node._uiProps.uiTransformComp,n=r.anchorX,s=r.anchorY,a=0;a<this._segments.length;++a){var o=this._segments[a],l=o.lineCount;l>e&&(t=0,e=l);var h=this._labelWidth*(.5*this._horizontalAlign-n);switch(this._horizontalAlign){case Nk.LEFT:break;case Nk.CENTER:h-=this._linesWidth[l-1]/2;break;case Nk.RIGHT:h-=this._linesWidth[l-1]}var u=o.node.position;if(o.node.setPosition(t+h,this._lineHeight*(i-l)-this._labelHeight*s,u.z),l===e&&(t+=o.node._uiProps.uiTransformComp.width),o.node.getComponent(lz)){var c=o.node.position.clone(),p=this._lineHeight,d=this._lineHeight*(1+mF);switch(o.node._uiProps.uiTransformComp.anchorY){case 1:c.y+=p+(d-p)/2;break;case.5:c.y+=d/2;break;default:c.y+=(d-p)/2}if(o.imageOffset){var f=o.imageOffset.split(",");if(1===f.length&&f[0]){var _=parseFloat(f[0]);Number.isInteger(_)&&(c.y+=_)}else if(2===f.length){var g=parseFloat(f[0]),m=parseFloat(f[1]);Number.isInteger(g)&&(c.x+=g),Number.isInteger(m)&&(c.y+=m)}}o.node.position=c}var y=o.node.getComponent(RU);if(y){var v=o.node.position.clone();v.y-=y.width,o.node.position=v}}},i._convertLiteralColorValue=function(t){var e=t.toUpperCase();return Ii[e]?Ii[e]:(new Ii).fromHEX(t)},i._applyTextAttribute=function(t){var e=t.node.getComponent($k);if(e){var i,r=t.styleIndex;if(this._textArray[r]&&(i=this._textArray[r].style),i){if(e.color=this._convertLiteralColorValue(i.color||"white"),e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var n=t.node.getComponent(RU);n||(n=t.node.addComponent(RU)),n.color=this._convertLiteralColorValue(i.outline.color),n.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var s=i.event;s&&(t.clickHandler=s.click||"",t.clickParam=s.param||"")}else e.fontSize=this._fontSize;e.cacheMode=this._cacheMode,this._font instanceof eF&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var a=e._assembler;a&&a.updateRenderData(e)}},i._applyLayer=function(){for(var t,e=ke(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},Be(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(yh),az.HorizontalAlign=Nk,az.VerticalAlign=Gk,je((jU=oz).prototype,"string",[xn,DU],Object.getOwnPropertyDescriptor(jU.prototype,"string"),jU.prototype),je(jU.prototype,"horizontalAlign",[MU,BU],Object.getOwnPropertyDescriptor(jU.prototype,"horizontalAlign"),jU.prototype),je(jU.prototype,"fontSize",[IU],Object.getOwnPropertyDescriptor(jU.prototype,"fontSize"),jU.prototype),je(jU.prototype,"fontFamily",[LU],Object.getOwnPropertyDescriptor(jU.prototype,"fontFamily"),jU.prototype),je(jU.prototype,"font",[FU,kU],Object.getOwnPropertyDescriptor(jU.prototype,"font"),jU.prototype),je(jU.prototype,"useSystemFont",[NU],Object.getOwnPropertyDescriptor(jU.prototype,"useSystemFont"),jU.prototype),je(jU.prototype,"cacheMode",[GU,UU],Object.getOwnPropertyDescriptor(jU.prototype,"cacheMode"),jU.prototype),je(jU.prototype,"maxWidth",[zU],Object.getOwnPropertyDescriptor(jU.prototype,"maxWidth"),jU.prototype),je(jU.prototype,"lineHeight",[VU],Object.getOwnPropertyDescriptor(jU.prototype,"lineHeight"),jU.prototype),je(jU.prototype,"imageAtlas",[HU,WU],Object.getOwnPropertyDescriptor(jU.prototype,"imageAtlas"),jU.prototype),je(jU.prototype,"handleTouchEvent",[XU],Object.getOwnPropertyDescriptor(jU.prototype,"handleTouchEvent"),jU.prototype),KU=je(jU.prototype,"_lineHeight",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),qU=je(jU.prototype,"_string",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),ZU=je(jU.prototype,"_horizontalAlign",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Nk.LEFT}}),JU=je(jU.prototype,"_fontSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),QU=je(jU.prototype,"_maxWidth",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$U=je(jU.prototype,"_fontFamily",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),tz=je(jU.prototype,"_font",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ez=je(jU.prototype,"_isSystemFontUsed",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),iz=je(jU.prototype,"_userDefinedFont",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rz=je(jU.prototype,"_cacheMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zk.NONE}}),nz=je(jU.prototype,"_imageAtlas",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sz=je(jU.prototype,"_handleTouchEvent",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),YU=jU))||YU)||YU)||YU)||YU)||YU)),yz=function(e){return t({UIMeshRenderer:e,UIModelComponent:e}),e}(Ze("cc.UIMeshRenderer")(gz=ai()(gz=Ci(110)(gz=oi()(gz=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._models=null,e._modelComponent=null,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?this._models=this._modelComponent._collectModels():console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},i.onEnable=function(){t.prototype.onEnable.call(this)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,this._models=null)},i.updateAssembler=function(t){if(this._models){this._modelComponent._detachFromScene();for(var e,i=ke(this._models);!(e=i()).done;){var r=e.value;t.commitModel.call(t,this,r,this._modelComponent.material)}return!0}return!1},i.update=function(){this._fitUIRenderQueue()},i._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var r=i.passes,n=r.length,s=0;s<n;s++){var a=r[s];a._priority=In.MAX-11,a.blendState.targets[0].blend||i.overridePipelineStates({blendState:{targets:[{blend:!0}]}},s)}}},Be(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(yh))||gz)||gz)||gz)||gz),vz=t("MeshBuffer",function(){function t(t){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=t}var e=t.prototype;return e.initialize=function(t,e){this._outOfCallback=e;var i=GN(t);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var r=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new nt(_.VERTEX|_.TRANSFER_DST,y.HOST|y.DEVICE,r,r)));var n=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new nt(_.INDEX|_.TRANSFER_DST,y.HOST|y.DEVICE,n,n))),this._attributes=t,this._iaInfo=new At(this.attributes,this.vertexBuffers,this.indexBuffer),this._reallocBuffer()},e.request=function(t,e){void 0===t&&(t=4),void 0===e&&(e=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+t*this._vertexFormatBytes,r=this.indicesOffset+e;if(t+this.vertexOffset>65535)return this._outOfCallback&&this._outOfCallback.call(this._batcher,t,e),!1;var n=this.vData.byteLength,s=this.iData.length;if(i>n||r>s){for(;n<i||s<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,s=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=t,this.indicesOffset+=e,this.byteOffset=i,this._dirty=!0,!0},e.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var t=0;t<this._hInputAssemblers.length;t++)Ln.free(this._hInputAssemblers[t]);this._hInputAssemblers.length=0},e.recordBatch=function(){var t=this.indicesOffset-this.indicesStart;if(!t)return Fn;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push(Ln.alloc(this._batcher.device,this._iaInfo));var e=this._hInputAssemblers[this._nextFreeIAHandle++],i=Ln.get(e);return i.firstIndex=this.indicesStart,i.indexCount=t,e},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(t),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(e),this._dirty=!1}},e._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},e._reallocVData=function(t){var e;if(this.vData&&(e=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),e&&t)for(var i=new Uint8Array(this.vData.buffer),r=0,n=e.length;r<n;r++)i[r]=e[r]},e._reallocIData=function(t){var e=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this.iData,r=0,n=e.length;r<n;r++)i[r]=e[r]},Be(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}());vz.OPACITY_OFFSET=8;var bz,Sz,Tz,Az,Ez,Cz,Rz,wz,xz,Oz,Pz,Dz,Mz,Bz,Iz,Lz,Fz,kz,Nz,Gz,Uz,zz,Vz,Hz,Wz,Xz,Yz=kn.Enum.NONE|kn.Enum.UI_3D,jz=t("UIDrawBatch",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._handle=Fn,this._passes=[],this._handle=Nn.alloc(),Nn.set(this._handle,Gn.VIS_FLAGS,Yz),Nn.set(this._handle,Gn.INPUT_ASSEMBLER,Fn),Nn.set(this._handle,Gn.DESCRIPTOR_SET,Fn)}var e=t.prototype;return e.destroy=function(){if(this._handle){for(var t=this.passes.length,e=0;e<t;e++)this.passes[e]._destroyHandle();this._passes=[],Nn.free(this._handle),this._handle=Fn}},e.clear=function(){this.bufferBatch=null,this.hInputAssembler=Fn,this.hDescriptorSet=Fn,this.camera=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=Yz},e.fillPasses=function(t,e,i,r,n,s){if(t){var a=t.passes;if(!a)return;Nn.set(this._handle,Gn.PASS_COUNT,a.length);for(var o=Gn.PASS_0,l=Gn.SHADER_0,h=0,u=0;u<a.length;u++,o++,l++){this._passes[u]||(this._passes[u]=new pn(Xe.director.root),this._passes[u]._handle=Un.alloc());var c=a[u],p=this._passes[u];e||(e=c.depthStencilState,i=0),r||(r=c.blendState,n=0),-1===n&&(n=0),h=i<<16|n,c.update(),p._initPassFromTarget(c,e,r,h),Nn.set(this._handle,o,p.handle),Nn.set(this._handle,l,p.getShaderVariant(s))}}},Be(t,[{key:"handle",get:function(){return this._handle}},{key:"hInputAssembler",get:function(){return Nn.get(this._handle,Gn.INPUT_ASSEMBLER)},set:function(t){Nn.set(this._handle,Gn.INPUT_ASSEMBLER,t)}},{key:"hDescriptorSet",get:function(){return Nn.get(this._handle,Gn.DESCRIPTOR_SET)},set:function(t){Nn.set(this._handle,Gn.DESCRIPTOR_SET,t)}},{key:"visFlags",get:function(){return Nn.get(this._handle,Gn.VIS_FLAGS)},set:function(t){Nn.set(this._handle,Gn.VIS_FLAGS,t)}},{key:"passes",get:function(){return this._passes}}]),t}()),Kz=function(e){return t({UIStaticBatch:e,UIStaticBatchComponent:e}),e}((bz=Ze("cc.UIStaticBatch"),Sz=ai(),Tz=oi(),Az=Ci(110),Ez=Ni(),bz(Cz=Sz(Cz=Tz(Cz=Az((wz=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._init=!1,e._meshBuffer=null,e._dirty=!0,e._lastMeshBuffer=null,e._uiDrawBatchList=[],e}Me(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._getBatcher();if(t){var e=kN,i=new vz(t);i.initialize(e,this._arrivalMaxBuffer.bind(this)),this._meshBuffer=i}},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearData(),this._meshBuffer&&(this._meshBuffer.destroy(),this._meshBuffer=null)},i.updateAssembler=function(t){t.currIsStatic=!0,this._dirty&&(t.finishMergeBatches(),this._lastMeshBuffer=t.currBufferBatch,t.currBufferBatch=this._meshBuffer,t.currStaticRoot=this),this._init&&(t.finishMergeBatches(),t.commitStaticBatch(this))},i.postUpdateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),t.currBufferBatch=this._lastMeshBuffer,t.currStaticRoot=null,this._dirty=!1,this._init=!0,this.node._static=!0,this._meshBuffer.uploadBuffers()),t.currIsStatic=!1},i.markAsDirty=function(){this._getBatcher()&&(this.node._static=!1,this._dirty=!0,this._init=!1,this._clearData())},i._requireDrawBatch=function(){var t=new jz;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},i._clearData=function(){if(this._meshBuffer){this._meshBuffer.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},i._getBatcher=function(){return Ai.root&&Ai.root.batcher2D?Ai.root.batcher2D:(He(9301),null)},i._arrivalMaxBuffer=function(){var t=this._getBatcher();t&&t.autoMergeBatches(),He(9300)},Be(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(Ch),je((Rz=wz).prototype,"color",[Qe,Ez],Object.getOwnPropertyDescriptor(Rz.prototype,"color"),Rz.prototype),Cz=Rz))||Cz)||Cz)||Cz)||Cz)),qz=t("LabelShadow",(xz=Ze("cc.LabelShadow"),Oz=ai(),Pz=Ci(110),Dz=oi(),Mz=xi($k),Bz=li(),Iz=li(),Lz=li(),xz(Fz=Oz(Fz=Pz(Fz=Dz(Fz=Mz(Fz=vi((zz=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_color",Nz,ti(e)),$e(e,"_offset",Gz,ti(e)),$e(e,"_blur",Uz,ti(e)),e}Me(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent($k);t&&t.updateRenderData(!0)},Be(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(ui),Nz=je((kz=zz).prototype,"_color",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(0,0,0,255)}}),Gz=je(kz.prototype,"_offset",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i(2,2)}}),Uz=je(kz.prototype,"_blur",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),je(kz.prototype,"color",[Bz],Object.getOwnPropertyDescriptor(kz.prototype,"color"),kz.prototype),je(kz.prototype,"offset",[Iz],Object.getOwnPropertyDescriptor(kz.prototype,"offset"),kz.prototype),je(kz.prototype,"blur",[Lz],Object.getOwnPropertyDescriptor(kz.prototype,"blur"),kz.prototype),Fz=kz))||Fz)||Fz)||Fz)||Fz)||Fz)||Fz)),Zz=function(e){return t({UIOpacity:e,UIOpacityComponent:e}),e}(Ze("cc.UIOpacity")(Vz=ai()(Vz=Ci(110)(Vz=oi()(Vz=vi((Xz=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_opacity",Wz,ti(e)),e}Me(e,t);var i=e.prototype;return i.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255},i.onDisable=function(){this.node._uiProps.localOpacity=1},Be(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=zn(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255)}}]),e}(ui),je((Hz=Xz).prototype,"opacity",[yr],Object.getOwnPropertyDescriptor(Hz.prototype,"opacity"),Hz.prototype),Wz=je(Hz.prototype,"_opacity",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),Vz=Hz))||Vz)||Vz)||Vz)||Vz)||Vz);Xe.MaskComponent=SG,di.setClassAlias(SG,"cc.MaskComponent"),Xe.LabelComponent=$k,di.setClassAlias($k,"cc.LabelComponent"),Xe.LabelOutlineComponent=RU,di.setClassAlias(RU,"cc.LabelOutlineComponent"),Xe.RichTextComponent=mz,di.setClassAlias(mz,"cc.RichTextComponent"),Xe.SpriteComponent=lz,di.setClassAlias(lz,"cc.SpriteComponent"),Xe.UIModelComponent=yz,di.setClassAlias(yz,"cc.UIModelComponent"),Xe.GraphicsComponent=gG,di.setClassAlias(gG,"cc.GraphicsComponent"),di.setClassAlias(Kz,"cc.UIStaticBatchComponent"),di.setClassAlias(Zz,"cc.UIOpacityComponent");var Jz=function(t,e,i){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=i};function Qz(t,e,i,r,n){var s=0,a=null;if(n===function(t,e,i,r){for(var n=0,s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}(t,e,i,r)>0)for(s=e;s<i;s+=r)a=gV(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=gV(s,t[s],t[s+1],a);return a&&pV(a,a.next)&&(mV(a),a=a.next),a}function $z(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var i=t,r=!1;do{if(r=!1,i.steiner||!pV(i,i.next)&&0!==cV(i.prev,i,i.next))i=i.next;else{if(mV(i),(i=e=i.prev)===i.next)return null;r=!0}}while(r||i!==e);return e}function tV(t,e,i,r,n,s,a){if(void 0===a&&(a=0),t){!a&&s&&function(t,e,i,r){var n=t;do{null===n.z&&(n.z=oV(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e=0,i=null,r=null,n=null,s=null,a=0,o=0,l=0,h=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,r=i,o=0,e=0;e<h&&(o++,r=r.nextZ);e++);for(l=h;o>0||l>0&&r;)0===o?(n=r,r=r.nextZ,l--):0!==l&&r?i.z<=r.z?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--):(n=i,i=i.nextZ,o--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,h*=2}while(a>1)}(n)}(t,r,n,s);for(var o=t,l=null,h=null;t.prev!==t.next;)if(l=t.prev,h=t.next,s?iV(t,r,n,s):eV(t))e.push(l.i/i),e.push(t.i/i),e.push(h.i/i),mV(t),t=h.next,o=h.next;else if((t=h)===o){a?1===a?tV(t=rV(t,e,i),e,i,r,n,s,2):2===a&&nV(t,e,i,r,n,s):tV($z(t),e,i,r,n,s,1);break}}}function eV(t){var e=t.prev,i=t,r=t.next;if(cV(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(hV(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&cV(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function iV(t,e,i,r){var n=t.prev,s=t,a=t.next;if(cV(n,s,a)>=0)return!1;for(var o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,l=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,h=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,u=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y,c=oV(o,l,e,i,r),p=oV(h,u,e,i,r),d=t.nextZ;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&hV(n.x,n.y,s.x,s.y,a.x,a.y,d.x,d.y)&&cV(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&hV(n.x,n.y,s.x,s.y,a.x,a.y,d.x,d.y)&&cV(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function rV(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!pV(n,s)&&dV(n,r,r.next,s)&&fV(n,s)&&fV(s,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(s.i/i),mV(r),mV(r.next),r=t=s),r=r.next}while(r!==t);return r}function nV(t,e,i,r,n,s){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&uV(a,o)){var l=_V(a,o);return a=$z(a,a.next),l=$z(l,l.next),tV(a,e,i,r,n,s),void tV(l,e,i,r,n,s)}o=o.next}a=a.next}while(a!==t)}function sV(t,e){return t.x-e.x}function aV(t,e){if(e=function(t,e){var i=e,r=t.x,n=t.y,s=-1/0,a=null;do{if(n<=i.y&&n>=i.next.y){var o=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&o>s){if(s=o,o===r){if(n===i.y)return i;if(n===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(r===s)return a.prev;var l,h=a,u=a.x,c=a.y,p=1/0;for(i=a.next;i!==h;)r>=i.x&&i.x>=u&&hV(n<c?r:s,n,u,c,n<c?s:r,n,i.x,i.y)&&((l=Math.abs(n-i.y)/(r-i.x))<p||l===p&&i.x>a.x)&&fV(i,t)&&(a=i,p=l),i=i.next;return a}(t,e)){var i=_V(e,t);$z(i,i.next)}}function oV(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function lV(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function hV(t,e,i,r,n,s,a,o){return(n-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(n-a)*(r-o)>=0}function uV(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&dV(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&fV(t,e)&&fV(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)}function cV(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function pV(t,e){return t.x===e.x&&t.y===e.y}function dV(t,e,i,r){return!!(pV(t,e)&&pV(i,r)||pV(t,r)&&pV(i,e))||cV(t,e,i)>0!=cV(t,e,r)>0&&cV(i,r,t)>0!=cV(i,r,e)>0}function fV(t,e){return cV(t.prev,t,t.next)<0?cV(t,e,t.next)>=0&&cV(t,t.prev,e)>=0:cV(t,e,t.prev)<0||cV(t,t.next,e)<0}function _V(t,e){var i=new Jz(t.i,t.x,t.y),r=new Jz(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function gV(t,e,i,r){var n=new Jz(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function mV(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yV(t,e,i){i=i||3;var r=e?e.length:0,n=r?e[0]*i:t.length,s=Qz(t,0,n,i,!0),a=[];if(!s)return a;var o=0,l=0,h=0,u=0,c=0,p=0,d=0;if(r&&(s=function(t,e,i,r){var n,s=[],a=0,o=null;for(a=0,n=e.length;a<n;a++)(o=Qz(t,e[a]*r,a<n-1?e[a+1]*r:t.length,r,!1))&&(o===o.next&&(o.steiner=!0),s.push(lV(o)));if(s.sort(sV),!i)return i;for(a=0;a<s.length;a++)aV(s[a],i),i=$z(i,i.next);return i}(t,e,s,i)),t.length>80*i){o=h=t[0],l=u=t[1];for(var f=i;f<n;f+=i)(c=t[f])<o&&(o=c),(p=t[f+1])<l&&(l=p),c>h&&(h=c),p>u&&(u=p);d=Math.max(h-o,u-l)}return tV(s,a,i,o,l,d),a}for(var vV=Math.PI,bV=Math.min,SV=Math.max,TV=Math.ceil,AV=Math.acos,EV=Math.cos,CV=Math.sin,RV=Math.atan2,wV=null,xV=null,OV=new Ii,PV=[],DV=0;DV<4;DV++)PV.push(new Si);function MV(t,e,i){return t<e?e:t>i?i:t}var BV={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!xV)return null;var i=xV.getRenderDataList(),r=i[xV.dataOffset];if(!r)return null;var n=r,s=n?n.vertexStart+e:0;return(s>65535||3*s>131070)&&(++xV.dataOffset,xV.dataOffset<i.length?r=i[xV.dataOffset]:(r=xV.requestRenderData(),i[xV.dataOffset]=r),n=r),n&&n.vertexCount<s&&n.request(e,3*e),r},stroke:function(t){Ii.copy(OV,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){Ii.copy(OV,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e,i,r,n,s=.5*t.lineWidth,a=t.lineCap,o=t.lineJoin,l=t.miterLimit;if(xV=t.impl){var h=(e=s,i=vV,r=xV.tessTol,n=2*AV(e/(e+r)),SV(2,TV(i/n)));this._calculateJoins(xV,s,o,l);for(var u=xV.paths,c=0,p=xV.pathOffset,d=xV.pathLength;p<d;p++){var f=u[p],_=f.points.length;o===Jk.ROUND?c+=2*(_+f.bevel*(h+2)+1):c+=2*(_+5*f.bevel+1),f.closed||(a===Zk.ROUND?c+=2*(2*h+2):c+=12)}var g=wV=this.getRenderData(t,c);if(g){for(var m=g.vData,y=g.iData,v=xV.pathOffset,b=xV.pathLength;v<b;v++){var S=u[v],T=S.points,A=T.length,E=g.vertexStart,C=void 0,R=void 0,w=0,x=0,O=S.closed;if(O?(C=T[A-1],R=T[0],w=0,x=A):(C=T[0],R=T[1],w=1,x=A-1),R=R||C,!O){var P=new MN(R.x,R.y);P.subtract(C),P.normalize();var D=P.x,M=P.y;a===Zk.BUTT?this._buttCapStart(C,D,M,s,0):a===Zk.SQUARE?this._buttCapStart(C,D,M,s,s):a===Zk.ROUND&&this._roundCapStart(C,D,M,s,h)}for(var B=w;B<x;++B)o===Jk.ROUND?this._roundJoin(C,R,s,s,h):0!=(R.flags&(Qk.PT_BEVEL|Qk.PT_INNERBEVEL))?this._bevelJoin(C,R,s,s):(this._vSet(R.x+R.dmx*s,R.y+R.dmy*s,1),this._vSet(R.x-R.dmx*s,R.y-R.dmy*s,-1)),C=R,R=T[B+1];if(O){var I=8*E;this._vSet(m[I],m[I+1],1),this._vSet(m[I+8],m[I+8+1],-1)}else{var L=new MN(R.x,R.y);L.subtract(C),L.normalize();var F=L.x,k=L.y;a===Zk.BUTT?this._buttCapEnd(R,F,k,s,0):a===Zk.SQUARE?this._buttCapEnd(R,F,k,s,s):a===Zk.ROUND&&this._roundCapEnd(R,F,k,s,h)}for(var N=g.indicesStart,G=E+2,U=g.vertexStart;G<U;G++)y[N++]=G-2,y[N++]=G-1,y[N++]=G;g.indicesStart=N}wV=null,xV=null}}},_expandFill:function(t){if(xV=t.impl){for(var e=xV.paths,i=0,r=xV.pathOffset,n=xV.pathLength;r<n;r++)i+=e[r].points.length;var s=wV=this.getRenderData(t,i);if(s){for(var a=s,o=a.vData,l=a.iData,h=xV.pathOffset,u=xV.pathLength;h<u;h++){var c=e[h],p=c.points,d=p.length;if(0!==d){for(var f=s.vertexStart,_=0;_<d;++_)this._vSet(p[_].x,p[_].y);var g=s.indicesStart;if(c.complex){for(var m=[],y=f,v=s.vertexStart;y<v;y++){var b=8*y;m.push(o[b++]),m.push(o[b++]),m.push(o[b++])}var S=yV(m,null,3);if(!S||0===S.length)continue;for(var T=0,A=S.length;T<A;T++)l[g++]=S[T]+f}else for(var E=f,C=f+2,R=a.vertexStart;C<R;C++)l[g++]=E,l[g++]=C-1,l[g++]=C;a.indicesStart=g}}wV=null,xV=null}}},_calculateJoins:function(t,e,i,r){var n=0;e>0&&(n=1/e);for(var s=t.paths,a=t.pathOffset,o=t.pathLength;a<o;a++){var l=s[a],h=l.points,u=h.length,c=h[u-1],p=h[0];l.bevel=0;for(var d=0;d<u;d++){var f,_,g=c.dy,m=-c.dx,y=p.dy,v=-p.dx;if(p.dmx=.5*(g+y),p.dmy=.5*(m+v),(f=p.dmx*p.dmx+p.dmy*p.dmy)>1e-6){var b=1/f;b>600&&(b=600),p.dmx*=b,p.dmy*=b}p.dx*c.dy-c.dx*p.dy>0&&(p.flags|=Qk.PT_LEFT),f*(_=SV(11,bV(c.len,p.len)*n))*_<1&&(p.flags|=Qk.PT_INNERBEVEL),p.flags&Qk.PT_CORNER&&(f*r*r<1||i===Jk.BEVEL||i===Jk.ROUND)&&(p.flags|=Qk.PT_BEVEL),0!=(p.flags&(Qk.PT_BEVEL|Qk.PT_INNERBEVEL))&&l.bevel++,c=p,p=h[d+1]}}},_flattenPaths:function(t){for(var e=t.paths,i=t.pathOffset,r=t.pathLength;i<r;i++){var n=e[i],s=n.points,a=s[s.length-1],o=s[0];s.length>2&&a.equals(o)&&(n.closed=!0,s.pop(),a=s[s.length-1]);for(var l=0,h=s.length;l<h;l++){var u=new MN(o.x,o.y);u.subtract(a),a.len=u.length(),(u.x||u.y)&&u.normalize(),a.dx=u.x,a.dy=u.y,a=o,o=s[l+1]}}},_chooseBevel:function(t,e,i,r){var n=i.x,s=i.y,a=0,o=0,l=0,h=0;return 0!==t?(a=n+e.dy*r,o=s-e.dx*r,l=n+i.dy*r,h=s-i.dx*r):(a=l=n+i.dmx*r,o=h=s+i.dmy*r),[a,o,l,h]},_buttCapStart:function(t,e,i,r,n){var s=t.x-e*n,a=t.y-i*n,o=i,l=-e;this._vSet(s+o*r,a+l*r,1),this._vSet(s-o*r,a-l*r,-1)},_buttCapEnd:function(t,e,i,r,n){var s=t.x+e*n,a=t.y+i*n,o=i,l=-e;this._vSet(s+o*r,a+l*r,1),this._vSet(s-o*r,a-l*r,-1)},_roundCapStart:function(t,e,i,r,n){for(var s=t.x,a=t.y,o=i,l=-e,h=0;h<n;h++){var u=h/(n-1)*vV,c=EV(u)*r,p=CV(u)*r;this._vSet(s-o*c-e*p,a-l*c-i*p,1),this._vSet(s,a,0)}this._vSet(s+o*r,a+l*r,1),this._vSet(s-o*r,a-l*r,-1)},_roundCapEnd:function(t,e,i,r,n){var s=t.x,a=t.y,o=i,l=-e;this._vSet(s+o*r,a+l*r,1),this._vSet(s-o*r,a-l*r,-1);for(var h=0;h<n;h++){var u=h/(n-1)*vV,c=EV(u)*r,p=CV(u)*r;this._vSet(s,a,0),this._vSet(s-o*c+e*p,a-l*c+i*p,1)}},_roundJoin:function(t,e,i,r,n){var s=t.dy,a=-t.dx,o=e.dy,l=-e.dx,h=e.x,u=e.y;if(0!=(e.flags&Qk.PT_LEFT)){var c=this._chooseBevel(e.flags&Qk.PT_INNERBEVEL,t,e,i),p=c[0],d=c[1],f=c[2],_=c[3],g=RV(-a,-s),m=RV(-l,-o);m>g&&(m-=2*vV),this._vSet(p,d,1),this._vSet(h-s*r,e.y-a*r,-1);for(var y=MV(TV((g-m)/vV)*n,2,n),v=0;v<y;v++){var b=g+v/(y-1)*(m-g),S=h+EV(b)*r,T=u+CV(b)*r;this._vSet(h,u,0),this._vSet(S,T,-1)}this._vSet(f,_,1),this._vSet(h-o*r,u-l*r,-1)}else{var A=this._chooseBevel(e.flags&Qk.PT_INNERBEVEL,t,e,-r),E=A[0],C=A[1],R=A[2],w=A[3],x=RV(a,s),O=RV(l,o);O<x&&(O+=2*vV),this._vSet(h+s*r,u+a*r,1),this._vSet(E,C,-1);for(var P=MV(TV((O-x)/vV)*n,2,n),D=0;D<P;D++){var M=x+D/(P-1)*(O-x),B=h+EV(M)*i,I=u+CV(M)*i;this._vSet(B,I,1),this._vSet(h,u,0)}this._vSet(h+o*r,u+l*r,1),this._vSet(R,w,-1)}},_bevelJoin:function(t,e,i,r){var n=0,s=0,a=0,o=0,l=0,h=0,u=0,c=0,p=t.dy,d=-t.dx,f=e.dy,_=-e.dx;if(e.flags&Qk.PT_LEFT){var g=this._chooseBevel(e.flags&Qk.PT_INNERBEVEL,t,e,i);l=g[0],h=g[1],u=g[2],c=g[3],this._vSet(l,h,1),this._vSet(e.x-p*r,e.y-d*r,-1),this._vSet(u,c,1),this._vSet(e.x-f*r,e.y-_*r,-1)}else{var m=this._chooseBevel(e.flags&Qk.PT_INNERBEVEL,t,e,-r);n=m[0],s=m[1],a=m[2],o=m[3],this._vSet(e.x+p*i,e.y+d*i,1),this._vSet(n,s,-1),this._vSet(e.x+f*i,e.y+_*i,1),this._vSet(a,o,-1)}},_vSet:function(t,e,i){if(void 0===i&&(i=0),wV){var r=wV,n=8*r.vertexStart,s=r.vData;s[n++]=t,s[n++]=e,s[n++]=0,Ii.toArray(s,OV,n),n+=4,s[n++]=i,r.vertexStart++}}},IV=t("graphicsAssembler",{getAssembler:function(){return BV}});gG.Assembler=IV;var LV=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},FV=new mi,kV=null,NV=null,GV=[],UV=[],zV=[],VV=[],HV=new wi,WV=new wi,XV=new _i,YV=null,jV=0,KV=0,qV=0,ZV=0,JV=0,QV=1,$V=null,tH="",eH=0,iH=0,rH=0,nH=0,sH=0,aH=0,oH=0,lH=!1,hH=0,uH=0,cH=0,pH={updateRenderData:function(t){t.renderData&&t.renderData.vertDirty&&kV!==t&&(NV=(kV=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),kV.actualFontSize=eH,NV.setContentSize(WV),kV.renderData.vertDirty=kV.renderData.uvDirty=!1,kV.markForUpdateRenderData(!1),kV=null,this._resetProperties())},_updateFontScale:function(){QV=eH/iH},_updateFontFamily:function(t){var e=t.font;$V=e.spriteFrame,YV=e.fntConfig,qk.fontAtlas=e.fontDefDictionary,VL.packToDynamicAtlas(t,$V)},_updateLabelInfo:function(){qk.hash="",qk.margin=0},_updateProperties:function(t){tH=t.string.toString(),eH=t.fontSize,iH=YV?YV.fontSize:t.fontSize,rH=t.horizontalAlign,nH=t.verticalAlign,sH=t.spacingX,oH=t.overflow,aH=t._lineHeight;var e=NV.contentSize;WV.width=e.width,WV.height=e.height,oH===Uk.NONE?(lH=!1,WV.width+=2*qk.margin,WV.height+=2*qk.margin):oH===Uk.RESIZE_HEIGHT?(lH=!0,WV.height+=2*qk.margin):lH=t.enableWrapText,qk.lineHeight=aH,qk.fontSize=eH,this._setupBMFontOverflowMetrics()},_resetProperties:function(){YV=null,$V=null,qk.hash="",qk.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=tH,e=t.length,i=YV.kerningDict,r=GV,n=-1,s=0;s<e;++s){var a=t.charCodeAt(s),o=i[n<<16|65535&a]||0;r[s]=s<e-1?o:0,n=a}},_multilineTextWrap:function(t){for(var e=tH.length,i=0,r=0,n=0,s=0,a=0,o=0,l=0,h=null,u=0;u<e;){var c=tH.charAt(u);if("\n"!==c){for(var p=t(tH,u,e),d=o,f=l,_=a,g=r,m=!1,y=0;y<p;++y){var v=u+y;if("\r"!==(c=tH.charAt(v)))if(h=qk.fontAtlas.getLetterDefinitionForChar(c,qk)){var b=g+h.offsetX*QV-qk.margin;if(lH&&cH>0&&r>0&&b+h.w*QV>cH&&!xF(c)){zV.push(a),a=0,i++,r=0,n-=aH*this._getFontScale()+0,m=!0;break}XV.x=b,XV.y=n-h.offsetY*QV,this._recordLetterInfo(XV,c,v,i),v+1<GV.length&&v<e-1&&(g+=GV[v+1]),g+=h.xAdvance*QV+sH,_=XV.x+h.w*QV,d<XV.y&&(d=XV.y),f>XV.y-h.h*QV&&(f=XV.y-h.h*QV)}else this._recordPlaceholderInfo(v,c),console.log("Can't find letter definition in texture atlas "+YV.atlasName+" for letter:"+c);else this._recordPlaceholderInfo(v,c)}m||(r=g,o<d&&(o=d),l>f&&(l=f),s<(a=_)&&(s=a),u+=p)}else zV.push(a),a=0,i++,r=0,n-=aH*this._getFontScale()+0,this._recordPlaceholderInfo(u,c),u++}return zV.push(a),KV=(jV=i+1)*aH*this._getFontScale(),jV>1&&(KV+=0*(jV-1)),WV.width=hH,WV.height=uH,hH<=0&&(WV.width=parseFloat(s.toFixed(2))+2*qk.margin),uH<=0&&(WV.height=parseFloat(KV.toFixed(2))+2*qk.margin),ZV=WV.height,JV=0,o>0&&(ZV=WV.height+o),l<-KV&&(JV=KV+l),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return oH===Uk.SHRINK?QV:1},_getFirstWordLen:function(t,e,i){var r=t.charAt(e);if(wF(r)||"\n"===r||xF(r))return 1;var n=1,s=qk.fontAtlas.getLetterDefinitionForChar(r,qk);if(!s)return n;for(var a=s.xAdvance*QV+sH,o=e+1;o<i&&(r=t.charAt(o),s=qk.fontAtlas.getLetterDefinitionForChar(r,qk));++o){if(a+s.offsetX*QV+s.w*QV>cH&&!xF(r)&&cH>0)return n;if(a+=s.xAdvance*QV+sH,"\n"===r||xF(r)||wF(r))break;n++}return n},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=UV.length){var i=new LV;UV.push(i)}UV[t].char=e,UV[t].hash=e.charCodeAt(0)+qk.hash,UV[t].valid=!1},_recordLetterInfo:function(t,e,i,r){if(i>=UV.length){var n=new LV;UV.push(n)}var s=e.charCodeAt(0)+qk.hash;UV[i].line=r,UV[i].char=e,UV[i].hash=s,UV[i].valid=qk.fontAtlas.getLetter(s).valid,UV[i].x=t.x,UV[i].y=t.y},_alignText:function(){KV=0,zV.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),oH===Uk.SHRINK&&eH>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||oH===Uk.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),eH=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,i=0|eH,r=0;e<i;){var n=r=e+i+1>>1;if(n<=0)break;QV=n/iH,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?i=r-1:e=r}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return KV>WV.height},_isHorizontalClamp:function(){for(var t=!1,e=0,i=tH.length;e<i;++e){var r=UV[e];if(r.valid){var n=qk.fontAtlas.getLetterDefinitionForChar(r.char,qk);if(!n)continue;var s=r.x+n.w/2*QV,a=r.line;if(hH>0)if(lH){if(zV[a]>WV.width&&(s>WV.width||s<0)){t=!0;break}}else if(s>WV.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var i=zV[e],r=t>WV.width||t<0;return lH?i>WV.width&&r:r},_updateQuads:function(){if(!kV)return!1;var t=$V?$V.texture:qk.fontAtlas.getTexture(),e=kV.renderData;e.dataLength=e.vertexCount=e.indicesCount=0;for(var i=NV.anchorPoint,r=WV,n=i.x*r.width,s=i.y*r.height,a=!0,o=0,l=tH.length;o<l;++o){var h=UV[o];if(h.valid){var u=qk.fontAtlas.getLetter(h.hash);if(u){FV.height=u.h,FV.width=u.w,FV.x=u.u,FV.y=u.v;var c=h.y+qV;if(uH>0){if(c>ZV){var p=c-ZV;FV.y+=p,FV.height-=p,c-=p}c-u.h*QV<JV&&oH===Uk.CLAMP&&(FV.height=c<JV?0:(c-JV)/QV)}var d=h.line,f=h.x+u.w/2*QV+VV[d];if(hH>0&&this._isHorizontalClamped(f,d))if(oH===Uk.CLAMP)FV.width=0;else if(oH===Uk.SHRINK){if(WV.width>u.w){a=!1;break}FV.width=0}if(FV.height>0&&FV.width>0){var _=this._determineRect(),g=h.x+VV[h.line];this.appendQuad(kV,t,FV,_,g-n,c-s,QV)}}else console.warn("Can't find letter in this bitmap-font")}}return a},appendQuad:function(){},_determineRect:function(){var t=$V.isRotated(),e=$V.getOriginalSize(),i=$V.getRect(),r=$V.getOffset(),n=r.x+(e.width-i.width)/2,s=r.y-(e.height-i.height)/2;if(t){var a=FV.x;FV.x=i.x+i.height-FV.y-FV.height-s,FV.y=a+i.y-n,FV.y<0&&(FV.height+=s)}else FV.x+=i.x-n,FV.y+=i.y+s;return t},_computeAlignmentOffset:function(){switch(VV.length=0,rH){case Nk.LEFT:for(var t=0;t<jV;++t)VV.push(0);break;case Nk.CENTER:for(var e=0,i=zV.length;e<i;e++)VV.push((WV.width-zV[e])/2);break;case Nk.RIGHT:for(var r=0,n=zV.length;r<n;r++)VV.push(WV.width-zV[r])}if(qV=WV.height,nH!==Gk.TOP){var s=WV.height-KV+aH*this._getFontScale()-iH*QV;nH===Gk.BOTTOM?qV-=s:qV-=s/2}},_setupBMFontOverflowMetrics:function(){var t=WV.width,e=WV.height;oH===Uk.RESIZE_HEIGHT&&(e=0),oH===Uk.NONE&&(t=0,e=0),hH=t,uH=e,HV.width=t,HV.height=e,cH=t}},dH=new Ii(255,255,255,255),fH={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){var i=t.node;t._setCacheAlpha(i._uiProps.opacity),dH.set(t.color),dH.a=255*i._uiProps.opacity,kL(i,e,t.renderData,dH)},appendQuad:function(t,e,i,r,n,s,a){var o=t.renderData;if(o){var l=o.dataLength;o.dataLength+=4,o.vertexCount=o.dataLength,o.indicesCount=o.dataLength/2*3;var h=o.data,u=e.width,c=e.height,p=i.width,d=i.height,f=0,_=0,g=0,m=0;r?(f=i.x/u,m=(i.x+d)/u,_=(i.y+p)/c,g=i.y/c,h[l].u=f,h[l].v=g,h[l+1].u=f,h[l+1].v=_,h[l+2].u=m,h[l+2].v=g,h[l+3].u=m,h[l+3].v=_):(f=i.x/u,m=(i.x+p)/u,_=(i.y+d)/c,g=i.y/c,h[l].u=f,h[l].v=_,h[l+1].u=m,h[l+1].v=_,h[l+2].u=f,h[l+2].v=g,h[l+3].u=m,h[l+3].v=g),h[l].x=n,h[l].y=s-d*a,h[l+1].x=n+p*a,h[l+1].y=s-d*a,h[l+2].x=n,h[l+2].y=s,h[l+3].x=n+p*a,h[l+3].y=s}}};Vn(fH,pH);var _H=null,gH=Cn(pH,{getAssemblerData:function(){return _H||(_H=new Kk(1024,1024)),_H.getTexture()},_updateFontFamily:function(t){qk.fontAtlas=_H,qk.fontFamily=this._getFontFamily(t);var e=t.getComponent(RU);e&&e.enabled?(qk.isOutlined=!0,qk.margin=e.width,qk.out=e.color.clone(),qk.out.a=e.color.a*t.color.a/255):(qk.isOutlined=!1,qk.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(t.font._nativeAsset?e=t.font._nativeAsset:Bn.postLoadNative(t.font,(function(){t.isValid&&(e=t.font._nativeAsset||"Arial",t.updateRenderData(!0))}))),e},_updateLabelInfo:function(t){var e,i,r;qk.fontDesc=this._getFontDesc(),qk.color=t.color,qk.hash=(i=(e=qk).color.toHEX(),r="",e.isOutlined&&e.margin>0&&(r=r+e.margin+e.out.toHEX()),""+e.fontSize+e.fontFamily+i+r)},_getFontDesc:function(){return qk.fontSize.toString()+"px "+qk.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),mH=new Ii(255,255,255,255),yH={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){if(t.renderData){var i=t.node;t._setCacheAlpha(i._uiProps.opacity),mH.a=255*i._uiProps.opacity,kL(i,e,t.renderData,mH)}},appendQuad:fH.appendQuad};Vn(yH,gH);var vH=$k.Overflow,bH=(1/255).toFixed(3),SH=null,TH=null,AH=null,EH="",CH="",RH=0,wH=0,xH=[],OH=new wi,PH=0,DH=0,MH=0,BH=new Ii,IH=1,LH="",FH=vH.NONE,kH=!1,NH=null,GH=Ii.BLACK.clone(),UH=null,zH=Ii.BLACK.clone(),VH=new mi,HH=wi.ZERO.clone(),WH=wi.ZERO.clone(),XH=_i.ZERO.clone(),YH=_i.ZERO.clone(),jH=0,KH=0,qH=!1,ZH=!1,JH=!1,QH=["left","center","right"],$H={getAssemblerData:function(){return $k._canvasPool.get()},resetAssemblerData:function(t){t&&$k._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData&&t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._resetDynamicAtlas(t),this._updateTexture(t),this.updateOpacity(t),t._setCacheAlpha(IH),this._calDynamicAtlas(t),t.actualFontSize=RH,e.setContentSize(OH),this.updateVertexData(t),this.updateUvs(t),t.markForUpdateRenderData(!1),SH=null,TH=null,AH=null}},updateVertexData:function(){},updateUvs:function(){},updateOpacity:function(t){for(var e=t.renderData.vData,i=5,r=t.node._uiProps.opacity,n=0;n<4;n++)e[i+3]=r,i+=9},_updateFontFamily:function(t){t.useSystemFont?LH=t.fontFamily||"Arial":t.font?t.font._nativeAsset?LH=t.font._nativeAsset:(Bn.postLoadNative(t.font,(function(){t.isValid&&(LH=t.font._nativeAsset||"Arial",t.updateRenderData(!0))})),LH="Arial"):LH="Arial"},_updateProperties:function(t,e){var i=t.assemblerData;i&&(SH=i.context,TH=i.canvas,AH=t.spriteFrame,CH=t.string.toString(),RH=t.fontSize,wH=RH,FH=t.overflow,WH.width=OH.width=e.width,WH.height=OH.height=e.height,KH=t.underlineHeight,PH=t.lineHeight,DH=t.horizontalAlign,MH=t.verticalAlign,BH=t.color,IH=t.node._uiProps.opacity,qH=t.isBold,ZH=t.isItalic,JH=t.isUnderline,kH=FH!==vH.NONE&&(FH===vH.RESIZE_HEIGHT||t.enableWrapText),(NH=(NH=RU&&t.getComponent(RU))&&NH.enabled&&NH.width>0?NH:null)&&GH.set(NH.color),(UH=(UH=qz&&t.getComponent(qz))&&UH.enabled?UH:null)&&zH.set(UH.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,i=0,r=0,n=0;if(HH.width=HH.height=0,NH&&(t=e=i=r=n=NH.width,HH.width=HH.height=2*n),UH){var s=UH.blur+n,a=UH.offset.x,o=UH.offset.y;i=Math.max(i,-a+s),r=Math.max(r,a+s),t=Math.max(t,o+s),e=Math.max(e,-o+s)}if(ZH){var l=wH*Math.tan(.20943951);r+=l,HH.width+=l}VH.x=i,VH.y=t,VH.width=i+r,VH.height=t+e},_calculateFillTextStartPosition:function(){var t=0;DH===Nk.RIGHT?t=OH.width-VH.width:DH===Nk.CENTER&&(t=(OH.width-VH.width)/2);var e=this._getLineHeight()*(xH.length-1),i=RH*(1-mF/2);if(MH!==Gk.TOP){var r=e+VH.height+RH-OH.height;MH===Gk.BOTTOM?i-=r+=mF/2*RH:i-=r/2}i+=0*RH,XH.set(t+VH.x,i+VH.y)},_updateTexture:function(t){if(SH&&TH){SH.clearRect(0,0,TH.width,TH.height),SH.font=EH,this._calculateFillTextStartPosition();var e=this._getLineHeight();SH.lineJoin="round",t._srcBlendFactor===w.SRC_ALPHA&&(SH.fillStyle="rgba("+BH.r+", "+BH.g+", "+BH.b+", "+bH+")",SH.fillRect(0,0,TH.width,TH.height)),SH.fillStyle="rgb("+BH.r+", "+BH.g+", "+BH.b+")";var i,r=XH.x,n=0;this._drawTextEffect(XH,e);for(var s=0;s<xH.length;++s)n=XH.y+s*e,NH&&SH.strokeText(xH[s],r,n),SH.fillText(xH[s],r,n);UH&&(SH.shadowColor="transparent"),AH&&(i=AH instanceof KL?AH.texture:AH,0!==TH.width&&0!==TH.height&&(i.reset({width:TH.width,height:TH.height,mipmapLevel:1}),i.uploadData(TH),AH instanceof KL&&(AH.rect=new mi(0,0,TH.width,TH.height),AH._calculateUV()),Xe.director.root&&Xe.director.root.batcher2D&&Xe.director.root.batcher2D._releaseDescriptorSetCache(i.getHash())))}},_resetDynamicAtlas:function(t){if(t.cacheMode===$k.CacheMode.BITMAP){var e=t.ttfSpriteFrame;VL.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}},_calDynamicAtlas:function(t){if(t.cacheMode===$k.CacheMode.BITMAP){var e=t.ttfSpriteFrame;VL.packToDynamicAtlas(t,e),t.renderData.uvDirty=!0}},_setupOutline:function(){SH.strokeStyle="rgba("+GH.r+", "+GH.g+", "+GH.b+", "+GH.a/255+")",SH.lineWidth=2*NH.width},_setupShadow:function(){SH.shadowColor="rgba("+zH.r+", "+zH.g+", "+zH.b+", "+zH.a/255+")",SH.shadowBlur=UH.blur,SH.shadowOffsetX=UH.offset.x,SH.shadowOffsetY=-UH.offset.y},_drawTextEffect:function(t,e){if(UH||NH||JH){var i=xH.length>1&&UH,r=this._measureText(SH,EH),n=0,s=0;UH&&this._setupShadow(),NH&&this._setupOutline();for(var a=0;a<xH.length;++a)n=t.x,s=t.y+a*e,i&&(NH&&SH.strokeText(xH[a],n,s),SH.fillText(xH[a],n,s)),JH&&(jH=r(xH[a]),DH===Nk.RIGHT?YH.x=t.x-jH:DH===Nk.CENTER?YH.x=t.x-jH/2:YH.x=t.x,YH.y=s+wH/8,SH.fillRect(YH.x,YH.y,jH,KH));i&&(SH.shadowColor="transparent")}},_updateLabelDimensions:function(){OH.width=Math.min(OH.width,2048),OH.height=Math.min(OH.height,2048);var t=!1;TH.width!==OH.width&&(TH.width=OH.width,t=!0),TH.height!==OH.height&&(TH.height=OH.height,t=!0),t&&(SH.font=EH),SH.textAlign=QH[DH],SH.textBaseline="alphabetic"},_getFontDesc:function(){var t=RH.toString()+"px ";return t+=LH,qH&&(t="bold "+t),ZH&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===PH?RH:PH*RH/wH)},_calculateParagraphLength:function(t,e){for(var i,r=[],n=ke(t);!(i=n()).done;){var s=OF(e,i.value,EH);r.push(s)}return r},_measureText:function(t,e){return function(i){return OF(t,i,e)}},_calculateShrinkFont:function(t){if(SH){var e=this._calculateParagraphLength(t,SH),i=0,r=0,n=0;if(kH){var s=WH.width,a=WH.height;if(s<0||a<0)return;r=a+1;for(var o=0,l=0|RH+1,h=0;o<l;){if((h=o+l+1>>1)<=0){ji(4003);break}RH=h,EH=this._getFontDesc(),SH.font=EH;var u=this._getLineHeight();for(r=0,i=0;i<t.length;++i){var c=OF(SH,t[i],EH);r+=DF(t[i],c,s,this._measureText(SH,EH)).length*u}r>a?l=h-1:o=h}0===o?ji(4003):(RH=o,EH=this._getFontDesc(),SH.font=EH)}else{for(r=t.length*this._getLineHeight(),i=0;i<t.length;++i)n<e[i]&&(n=e[i]);var p=(OH.width-VH.width)/n,d=OH.height/r;RH=wH*Math.min(1,p,d)|0,EH=this._getFontDesc(),SH.font=EH}}},_calculateWrapText:function(t){if(kH&&SH){xH=[];for(var e=WH.width,i=0;i<t.length;++i){var r=OF(SH,t[i],EH),n=DF(t[i],r,e,this._measureText(SH,EH));xH=xH.concat(n)}}},_calculateLabelFont:function(){if(SH){var t=CH.split("\n");switch(xH=t,EH=this._getFontDesc(),SH.font=EH,FH){case vH.NONE:for(var e=0,i=0,r=0;r<t.length;++r){var n=OF(SH,t[r],EH);e=e>n?e:n}i=(xH.length+mF)*this._getLineHeight();var s=parseFloat(e.toFixed(2)),a=parseFloat(i.toFixed(2));OH.width=s+VH.width,OH.height=a+VH.height,WH.width=s+HH.width,WH.height=a+HH.height;break;case vH.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case vH.CLAMP:this._calculateWrapText(t);break;case vH.RESIZE_HEIGHT:this._calculateWrapText(t);var o=(xH.length+mF)*this._getLineHeight();OH.height=o+VH.height,WH.height=o+HH.height}}}},tW=Ii.WHITE.clone(),eW={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.vertexCount=4,e.indicesCount=6;var i=e.vData=new Float32Array(36);i[3]=i[21]=i[22]=i[31]=0,i[4]=i[12]=i[13]=i[30]=1;for(var r=5,n=0;n<4;n++)Ii.toArray(i,tW,r),r+=9;return e},fillBuffers:function(t,e){var i=t.renderData,r=i.data,n=t.node,s=e.acquireBufferBatch(),a=s.byteOffset>>2,o=s.indicesOffset,l=s.vertexOffset;s.request()||(s=e.currBufferBatch,o=0,l=0,a=0);var h=s.vData,u=s.iData,c=i.vData,p=r[0],d=r[3];n.updateWorldTransform();var f=n._pos,_=n._rot,g=n._scale,m=p.x*g.x,y=d.x*g.x,v=p.y*g.y,b=d.y*g.y,S=_.x,T=_.y,A=_.z,E=_.w,C=S*T,R=A*E,w=S*S-T*T,x=E*E-A*A,O=x+w,P=2*(C-R),D=x-w,M=2*(C+R),B=f.x,I=f.y;c[0]=O*m+P*v+B,c[1]=D*v+M*m+I,c[9]=O*y+P*v+B,c[10]=D*v+M*y+I,c[18]=O*m+P*b+B,c[19]=D*b+M*m+I,c[27]=O*y+P*b+B,c[28]=D*b+M*y+I,h.set(c,a),u[o++]=l,u[o++]=l+1,u[o++]=l+2,u[o++]=l+2,u[o++]=l+1,u[o++]=l+3},updateVertexData:function(t){var e=t.renderData;if(e){var i=t.node._uiProps.uiTransformComp,r=i.width,n=i.height,s=i.anchorX*r,a=i.anchorY*n,o=e.data;o[0].x=-s,o[0].y=-a,o[3].x=r-s,o[3].y=n-a}},updateUvs:function(t){var e=t.renderData;if(e){var i=e.vData;if(i&&e.uvDirty){var r=t.ttfSpriteFrame.uv;i[3]=r[0],i[4]=r[1],i[12]=r[2],i[13]=r[3],i[21]=r[4],i[22]=r[5],i[30]=r[6],i[31]=r[7],e.uvDirty=!1}}}};Vn(eW,$H);var iW=t("labelAssembler",{getAssembler:function(t){var e=eW;return t.font instanceof _F?e=fH:t.cacheMode===$k.CacheMode.CHAR&&(e=yH),e}});$k.Assembler=iW;var rW=lz.FillType,nW=new gi,sW=new Ii(255,255,255,255),aW={useModel:!1,updateRenderData:function(t){var e=t.spriteFrame;VL.packToDynamicAtlas(t,e);var i=t.renderData;if(i&&e){var r=i.uvDirty,n=i.vertDirty;if(!r&&!n)return;var s=t.fillStart,a=t.fillRange;a<0&&(s+=a,a=-a),a=(a=(a=s+a)>1?1:a)<0?0:a;var o=(s=(s=s>1?1:s)<0?0:s)+(a=(a-=s)<0?0:a);o=o>1?1:o,r&&this.updateUVs(t,s,o),n&&(this.updateVertexData&&this.updateVertexData(t,s,o),this.updateWorldVertexData(t))}},updateUVs:function(t,e,i){var r=t.spriteFrame,n=t.renderData,s=n.data,a=r.width,o=r.height,l=r.getRect(),h=0,u=0,c=0,p=0,d=0,f=0,_=0,g=0,m=0,y=0;switch(r.isRotated()?(h=l.x/a,u=(l.y+l.width)/o,c=d=h,_=m=(l.x+l.height)/a,f=y=u,p=g=l.y/o):(h=l.x/a,u=(l.y+l.height)/o,c=_=h,d=m=(l.x+l.width)/a,p=f=u,g=y=l.y/o),t.fillType){case rW.HORIZONTAL:s[0].u=c+(d-c)*e,s[0].v=p+(f-p)*e,s[1].u=c+(d-c)*i,s[1].v=p+(f-p)*i,s[2].u=_+(m-_)*e,s[2].v=g+(y-g)*e,s[3].u=_+(m-_)*i,s[3].v=g+(y-g)*i;break;case rW.VERTICAL:s[0].u=c+(_-c)*e,s[0].v=p+(g-p)*e,s[1].u=d+(m-d)*e,s[1].v=f+(y-f)*e,s[2].u=c+(_-c)*i,s[2].v=p+(g-p)*i,s[3].u=d+(m-d)*i,s[3].v=f+(y-f)*i;break;default:Ie(2626)}n.uvDirty=!1},updateVertexData:function(t,e,i){var r=t.renderData,n=r.data,s=t.node._uiProps.uiTransformComp,a=s.width,o=s.height,l=s.anchorX*a,h=s.anchorY*o,u=-l,c=-h,p=a-l,d=o-h,f=0;switch(t.fillType){case rW.HORIZONTAL:f=u+(p-u)*i,u+=(p-u)*e,p=f;break;case rW.VERTICAL:f=c+(d-c)*i,c+=(d-c)*e,d=f;break;default:Ie(2626)}n[4].x=u,n[4].y=c,n[5].x=p,n[5].y=c,n[6].x=u,n[6].y=d,n[7].x=p,n[7].y=d,r.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indicesCount=6;for(var i,r=e.data,n=ke(r);!(i=n()).done;)i.value.z=0;return e},updateWorldVertexData:function(t){var e=t.node,i=t.renderData.data;e.getWorldMatrix(nW);for(var r=0;r<4;r++){var n=i[r+4],s=i[r];Si.transformMat4(s,n,nW)}},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var i=t.node;sW.set(t.color),sW.a=255*i._uiProps.opacity,function(t,e,i,r){var n=i.data,s=e.acquireBufferBatch(),a=s.byteOffset>>2,o=i.vertexCount,l=s.indicesOffset,h=s.vertexOffset;s.request(o,i.indicesCount)||(s=e.currBufferBatch,o=0,l=0,h=0);for(var u=s.vData,c=0;c<o;c++){var p=n[c];u[a++]=p.x,u[a++]=p.y,u[a++]=p.z,u[a++]=p.u,u[a++]=p.v,Ii.toArray(u,r,a),a+=4}var d=s.iData;d[l++]=h,d[l++]=h+1,d[l++]=h+2,d[l++]=h+1,d[l++]=h+3,d[l++]=h+2}(0,e,t.renderData,sW)},updateColor:function(){}},oW=2*Math.PI,lW=1e-6,hW=new Ii(255,255,255,255),uW=[new _i,new _i,new _i,new _i],cW=new Array(4),pW=new Array(8),dW=[new _i,new _i,new _i,new _i],fW=[new _i,new _i,new _i,new _i],_W=new _i,gW=[new _i,new _i,new _i,new _i];function mW(t,e,i,r,n,s,a){var o=Math.sin(s);o=Math.abs(o)>lW?o:0;var l=Math.cos(s),h=0,u=0;if(0!==(l=Math.abs(l)>lW?l:0)){if(h=o/l,(t-n.x)*l>0){var c=n.y+h*(t-n.x);a[0].x=t,a[0].y=c}if((e-n.x)*l>0){var p=n.y+h*(e-n.x);a[2].x=e,a[2].y=p}}if(0!==o){if(u=l/o,(r-n.y)*o>0){var d=n.x+u*(r-n.y);a[3].x=d,a[3].y=r}if((i-n.y)*o>0){var f=n.x+u*(i-n.y);a[1].x=f,a[1].y=i}}}function yW(t,e){var i=e.x-t.x,r=e.y-t.y;if(0===i&&0===r)return 0;if(0===i)return r>0?.5*Math.PI:1.5*Math.PI;var n=Math.atan(r/i);return i<0&&(n+=Math.PI),n}function vW(t,e,i,r,n){var s=cW,a=s[0],o=s[1],l=s[2],h=s[3];t[e].x=i.x,t[e].y=i.y,t[e+1].x=r.x,t[e+1].y=r.y,t[e+2].x=n.x,t[e+2].y=n.y,bW((i.x-a)/(l-a),(i.y-o)/(h-o),t,e),bW((r.x-a)/(l-a),(r.y-o)/(h-o),t,e+1),bW((n.x-a)/(l-a),(n.y-o)/(h-o),t,e+2)}function bW(t,e,i,r){var n=pW,s=n[0]+(n[2]-n[0])*t,a=n[4]+(n[6]-n[4])*t,o=n[1]+(n[3]-n[1])*t,l=n[5]+(n[7]-n[5])*t,h=i[r];h.u=s+(a-s)*e,h.v=o+(l-o)*e}for(var SW={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;VL.packToDynamicAtlas(t,e);var i,r,n,s,a,o,l,h,u,c=t.renderData;if(c&&e&&(c.vertDirty||c.uvDirty)){var p=c.data,d=t.fillStart,f=t.fillRange;for(f<0&&(d+=f,f=-f);d>=1;)d-=1;for(;d<0;)d+=1;var _=(d*=oW)+(f*=oW);!function(t){var e=t.node._uiProps.uiTransformComp,i=e.width,r=e.height,n=e.anchorX*i,s=e.anchorY*r,a=-n,o=-s,l=i-n,h=r-s,u=cW;u[0]=a,u[1]=o,u[2]=l,u[3]=h;var c=t.fillCenter,p=_W.x=Math.min(Math.max(0,c.x),1)*(l-a)+a,d=_W.y=Math.min(Math.max(0,c.y),1)*(h-o)+o;uW[0].x=uW[3].x=a,uW[1].x=uW[2].x=l,uW[0].y=uW[1].y=o,uW[2].y=uW[3].y=h;for(var f,_=ke(gW);!(f=_()).done;){var g=f.value;_i.set(g,0,0)}p!==u[0]&&_i.set(gW[0],3,0),p!==u[2]&&_i.set(gW[2],1,2),d!==u[1]&&_i.set(gW[1],0,1),d!==u[3]&&_i.set(gW[3],2,3)}(t),r=(i=e).width,n=i.height,s=i.getRect(),a=0,o=0,l=0,h=0,u=pW,i.isRotated()?(a=s.x/r,o=(s.x+s.height)/r,l=s.y/n,h=(s.y+s.width)/n,u[0]=u[2]=a,u[4]=u[6]=o,u[3]=u[7]=h,u[1]=u[5]=l):(a=s.x/r,o=(s.x+s.width)/r,l=s.y/n,h=(s.y+s.height)/n,u[0]=u[4]=a,u[2]=u[6]=o,u[1]=u[3]=h,u[5]=u[7]=l),mW(cW[0],cW[2],cW[1],cW[3],_W,d,dW),mW(cW[0],cW[2],cW[1],cW[3],_W,d+f,fW);for(var g=0,m=0;m<4;++m){var y=gW[m];if(y)if(f>=oW)c.dataLength=g+3,vW(p,g,_W,uW[y.x],uW[y.y]),g+=3;else{var v=yW(_W,uW[y.x]),b=yW(_W,uW[y.y]);b<v&&(b+=oW),v-=oW,b-=oW;for(var S=0;S<3;++S)v>=_||(v>=d?(c.dataLength=g+3,vW(p,g,_W,uW[y.x],b>=_?fW[m]:uW[y.y]),g+=3):b>d&&(b<=_?(c.dataLength=g+3,vW(p,g,_W,dW[m],uW[y.y]),g+=3):(c.dataLength=g+3,vW(p,g,_W,dW[m],fW[m]),g+=3))),v+=oW,b+=oW}}c.indicesCount=c.vertexCount=g,c.vertDirty=c.uvDirty=!1}},fillBuffers:function(t,e){var i=t.node,r=t.renderData;hW.set(t.color),hW.a=255*i._uiProps.opacity,function(t,e,i,r){var n=i.data,s=e.acquireBufferBatch(),a=s.byteOffset>>2,o=i.vertexCount,l=s.indicesOffset,h=s.vertexOffset;s.request(o,i.indicesCount)||(s=e.currBufferBatch,o=0,l=0,h=0);var u=s.vData;t.getWorldMatrix(FL);for(var c=0;c<o;c++){var p=n[c];Si.set(LL,p.x,p.y,0),Si.transformMat4(LL,LL,FL),u[a++]=LL.x,u[a++]=LL.y,u[a++]=LL.z,u[a++]=p.u,u[a++]=p.v,Ii.toArray(u,r,a),a+=4}for(var d=s.iData,f=0;f<i.dataLength;f++)d[l+f]=h+f}(i,e,r,hW)},updateColor:function(){}},TW=[],AW=0;AW<4;AW++)TW.push(new Si);for(var EW={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){var e=t.spriteFrame;VL.packToDynamicAtlas(t,e);var i=t.renderData;i&&e&&(i.vertDirty&&this.updateVertexData(t),i.uvDirty&&this.updateUvs(t))},updateWorldVerts:function(t,e){var i=t.renderData.data,r=t.node,n=i[0],s=i[3],a=r.worldMatrix,o=a.m00,l=a.m01,h=a.m04,u=a.m05,c=1===o&&0===l&&0===h&&1===u,p=a.m12,d=a.m13,f=n.x,_=s.x,g=n.y,m=s.y;if(c){var y=f+p,v=_+p,b=g+d,S=m+d;e[0]=y,e[1]=b,e[9]=v,e[10]=b,e[18]=y,e[19]=S,e[27]=v,e[28]=S}else{var T=o*f,A=o*_,E=l*f,C=l*_,R=h*g+p,w=h*m+p,x=u*g+d,O=u*m+d;e[0]=T+R,e[1]=E+x,e[9]=A+R,e[10]=C+x,e[18]=T+w,e[19]=E+O,e[27]=A+w,e[28]=C+O}r._uiProps.uiTransformDirty=!1},fillBuffers:function(t,e){if(null!==t){var i=t.renderData.vData;t.node._uiProps.uiTransformDirty&&this.updateWorldVerts(t,i);var r=e.acquireBufferBatch(),n=r.byteOffset>>2,s=r.indicesOffset,a=r.vertexOffset;r.request()||(r=e.currBufferBatch,n=0,s=0,a=0);var o=r.vData,l=r.iData;o.set(i,n);var h=a,u=a+1,c=a+2,p=a+3;l[s++]=h,l[s++]=u,l[s++]=c,l[s++]=c,l[s++]=u,l[s++]=p}},updateVertexData:function(t){var e=t.renderData;if(e){var i=t.node._uiProps.uiTransformComp,r=e.data,n=i.width,s=i.height,a=i.anchorX*n,o=i.anchorY*s,l=0,h=0,u=0,c=0;if(t.trim)l=-a,h=-o,u=n-a,c=s-o;else{var p=t.spriteFrame,d=p.getOriginalSize(),f=p.getRect(),_=d.width,g=d.height,m=f.width,y=f.height,v=p.getOffset(),b=n/_,S=s/g,T=v.x+(_-m)/2,A=v.x-(_-m)/2;l=T*b-a,h=(v.y+(g-y)/2)*S-o,u=n+A*b-a,c=s+(v.y-(g-y)/2)*S-o}r[0].x=l,r[0].y=h,r[3].x=u,r[3].y=c,e.vertDirty=!1,this.updateWorldVerts(t,e.vData)}},updateUvs:function(t){var e=t.renderData,i=e.vData,r=t.spriteFrame.uv;i[3]=r[0],i[4]=r[1],i[12]=r[2],i[13]=r[3],i[21]=r[4],i[22]=r[5],i[30]=r[6],i[31]=r[7],e.uvDirty=!1},updateColor:function(t){for(var e=t.renderData.vData,i=5,r=t.color,n=r.r/255,s=r.g/255,a=r.b/255,o=t.node._uiProps.opacity,l=0;l<4;l++)e[i]=n,e[i+1]=s,e[i+2]=a,e[i+3]=o,i+=9}},CW=new Si,RW=new gi,wW={useModel:!1,createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indicesCount=54,e},updateRenderData:function(t){var e=t.spriteFrame;VL.packToDynamicAtlas(t,e);var i=t.renderData;i&&e&&i.vertDirty&&(this.updateVertexData(t),this.updateWorldVertexData(t))},updateVertexData:function(t){var e=t.renderData,i=e.data,r=t.node._uiProps.uiTransformComp,n=r.width,s=r.height,a=r.anchorX*n,o=r.anchorY*s,l=t.spriteFrame,h=l.insetLeft,u=l.insetRight,c=l.insetTop,p=l.insetBottom,d=n-h-u,f=s-c-p,_=n/(h+u),g=s/(c+p);_=Number.isNaN(_)||_>1?1:_,g=Number.isNaN(g)||g>1?1:g,d=d<0?0:d,f=f<0?0:f,i[0].x=-a,i[0].y=-o,i[1].x=h*_-a,i[1].y=p*g-o,i[2].x=i[1].x+d,i[2].y=i[1].y+f,i[3].x=n-a,i[3].y=s-o,e.vertDirty=!1},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var i=e.acquireBufferBatch(),r=t.renderData,n=r.data,s=i.byteOffset>>2,a=r.vertexCount,o=i.indicesOffset,l=i.vertexOffset,h=t.spriteFrame.uvSliced;i.request(a,r.indicesCount)||(i=e.currBufferBatch,s=0,o=0,l=0);for(var u=i.vData,c=i.iData,p=4;p<20;++p){var d=n[p],f=h[p-4];u[s++]=d.x,u[s++]=d.y,u[s++]=d.z,u[s++]=f.u,u[s++]=f.v,Ii.toArray(u,n[p].color,s),s+=4}for(var _=0;_<3;++_)for(var g=0;g<3;++g){var m=l+4*_+g;c[o++]=m,c[o++]=m+1,c[o++]=m+4,c[o++]=m+1,c[o++]=m+5,c[o++]=m+4}},updateWorldVertexData:function(t){var e=t.node,i=t.renderData.data;e.getWorldMatrix(RW);for(var r=0;r<4;++r)for(var n=i[r],s=0;s<4;++s){var a=i[s],o=i[4+4*r+s];Si.set(CW,a.x,n.y,0),Si.transformMat4(o,CW,RW)}},updateColor:function(t){for(var e=t.renderData.data,i=t.color,r=i.r,n=i.g,s=i.b,a=255*t.node._uiProps.opacity,o=4;o<20;o++)e[o].color.r=r,e[o].color.g=n,e[o].color.b=s,e[o].color.a=a}},xW=[],OW=0;OW<4;OW++)xW.push(new Si);var PW={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,i=t.spriteFrame;if(i&&e&&(e.uvDirty||e.vertDirty)){var r=t.node._uiProps.uiTransformComp,n=Math.abs(r.width),s=Math.abs(r.height),a=i.getRect(),o=i.insetLeft,l=i.insetRight,h=a.width-o-l,u=i.insetTop,c=i.insetBottom,p=a.height-u-c,d=n-o-l,f=s-u-c;d=d>0?d:0,f=f>0?f:0;var _=0===h?d:d/h,g=0===p?f:f/p,m=Math.ceil(g+2),y=Math.ceil(_+2);e.dataLength=Math.max(8,m+1,y+1),this.updateVerts(t,d,f,m,y),e.vertexCount=m*y*4,e.indicesCount=m*y*6,e.uvDirty=!1,e.vertDirty=!1,this.updateColor(t)}},fillBuffers:function(t,e){var i=t.node,r=t.node._uiProps.uiTransformComp,n=Math.abs(r.width),s=Math.abs(r.height),a=t.renderData,o=e.acquireBufferBatch(),l=o.indicesOffset,h=o.byteOffset>>2,u=o.vertexOffset,c=a.vertexCount,p=a.indicesCount,d=o.vData,f=o.iData;o.request(c,p)||(o=e.currBufferBatch,h=0,l=0,u=0);var _=t.spriteFrame,g=_.isRotated(),m=_.uv,y=t.spriteFrame.uvSliced,v=_.getRect(),b=_.insetLeft,S=_.insetRight,T=v.width-b-S,A=_.insetTop,E=_.insetBottom,C=v.height-A-E,R=n-b-S,w=s-A-E;R=R>0?R:0,w=w>0?w:0;var x=0===T?R:R/T,O=0===C?w:w/C,P=Math.ceil(O+2),D=Math.ceil(x+2),M=i.worldMatrix,B=a.data;this.fillVertices(d,h,M,P,D,B);for(var I=0,L=0,F=[],k=[],N=0,G=P;N<G;++N){L=w>C?w>=N*C?1:O%1:O;for(var U=0,z=D;U<z;++U){I=R>T?R>=U*T?1:x%1:x;var V=h+3,H=V+1;g?(0===N?(F[0]=y[0].u,F[1]=y[0].u,F[2]=y[4].u+(y[8].u-y[4].u)*L):N<P-1?(F[0]=y[4].u,F[1]=y[4].u,F[2]=y[4].u+(y[8].u-y[4].u)*L):N===P-1&&(F[0]=y[8].u,F[1]=y[8].u,F[2]=y[12].u),0===U?(k[0]=y[0].v,k[1]=y[1].v+(y[2].v-y[1].v)*I,k[2]=y[0].v):U<D-1?(k[0]=y[1].v,k[1]=y[1].v+(y[2].v-y[1].v)*I,k[2]=y[1].v):U===D-1&&(k[0]=y[2].v,k[1]=y[3].v,k[2]=y[2].v),F[3]=F[2],k[3]=k[1]):(0===U?(F[0]=y[0].u,F[1]=y[1].u+(y[2].u-y[1].u)*I,F[2]=m[0]):U<D-1?(F[0]=y[1].u,F[1]=y[1].u+(y[2].u-y[1].u)*I,F[2]=y[1].u):U===D-1&&(F[0]=y[2].u,F[1]=y[3].u,F[2]=y[2].u),0===N?(k[0]=y[0].v,k[1]=y[0].v,k[2]=y[4].v+(y[8].v-y[4].v)*L):N<P-1?(k[0]=y[4].v,k[1]=y[4].v,k[2]=y[4].v+(y[8].v-y[4].v)*L):N===P-1&&(k[0]=y[8].v,k[1]=y[8].v,k[2]=y[12].v),F[3]=F[1],k[3]=k[2]),d[V]=F[0],d[H]=k[0],d[V+9]=F[1],d[H+9]=k[1],d[V+18]=F[2],d[H+18]=k[2],d[V+27]=F[3],d[H+27]=k[3],Ii.toArray(d,B[0].color,H+1),Ii.toArray(d,B[0].color,H+9+1),Ii.toArray(d,B[0].color,H+18+1),Ii.toArray(d,B[0].color,H+27+1),h+=36}}for(var W=0;W<p;W+=6)f[l++]=u,f[l++]=u+1,f[l++]=u+2,f[l++]=u+1,f[l++]=u+3,f[l++]=u+2,u+=4},fillVertices:function(t,e,i,r,n,s){for(var a=0,o=0,l=0,h=0,u=0,c=r;u<c;++u){l=s[u].y,h=s[u+1].y;for(var p=0,d=n;p<d;++p){a=s[p].x,o=s[p+1].x,Si.set(xW[0],a,l,0),Si.set(xW[1],o,l,0),Si.set(xW[2],a,h,0),Si.set(xW[3],o,h,0);for(var f=0;f<4;f++){var _=xW[f];Si.transformMat4(_,_,i);var g=9*f;t[e+g]=_.x,t[e+g+1]=_.y,t[e+g+2]=_.z}e+=36}}},updateVerts:function(t,e,i,r,n){var s,a,o=t.node._uiProps.uiTransformComp,l=t.renderData.data,h=t.spriteFrame,u=h.getRect(),c=Math.abs(o.width),p=Math.abs(o.height),d=o.anchorX*c,f=o.anchorY*p,_=h.insetLeft,g=h.insetRight,m=u.width-_-g,y=h.insetTop,v=h.insetBottom,b=u.height-y-v,S=o.width/(_+g)>1?1:o.width/(_+g),T=o.height/(y+v)>1?1:o.height/(y+v);s=m>0?Math.floor(1e3*e)/1e3%m==0?m:e%m:e,a=b>0?Math.floor(1e3*i)/1e3%b==0?b:i%b:i;for(var A=0;A<=n;A++)0===A?l[A].x=-d:A>0&&A<n?l[A].x=1===A?_*S+Math.min(m,e)-d:m>0?A===n-1?_+s+m*(A-2)-d:_+Math.min(m,e)+m*(A-2)-d:_+e-d:A===n&&(l[A].x=Math.min(_+e+g,c)-d);for(var E=0;E<=r;E++)0===E?l[E].y=-f:E>0&&E<r?l[E].y=1===E?v*T+Math.min(b,i)-f:b>0?E===r-1?v+a+(E-2)*b-f:v+Math.min(b,i)+(E-2)*b-f:v+i-f:E===r&&(l[E].y=Math.min(v+i+y,p)-f)},updateColor:function(t){var e=t.renderData.data,i=e.length;if(0!==i)for(var r=t.color,n=r.r,s=r.g,a=r.b,o=255*t.node._uiProps.opacity,l=0;l<i;l++)e[l].color.r=n,e[l].color.g=s,e[l].color.b=a,e[l].color.a=o}},DW=lz.Type,MW=lz.FillType,BW=t("spriteAssembler",{getAssembler:function(t){var e=EW,i=t;switch(i.type){case DW.SLICED:e=wW;break;case DW.TILED:e=PW;break;case DW.FILLED:e=i.fillType===MW.RADIAL?SW:aW}return e}});lz.Assembler=BW;var IW=Ql.sharedManager,LW={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){t.type===pG.IMAGE_STENCIL&&(EW.updateRenderData(t),EW.updateColor(t))},fillBuffers:function(t,e){(t.type!==pG.IMAGE_STENCIL||t.spriteFrame)&&(IW.pushMask(t),e.finishMergeBatches(),function(t,e){IW.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(IW.enterLevel(t),t.type===pG.IMAGE_STENCIL){EW.fillBuffers(t,e);var i=t.graphics.getMaterialInstance(0);e.forceMergeBatches(i,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),IW.enableMask())}},FW={fillBuffers:function(){IW.exitMask()}},kW={getAssembler:function(){return LW}},NW={getAssembler:function(){return FW}};SG.Assembler=kW,SG.PostAssembler=NW;var GW=new Bt(null),UW=new gi,zW=t("UI",function(){var t=n.prototype;function n(t){var n=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new i((function(){return new vz(n)}),128),this._drawBatchPool=void 0,this._meshBuffers=new Map,this._customMeshBuffers=new Map,this._meshBufferUseCount=new Map,this._batches=void 0,this._doUploadBuffersCall=new Map,this._emptyMaterial=new Fi,this._currScene=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currBlendTargetHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._descriptorSetCache=new HW,this._root=t,this.device=t.device,this._batches=new r(64),this._drawBatchPool=new e((function(){return new jz}),128)}return t.acquireBufferBatch=function(t){void 0===t&&(t=kN);var e=t===kN?36:UN(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},t.registerCustomBuffer=function(t,e){var i;t instanceof vz?i=t:(i=this._bufferBatchPool.add()).initialize(t,e||this._recreateMeshBuffer.bind(this,t));var r=i.vertexFormatBytes,n=this._customMeshBuffers.get(r);return n||(n=[],this._customMeshBuffers.set(r,n)),n.push(i),i},t.unRegisterCustomBuffer=function(t){var e=this._customMeshBuffers.get(t.vertexFormatBytes);if(e)for(var i=0;i<e.length;i++)if(e[i]===t){e.splice(i,1);break}},t.initialize=function(){return!0},t.destroy=function(){for(var t=this,e=0;e<this._batches.length;e++)this._batches.array[e]&&this._batches.array[e].destroy(this);this._batches.destroy();for(var i,r=ke(this._meshBuffers.keys());!(i=r()).done;){var n=i.value,s=this._meshBuffers.get(n);s&&s.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(e){e.destroy(t)})),this._descriptorSetCache.destroy(),this._meshBuffers.clear(),Ql.sharedManager.destroy()},t.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},t.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,i=0;i<e.length;i++){var r=e[i];if(r.visibility&t.layer)return r}return null},t.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.addUploadBuffersFunc=function(t,e){this._doUploadBuffersCall.set(t,e)},t.removeUploadBuffersFunc=function(t){this._doUploadBuffersCall.delete(t)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var i=t[e];i.enabledInHierarchy&&this._recursiveScreenNode(i.node)}var r=0;if(this._batches.length)for(var n=0;n<this._batches.length;++n){var s=this._batches.array[n];if(s.renderScene){if(s.model)for(var a=s.model.subModels,o=0;o<a.length;o++)a[o].priority=r++;else s.hDescriptorSet=this._descriptorSetCache.getDescriptorSet(s);s.renderScene.addBatch(s)}}},t.uploadBuffers=function(){var t=this;this._batches.length>0&&(this._doUploadBuffersCall.forEach((function(e,i){e.call(i,t)})),this._meshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._customMeshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._descriptorSetCache.update())},t.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._currLayer=0,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._currScene=null,this._currMeshBuffer=null,this._meshBufferUseCount.clear(),this._batches.clear(),Ql.sharedManager.reset(),this._descriptorSetCache.reset()},t.commitComp=function(t,e,i,r){var n,s,a=t,o=0,l=0;e?(n=e.getGFXTexture(),s=e.getGFXSampler(),o=e.getHash(),l=e.getSamplerHash()):(n=null,s=null);var h=a._getRenderScene(),u=a.getRenderMaterial(0);a.stencilStage=Ql.sharedManager.stage;var c=a.blendHash,p=a.stencilStage;this._currScene===h&&this._currLayer===t.node.layer&&this._currMaterial===u&&this._currBlendTargetHash===c&&this._currDepthStencilStateStage===p&&this._currTextureHash===o&&this._currSamplerHash===l&&this._currTransform===r||(this.autoMergeBatches(this._currComponent),this._currScene=h,this._currComponent=a,this._currTransform=r,this._currMaterial=u,this._currTexture=n,this._currSampler=s,this._currTextureHash=o,this._currSamplerHash=l,this._currBlendTargetHash=c,this._currDepthStencilStateStage=p,this._currLayer=t.node.layer),i&&i.fillBuffers(a,this)},t.commitModel=function(t,e,i){var r;this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent);var n=0;i&&(t.stencilStage!==Yl.ENABLED&&t.stencilStage!==Yl.DISABLED||(t.stencilStage=Ql.sharedManager.stage),r=Ql.sharedManager.getStencilStage(t.stencilStage,i),n=Ql.sharedManager.getStencilHash(t.stencilStage));var s=Xe.director.getTotalFrames();e&&(e.updateTransform(s),e.updateUBOs(s));for(var a=0;a<e.subModels.length;a++){var o=this._drawBatchPool.alloc(),l=e.subModels[a];o.renderScene=t._getRenderScene(),o.visFlags=t.node.layer,o.model=e,o.bufferBatch=null,o.texture=null,o.sampler=null,o.useLocalData=null,r||(r=null),o.fillPasses(i,r,n,null,0,l.patches),o.hDescriptorSet=Hn.get(l.handle,Wn.DESCRIPTOR_SET),o.hInputAssembler=Hn.get(l.handle,Wn.INPUT_ASSEMBLER),o.model.visFlags=o.visFlags,this._batches.push(o)}this._currMaterial=this._emptyMaterial,this._currScene=null,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,i=null==e?void 0:e.recordBatch(),r=this._currMaterial;if(i&&r&&e){var n,s,a=0,o=0;t&&(n=-1===t.blendHash?null:t.getBlendState(),o=t.blendHash,s=null!==t.customMaterial?Ql.sharedManager.getStencilStage(t.stencilStage,r):Ql.sharedManager.getStencilStage(t.stencilStage),a=Ql.sharedManager.getStencilHash(t.stencilStage));var l=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();l.renderScene=this._currScene,l.visFlags=this._currLayer,l.bufferBatch=e,l.texture=this._currTexture,l.sampler=this._currSampler,l.hInputAssembler=i,l.useLocalData=this._currTransform,l.textureHash=this._currTextureHash,l.samplerHash=this._currSamplerHash,l.fillPasses(r,s,a,n,o,null),this._batches.push(l),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,Ue.__isWebIOS14OrIPadOS14Env&&!this._currIsStatic&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,i){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=e.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=i.node.layer,this._currScene=i._getRenderScene(),this.autoMergeBatches(i)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.flushMaterial=function(t){this._currMaterial=t},t.walk=function(t,e){void 0===e&&(e=0);var i=t.children.length;if(this._preProcess(t),i>0&&!t._static)for(var r=t.children,n=0;n<r.length;++n){var s=r[n];this.walk(s,e)}this._postProcess(t),e+=1},t._preProcess=function(t){var e=t._uiProps.uiComp;if(!e){var i=t._uiProps.localOpacity;t._uiProps.opacity=t.parent&&t.parent._uiProps?t.parent._uiProps.opacity*i:i}t._uiProps.uiTransformComp&&e&&e.enabledInHierarchy&&e.updateAssembler(this)},t._postProcess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._recreateMeshBuffer.bind(this,t));var i=UN(t),r=this._meshBuffers.get(i);return r||(r=[],this._meshBuffers.set(i,r)),r.push(e),e},t._recreateMeshBuffer=function(t,e,i){this.autoMergeBatches(),this._requireBufferBatch(t,e,i)},t._requireBufferBatch=function(t,e,i){var r=UN(t),n=this._meshBuffers.get(r);n||(n=[],this._meshBuffers.set(r,n));var s=this._meshBufferUseCount.get(r)||0;s>=n.length?this._currMeshBuffer=this._createMeshBuffer(t):this._currMeshBuffer=n[s],this._meshBufferUseCount.set(r,s+1),e&&i&&this._currMeshBuffer.request(e,i)},t._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},t._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},Be(n,[{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),n}()),VW=function(){function t(){this._handle=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=Xe.director.root.device;this._localData=new Float32Array(Yn.COUNT),this._localBuffer=t.createBuffer(new nt(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,Yn.SIZE,Yn.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=Xe.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,GW.layout=t.passes[0].localSetLayout,this._handle&&(Xn.free(this._handle),this._handle=null),this._handle=Xn.alloc(e,GW),this._descriptorSet=Xn.get(this._handle),this._descriptorSet.bindBuffer(Yn.BINDING,this._localBuffer);var i=jn.SAMPLER_SPRITE;this._descriptorSet.bindTexture(i,t.texture),this._descriptorSet.bindSampler(i,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.updateLocal=function(){this._transform&&this.uploadLocalData()},e.equals=function(t,e,i){return this._transform===t&&this._textureHash===e&&this._samplerHash===i},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._handle&&(Xn.free(this._handle),this._handle=null),this._localData=null},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&t.updateWorldTransform(),this._transformUpdate){var e=t._mat;gi.toArray(this._localData,e,Yn.MAT_WORLD_OFFSET),gi.inverseTranspose(UW,e),gi.toArray(this._localData,UW,Yn.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},Be(t,[{key:"handle",get:function(){return this._handle}}]),t}(),HW=function(){function t(){this._descriptorSetCache=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new e((function(){return new VW}),16)}var i=t.prototype;return i.getDescriptorSet=function(t){var e=Xe.director.root;if(t.useLocalData){for(var i=this._localDescriptorSetCache,r=0,n=i.length;r<n;r++){var s=i[r];if(s.equals(t.useLocalData,t.textureHash,t.samplerHash))return s.handle}var a=this._localCachePool.alloc();return a.initialize(t),this._localDescriptorSetCache.push(a),a.handle}var o=this._descriptorSetCache.get(t.textureHash);if(o&&o.has(t.samplerHash))return o.get(t.samplerHash);GW.layout=t.passes[0].localSetLayout;var l=Xn.alloc(e.device,GW),h=Xn.get(l),u=jn.SAMPLER_SPRITE;return h.bindTexture(u,t.texture),h.bindSampler(u,t.sampler),h.update(),o?this._descriptorSetCache.get(t.textureHash).set(t.samplerHash,l):this._descriptorSetCache.set(t.textureHash,new Map([[t.samplerHash,l]])),l},i.update=function(){this._localDescriptorSetCache.forEach((function(t){t.updateLocal()}))},i.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},i.releaseDescriptorSetCache=function(t){this._descriptorSetCache.has(t)&&(this._descriptorSetCache.get(t).forEach((function(t){Xn.free(t)})),this._descriptorSetCache.delete(t))},i.destroy=function(){this._descriptorSetCache.forEach((function(t){t.forEach((function(t){Xn.free(t)}))})),this._descriptorSetCache.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy((function(t){t.destroy()}))},t}();Xe.internal.Batcher2D=zW;var WW,XW,YW,jW,KW,qW,ZW,JW,QW,$W,tX,eX,iX,rX,nX,sX,aX,oX,lX,hX,uX,cX,pX,dX,fX,_X,gX,mX,yX,vX,bX,SX,TX,AX,EX,CX,RX,wX,xX,OX,PX,DX,MX,BX,IX,LX,FX,kX,NX,GX,UX,zX=null,VX=-1,HX="BES bswy:->@123丁ぁᄁ",WX=Object.create(null),XX=[],YX=3e3;function jX(){for(var t=!0,e=Date.now(),i=XX.length-1;i>=0;i--){var r=XX[i],n=r.fontFamilyName;if(e-r.startTime>YX)He(4933,n),r.onComplete(null,n),XX.splice(i,1);else{var s=r.refWidth,a="40px "+n;zX.font=a,s!==OF(zX,HX,a)?(XX.splice(i,1),r.onComplete(null,n)):t=!1}}t&&(clearInterval(VX),VX=-1)}function KX(t,e,i){var r=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,r=t.lastIndexOf("/");return-1!==(i=-1===r?t.substring(0,e)+"_LABEL":t.substring(r+1,e)+"_LABEL").indexOf(" ")&&(i='"'+i+'"'),i}(t);if(WX[r])i(null,r);else{if(!zX){var n=document.createElement("canvas");n.width=100,n.height=100,zX=n.getContext("2d")}var s=OF(zX,HX,"40px "+r),a=document.createElement("style");a.type="text/css";var o="";Number.isNaN(r)?o+="@font-face { font-family:"+r+"; src:":o+='@font-face { font-family:"'+r+'"; src:',o+='url("'+t+'");',a.textContent=o+"}",document.body.appendChild(a);var l,h,u,c,p,d,f=document.createElement("div"),_=f.style;if(_.fontFamily=r,f.innerHTML=".",_.position="absolute",_.left="-100px",_.top="-100px",document.body.appendChild(f),function(){if(void 0===WW)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);WW=t?parseInt(t[1],10)>42:!e}else WW=!1;return WW}())l=Date.now(),h=r,u=i,c=new Promise((function(t,e){!function i(){Date.now()-l>=YX?e():document.fonts.load("40px "+h).then((function(e){e.length>=1?t():setTimeout(i,100)}),(function(){e()}))}()})),p=null,d=new Promise((function(t,e){p=setTimeout(e,YX)})),Promise.race([d,c]).then((function(){p&&(clearTimeout(p),p=null),u(null,h)}),(function(){He(4933,h),u(null,h)}));else{var g={fontFamilyName:r,refWidth:s,onComplete:i,startTime:Date.now()};XX.push(g),-1===VX&&(VX=setInterval(jX,100))}WX[r]=a}}function qX(t,e,i,r){var n=new cF;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}ii.register({".font":KX,".eot":KX,".ttf":KX,".woff":KX,".svg":KX,".ttc":KX}),ri.register({".font":qX,".eot":qX,".ttf":qX,".woff":qX,".svg":qX,".ttc":qX}),Xe.UI={MeshBuffer:vz,spriteAssembler:BW,graphicsAssembler:IV,labelAssembler:iW};var ZX,JX,QX,$X=new Ii;!function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.SPRITE=2]="SPRITE",t[t.SCALE=3]="SCALE"}(ZX||(ZX={})),Li(ZX),function(t){t.NORMAL="normal",t.HOVER="hover",t.PRESSED="pressed",t.DISABLED="disabled"}(JX||(JX={})),function(t){t.CLICK="click"}(QX||(QX={}));var tY,eY,iY,rY=function(e){return t({Button:e,ButtonComponent:e}),e}((XW=Ze("cc.Button"),YW=ai(),jW=Ci(110),KW=oi(),qW=xi(Ml),ZW=si(Yr),JW=Ri(),QW=li(),$W=Ri(),tX=li(),eX=si(ZX),iX=Ri(),rX=li(),nX=li(),sX=li(),aX=li(),oX=li(),lX=Kn(),hX=qn(),uX=li(),cX=li(),pX=si(KL),dX=li(),fX=si(KL),_X=li(),gX=si(KL),mX=li(),yX=si(KL),vX=li(),bX=si([Xi]),SX=Ri(),TX=li(),XW(AX=YW(AX=jW(AX=KW(AX=qW(AX=vi((UX=GX=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"clickEvents",CX,ti(e)),$e(e,"_interactable",RX,ti(e)),$e(e,"_transition",wX,ti(e)),$e(e,"_normalColor",xX,ti(e)),$e(e,"_hoverColor",OX,ti(e)),$e(e,"_pressedColor",PX,ti(e)),$e(e,"_disabledColor",DX,ti(e)),$e(e,"_normalSprite",MX,ti(e)),$e(e,"_hoverSprite",BX,ti(e)),$e(e,"_pressedSprite",IX,ti(e)),$e(e,"_disabledSprite",LX,ti(e)),$e(e,"_duration",FX,ti(e)),$e(e,"_zoomScale",kX,ti(e)),$e(e,"_target",NX,ti(e)),e._pressed=!1,e._hovered=!1,e._fromColor=new Ii,e._toColor=new Ii,e._time=0,e._transitionFinished=!0,e._fromScale=new Si,e._toScale=new Si,e._originalScale=null,e._sprite=null,e._targetScale=new Si,e}Me(e,t);var i=e.prototype;return i.__preload=function(){this.target||(this.target=this.node);var t=this.node.getComponent(lz);t&&(this._normalSprite=t.spriteFrame),this._applyTarget(),this._resetState()},i.onEnable=function(){this._registerNodeEvent()},i.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},i.update=function(t){var e=this.target;if(!this._transitionFinished&&e&&(this._transition===ZX.COLOR||this._transition===ZX.SCALE)){this._time+=t;var i=1;if(this._duration>0&&(i=this._time/this._duration),i>=1&&(i=1),this._transition===ZX.COLOR){var r=e._uiProps.uiComp;Ii.lerp($X,this._fromColor,this._toColor,i),r&&(r.color=$X)}else this.transition===ZX.SCALE&&(e.getScale(this._targetScale),this._targetScale.x=$r(this._fromScale.x,this._toScale.x,i),this._targetScale.y=$r(this._fromScale.y,this._toScale.y,i),e.setScale(this._targetScale));1===i&&(this._transitionFinished=!0)}},i._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},i._resetState=function(){this._pressed=!1,this._hovered=!1;var t=this.target;if(t){var e=t.getComponent(Ch);if(e){var i=this._transition;i===ZX.COLOR&&this._interactable?e.color=this._normalColor:i===ZX.SCALE&&this._originalScale&&t.setScale(this._originalScale),this._transitionFinished=!0}}},i._registerNodeEvent=function(){this.node.on(bi.TOUCH_START,this._onTouchBegan,this),this.node.on(bi.TOUCH_MOVE,this._onTouchMove,this),this.node.on(bi.TOUCH_END,this._onTouchEnded,this),this.node.on(bi.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(bi.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(bi.MOUSE_LEAVE,this._onMouseMoveOut,this)},i._registerTargetEvent=function(t){t.on(bi.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},i._unregisterNodeEvent=function(){this.node.off(bi.TOUCH_START,this._onTouchBegan,this),this.node.off(bi.TOUCH_MOVE,this._onTouchMove,this),this.node.off(bi.TOUCH_END,this._onTouchEnded,this),this.node.off(bi.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(bi.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(bi.MOUSE_LEAVE,this._onMouseMoveOut,this)},i._unregisterTargetEvent=function(t){t.off(bi.TRANSFORM_CHANGED)},i._getTargetSprite=function(t){var e=null;return t&&(e=t.getComponent(lz)),e},i._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new Si),Si.copy(this._originalScale,this.target.getScale()))},i._onTargetSpriteFrameChanged=function(t){this._transition===ZX.SPRITE&&this._setCurrentStateSpriteFrame(t.spriteFrame)},i._setCurrentStateSpriteFrame=function(t){if(t)switch(this._getButtonState()){case JX.NORMAL:this._normalSprite=t;break;case JX.HOVER:this._hoverSprite=t;break;case JX.PRESSED:this._pressedSprite=t;break;case JX.DISABLED:this._disabledSprite=t}},i._onTargetColorChanged=function(t){this._transition===ZX.COLOR&&this._setCurrentStateColor(t)},i._setCurrentStateColor=function(t){switch(this._getButtonState()){case JX.NORMAL:this._normalColor=t;break;case JX.HOVER:this._hoverColor=t;break;case JX.PRESSED:this._pressedColor=t;break;case JX.DISABLED:this._disabledColor=t}},i._onTargetTransformChanged=function(t){t|vr.SCALE&&this._originalScale&&this._transition===ZX.SCALE&&this._transitionFinished&&Si.copy(this._originalScale,this.target.getScale())},i._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},i._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&t){var e=t.touch;if(e){var i,r=this.node._uiProps.uiTransformComp.isHit(e.getUILocation());this._transition===ZX.SCALE&&this.target&&this._originalScale?r?(Si.copy(this._fromScale,this._originalScale),Si.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(i=r?JX.PRESSED:JX.NORMAL,this._applyTransition(i)),t&&(t.propagationStopped=!0)}}},i._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(Xi.emitEvents(this.clickEvents,t),this.node.emit(QX.CLICK,this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},i._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},i._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==ZX.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},i._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},i._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},i._getButtonState=function(){var t=JX.NORMAL;return this._interactable?this._pressed?t=JX.PRESSED:this._hovered&&(t=JX.HOVER):t=JX.DISABLED,t.toString()},i._updateColorTransition=function(t){var e,i=this[t+"Color"],r=null===(e=this.target)||void 0===e?void 0:e.getComponent(Ch);r&&(t===JX.DISABLED?r.color=i:(this._fromColor=r.color.clone(),this._toColor=i,this._time=0,this._transitionFinished=!1))},i._updateSpriteTransition=function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},i._updateScaleTransition=function(t){this._interactable&&(t===JX.PRESSED?this._zoomUp():this._zoomBack())},i._zoomUp=function(){this._originalScale&&(Si.copy(this._fromScale,this._originalScale),Si.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},i._zoomBack=function(){this.target&&this._originalScale&&(Si.copy(this._fromScale,this.target.getScale()),Si.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},i._applyTransition=function(t){var e=this._transition;e===ZX.COLOR?this._updateColorTransition(t):e===ZX.SPRITE?this._updateSpriteTransition(t):e===ZX.SCALE&&this._updateScaleTransition(t)},Be(e,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable=t,this._updateState(),this._interactable||this._resetState()}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition===ZX.COLOR?this._updateColorTransition(JX.NORMAL):this._transition===ZX.SPRITE&&this._updateSpriteTransition(JX.NORMAL),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var e=this.node.getComponent(lz);e&&(e.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),e}(ui),GX.Transition=ZX,GX.EventType=QX,je((EX=UX).prototype,"target",[ZW,JW,QW],Object.getOwnPropertyDescriptor(EX.prototype,"target"),EX.prototype),je(EX.prototype,"interactable",[$W,tX],Object.getOwnPropertyDescriptor(EX.prototype,"interactable"),EX.prototype),je(EX.prototype,"transition",[eX,iX,rX],Object.getOwnPropertyDescriptor(EX.prototype,"transition"),EX.prototype),je(EX.prototype,"normalColor",[nX],Object.getOwnPropertyDescriptor(EX.prototype,"normalColor"),EX.prototype),je(EX.prototype,"pressedColor",[sX],Object.getOwnPropertyDescriptor(EX.prototype,"pressedColor"),EX.prototype),je(EX.prototype,"hoverColor",[aX],Object.getOwnPropertyDescriptor(EX.prototype,"hoverColor"),EX.prototype),je(EX.prototype,"disabledColor",[oX],Object.getOwnPropertyDescriptor(EX.prototype,"disabledColor"),EX.prototype),je(EX.prototype,"duration",[lX,hX,uX],Object.getOwnPropertyDescriptor(EX.prototype,"duration"),EX.prototype),je(EX.prototype,"zoomScale",[cX],Object.getOwnPropertyDescriptor(EX.prototype,"zoomScale"),EX.prototype),je(EX.prototype,"normalSprite",[pX,dX],Object.getOwnPropertyDescriptor(EX.prototype,"normalSprite"),EX.prototype),je(EX.prototype,"pressedSprite",[fX,_X],Object.getOwnPropertyDescriptor(EX.prototype,"pressedSprite"),EX.prototype),je(EX.prototype,"hoverSprite",[gX,mX],Object.getOwnPropertyDescriptor(EX.prototype,"hoverSprite"),EX.prototype),je(EX.prototype,"disabledSprite",[yX,vX],Object.getOwnPropertyDescriptor(EX.prototype,"disabledSprite"),EX.prototype),CX=je(EX.prototype,"clickEvents",[bX,ei,SX,TX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RX=je(EX.prototype,"_interactable",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),wX=je(EX.prototype,"_transition",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ZX.NONE}}),xX=je(EX.prototype,"_normalColor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),OX=je(EX.prototype,"_hoverColor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(211,211,211,255)}}),PX=je(EX.prototype,"_pressedColor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ii.WHITE.clone()}}),DX=je(EX.prototype,"_disabledColor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(124,124,124,255)}}),MX=je(EX.prototype,"_normalSprite",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BX=je(EX.prototype,"_hoverSprite",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IX=je(EX.prototype,"_pressedSprite",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LX=je(EX.prototype,"_disabledSprite",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FX=je(EX.prototype,"_duration",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),kX=je(EX.prototype,"_zoomScale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),NX=je(EX.prototype,"_target",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AX=EX))||AX)||AX)||AX)||AX)||AX)||AX)),nY=function(){function t(){}return t.add=function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},t.remove=function(t){var e=this._tabIndexList,i=e.indexOf(t);-1!==i&&e.splice(i,1)},t.resort=function(){this._tabIndexList.sort((function(t,e){return t._delegate.tabIndex-e._delegate.tabIndex}))},t.next=function(t){var e=this._tabIndexList,i=e.indexOf(t);if(t.setFocus(!1),-1!==i){var r=e[i+1];r&&r._delegate.tabIndex>=0&&r.setFocus(!0)}},t}();nY._tabIndexList=[],function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DONE=1]="DONE",t[t.SEND=2]="SEND",t[t.SEARCH=3]="SEARCH",t[t.GO=4]="GO",t[t.NEXT=5]="NEXT"}(tY||(tY={})),Oi(tY),function(t){t[t.ANY=0]="ANY",t[t.EMAIL_ADDR=1]="EMAIL_ADDR",t[t.NUMERIC=2]="NUMERIC",t[t.PHONE_NUMBER=3]="PHONE_NUMBER",t[t.URL=4]="URL",t[t.DECIMAL=5]="DECIMAL",t[t.SINGLE_LINE=6]="SINGLE_LINE"}(eY||(eY={})),Oi(eY),function(t){t[t.PASSWORD=0]="PASSWORD",t[t.SENSITIVE=1]="SENSITIVE",t[t.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",t[t.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",t[t.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",t[t.DEFAULT=5]="DEFAULT"}(iY||(iY={})),Oi(iY);var sY,aY,oY,lY,hY,uY,cY,pY,dY,fY,_Y,gY,mY,yY,vY,bY,SY,TY,AY,EY,CY,RY,wY,xY,OY,PY,DY,MY,BY,IY,LY,FY,kY,NY,GY,UY,zY,VY,HY,WY,XY,YY,jY,KY,qY,ZY,JY,QY,$Y,tj,ej,ij,rj,nj,sj,aj,oj,lj,hj,uj,cj,pj=function(){function t(){this._editing=!1,this._delegate=null}var e=t.prototype;return e.init=function(){},e.onEnable=function(){},e.update=function(){},e.onDisable=function(){this._editing&&this.endEditing()},e.clear=function(){this._delegate=null},e.setTabIndex=function(){},e.setSize=function(){},e.setFocus=function(t){t?this.beginEditing():this.endEditing()},e.isFocused=function(){return this._editing},e.beginEditing=function(){},e.endEditing=function(){},t}(),dj=new gi,fj=new gi,_j=new Si,gj=null,mj=0,yj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._delegate=null,e._inputMode=-1,e._inputFlag=-1,e._returnType=-1,e.__eventListeners={},e.__fullscreen=!1,e.__autoResize=!1,e.__orientationChanged=void 0,e._edTxt=null,e._isTextArea=!1,e._textLabelFont=null,e._textLabelFontSize=null,e._textLabelFontColor=null,e._textLabelAlign=null,e._placeholderLabelFont=null,e._placeholderLabelFontSize=null,e._placeholderLabelFontColor=null,e._placeholderLabelAlign=null,e._placeholderLineHeight=null,e._placeholderStyleSheet=null,e._domId="EditBoxId_"+ ++mj,e}Me(e,t);var i=e.prototype;return i.init=function(t){t&&(this._delegate=t,t.inputMode===eY.ANY?this._createTextArea():this._createInput(),nY.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),this.__fullscreen=Bi.isAutoFullScreenEnabled(),this.__autoResize=Bi._resizeWithBrowserSize)},i.clear=function(){this._removeEventListeners(),this._removeDomFromGameContainer(),nY.remove(this),gj===this&&(gj=null),this._delegate=null},i.update=function(){this._updateMatrix()},i.setTabIndex=function(t){this._edTxt.tabIndex=t,nY.resort()},i.setSize=function(t,e){var i=this._edTxt;i&&(i.style.width=t+"px",i.style.height=e+"px")},i.beginEditing=function(){gj&&gj!==this&&gj.setFocus(!1),this._editing=!0,gj=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},i.endEditing=function(){this._edTxt.blur()},i._createInput=function(){this._isTextArea=!1,this._edTxt=document.createElement("input")},i._createTextArea=function(){this._isTextArea=!0,this._edTxt=document.createElement("textarea")},i._addDomToGameContainer=function(){Xe.GAME_VIEW&&this._edTxt?(Xe.gameView.container.appendChild(this._edTxt),Xe.gameView.head.appendChild(this._placeholderStyleSheet)):Mi.container&&this._edTxt&&(Mi.container.appendChild(this._edTxt),document.head.appendChild(this._placeholderStyleSheet))},i._removeDomFromGameContainer=function(){(Xe.GAME_VIEW?Wi(Xe.gameView.container,this._edTxt):Wi(Mi.container,this._edTxt))&&this._edTxt&&(Xe.GAME_VIEW?Xe.gameView.container.removeChild(this._edTxt):Mi.container.removeChild(this._edTxt)),(Xe.GAME_VIEW?Wi(Xe.gameView.head,this._placeholderStyleSheet):Wi(document.head,this._placeholderStyleSheet))&&(Xe.GAME_VIEW?Xe.gameView.head.removeChild(this._placeholderStyleSheet):document.head.removeChild(this._placeholderStyleSheet)),this._edTxt=null,this._placeholderStyleSheet=null},i._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),Ue.isMobile&&this._showDomOnMobile()},i._hideDom=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),Ue.isMobile&&this._hideDomOnMobile()},i._showDomOnMobile=function(){Ne.os===Ge.ANDROID&&(this.__fullscreen&&(Bi.enableAutoFullScreen(!1),Hi.exitFullScreen()),this.__autoResize&&Bi.resizeWithBrowserSize(!1),this._adjustWindowScroll())},i._hideDomOnMobile=function(){var t=this;Ne.os===Ge.ANDROID&&(this.__autoResize&&Bi.resizeWithBrowserSize(!0),setTimeout((function(){gj||t.__fullscreen&&Bi.enableAutoFullScreen(!0)}),400)),this._scrollBackWindow()},i._adjustWindowScroll=function(){var t=this;setTimeout((function(){window.scrollY<40&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},i._scrollBackWindow=function(){setTimeout((function(){Ne.browserType!==ze.WECHAT||Ne.os!==Ge.IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),400)},i._updateMatrix=function(){if(this._edTxt){var t=this._delegate.node,e=Bi.getScaleX(),i=Bi.getScaleY(),r=1,n=1;Xe.GAME_VIEW&&(r=Xe.gameView.canvas.width/Xe.game.canvas.width,n=Xe.gameView.canvas.height/Xe.game.canvas.height),e*=r,i*=n;var s=Bi.getViewportRect(),a=Bi.getDevicePixelRatio();t.getWorldMatrix(dj);var o=t._uiProps.uiTransformComp;if(o&&Si.set(_j,-o.anchorX*o.width,-o.anchorY*o.height,_j.z),gi.transform(dj,dj,_j),t._uiProps.uiTransformComp){var l=Ai.root.batcher2D.getFirstRenderCamera(t);if(l){l.node.getWorldRT(fj);var h=fj.m12,u=fj.m13,c=Di.center;fj.m12=c.x-(fj.m00*h+fj.m04*u),fj.m13=c.y-(fj.m01*h+fj.m05*u),gi.multiply(fj,fj,dj),e/=a,i/=a;var p=Xe.GAME_VIEW?Xe.gameView.container:Mi.container,d=fj.m00*e,f=dj.m01,_=dj.m04,g=fj.m05*i,m=parseInt(p&&p.style.paddingLeft||"0");m+=s.x*r/a;var y=parseInt(p&&p.style.paddingBottom||"0");y+=s.y/a;var v="matrix("+d+","+-f+","+-_+","+g+","+(fj.m12*e+m)+","+-(fj.m13*i+y)+")";this._edTxt.style.transform=v,this._edTxt.style["-webkit-transform"]=v,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},i._updateInputType=function(){var t=this._delegate,e=t.inputMode,i=t.inputFlag,r=t.returnType,n=this._edTxt;if(this._inputMode!==e||this._inputFlag!==i||this._returnType!==r){if(this._inputMode=e,this._inputFlag=i,this._returnType=r,this._isTextArea){var s="none";return i===iY.INITIAL_CAPS_ALL_CHARACTERS?s="uppercase":i===iY.INITIAL_CAPS_WORD&&(s="capitalize"),void(n.style.textTransform=s)}if(n=n,i===iY.PASSWORD)return n.type="password",void(n.style.textTransform="none");var a=n.type;e===eY.EMAIL_ADDR?a="email":e===eY.NUMERIC||e===eY.DECIMAL?a="number":e===eY.PHONE_NUMBER?(a="number",n.pattern="[0-9]*"):e===eY.URL?a="url":(a="text",r===tY.SEARCH&&(a="search")),n.type=a;var o="none";i===iY.INITIAL_CAPS_ALL_CHARACTERS?o="uppercase":i===iY.INITIAL_CAPS_WORD&&(o="capitalize"),n.style.textTransform=o}},i._updateMaxLength=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},i._initStyleSheet=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflowY="scroll"):((t=t).type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")}},i._updateStyleSheet=function(){var t=this._delegate,e=this._edTxt;e&&t&&(e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel))},i._updateTextLabel=function(t){if(t){var e=t.font;e=!e||e instanceof _F?t.fontFamily:e._fontFamily;var i=t.fontSize*t.node.scale.y;if((this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign)&&(this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign,this._edTxt)){var r=this._edTxt;switch(r.style.fontSize=i+"px",r.style.color=t.color.toCSS(),r.style.fontFamily=e,t.horizontalAlign){case $k.HorizontalAlign.LEFT:r.style.textAlign="left";break;case $k.HorizontalAlign.CENTER:r.style.textAlign="center";break;case $k.HorizontalAlign.RIGHT:r.style.textAlign="right"}}}},i._updatePlaceholderLabel=function(t){if(t){var e=t.font;e=!e||e instanceof _F?t.fontFamily:t.font._fontFamily;var i=t.fontSize*t.node.scale.y;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var r=this._placeholderStyleSheet,n=t.color.toCSS(),s=t.fontSize,a="";switch(t.horizontalAlign){case $k.HorizontalAlign.LEFT:a="left";break;case $k.HorizontalAlign.CENTER:a="center";break;case $k.HorizontalAlign.RIGHT:a="right"}r.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+s+"px;text-align: "+a+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+s+"px;text-align: "+a+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+s+"px;text-align: "+a+";}",Ne.browserType===ze.EDGE&&(r.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},i._registerEventListeners=function(){var t=this;if(this._edTxt){var e=this._edTxt,i=!1,r=this.__eventListeners;r.compositionStart=function(){i=!0},r.compositionEnd=function(){i=!1,t._delegate._editBoxTextChanged(e.value)},r.onInput=function(){if(!i){var r=t._delegate,n=r.maxLength;n>=0&&(e.value=e.value.slice(0,n)),r._editBoxTextChanged(e.value)}},r.onClick=function(){t._editing&&Ue.isMobile&&t._adjustWindowScroll()},r.onKeydown=function(i){i.keyCode===Fe.KEY.enter?(i.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t._isTextArea||e.blur()):i.keyCode===Fe.KEY.tab&&(i.propagationStopped=!0,i.preventDefault(),nY.next(t))},r.onBlur=function(){Ue.isMobile&&i&&r.compositionEnd(),t._editing=!1,gj=null,t._hideDom(),t._delegate._editBoxEditingDidEnded()},e.addEventListener("compositionstart",r.compositionStart),e.addEventListener("compositionend",r.compositionEnd),e.addEventListener("input",r.onInput),e.addEventListener("keydown",r.onKeydown),e.addEventListener("blur",r.onBlur),e.addEventListener("touchstart",r.onClick)}},i._removeEventListeners=function(){if(this._edTxt){var t=this._edTxt,e=this.__eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}},e}(pj);!function(t){t.EDITING_DID_BEGAN="editing-did-began",t.EDITING_DID_ENDED="editing-did-ended",t.TEXT_CHANGED="text-changed",t.EDITING_RETURN="editing-return"}(cj||(cj={}));var vj,bj,Sj,Tj,Aj,Ej,Cj,Rj,wj,xj,Oj,Pj,Dj,Mj,Bj,Ij,Lj,Fj,kj,Nj,Gj,Uj,zj,Vj,Hj,Wj,Xj,Yj,jj,Kj,qj,Zj,Jj,Qj,$j,tK,eK,iK,rK,nK,sK,aK,oK,lK,hK,uK,cK,pK,dK,fK,_K,gK,mK,yK,vK=function(e){return t({EditBox:e,EditBoxComponent:e}),e}((sY=Ze("cc.EditBox"),aY=ai(),oY=Ci(110),lY=oi(),hY=xi(Ml),uY=Ri(),cY=li(),pY=Ri(),dY=li(),fY=si($k),_Y=Ri(),gY=li(),mY=si($k),yY=Ri(),vY=li(),bY=si(KL),SY=Ri(),TY=li(),AY=si(iY),EY=Ri(),CY=li(),RY=si(eY),wY=Ri(),xY=li(),OY=si(tY),PY=Ri(),DY=li(),MY=Ri(),BY=li(),IY=Ri(),LY=li(),FY=si([Xi]),kY=Ri(),NY=li(),GY=si([Xi]),UY=Ri(),zY=li(),VY=si([Xi]),HY=Ri(),WY=li(),XY=si([Xi]),YY=Ri(),jY=li(),sY(KY=aY(KY=oY(KY=lY(KY=hY(KY=vi((uj=hj=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"editingDidBegan",ZY,ti(e)),$e(e,"textChanged",JY,ti(e)),$e(e,"editingDidEnded",QY,ti(e)),$e(e,"editingReturn",$Y,ti(e)),e._impl=null,e._background=null,$e(e,"_textLabel",tj,ti(e)),$e(e,"_placeholderLabel",ej,ti(e)),$e(e,"_returnType",ij,ti(e)),$e(e,"_string",rj,ti(e)),$e(e,"_tabIndex",nj,ti(e)),$e(e,"_backgroundImage",sj,ti(e)),$e(e,"_inputFlag",aj,ti(e)),$e(e,"_inputMode",oj,ti(e)),$e(e,"_maxLength",lj,ti(e)),e._isLabelVisible=!1,e}Me(e,t);var i=e.prototype;return i.__preload=function(){this._init()},i.onEnable=function(){this._registerEvent(),this._impl&&this._impl.onEnable()},i.update=function(){this._impl&&this._impl.update()},i.onDisable=function(){this._unregisterEvent(),this._impl&&this._impl.onDisable()},i.onDestroy=function(){this._impl&&this._impl.clear()},i.setFocus=function(){this._impl&&this._impl.setFocus(!0)},i.focus=function(){this._impl&&this._impl.setFocus(!0)},i.blur=function(){this._impl&&this._impl.setFocus(!1)},i.isFocused=function(){return!!this._impl&&this._impl.isFocused()},i._editBoxEditingDidBegan=function(){Xi.emitEvents(this.editingDidBegan,this),this.node.emit(cj.EDITING_DID_BEGAN,this)},i._editBoxEditingDidEnded=function(){Xi.emitEvents(this.editingDidEnded,this),this.node.emit(cj.EDITING_DID_ENDED,this)},i._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,Xi.emitEvents(this.textChanged,t,this),this.node.emit(cj.TEXT_CHANGED,this)},i._editBoxEditingReturn=function(){Xi.emitEvents(this.editingReturn,this),this.node.emit(cj.EDITING_RETURN,this)},i._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},i._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},i._onTouchBegan=function(t){t.propagationStopped=!0},i._onTouchCancel=function(t){t.propagationStopped=!0},i._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},i._init=function(){this._createBackgroundSprite(),this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(bi.SIZE_CHANGED,this._resizeChildNodes,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},i._createBackgroundSprite=function(){this._background||(this._background=this.node.getComponent(lz),this._background||(this._background=this.node.addComponent(lz))),this._background.type=lz.Type.SLICED,this._background.spriteFrame=this._backgroundImage},i._updateTextLabel=function(){var t=this._textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||(e=new Yr("TEXT_LABEL")),(t=e.getComponent($k))||(t=e.addComponent($k)),e.parent=this.node,this._textLabel=t}this._textLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=$k.Overflow.CLAMP,this._inputMode===eY.ANY?(t.verticalAlign=Gk.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},i._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||(e=new Yr("PLACEHOLDER_LABEL")),(t=e.getComponent($k))||(t=e.addComponent($k)),e.parent=this.node,this._placeholderLabel=t}this._placeholderLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=$k.Overflow.CLAMP,this._inputMode===eY.ANY?(t.verticalAlign=Gk.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this.placeholder},i._syncSize=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(this._background){var i=this._background.node._uiProps.uiTransformComp;i.anchorPoint=t.anchorPoint,i.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)},i._updateLabels=function(){if(this._isLabelVisible){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},i._updateString=function(t){var e=this._textLabel;if(e){var i=t;i&&(i=this._updateLabelStringStyle(i)),e.string=i,this._updateLabels()}},i._updateLabelStringStyle=function(t,e){void 0===e&&(e=!1);var i,r=this._inputFlag;if(e||r!==iY.PASSWORD)r===iY.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():r===iY.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):r===iY.INITIAL_CAPS_SENTENCE&&(t=(i=t).charAt(0).toUpperCase()+i.slice(1));else{for(var n="",s=t.length,a=0;a<s;++a)n+="●";t=n}return t},i._registerEvent=function(){this.node.on(bi.TOUCH_START,this._onTouchBegan,this),this.node.on(bi.TOUCH_END,this._onTouchEnded,this)},i._unregisterEvent=function(){this.node.off(bi.TOUCH_START,this._onTouchBegan,this),this.node.off(bi.TOUCH_END,this._onTouchEnded,this)},i._updateLabelPosition=function(t){var e=this.node._uiProps.uiTransformComp,i=-e.anchorX*e.width,r=-e.anchorY*e.height,n=this._placeholderLabel,s=this._textLabel;s&&(s.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),s.node.setPosition(i+2,r+t.height,s.node.position.z),this._inputMode===eY.ANY&&(s.verticalAlign=Gk.TOP),s.enableWrapText=this._inputMode===eY.ANY),n&&(n.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),n.lineHeight=t.height,n.node.setPosition(i+2,r+t.height,n.node.position.z),this._inputMode===eY.ANY&&(n.verticalAlign=Gk.TOP),n.enableWrapText=this._inputMode===eY.ANY)},i._resizeChildNodes=function(){var t=this.node._uiProps.uiTransformComp,e=this._textLabel&&this._textLabel.node;e&&(e.setPosition(-t.width/2,t.height/2,e.position.z),e._uiProps.uiTransformComp.setContentSize(t.contentSize));var i=this._placeholderLabel&&this._placeholderLabel.node;i&&(i.setPosition(-t.width/2,t.height/2,i.position.z),i._uiProps.uiTransformComp.setContentSize(t.contentSize));var r=this._background&&this._background.node;r&&r._uiProps.uiTransformComp.setContentSize(t.contentSize)},Be(e,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string=t,this._updateString(t)}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._createBackgroundSprite())}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag=t,this._updateString(this._string)}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),e}(ui),hj._EditBoxImpl=pj,hj.KeyboardReturnType=tY,hj.InputFlag=iY,hj.InputMode=eY,hj.EventType=cj,je((qY=uj).prototype,"string",[uY,cY],Object.getOwnPropertyDescriptor(qY.prototype,"string"),qY.prototype),je(qY.prototype,"placeholder",[pY,dY],Object.getOwnPropertyDescriptor(qY.prototype,"placeholder"),qY.prototype),je(qY.prototype,"textLabel",[fY,_Y,gY],Object.getOwnPropertyDescriptor(qY.prototype,"textLabel"),qY.prototype),je(qY.prototype,"placeholderLabel",[mY,yY,vY],Object.getOwnPropertyDescriptor(qY.prototype,"placeholderLabel"),qY.prototype),je(qY.prototype,"backgroundImage",[bY,SY,TY],Object.getOwnPropertyDescriptor(qY.prototype,"backgroundImage"),qY.prototype),je(qY.prototype,"inputFlag",[AY,EY,CY],Object.getOwnPropertyDescriptor(qY.prototype,"inputFlag"),qY.prototype),je(qY.prototype,"inputMode",[RY,wY,xY],Object.getOwnPropertyDescriptor(qY.prototype,"inputMode"),qY.prototype),je(qY.prototype,"returnType",[OY,PY,DY],Object.getOwnPropertyDescriptor(qY.prototype,"returnType"),qY.prototype),je(qY.prototype,"maxLength",[MY,BY],Object.getOwnPropertyDescriptor(qY.prototype,"maxLength"),qY.prototype),je(qY.prototype,"tabIndex",[IY,LY],Object.getOwnPropertyDescriptor(qY.prototype,"tabIndex"),qY.prototype),ZY=je(qY.prototype,"editingDidBegan",[FY,ei,kY,NY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JY=je(qY.prototype,"textChanged",[GY,ei,UY,zY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),QY=je(qY.prototype,"editingDidEnded",[VY,ei,HY,WY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$Y=je(qY.prototype,"editingReturn",[XY,ei,YY,jY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tj=je(qY.prototype,"_textLabel",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ej=je(qY.prototype,"_placeholderLabel",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ij=je(qY.prototype,"_returnType",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tY.DEFAULT}}),rj=je(qY.prototype,"_string",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),nj=je(qY.prototype,"_tabIndex",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sj=je(qY.prototype,"_backgroundImage",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aj=je(qY.prototype,"_inputFlag",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iY.DEFAULT}}),oj=je(qY.prototype,"_inputMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eY.ANY}}),lj=je(qY.prototype,"_maxLength",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),KY=qY))||KY)||KY)||KY)||KY)||KY)||KY));"object"!=typeof window||"object"!=typeof document||Zn||Jn||Qn||(vK._EditBoxImpl=yj);var bK,SK,TK,AK,EK,CK,RK=bi;!function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"}(bK||(bK={})),Li(bK),function(t){t[t.NONE=0]="NONE",t[t.CONTAINER=1]="CONTAINER",t[t.CHILDREN=2]="CHILDREN"}(SK||(SK={})),Li(SK),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(TK||(TK={})),Li(TK),function(t){t[t.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",t[t.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(AK||(AK={})),Li(AK),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(EK||(EK={})),Li(EK),function(t){t[t.NONE=0]="NONE",t[t.FIXED_ROW=1]="FIXED_ROW",t[t.FIXED_COL=2]="FIXED_COL"}(CK||(CK={})),Li(CK);var wK,xK,OK,PK,DK,MK,BK,IK,LK,FK,kK,NK,GK,UK,zK,VK,HK,WK,XK,YK,jK,KK,qK,ZK=new Si,JK=function(e){return t({Layout:e,LayoutComponent:e}),e}((vj=Ze("cc.Layout"),bj=ai(),Sj=Ci(110),Tj=oi(),Aj=xi(Ml),Ej=Ni(),Cj=li(),Rj=Ni(),wj=li(),xj=si(bK),Oj=li(),Pj=si(SK),Dj=Ni(),Mj=li(),Bj=Ni(),Ij=li(),Lj=si(TK),Fj=li(),kj=li(),Nj=li(),Gj=li(),Uj=li(),zj=li(),Vj=li(),Hj=si(AK),Wj=li(),Xj=si(EK),Yj=li(),jj=si(CK),Kj=Ni(),qj=li(),Zj=Ni(),Jj=li(),Qj=li(),vj($j=bj($j=Sj($j=Tj($j=Aj($j=vi((yK=mK=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_resizeMode",eK,ti(e)),$e(e,"_layoutType",iK,ti(e)),$e(e,"_cellSize",rK,ti(e)),$e(e,"_startAxis",nK,ti(e)),$e(e,"_paddingLeft",sK,ti(e)),$e(e,"_paddingRight",aK,ti(e)),$e(e,"_paddingTop",oK,ti(e)),$e(e,"_paddingBottom",lK,ti(e)),$e(e,"_spacingX",hK,ti(e)),$e(e,"_spacingY",uK,ti(e)),$e(e,"_verticalDirection",cK,ti(e)),$e(e,"_horizontalDirection",pK,ti(e)),$e(e,"_constraint",dK,ti(e)),$e(e,"_constraintNum",fK,ti(e)),$e(e,"_affectedByScale",_K,ti(e)),$e(e,"_isAlign",gK,ti(e)),e._layoutSize=new wi(300,200),e._layoutDirty=!0,e._childrenDirty=!1,e._usefulLayoutObj=[],e._init=!1,e}Me(e,t);var i=e.prototype;return i.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)},i.onEnable=function(){this._addEventListeners();var t=this.node._uiProps.uiTransformComp;t.contentSize.equals(wi.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},i.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},i._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e],r=i._uiProps.uiTransformComp;i.activeInHierarchy&&r&&this._usefulLayoutObj.push(r)}},i._addEventListeners=function(){Ai.on(Ei.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(RK.SIZE_CHANGED,this._resized,this),this.node.on(RK.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(RK.CHILD_ADDED,this._childAdded,this),this.node.on(RK.CHILD_REMOVED,this._childRemoved,this),this.node.on(RK.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},i._removeEventListeners=function(){Ai.off(Ei.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(RK.SIZE_CHANGED,this._resized,this),this.node.off(RK.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(RK.CHILD_ADDED,this._childAdded,this),this.node.off(RK.CHILD_REMOVED,this._childRemoved,this),this.node.off(RK.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},i._addChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.on(RK.SIZE_CHANGED,this._doLayoutDirty,this),i.on(RK.TRANSFORM_CHANGED,this._transformDirty,this),i.on(RK.ANCHOR_CHANGED,this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._childrenChanged,this)}},i._removeChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.off(RK.SIZE_CHANGED,this._doLayoutDirty,this),i.off(RK.TRANSFORM_CHANGED,this._transformDirty,this),i.off(RK.ANCHOR_CHANGED,this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._childrenChanged,this)}},i._childAdded=function(t){t.on(RK.SIZE_CHANGED,this._doLayoutDirty,this),t.on(RK.TRANSFORM_CHANGED,this._transformDirty,this),t.on(RK.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},i._childRemoved=function(t){t.off(RK.SIZE_CHANGED,this._doLayoutDirty,this),t.off(RK.TRANSFORM_CHANGED,this._transformDirty,this),t.off(RK.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},i._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},i._doLayoutHorizontally=function(t,e,i,r){var n=this.node._uiProps.uiTransformComp.anchorPoint,s=this._getFixedBreakingNum(),a=1,o=this._paddingLeft;this._horizontalDirection===EK.RIGHT_TO_LEFT&&(a=-1,o=this._paddingRight);var l=(this._horizontalDirection-n.x)*t+a*o,h=l-a*this._spacingX,u=0,c=0,p=0,d=0,f=!1,_=this._usefulLayoutObj.length,g=this._cellSize.width,m=this._getPaddingH();this._layoutType!==bK.GRID&&this._resizeMode===SK.CHILDREN&&(g=(t-m-(_-1)*this._spacingX)/_);for(var y=this._usefulLayoutObj,v=0;v<y.length;++v){var b=y[v],S=b.node,T=S.scale,A=this._getUsedScaleValue(T.x),E=this._getUsedScaleValue(T.y);this._resizeMode===SK.CHILDREN&&(b.width=g/A,this._layoutType===bK.GRID&&(b.height=this._cellSize.height/E));var C=Math.abs(this._horizontalDirection-b.anchorX),R=b.width*A,w=b.height*E;w>p&&(d=Math.max(p,d),c=p||w,p=w),h+=a*(C*R+this._spacingX);var x=a*(1-C)*R;if(e){if(s>0)(f=v/s>0&&v%s==0)&&(c=p>w?p:c);else if(R>t-m)h>l+a*C*R&&(f=!0);else{var O=(1-this._horizontalDirection-n.x)*t,P=h+x+a*(a>0?this._paddingRight:this._paddingLeft);f=Math.abs(P)>Math.abs(O)}f&&(h=l+a*C*R,w!==p&&(c=p),u+=c+this._spacingY,c=p=w)}var D=i(S,b,u);r&&S.setPosition(h,D),h+=x}return c=Math.max(c,p),Math.max(d,u+c)+this._getPaddingV()},i._doLayoutVertically=function(t,e,i,r){var n=this.node._uiProps.uiTransformComp.anchorPoint,s=this._getFixedBreakingNum(),a=1,o=this._paddingBottom;this._verticalDirection===AK.TOP_TO_BOTTOM&&(a=-1,o=this._paddingTop);var l=(this._verticalDirection-n.y)*t+a*o,h=l-a*this._spacingY,u=0,c=0,p=0,d=0,f=!1,_=this._usefulLayoutObj.length,g=this._cellSize.height,m=this._getPaddingV();this._layoutType!==bK.GRID&&this._resizeMode===SK.CHILDREN&&(g=(t-m-(_-1)*this._spacingY)/_);for(var y=this._usefulLayoutObj,v=0;v<y.length;++v){var b=y[v],S=b.node,T=S.scale,A=this._getUsedScaleValue(T.x),E=this._getUsedScaleValue(T.y);this._resizeMode===SK.CHILDREN&&(b.height=g/E,this._layoutType===bK.GRID&&(b.width=this._cellSize.width/A));var C=Math.abs(this._verticalDirection-b.anchorY),R=b.width*A,w=b.height*E;R>u&&(c=Math.max(u,c),p=u||R,u=R),h+=a*(C*w+this._spacingY);var x=a*(1-C)*w;if(e){if(s>0)(f=v/s>0&&v%s==0)&&(p=u>w?u:p);else if(w>t-m)h>l+a*C*w&&(f=!0);else{var O=(1-this._verticalDirection-n.y)*t,P=h+x+a*(a>0?this._paddingTop:this._paddingBottom);f=Math.abs(P)>Math.abs(O)}f&&(h=l+a*C*w,R!==u&&(p=u),d+=p+this._spacingX,p=u=R)}var D=i(S,b,d);r&&(S.getPosition(ZK),S.setPosition(D,h,ZK.z)),h+=x}return p=Math.max(p,u),Math.max(c,d+p)+this._getPaddingH()},i._doLayoutGridAxisHorizontal=function(t,e){var i=this,r=e.width,n=1,s=-t.y*e.height,a=this._paddingBottom;this._verticalDirection===AK.TOP_TO_BOTTOM&&(n=-1,s=(1-t.y)*e.height,a=this._paddingTop);var o=function(t,e,r){return s+n*(r+(1-e.anchorY)*e.height*i._getUsedScaleValue(t.scale.y)+a)},l=0;this._resizeMode===SK.CONTAINER&&(l=this._doLayoutHorizontally(r,!0,o,!1),s=-t.y*l,this._verticalDirection===AK.TOP_TO_BOTTOM&&(n=-1,s=(1-t.y)*l)),this._doLayoutHorizontally(r,!0,o,!0),this._resizeMode===SK.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(r,l)},i._doLayoutGridAxisVertical=function(t,e){var i=this,r=e.height,n=1,s=-t.x*e.width,a=this._paddingLeft;this._horizontalDirection===EK.RIGHT_TO_LEFT&&(n=-1,s=(1-t.x)*e.width,a=this._paddingRight);var o=function(t,e,r){return s+n*(r+(1-e.anchorX)*e.width*i._getUsedScaleValue(t.scale.x)+a)},l=0;this._resizeMode===SK.CONTAINER&&(l=this._doLayoutVertically(r,!0,o,!1),s=-t.x*l,this._horizontalDirection===EK.RIGHT_TO_LEFT&&(n=-1,s=(1-t.x)*l)),this._doLayoutVertically(r,!0,o,!0),this._resizeMode===SK.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(l,r)},i._doLayoutGrid=function(){var t=this.node._uiProps.uiTransformComp,e=t.anchorPoint,i=t.contentSize;this.startAxis===TK.HORIZONTAL?this._doLayoutGridAxisHorizontal(e,i):this.startAxis===TK.VERTICAL&&this._doLayoutGridAxisVertical(e,i)},i._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,e=0,i=t.length;if(this._resizeMode===SK.CONTAINER){for(var r=0;r<t.length;++r){var n=t[r],s=n.node.scale;e+=n.width*this._getUsedScaleValue(s.x)}e+=(i-1)*this._spacingX+this._getPaddingH()}else e=this.node._uiProps.uiTransformComp.width;return e},i._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,e=0,i=t.length;if(this._resizeMode===SK.CONTAINER){for(var r=0;r<t.length;++r){var n=t[r],s=n.node.scale;e+=n.height*this._getUsedScaleValue(s.y)}e+=(i-1)*this._spacingY+this._getPaddingV()}else e=this.node._uiProps.uiTransformComp.height;return e},i._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===bK.HORIZONTAL){var e=this._getHorizontalBaseWidth();this._doLayoutHorizontally(e,!1,(function(e){return(t._isAlign?Si.ZERO:e.position).y}),!0),this.node._uiProps.uiTransformComp.width=e}else if(this._layoutType===bK.VERTICAL){var i=this._getVerticalBaseHeight();this._doLayoutVertically(i,!1,(function(e){return(t._isAlign?Si.ZERO:e.position).x}),!0),this.node._uiProps.uiTransformComp.height=i}else this._layoutType===bK.GRID&&this._doLayoutGrid()},i._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},i._transformDirty=function(t){t&vr.SCALE&&t&vr.POSITION&&this._affectedByScale&&this._doLayoutDirty()},i._doLayoutDirty=function(){this._layoutDirty=!0},i._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},i._getPaddingH=function(){return this._paddingLeft+this._paddingRight},i._getPaddingV=function(){return this._paddingTop+this._paddingBottom},i._getFixedBreakingNum=function(){if(this._layoutType!==bK.GRID||this._constraint===CK.NONE||this._constraintNum<=0)return 0;var t=this._constraint===CK.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===TK.VERTICAL&&(t=this._constraint===CK.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},Be(e,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){this._layoutType===bK.HORIZONTAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){this._layoutType===bK.VERTICAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){this._layoutType!==bK.NONE&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){this._layoutType!==bK.NONE&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){this._constraint!==CK.NONE&&this._constraintNum!==t&&(t<=0&&We("Limit values to be greater than 0"),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),e}(ui),mK.Type=bK,mK.VerticalDirection=AK,mK.HorizontalDirection=EK,mK.ResizeMode=SK,mK.AxisDirection=TK,mK.Constraint=CK,je((tK=yK).prototype,"alignHorizontal",[Ej,Cj],Object.getOwnPropertyDescriptor(tK.prototype,"alignHorizontal"),tK.prototype),je(tK.prototype,"alignVertical",[Rj,wj],Object.getOwnPropertyDescriptor(tK.prototype,"alignVertical"),tK.prototype),je(tK.prototype,"type",[xj,Oj],Object.getOwnPropertyDescriptor(tK.prototype,"type"),tK.prototype),je(tK.prototype,"resizeMode",[Pj,Dj,Mj],Object.getOwnPropertyDescriptor(tK.prototype,"resizeMode"),tK.prototype),je(tK.prototype,"cellSize",[Bj,Ij],Object.getOwnPropertyDescriptor(tK.prototype,"cellSize"),tK.prototype),je(tK.prototype,"startAxis",[Lj,Fj],Object.getOwnPropertyDescriptor(tK.prototype,"startAxis"),tK.prototype),je(tK.prototype,"paddingLeft",[kj],Object.getOwnPropertyDescriptor(tK.prototype,"paddingLeft"),tK.prototype),je(tK.prototype,"paddingRight",[Nj],Object.getOwnPropertyDescriptor(tK.prototype,"paddingRight"),tK.prototype),je(tK.prototype,"paddingTop",[Gj],Object.getOwnPropertyDescriptor(tK.prototype,"paddingTop"),tK.prototype),je(tK.prototype,"paddingBottom",[Uj],Object.getOwnPropertyDescriptor(tK.prototype,"paddingBottom"),tK.prototype),je(tK.prototype,"spacingX",[zj],Object.getOwnPropertyDescriptor(tK.prototype,"spacingX"),tK.prototype),je(tK.prototype,"spacingY",[Vj],Object.getOwnPropertyDescriptor(tK.prototype,"spacingY"),tK.prototype),je(tK.prototype,"verticalDirection",[Hj,Wj],Object.getOwnPropertyDescriptor(tK.prototype,"verticalDirection"),tK.prototype),je(tK.prototype,"horizontalDirection",[Xj,Yj],Object.getOwnPropertyDescriptor(tK.prototype,"horizontalDirection"),tK.prototype),je(tK.prototype,"constraint",[jj,Kj,qj],Object.getOwnPropertyDescriptor(tK.prototype,"constraint"),tK.prototype),je(tK.prototype,"constraintNum",[Zj,Jj],Object.getOwnPropertyDescriptor(tK.prototype,"constraintNum"),tK.prototype),je(tK.prototype,"affectedByScale",[Qj],Object.getOwnPropertyDescriptor(tK.prototype,"affectedByScale"),tK.prototype),eK=je(tK.prototype,"_resizeMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return SK.NONE}}),iK=je(tK.prototype,"_layoutType",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bK.NONE}}),rK=je(tK.prototype,"_cellSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wi(40,40)}}),nK=je(tK.prototype,"_startAxis",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return TK.HORIZONTAL}}),sK=je(tK.prototype,"_paddingLeft",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aK=je(tK.prototype,"_paddingRight",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oK=je(tK.prototype,"_paddingTop",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lK=je(tK.prototype,"_paddingBottom",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hK=je(tK.prototype,"_spacingX",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uK=je(tK.prototype,"_spacingY",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cK=je(tK.prototype,"_verticalDirection",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return AK.TOP_TO_BOTTOM}}),pK=je(tK.prototype,"_horizontalDirection",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return EK.LEFT_TO_RIGHT}}),dK=je(tK.prototype,"_constraint",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return CK.NONE}}),fK=je(tK.prototype,"_constraintNum",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),_K=je(tK.prototype,"_affectedByScale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gK=je(tK.prototype,"_isAlign",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$j=tK))||$j)||$j)||$j)||$j)||$j)||$j));!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.FILLED=2]="FILLED"}(qK||(qK={})),Oi(qK);var QK,$K,tq,eq,iq,rq,nq,sq,aq,oq,lq,hq,uq,cq,pq,dq,fq,_q,gq,mq,yq,vq,bq,Sq,Tq,Aq=function(e){return t({ProgressBar:e,ProgressBarComponent:e}),e}((wK=Ze("cc.ProgressBar"),xK=ai(),OK=Ci(110),PK=oi(),DK=xi(Ml),MK=si(lz),BK=li(),IK=si(qK),LK=li(),FK=li(),kK=hi(),NK=li(),GK=li(),wK(UK=xK(UK=OK(UK=PK(UK=DK((KK=jK=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_barSprite",VK,ti(e)),$e(e,"_mode",HK,ti(e)),$e(e,"_totalLength",WK,ti(e)),$e(e,"_progress",XK,ti(e)),$e(e,"_reverse",YK,ti(e)),e}Me(e,t);var i=e.prototype;return i._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=this.node._uiProps.uiTransformComp,i=e.contentSize,r=e.anchorPoint,n=t._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===lz.FillType.RADIAL&&(this._mode=qK.FILLED),this._mode===qK.HORIZONTAL?this.totalLength=n.width:this._mode===qK.VERTICAL?this.totalLength=n.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var s=-i.width*r.x;t.setPosition(s,0,0)}}},i._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=t._uiProps.uiTransformComp,i=e.anchorPoint,r=e.contentSize,n=t.getPosition(),s=new _i(0,.5),a=qe(this._progress),o=this._totalLength*a,l=r,h=0,u=0;switch(this._mode){case qK.HORIZONTAL:this._reverse&&(s=new _i(1,.5)),l=new wi(o,r.height),h=this._totalLength,u=r.height;break;case qK.VERTICAL:s=this._reverse?new _i(.5,1):new _i(.5,0),l=new wi(r.width,o),h=r.width,u=this._totalLength}if(this._mode===qK.FILLED)this._barSprite.type!==lz.Type.FILLED?We("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(o*=-1),this._barSprite.fillRange=o);else if(this._barSprite.type!==lz.Type.FILLED){var c=s.x-i.x,p=s.y-i.y,d=new Si(h*c,u*p,0);t.setPosition(n.x+d.x,n.y+d.y,n.z),e.setAnchorPoint(s),e.setContentSize(l)}else We("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},Be(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var e=this._barSprite.node;if(!e)return;var i=e._uiProps.uiTransformComp.contentSize;this._mode===qK.HORIZONTAL?this.totalLength=i.width:this._mode===qK.VERTICAL?this.totalLength=i.height:this._mode===qK.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){this._mode===qK.FILLED&&(t=qe(t)),this._totalLength=t,this._updateBarStatus()}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}(ui),jK.Mode=qK,je((zK=KK).prototype,"barSprite",[MK,BK],Object.getOwnPropertyDescriptor(zK.prototype,"barSprite"),zK.prototype),je(zK.prototype,"mode",[IK,LK],Object.getOwnPropertyDescriptor(zK.prototype,"mode"),zK.prototype),je(zK.prototype,"totalLength",[FK],Object.getOwnPropertyDescriptor(zK.prototype,"totalLength"),zK.prototype),je(zK.prototype,"progress",[kK,Yi,NK],Object.getOwnPropertyDescriptor(zK.prototype,"progress"),zK.prototype),je(zK.prototype,"reverse",[GK],Object.getOwnPropertyDescriptor(zK.prototype,"reverse"),zK.prototype),VK=je(zK.prototype,"_barSprite",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HK=je(zK.prototype,"_mode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qK.HORIZONTAL}}),WK=je(zK.prototype,"_totalLength",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),XK=je(zK.prototype,"_progress",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),YK=je(zK.prototype,"_reverse",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),UK=zK))||UK)||UK)||UK)||UK)||UK)),Eq=new Si,Cq=new Si,Rq=new Si,wq=new _i,xq=new Ii,Oq=new _i;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Tq||(Tq={})),Li(Tq);var Pq,Dq,Mq,Bq,Iq,Lq,Fq,kq,Nq,Gq,Uq,zq,Vq,Hq,Wq,Xq,Yq,jq,Kq,qq,Zq,Jq,Qq,$q,tZ,eZ,iZ,rZ,nZ,sZ,aZ,oZ,lZ,hZ,uZ,cZ,pZ,dZ,fZ,_Z,gZ,mZ,yZ,vZ,bZ,SZ,TZ,AZ,EZ,CZ=function(e){return t({ScrollBar:e,ScrollBarComponent:e}),e}((QK=Ze("cc.ScrollBar"),$K=ai(),tq=Ci(110),eq=oi(),iq=xi(Ml),rq=si(lz),nq=Ri(),sq=li(),aq=si(Tq),oq=Ri(),lq=li(),hq=Ri(),uq=li(),cq=Ri(),pq=li(),QK(dq=$K(dq=tq(dq=eq(dq=iq((Sq=bq=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_scrollView",_q,ti(e)),$e(e,"_handle",gq,ti(e)),$e(e,"_direction",mq,ti(e)),$e(e,"_enableAutoHide",yq,ti(e)),$e(e,"_autoHideTime",vq,ti(e)),e._touching=!1,e._opacity=255,e._autoHideRemainingTime=0,e}Me(e,t);var i=e.prototype;return i.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},i.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity)},i.onScroll=function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e._uiProps.uiTransformComp.contentSize,r=this._scrollView.node._uiProps.uiTransformComp.contentSize,n=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(i,r)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var s=0,a=0,o=0,l=0,h=0,u=Oq;u.set(0,0),this._direction===Tq.HORIZONTAL?(s=i.width,a=r.width,h=n.width,o=t.x,this._convertToScrollViewSpace(u,e),l=-u.x):this._direction===Tq.VERTICAL&&(s=i.height,a=r.height,h=n.height,o=t.y,this._convertToScrollViewSpace(u,e),l=-u.y);var c=this._calculateLength(s,a,h,o),p=Oq;this._calculatePosition(p,s,a,h,l,o,c),this._updateLength(c),this._updateHandlerPosition(p)}}}},i.setScrollView=function(t){this._scrollView=t},i.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},i.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t._uiProps.uiTransformComp.contentSize,i=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this._autoHideTime}},i.onEnable=function(){var t=this.node.getComponent(lz);t&&(this._opacity=t.color.a)},i.start=function(){this._enableAutoHide&&this._setOpacity(0)},i.update=function(t){this._processAutoHide(t)},i._convertToScrollViewSpace=function(t,e){var i=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,r=e._uiProps.uiTransformComp;if(i&&r){Eq.set(-r.anchorX*r.width,-r.anchorY*r.height,0),r.convertToWorldSpaceAR(Eq,Cq);var n=i.convertToNodeSpaceAR(Cq);n.x+=i.anchorX*i.width,n.y+=i.anchorY*i.height,t.set(n.x,n.y)}else t.set(_i.ZERO)},i._setOpacity=function(t){if(this._handle){var e=this.node.getComponent(lz);e&&(xq.set(e.color),xq.a=t,e.color=xq),(e=this._handle.getComponent(lz))&&(xq.set(e.color),xq.a=t,e.color=xq)}},i._updateHandlerPosition=function(t){if(this._handle){var e=Rq;this._fixupHandlerPosition(e),this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}},i._fixupHandlerPosition=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,r=e.anchorPoint,n=this.handle.node._uiProps.uiTransformComp.contentSize,s=this.handle.node.parent;Si.set(Eq,-i.width*r.x,-i.height*r.y,0);var a=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR(Eq,Cq),o=t;o.set(0,0,0),s._uiProps.uiTransformComp.convertToNodeSpaceAR(a,o),this.direction===Tq.HORIZONTAL?o.set(o.x,o.y+(i.height-n.height)/2,o.z):this.direction===Tq.VERTICAL&&o.set(o.x+(i.width-n.width)/2,o.y,o.z),this.handle.node.setPosition(o)},i._conditionalDisableScrollBar=function(t,e){return t.width<=e.width&&this._direction===Tq.HORIZONTAL||t.height<=e.height&&this._direction===Tq.VERTICAL},i._calculateLength=function(t,e,i,r){var n=t;return r&&(n+=20*(r>0?r:-r)),i*(e/n)},i._calculatePosition=function(t,e,i,r,n,s,a){var o=e-i;s&&(o+=Math.abs(s));var l=0;o&&(l=qe(l=n/o));var h=(r-a)*l;this._direction===Tq.VERTICAL?t.set(0,h):t.set(h,0)},i._updateLength=function(t){if(this._handle){var e=this._handle.node._uiProps.uiTransformComp,i=e.contentSize,r=e.anchorPoint;r.x===wq.x&&r.y===wq.y||e.setAnchorPoint(wq),this._direction===Tq.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}},i._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(e)}},Be(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(_i.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(_i.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),e}(ui),bq.Direction=Tq,je((fq=Sq).prototype,"handle",[rq,nq,sq],Object.getOwnPropertyDescriptor(fq.prototype,"handle"),fq.prototype),je(fq.prototype,"direction",[aq,oq,lq],Object.getOwnPropertyDescriptor(fq.prototype,"direction"),fq.prototype),je(fq.prototype,"enableAutoHide",[hq,uq],Object.getOwnPropertyDescriptor(fq.prototype,"enableAutoHide"),fq.prototype),je(fq.prototype,"autoHideTime",[cq,pq],Object.getOwnPropertyDescriptor(fq.prototype,"autoHideTime"),fq.prototype),_q=je(fq.prototype,"_scrollView",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gq=je(fq.prototype,"_handle",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mq=je(fq.prototype,"_direction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Tq.HORIZONTAL}}),yq=je(fq.prototype,"_enableAutoHide",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vq=je(fq.prototype,"_autoHideTime",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dq=fq))||dq)||dq)||dq)||dq)||dq)),RZ=t("ViewGroup",Ze("cc.ViewGroup")(Pq=Ci(110)(Pq=function(t){function e(){return t.apply(this,arguments)||this}return Me(e,t),e}(ui))||Pq)||Pq);Xe.ViewGroup=RZ;var wZ,xZ=1e-4,OZ=new Si,PZ=new Si,DZ=new _i,MZ=new _i,BZ=function(){return(new Date).getMilliseconds()},IZ={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(t){t.SCROLL_TO_TOP="scroll-to-top",t.SCROLL_TO_BOTTOM="scroll-to-bottom",t.SCROLL_TO_LEFT="scroll-to-left",t.SCROLL_TO_RIGHT="scroll-to-right",t.SCROLL_BEGAN="scroll-began",t.SCROLL_ENDED="scroll-ended",t.BOUNCE_TOP="bounce-top",t.BOUNCE_BOTTOM="bounce-bottom",t.BOUNCE_LEFT="bounce-left",t.BOUNCE_RIGHT="bounce-right",t.SCROLLING="scrolling",t.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",t.TOUCH_UP="touch-up"}(wZ||(wZ={}));var LZ,FZ,kZ,NZ,GZ,UZ,zZ,VZ,HZ,WZ,XZ,YZ,jZ,KZ,qZ,ZZ,JZ,QZ,$Z,tJ,eJ,iJ,rJ=function(e){return t({ScrollView:e,ScrollViewComponent:e}),e}((Dq=Ze("cc.ScrollView"),Mq=ai(),Bq=Ci(110),Iq=oi(),Lq=xi(Ml),Fq=hi(),kq=Ri(),Nq=li(),Gq=hi(),Uq=Ri(),zq=li(),Vq=Ri(),Hq=li(),Wq=Ri(),Xq=li(),Yq=si(Yr),jq=Ri(),Kq=li(),qq=Ri(),Zq=li(),Jq=si(CZ),Qq=Ri(),$q=li(),tZ=Ri(),eZ=li(),iZ=si(CZ),rZ=Ri(),nZ=li(),sZ=Ri(),aZ=li(),oZ=si([Xi]),lZ=Ri(),hZ=li(),Dq(uZ=Mq(uZ=Bq(uZ=Iq(uZ=Lq((EZ=AZ=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"bounceDuration",pZ,ti(e)),$e(e,"brake",dZ,ti(e)),$e(e,"elastic",fZ,ti(e)),$e(e,"inertia",_Z,ti(e)),$e(e,"horizontal",gZ,ti(e)),$e(e,"vertical",mZ,ti(e)),$e(e,"cancelInnerEvents",yZ,ti(e)),$e(e,"scrollEvents",vZ,ti(e)),e._autoScrolling=!1,e._scrolling=!1,$e(e,"_content",bZ,ti(e)),$e(e,"_horizontalScrollBar",SZ,ti(e)),$e(e,"_verticalScrollBar",TZ,ti(e)),e._topBoundary=0,e._bottomBoundary=0,e._leftBoundary=0,e._rightBoundary=0,e._touchMoveDisplacements=[],e._touchMoveTimeDeltas=[],e._touchMovePreviousTimestamp=0,e._touchMoved=!1,e._autoScrollAttenuate=!1,e._autoScrollStartPosition=new Si,e._autoScrollTargetDelta=new Si,e._autoScrollTotalTime=0,e._autoScrollAccumulatedTime=0,e._autoScrollCurrentlyOutOfBoundary=!1,e._autoScrollBraking=!1,e._autoScrollBrakingStartPosition=new Si,e._outOfBoundaryAmount=new Si,e._outOfBoundaryAmountDirty=!0,e._stopMouseWheel=!1,e._mouseWheelEventElapsedTime=0,e._isScrollEndedWithThresholdEventFired=!1,e._scrollEventEmitMask=0,e._isBouncing=!1,e._contentPos=new Si,e._deltaPos=new Si,e}Me(e,t);var i=e.prototype;return i.scrollToBottom=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new _i(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0)},i.scrollToTop=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new _i(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new _i(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new _i(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToTopLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new _i(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToTopRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new _i(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToBottomLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new _i(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToBottomRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new _i(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToOffset=function(t,e,i){void 0===i&&(i=!0);var r=this.getMaxScrollOffset(),n=new _i(0,0);0===r.x?n.x=0:n.x=t.x/r.x,0===r.y?n.y=1:n.y=(r.y-t.y)/r.y,this.scrollTo(n,e,i)},i.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new _i(e,t)},i.getMaxScrollOffset=function(){if(!this._content||!this.view)return _i.ZERO;var t=this._content._uiProps.uiTransformComp.contentSize,e=t.width-this.view.width,i=t.height-this.view.height;return new _i(e=e>=0?e:0,i=i>=0?i:0)},i.scrollToPercentHorizontal=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new _i(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(r,e,!1!==i):this._moveContent(r)},i.scrollTo=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new _i(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(r,e,i):this._moveContent(r)},i.scrollToPercentVertical=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new _i(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(r,e,i):this._moveContent(r)},i.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},i.setContentPosition=function(t){this._setContentPosition(t)},i._setContentPosition=function(t){if(this._content){var e=this._getContentPosition();Math.abs(t.x-e.x)<xZ&&Math.abs(t.y-e.y)<xZ||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},i.getContentPosition=function(){return this._getContentPosition()},i._getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):Si.ZERO},i.isScrolling=function(){return this._scrolling},i.isAutoScrolling=function(){return this._autoScrolling},i.getScrollEndedEventTiming=function(){return xZ},i.start=function(){this._calculateBoundary(),this._content&&Ai.once(Ei.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},i.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(Yr.EventType.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(Yr.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(Yr.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(Yr.EventType.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},i.update=function(t){this._autoScrolling&&this._processAutoScrolling(t)},i.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(Yr.EventType.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(Yr.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(Yr.EventType.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(Yr.EventType.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollBar(),this.stopAutoScroll()},i._registerEvent=function(){this.node.on(Yr.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(Yr.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(Yr.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(Yr.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(Yr.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},i._unregisterEvent=function(){this.node.off(Yr.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(Yr.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(Yr.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(Yr.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(Yr.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},i._onMouseWheel=function(t,e){if(!this.horizontal&&this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=new Si,r=t.getScrollY();this.vertical?i.set(0,-.1*r,0):this.horizontal&&i.set(-.1*r,0,0),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(i),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},i._onTouchBegan=function(t,e){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(t,e)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)))},i._onTouchMoved=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){var i=t.touch;if(this._handleMoveLogic(i),this.cancelInnerEvents){var r=i.getUILocation(DZ);if(r.subtract(i.getUIStartLocation(MZ)),r.length()>7&&!this._touchMoved&&t.target!==this.node){var n=new $n(t.getTouches(),t.bubbles);n.type=Yr.EventType.TOUCH_CANCEL,n.touch=t.touch,n.simulate=!0,t.target.dispatchEvent(n),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},i._onTouchEnded=function(t,e){if(this.enabledInHierarchy&&this._content&&t&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent(wZ.TOUCH_UP);var i=t.touch;this._handleReleaseLogic(i),this._stopPropagationIfTargetIsMe(t)}},i._onTouchCancelled=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){if(t&&!t.simulate){var i=t.touch;this._handleReleaseLogic(i)}this._stopPropagationIfTargetIsMe(t)}},i._calculateBoundary=function(){if(this._content&&this.view){var t=this._content.getComponent(JK);t&&t.enabledInHierarchy&&t.updateLayout();var e=this.view,i=e.width*e.anchorX,r=e.height*e.anchorY;this._leftBoundary=-i,this._bottomBoundary=-r,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e.contentSize)}},i._hasNestedViewGroup=function(t,e){if(t&&t.eventPhase===ts.CAPTURING_PHASE){if(e)for(var i,r=ke(e);!(i=r()).done;){var n=i.value;if(this.node===n)return t.target&&t.target.getComponent(RZ),!1;if(n.getComponent(RZ))return!1}return!1}},i._startInertiaScroll=function(t){var e=new Si(t);e.multiplyScalar(.7),this._startAttenuatingAutoScroll(e,t)},i._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},i._startAttenuatingAutoScroll=function(t,e){var i=t.clone();if(i.normalize(),this._content&&this.view){var r=this._content._uiProps.uiTransformComp.contentSize,n=this.view.contentSize,s=r.width-n.width,a=r.height-n.height,o=this._calculateAttenuatedFactor(s),l=this._calculateAttenuatedFactor(a);i.x=i.x*s*(1-this.brake)*o,i.y=i.y*a*l*(1-this.brake),i.z=0}var h=t.length(),u=i.length()/h;if(i.add(t),this.brake>0&&u>7){u=Math.sqrt(u);var c=t.clone();c.multiplyScalar(u),i.set(c),i.add(t)}var p=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&u>3&&(p*=u=3),0===this.brake&&u>1&&(p*=u),this._startAutoScroll(i,p,!0)},i._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},i._startAutoScroll=function(t,e,i){void 0===i&&(i=!1);var r=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=r,this._autoScrollAttenuate=i,Si.copy(this._autoScrollStartPosition,this._getContentPosition()),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition.set(0,0,0),this._getHowMuchOutOfBoundary().equals(Si.ZERO,xZ)||(this._autoScrollCurrentlyOutOfBoundary=!0)},i._calculateTouchMoveVelocity=function(){var t=new Si,e=0;if((e=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),e))<=0||e>=.5)t.set(Si.ZERO);else{var i=new Si;i=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e),t}),i),t.set(i.x*(1-this.brake)/e,i.y*(1-this.brake)/e,i.z)}return t},i._flattenVectorByDirection=function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},i._moveContent=function(t,e){var i=this._flattenVectorByDirection(t);OZ.set(this._getContentPosition()),OZ.add(i),OZ.set(Math.floor(1e4*OZ.x)*xZ,Math.floor(1e4*OZ.y)*xZ,OZ.z),this._setContentPosition(OZ);var r=this._getHowMuchOutOfBoundary();DZ.set(r.x,r.y),this._updateScrollBar(DZ),this.elastic&&e&&this._startBounceBackIfNeeded()},i._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.x-e.anchorX*e.width},i._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+t.width},i._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+t.height},i._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.y-e.anchorY*e.height},i._getHowMuchOutOfBoundary=function(t){if((t=t||new Si).equals(Si.ZERO,xZ)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=new Si;return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.equals(Si.ZERO,xZ)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e),e},i._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onScroll(t),this.verticalScrollBar&&this.verticalScrollBar.onScroll(t)},i._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar.onTouchBegan()},i._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar.onTouchEnded()},i._dispatchEvent=function(t){if(t===wZ.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(t===wZ.SCROLL_TO_TOP||t===wZ.SCROLL_TO_BOTTOM||t===wZ.SCROLL_TO_LEFT||t===wZ.SCROLL_TO_RIGHT){var e=1<<IZ[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}Xi.emitEvents(this.scrollEvents,this,IZ[t]),this.node.emit(t,this)},i._adjustContentOutOfBoundary=function(){if(this._content&&(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary())){var t=this._getHowMuchOutOfBoundary();OZ.set(this._getContentPosition()),OZ.add(t),this._content.setPosition(OZ),this._updateScrollBar(_i.ZERO)}},i._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.hide()},i._updateScrollBarState=function(){if(this._content&&this.view){var t=this.view,e=this._content._uiProps.uiTransformComp;this.verticalScrollBar&&(e.height<t.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(e.width<t.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},i._stopPropagationIfTargetIsMe=function(t){t.eventPhase===ts.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},i._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},i._handleMoveLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._processDeltaMove(this._deltaPos)},i._handleReleaseLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(wZ.SCROLL_ENDED))},i._getLocalAxisAlignDelta=function(t,e){var i=this.node._uiProps.uiTransformComp,r=new Si;i&&(e.getUILocation(DZ),e.getUIPreviousLocation(MZ),OZ.set(DZ.x,DZ.y,0),PZ.set(MZ.x,MZ.y,0),i.convertToNodeSpaceAR(OZ,OZ),i.convertToNodeSpaceAR(PZ,PZ),Si.subtract(r,OZ,PZ)),t.set(r)},i._scrollChildren=function(t){this._clampDelta(t);var e,i,r=t;if(this.elastic&&(e=this._getHowMuchOutOfBoundary(),r.x*=0===e.x?1:.5,r.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(r),r.add(e)),this._content){var n=this._content._uiProps.uiTransformComp,s=n.anchorX,a=n.anchorY,o=n.width,l=n.height,h=this._content.position||Si.ZERO;r.y>0?h.y-a*l+r.y>=this._bottomBoundary&&(i=wZ.SCROLL_TO_BOTTOM):r.y<0&&h.y-a*l+l+r.y<=this._topBoundary&&(i=wZ.SCROLL_TO_TOP),r.x<0?h.x-s*o+o+r.x<=this._rightBoundary&&(i=wZ.SCROLL_TO_RIGHT):r.x>0&&h.x-s*o+r.x>=this._leftBoundary&&(i=wZ.SCROLL_TO_LEFT)}this._moveContent(r,!1),0===r.x&&0===r.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent(wZ.SCROLL_BEGAN)),this._dispatchEvent(wZ.SCROLLING)),i&&i.length>0&&this._dispatchEvent(i)},i._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(wZ.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=BZ(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},i._clampDelta=function(t){if(this._content&&this.view){var e=this.view.contentSize,i=this._content._uiProps.uiTransformComp;i.width<e.width&&(t.x=0),i.height<e.height&&(t.y=0)}},i._gatherTouchMove=function(t){var e=t.clone();for(this._clampDelta(e);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(e);var i=BZ();this._touchMoveTimeDeltas.push((i-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=i},i._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(this._clampDelta(t),t.equals(Si.ZERO,xZ))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(t.y>0&&this._dispatchEvent(wZ.BOUNCE_TOP),t.y<0&&this._dispatchEvent(wZ.BOUNCE_BOTTOM),t.x>0&&this._dispatchEvent(wZ.BOUNCE_RIGHT),t.x<0&&this._dispatchEvent(wZ.BOUNCE_LEFT),this._isBouncing=!0),!0},i._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(OZ,xZ)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},i._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(Si.ZERO,xZ)},i._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this._getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},i._processAutoScrolling=function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/i);var r,n=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(r=n,n=(r-=1)*r*r*r*r+1);var s=this._autoScrollTargetDelta.clone();s.multiplyScalar(n);var a=this._autoScrollStartPosition.clone();a.add(s);var o=Math.abs(n-1)<=xZ;if(Math.abs(n-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(wZ.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var l=a.clone();l.subtract(this._autoScrollBrakingStartPosition),e&&l.multiplyScalar(i),a.set(this._autoScrollBrakingStartPosition),a.add(l)}else{var h=a.clone();h.subtract(this.getContentPosition());var u=this._getHowMuchOutOfBoundary(h);u.equals(Si.ZERO,xZ)||(a.add(u),o=!0)}o&&(this._autoScrolling=!1);var c=a.clone();c.subtract(this._getContentPosition()),this._clampDelta(c),this._moveContent(c,o),this._dispatchEvent(wZ.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(wZ.SCROLL_ENDED))},i._checkMouseWheel=function(t){if(!this._getHowMuchOutOfBoundary().equals(Si.ZERO,xZ))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(wZ.SCROLL_ENDED),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(wZ.SCROLL_ENDED),this._stopMouseWheel=!1)},i._calculateMovePercentDelta=function(t){var e=t.anchor,i=t.applyToHorizontal,r=t.applyToVertical;this._calculateBoundary(),e.clampf(_i.ZERO,_i.ONE);var n=this._getContentBottomBoundary()-this._bottomBoundary;n=-n;var s=this._getContentLeftBoundary()-this._leftBoundary;s=-s;var a=new Si;if(this._content&&this.view){var o=0,l=this._content._uiProps.uiTransformComp.contentSize,h=this.view.contentSize;i&&(o=l.width-h.width,a.x=s-o*e.x),r&&(o=l.height-h.height,a.y=n-o*e.y)}return a},i._moveContentToTopLeft=function(t){var e=this._getContentBottomBoundary()-this._bottomBoundary;e=-e;var i=new Si,r=0,n=this._getContentLeftBoundary()-this._leftBoundary;if(n=-n,this._content){var s=this._content._uiProps.uiTransformComp.contentSize;s.height<t.height&&(r=s.height-t.height,i.y=e-r),s.width<t.width&&(r=s.width-t.width,i.x=n)}this._updateScrollBarState(),this._moveContent(i),this._adjustContentOutOfBoundary()},i._scaleChanged=function(t){t===vr.SCALE&&this._calculateBoundary()},Be(e,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var e=t&&t.parent&&t.parent._uiProps.uiTransformComp;!t||t&&e?(this._content=t,this._calculateBoundary()):ji(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(_i.ZERO)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(_i.ZERO)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t._uiProps.uiTransformComp:null}}]),e}(RZ),AZ.EventType=wZ,pZ=je((cZ=EZ).prototype,"bounceDuration",[ei,Fq,kq,Nq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dZ=je(cZ.prototype,"brake",[ei,Gq,Uq,zq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),fZ=je(cZ.prototype,"elastic",[ei,Vq,Hq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_Z=je(cZ.prototype,"inertia",[ei,Wq,Xq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),je(cZ.prototype,"content",[Yq,jq,Kq],Object.getOwnPropertyDescriptor(cZ.prototype,"content"),cZ.prototype),gZ=je(cZ.prototype,"horizontal",[ei,qq,Zq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),je(cZ.prototype,"horizontalScrollBar",[Jq,Qq,$q],Object.getOwnPropertyDescriptor(cZ.prototype,"horizontalScrollBar"),cZ.prototype),mZ=je(cZ.prototype,"vertical",[ei,tZ,eZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),je(cZ.prototype,"verticalScrollBar",[iZ,rZ,nZ],Object.getOwnPropertyDescriptor(cZ.prototype,"verticalScrollBar"),cZ.prototype),yZ=je(cZ.prototype,"cancelInnerEvents",[ei,sZ,aZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),vZ=je(cZ.prototype,"scrollEvents",[oZ,ei,lZ,hZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bZ=je(cZ.prototype,"_content",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SZ=je(cZ.prototype,"_horizontalScrollBar",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TZ=je(cZ.prototype,"_verticalScrollBar",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uZ=cZ))||uZ)||uZ)||uZ)||uZ)||uZ)),nJ=new Si;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(iJ||(iJ={})),Li(iJ);var sJ,aJ,oJ,lJ,hJ,uJ,cJ,pJ,dJ,fJ,_J,gJ,mJ,yJ,vJ,bJ,SJ,TJ,AJ,EJ,CJ=function(e){return t({Slider:e,SliderComponent:e}),e}((LZ=Ze("cc.Slider"),FZ=ai(),kZ=Ci(110),NZ=oi(),GZ=xi(Ml),UZ=si(lz),zZ=li(),VZ=si(iJ),HZ=li(),WZ=hi(),XZ=li(),YZ=si([Xi]),jZ=li(),LZ(KZ=FZ(KZ=kZ(KZ=NZ(KZ=GZ((eJ=tJ=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"slideEvents",ZZ,ti(e)),$e(e,"_handle",JZ,ti(e)),$e(e,"_direction",QZ,ti(e)),$e(e,"_progress",$Z,ti(e)),e._offset=new Si,e._dragging=!1,e._touchHandle=!1,e._handleLocalPos=new Si,e._touchPos=new Si,e}Me(e,t);var i=e.prototype;return i.__preload=function(){this._updateHandlePosition()},i.onEnable=function(){this._updateHandlePosition(),this.node.on(bi.TOUCH_START,this._onTouchBegan,this),this.node.on(bi.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(bi.TOUCH_END,this._onTouchEnded,this),this.node.on(bi.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.on(bi.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(bi.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(bi.TOUCH_END,this._onTouchEnded,this))},i.onDisable=function(){this.node.off(bi.TOUCH_START,this._onTouchBegan,this),this.node.off(bi.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(bi.TOUCH_END,this._onTouchEnded,this),this.node.off(bi.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.off(bi.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(bi.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(bi.TOUCH_END,this._onTouchEnded,this))},i._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var e=t.touch.getUILocation();Si.set(this._touchPos,e.x,e.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}},i._onTouchBegan=function(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},i._onTouchMoved=function(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},i._onTouchEnded=function(t){this._dragging=!1,this._touchHandle=!1,this._offset=new Si,t&&(t.propagationStopped=!0)},i._onTouchCancelled=function(t){this._dragging=!1,t&&(t.propagationStopped=!0)},i._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},i._emitSlideEvent=function(){Xi.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},i._updateProgress=function(t){if(this._handle&&t){var e=t.getUILocation();Si.set(this._touchPos,e.x,e.y,0);var i=this.node._uiProps.uiTransformComp,r=i.convertToNodeSpaceAR(this._touchPos,nJ);this.direction===iJ.Horizontal?this.progress=qe(.5+(r.x-this._offset.x)/i.width):this.progress=qe(.5+(r.y-this._offset.y)/i.height)}},i._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var t=this.node._uiProps.uiTransformComp;this._direction===iJ.Horizontal?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}},i._changeLayout=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){var i=this._handle.node.position;this._direction===iJ.Horizontal?this._handle.node.setPosition(i.x,0,i.z):this._handle.node.setPosition(0,i.y,i.z),this._updateHandlePosition()}},Be(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),e}(ui),tJ.Direction=iJ,je((qZ=eJ).prototype,"handle",[UZ,zZ],Object.getOwnPropertyDescriptor(qZ.prototype,"handle"),qZ.prototype),je(qZ.prototype,"direction",[VZ,HZ],Object.getOwnPropertyDescriptor(qZ.prototype,"direction"),qZ.prototype),je(qZ.prototype,"progress",[Yi,WZ,XZ],Object.getOwnPropertyDescriptor(qZ.prototype,"progress"),qZ.prototype),ZZ=je(qZ.prototype,"slideEvents",[YZ,ei,jZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JZ=je(qZ.prototype,"_handle",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QZ=je(qZ.prototype,"_direction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iJ.Horizontal}}),$Z=je(qZ.prototype,"_progress",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),KZ=qZ))||KZ)||KZ)||KZ)||KZ)||KZ));function RJ(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Object.assign.apply(Object,[{}].concat(e))}!function(t){t.TOGGLE="toggle"}(EJ||(EJ={}));var wJ,xJ,OJ,PJ,DJ,MJ,BJ,IJ,LJ,FJ,kJ,NJ,GJ,UJ,zJ,VJ,HJ,WJ,XJ,YJ,jJ,KJ,qJ,ZJ,JJ,QJ,$J,tQ,eQ,iQ,rQ,nQ,sQ,aQ,oQ,lQ,hQ,uQ,cQ,pQ,dQ,fQ,_Q,gQ,mQ,yQ,vQ,bQ,SQ,TQ,AQ,EQ,CQ,RQ,wQ,xQ,OQ,PQ,DQ,MQ=function(e){return t({Toggle:e,ToggleComponent:e}),e}((sJ=Ze("cc.Toggle"),aJ=ai(),oJ=Ci(110),lJ=oi(),hJ=xi(Ml),uJ=Ri(),cJ=li(),pJ=si(lz),dJ=Ri(),fJ=li(),_J=si([Xi]),gJ=li(),sJ(mJ=aJ(mJ=oJ(mJ=lJ(mJ=hJ((AJ=TJ=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"checkEvents",vJ,ti(e)),$e(e,"_isChecked",bJ,ti(e)),$e(e,"_checkMark",SJ,ti(e)),e}Me(e,t);var i=e.prototype;return i._internalToggle=function(){this.isChecked=!this.isChecked},i._set=function(t,e){if(void 0===e&&(e=!0),this._isChecked!=t){this._isChecked=t;var i=this._toggleContainer;i&&i.enabled&&this.enabled&&(t||!i.anyTogglesChecked()&&!i.allowSwitchOff)&&(this._isChecked=!0,i.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}},i.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},i.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},i.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},i.OnDestroy=function(){var t=this._toggleContainer;t&&t.ensureValidState()},i._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&Xi.emitEvents(this.checkEvents,this)},Be(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return Xe.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),e}(rY),TJ.EventType=RJ(EJ,QX),je((yJ=AJ).prototype,"isChecked",[uJ,cJ],Object.getOwnPropertyDescriptor(yJ.prototype,"isChecked"),yJ.prototype),je(yJ.prototype,"checkMark",[pJ,dJ,fJ],Object.getOwnPropertyDescriptor(yJ.prototype,"checkMark"),yJ.prototype),vJ=je(yJ.prototype,"checkEvents",[_J,ei,gJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bJ=je(yJ.prototype,"_isChecked",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),SJ=je(yJ.prototype,"_checkMark",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mJ=yJ))||mJ)||mJ)||mJ)||mJ)||mJ)),BQ=function(e){return t({ToggleContainer:e,ToggleContainerComponent:e}),e}((wJ=Ze("cc.ToggleContainer"),xJ=ai(),OJ=Ci(110),PJ=oi(),DJ=li(),MJ=si([Xi]),BJ=li(),wJ(IJ=xJ(IJ=OJ(IJ=PJ(IJ=vi((NJ=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_allowSwitchOff",FJ,ti(e)),$e(e,"checkEvents",kJ,ti(e)),e}Me(e,t);var i=e.prototype;return i.onEnable=function(){this.ensureValidState(),this.node.on(bi.CHILD_ADDED,this.ensureValidState,this),this.node.on(bi.CHILD_REMOVED,this.ensureValidState,this)},i.onDisable=function(){this.node.off(bi.CHILD_ADDED,this.ensureValidState,this),this.node.off(bi.CHILD_REMOVED,this.ensureValidState,this)},i.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},i.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},i.notifyToggleCheck=function(t,e){if(void 0===e&&(e=!0),this.enabledInHierarchy){for(var i=0;i<this.toggleItems.length;i++){var r=this.toggleItems[i];r!==t&&(e?r.isChecked=!1:r.setIsCheckedWithoutNotify(!1))}this.checkEvents&&Xe.Component.EventHandler.emitEvents(this.checkEvents,t)}},i.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}var i=this.activeToggles();if(i.length>1)for(var r=i[0],n=0;n<i.length;++n){var s=i[n];s!==r&&(s.isChecked=!1)}},Be(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var e=t.getComponent("cc.Toggle");return e&&e.enabled?e:null})).filter(Boolean)}}]),e}(ui),FJ=je((LJ=NJ).prototype,"_allowSwitchOff",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(LJ.prototype,"allowSwitchOff",[DJ],Object.getOwnPropertyDescriptor(LJ.prototype,"allowSwitchOff"),LJ.prototype),kJ=je(LJ.prototype,"checkEvents",[MJ,ei,BJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IJ=LJ))||IJ)||IJ)||IJ)||IJ)||IJ)),IQ=new _i;function LQ(t){return t instanceof es?Di:t._uiProps.uiTransformComp?t._uiProps.uiTransformComp.contentSize:wi.ZERO}function FQ(t,e,i,r){t.parent?IQ.set(t.parent.getScale().x,t.parent.getScale().y):IQ.set(0,0);for(var n=IQ.x,s=IQ.y,a=0,o=0,l=t.parent;;){if(!l)return i.x=i.y=0,void(r.x=r.y=1);var h=l.getPosition();if(a+=h.x,o+=h.y,(l=l.parent)===e)break;l?IQ.set(l.getScale().x,l.getScale().y):IQ.set(0,0);var u=IQ.x,c=IQ.y;a*=u,o*=c,n*=u,s*=c}r.x=0!==n?1/n:1,r.y=0!==s?1/s:1,i.x=-a,i.y=-o}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(PQ||(PQ={})),Li(PQ),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(DQ||(DQ={}));var kQ,NQ,GQ,UQ,zQ,VQ,HQ,WQ,XQ,YQ,jQ,KQ,qQ,ZQ,JQ,QQ,$Q,t$,e$,i$=DQ.TOP|DQ.BOT,r$=DQ.LEFT|DQ.RIGHT,n$=function(e){return t({Widget:e,WidgetComponent:e}),e}((GJ=Ze("cc.Widget"),UJ=ai(),zJ=Ci(110),VJ=oi(),HJ=xi(Ml),WJ=si(Yr),XJ=li(),YJ=li(),jJ=li(),KJ=li(),qJ=li(),ZJ=li(),JJ=li(),QJ=Ni(),$J=Ni(),tQ=li(),eQ=li(),iQ=li(),rQ=li(),nQ=li(),sQ=li(),aQ=si(PQ),oQ=li(),GJ(lQ=UJ(lQ=zJ(lQ=VJ(lQ=HJ(lQ=vi((OQ=xQ=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._lastPos=new Si,e._lastSize=new wi,e._dirty=!0,e._hadAlignOnce=!1,$e(e,"_alignFlags",uQ,ti(e)),$e(e,"_target",cQ,ti(e)),$e(e,"_left",pQ,ti(e)),$e(e,"_right",dQ,ti(e)),$e(e,"_top",fQ,ti(e)),$e(e,"_bottom",_Q,ti(e)),$e(e,"_horizontalCenter",gQ,ti(e)),$e(e,"_verticalCenter",mQ,ti(e)),$e(e,"_isAbsLeft",yQ,ti(e)),$e(e,"_isAbsRight",vQ,ti(e)),$e(e,"_isAbsTop",bQ,ti(e)),$e(e,"_isAbsBottom",SQ,ti(e)),$e(e,"_isAbsHorizontalCenter",TQ,ti(e)),$e(e,"_isAbsVerticalCenter",AQ,ti(e)),$e(e,"_originalWidth",EQ,ti(e)),$e(e,"_originalHeight",CQ,ti(e)),$e(e,"_alignMode",RQ,ti(e)),$e(e,"_lockFlags",wQ,ti(e)),e}Me(e,t);var i=e.prototype;return i.updateAlignment=function(){Xe._widgetManager.updateAlignment(this.node)},i._validateTargetInDEV=function(){},i.setDirty=function(){this._recursiveDirty()},i.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),Xe._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},i.onDisable=function(){Xe._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},i.onDestroy=function(){this._removeParentEvent()},i._adjustWidgetToAllowMovingInEditor=function(){},i._adjustWidgetToAllowResizingInEditor=function(){},i._adjustWidgetToAnchorChanged=function(){this.setDirty()},i._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},i._registerEvent=function(){this.node.on(bi.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(bi.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(bi.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(bi.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._unregisterEvent=function(){this.node.off(bi.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(bi.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(bi.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},i._removeParentEvent=function(){this.node.off(bi.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var i=this.node.parent&&this.node.parent._uiProps,r=i&&i.uiTransformComp,n=r?r.contentSize:Di;this.isAlignLeft&&t===DQ.LEFT?this._left=e?this._left*n.width:this._left/n.width:this.isAlignRight&&t===DQ.RIGHT?this._right=e?this._right*n.width:this._right/n.width:this.isAlignHorizontalCenter&&t===DQ.CENTER?this._horizontalCenter=e?this._horizontalCenter*n.width:this._horizontalCenter/n.width:this.isAlignTop&&t===DQ.TOP?this._top=e?this._top*n.height:this._top/n.height:this.isAlignBottom&&t===DQ.BOT?this._bottom=e?this._bottom*n.height:this._bottom/n.height:this.isAbsoluteVerticalCenter&&t===DQ.MID&&(this._verticalCenter=this._verticalCenter/n.height),this._recursiveDirty()}},i._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(Ml)&&(t.on(bi.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.on(bi.SIZE_CHANGED,this._setDirtyByMode,this))},i._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(bi.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.off(bi.SIZE_CHANGED,this._setDirtyByMode,this))},i._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(bi.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.off(bi.SIZE_CHANGED,this._setDirtyByMode,this))},i._setDirtyByMode=function(){this.alignMode===PQ.ALWAYS&&this._recursiveDirty()},i._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var i=(t&r$)>0,r=this.node._uiProps.uiTransformComp;e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=r.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=r.height))):(i?this.isStretchWidth&&(r.width=this._originalWidth):this.isStretchHeight&&(r.height=this._originalHeight),this._alignFlags&=~t)}},i._recursiveDirty=function(){this._dirty||(this._dirty=!0)},Be(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&DQ.TOP)>0},set:function(t){this._setAlign(DQ.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&DQ.BOT)>0},set:function(t){this._setAlign(DQ.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&DQ.LEFT)>0},set:function(t){this._setAlign(DQ.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&DQ.RIGHT)>0},set:function(t){this._setAlign(DQ.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&DQ.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=DQ.MID):this._alignFlags&=~DQ.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&DQ.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=DQ.CENTER):this._alignFlags&=~DQ.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&r$)===r$}},{key:"isStretchHeight",get:function(){return(this._alignFlags&i$)===i$}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(DQ.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(DQ.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(DQ.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(DQ.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(DQ.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(DQ.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}(ui),xQ.AlignMode=PQ,je((hQ=OQ).prototype,"target",[WJ,XJ],Object.getOwnPropertyDescriptor(hQ.prototype,"target"),hQ.prototype),je(hQ.prototype,"isAlignTop",[YJ],Object.getOwnPropertyDescriptor(hQ.prototype,"isAlignTop"),hQ.prototype),je(hQ.prototype,"isAlignBottom",[jJ],Object.getOwnPropertyDescriptor(hQ.prototype,"isAlignBottom"),hQ.prototype),je(hQ.prototype,"isAlignLeft",[KJ],Object.getOwnPropertyDescriptor(hQ.prototype,"isAlignLeft"),hQ.prototype),je(hQ.prototype,"isAlignRight",[qJ],Object.getOwnPropertyDescriptor(hQ.prototype,"isAlignRight"),hQ.prototype),je(hQ.prototype,"isAlignVerticalCenter",[ZJ],Object.getOwnPropertyDescriptor(hQ.prototype,"isAlignVerticalCenter"),hQ.prototype),je(hQ.prototype,"isAlignHorizontalCenter",[JJ],Object.getOwnPropertyDescriptor(hQ.prototype,"isAlignHorizontalCenter"),hQ.prototype),je(hQ.prototype,"isStretchWidth",[QJ],Object.getOwnPropertyDescriptor(hQ.prototype,"isStretchWidth"),hQ.prototype),je(hQ.prototype,"isStretchHeight",[$J],Object.getOwnPropertyDescriptor(hQ.prototype,"isStretchHeight"),hQ.prototype),je(hQ.prototype,"top",[tQ],Object.getOwnPropertyDescriptor(hQ.prototype,"top"),hQ.prototype),je(hQ.prototype,"editorTop",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"editorTop"),hQ.prototype),je(hQ.prototype,"bottom",[eQ],Object.getOwnPropertyDescriptor(hQ.prototype,"bottom"),hQ.prototype),je(hQ.prototype,"editorBottom",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"editorBottom"),hQ.prototype),je(hQ.prototype,"left",[iQ],Object.getOwnPropertyDescriptor(hQ.prototype,"left"),hQ.prototype),je(hQ.prototype,"editorLeft",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"editorLeft"),hQ.prototype),je(hQ.prototype,"right",[rQ],Object.getOwnPropertyDescriptor(hQ.prototype,"right"),hQ.prototype),je(hQ.prototype,"editorRight",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"editorRight"),hQ.prototype),je(hQ.prototype,"horizontalCenter",[nQ],Object.getOwnPropertyDescriptor(hQ.prototype,"horizontalCenter"),hQ.prototype),je(hQ.prototype,"editorHorizontalCenter",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"editorHorizontalCenter"),hQ.prototype),je(hQ.prototype,"verticalCenter",[sQ],Object.getOwnPropertyDescriptor(hQ.prototype,"verticalCenter"),hQ.prototype),je(hQ.prototype,"editorVerticalCenter",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"editorVerticalCenter"),hQ.prototype),je(hQ.prototype,"isAbsoluteTop",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"isAbsoluteTop"),hQ.prototype),je(hQ.prototype,"isAbsoluteBottom",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"isAbsoluteBottom"),hQ.prototype),je(hQ.prototype,"isAbsoluteLeft",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"isAbsoluteLeft"),hQ.prototype),je(hQ.prototype,"isAbsoluteRight",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"isAbsoluteRight"),hQ.prototype),je(hQ.prototype,"isAbsoluteHorizontalCenter",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"isAbsoluteHorizontalCenter"),hQ.prototype),je(hQ.prototype,"isAbsoluteVerticalCenter",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"isAbsoluteVerticalCenter"),hQ.prototype),je(hQ.prototype,"alignMode",[aQ,oQ],Object.getOwnPropertyDescriptor(hQ.prototype,"alignMode"),hQ.prototype),je(hQ.prototype,"alignFlags",[yr],Object.getOwnPropertyDescriptor(hQ.prototype,"alignFlags"),hQ.prototype),uQ=je(hQ.prototype,"_alignFlags",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cQ=je(hQ.prototype,"_target",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pQ=je(hQ.prototype,"_left",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dQ=je(hQ.prototype,"_right",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fQ=je(hQ.prototype,"_top",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_Q=je(hQ.prototype,"_bottom",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gQ=je(hQ.prototype,"_horizontalCenter",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mQ=je(hQ.prototype,"_verticalCenter",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yQ=je(hQ.prototype,"_isAbsLeft",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),vQ=je(hQ.prototype,"_isAbsRight",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bQ=je(hQ.prototype,"_isAbsTop",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),SQ=je(hQ.prototype,"_isAbsBottom",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),TQ=je(hQ.prototype,"_isAbsHorizontalCenter",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),AQ=je(hQ.prototype,"_isAbsVerticalCenter",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),EQ=je(hQ.prototype,"_originalWidth",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CQ=je(hQ.prototype,"_originalHeight",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),RQ=je(hQ.prototype,"_alignMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return PQ.ON_WINDOW_RESIZE}}),wQ=je(hQ.prototype,"_lockFlags",[ei,is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lQ=hQ))||lQ)||lQ)||lQ)||lQ)||lQ)||lQ));Xe.internal.computeInverseTransForTarget=FQ,Xe.internal.getReadonlyNodeSize=LQ;var s$,a$=new Ii;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(s$||(s$={})),Li(s$);var o$,l$,h$,u$,c$,p$,d$,f$,_$,g$,m$,y$,v$,b$,S$,T$,A$,E$,C$,R$,w$,x$,O$,P$,D$,M$,B$,I$,L$,F$,k$,N$,G$,U$,z$,V$,H$,W$,X$,Y$,j$,K$,q$,Z$,J$,Q$=function(e){return t({PageViewIndicator:e,PageViewIndicatorComponent:e}),e}((kQ=Ze("cc.PageViewIndicator"),NQ=ai(),GQ=Ci(110),UQ=oi(),zQ=si(KL),VQ=li(),HQ=si(s$),WQ=li(),XQ=si(wi),YQ=li(),jQ=li(),kQ(KQ=NQ(KQ=GQ(KQ=UQ((e$=t$=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"spacing",ZQ,ti(e)),$e(e,"_spriteFrame",JQ,ti(e)),$e(e,"_direction",QQ,ti(e)),$e(e,"_cellSize",$Q,ti(e)),e._layout=null,e._pageView=null,e._indicators=[],e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._updateLayout()},i.setPageView=function(t){this._pageView=t,this._refresh()},i._updateLayout=function(){this._layout=this.getComponent(JK),this._layout||(this._layout=this.addComponent(JK));var t=this._layout;this.direction===s$.HORIZONTAL?(t.type=JK.Type.HORIZONTAL,t.spacingX=this.spacing):this.direction===s$.VERTICAL&&(t.type=JK.Type.VERTICAL,t.spacingY=this.spacing),t.resizeMode=JK.ResizeMode.CONTAINER},i._createIndicator=function(){var t=new Yr;t.layer=this.node.layer;var e=t.addComponent(lz);return e.spriteFrame=this.spriteFrame,e.sizeMode=lz.SizeMode.CUSTOM,t.parent=this.node,t._uiProps.uiTransformComp.setContentSize(this._cellSize),t},i._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var e=this._pageView.curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var r=t[i];if(r._uiProps.uiComp){var n=r._uiProps.uiComp;a$.set(n.color),a$.a=127.5,n.color=a$}}if(t[e]._uiProps.uiComp){var s=t[e]._uiProps.uiComp;a$.set(s.color),a$.a=255,s.color=a$}}}},i._refresh=function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;i>0;--i){var r=t[i-1];this.node.removeChild(r),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},Be(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),e}(ui),t$.Direction=s$,je((qQ=e$).prototype,"spriteFrame",[zQ,VQ],Object.getOwnPropertyDescriptor(qQ.prototype,"spriteFrame"),qQ.prototype),je(qQ.prototype,"direction",[HQ,WQ],Object.getOwnPropertyDescriptor(qQ.prototype,"direction"),qQ.prototype),je(qQ.prototype,"cellSize",[XQ,YQ],Object.getOwnPropertyDescriptor(qQ.prototype,"cellSize"),qQ.prototype),ZQ=je(qQ.prototype,"spacing",[ei,jQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JQ=je(qQ.prototype,"_spriteFrame",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QQ=je(qQ.prototype,"_direction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s$.HORIZONTAL}}),$Q=je(qQ.prototype,"_cellSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wi(20,20)}}),KQ=qQ))||KQ)||KQ)||KQ)||KQ)),$$=new _i;!function(t){t[t.Unified=0]="Unified",t[t.Free=1]="Free"}(q$||(q$={})),Li(q$),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(Z$||(Z$={})),Li(Z$),function(t){t.PAGE_TURNING="page-turning"}(J$||(J$={}));var t0=function(e){return t({PageView:e,PageViewComponent:e}),e}((o$=Ze("cc.PageView"),l$=ai(),h$=Ci(110),u$=oi(),c$=si(q$),p$=li(),d$=si(Z$),f$=li(),_$=hi(),g$=li(),m$=hi(),y$=li(),v$=si(Q$),b$=li(),S$=li(),T$=si(CZ),A$=Ni(),E$=si(CZ),C$=Ni(),R$=Ni(),w$=Ni(),x$=Ni(),O$=si([Xi]),P$=Ni(),D$=si([Xi]),M$=li(),o$(B$=l$(B$=h$(B$=u$((K$=j$=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"autoPageTurningThreshold",L$,ti(e)),$e(e,"horizontal",F$,ti(e)),$e(e,"vertical",k$,ti(e)),$e(e,"cancelInnerEvents",N$,ti(e)),$e(e,"scrollEvents",G$,ti(e)),$e(e,"pageTurningSpeed",U$,ti(e)),$e(e,"pageEvents",z$,ti(e)),$e(e,"_sizeMode",V$,ti(e)),$e(e,"_direction",H$,ti(e)),$e(e,"_scrollThreshold",W$,ti(e)),$e(e,"_pageTurningEventTiming",X$,ti(e)),$e(e,"_indicator",Y$,ti(e)),e._curPageIdx=0,e._lastPageIdx=0,e._pages=[],e._initContentPos=new Si,e._scrollCenterOffsetX=[],e._scrollCenterOffsetY=[],e._touchBeganPosition=new _i,e._touchEndPosition=new _i,e}Me(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(bi.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(bi.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},i.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},i.getCurrentPageIndex=function(){return this._curPageIdx},i.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},i.getPages=function(){return this._pages},i.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._uiProps.uiTransformComp?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):ji(4301))},i.insertPage=function(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._uiProps.uiTransformComp)return void ji(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}},i.removePage=function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):He(4300,t.name)}},i.removePageAtIndex=function(t){var e=this._pages;if(!(t<0||t>=e.length)){var i=e[t];i&&this.content&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView())}},i.removeAllPages=function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},i.scrollToPage=function(t,e){void 0===e&&(e=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},i.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},i._updatePageView=function(){if(this.content){var t=this.content.getComponent(JK);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var i=this._initContentPos,r=0;r<e;++r){var n=this._pages[r].position;this.direction===Z$.Horizontal?this._scrollCenterOffsetX[r]=Math.abs(i.x+n.x):this._scrollCenterOffsetY[r]=Math.abs(i.y+n.y)}this.indicator&&this.indicator._refresh()}},i._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&this._sizeMode===q$.Unified)for(var e=this._pages,i=t.contentSize,r=0,n=e.length;r<n;r++)e[r]._uiProps.uiTransformComp.setContentSize(i)},i._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},i._onTouchBegan=function(e,i){e.touch.getUILocation($$),_i.set(this._touchBeganPosition,$$.x,$$.y),t.prototype._onTouchBegan.call(this,e,i)},i._onTouchMoved=function(e,i){t.prototype._onTouchMoved.call(this,e,i)},i._onTouchEnded=function(e,i){e.touch.getUILocation($$),_i.set(this._touchEndPosition,$$.x,$$.y),t.prototype._onTouchEnded.call(this,e,i)},i._onTouchCancelled=function(e,i){e.touch.getUILocation($$),_i.set(this._touchEndPosition,$$.x,$$.y),t.prototype._onTouchCancelled.call(this,e,i)},i._onMouseWheel=function(){},i._syncScrollDirection=function(){this.horizontal=this.direction===Z$.Horizontal,this.vertical=this.direction===Z$.Vertical},i._syncSizeMode=function(){var t=this.view;if(this.content&&t){var e=this.content.getComponent(JK);if(e){if(this._sizeMode===q$.Free&&this._pages.length>0){var i=this._pages[0]._uiProps.uiTransformComp,r=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===Z$.Horizontal?(e.paddingLeft=(t.width-i.width)/2,e.paddingRight=(t.width-r.width)/2):this.direction===Z$.Vertical&&(e.paddingTop=(t.height-i.height)/2,e.paddingBottom=(t.height-r.height)/2)}e.updateLayout()}}},i._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];this._pages.indexOf(i)>=0||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},i._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,Xi.emitEvents(this.pageEvents,this,J$.PAGE_TURNING),this.node.emit(J$.PAGE_TURNING,this))},i._isQuicklyScrollable=function(t){if(this.direction===Z$.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===Z$.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},i._moveOffsetValue=function(t){var e=new _i;if(this._sizeMode===q$.Free)this.direction===Z$.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===Z$.Vertical&&(e.y=this._scrollCenterOffsetY[t]);else{var i=this.view;if(!i)return e;this.direction===Z$.Horizontal?e.x=t*i.width:this.direction===Z$.Vertical&&(e.y=t*i.height)}return e},i._getDragDirection=function(t){return this._direction===Z$.Horizontal?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},i._isScrollable=function(t,e,i){if(this._sizeMode===q$.Free){var r=0,n=0;if(this.direction===Z$.Horizontal)return r=this._scrollCenterOffsetX[e],n=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(r-n)*this.scrollThreshold;if(this.direction===Z$.Vertical)return r=this._scrollCenterOffsetY[e],n=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(r-n)*this.scrollThreshold}else{var s=this.view;if(!s)return!1;if(this.direction===Z$.Horizontal)return Math.abs(t.x)>=s.width*this.scrollThreshold;if(this.direction===Z$.Vertical)return Math.abs(t.y)>=s.height*this.scrollThreshold}return!1},i._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=new _i;_i.subtract(e,this._touchBeganPosition,this._touchEndPosition);var i=this._curPageIdx,r=i+this._getDragDirection(e),n=this.pageTurningSpeed*Math.abs(i-r);if(r<this._pages.length){if(this._isScrollable(e,i,r))return void this.scrollToPage(r,n);var s=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(s))return void this.scrollToPage(r,n)}this.scrollToPage(i,n)}},Be(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),e}(rJ),j$.SizeMode=q$,j$.Direction=Z$,j$.EventType=RJ(J$,wZ),je((I$=K$).prototype,"sizeMode",[c$,p$],Object.getOwnPropertyDescriptor(I$.prototype,"sizeMode"),I$.prototype),je(I$.prototype,"direction",[d$,f$],Object.getOwnPropertyDescriptor(I$.prototype,"direction"),I$.prototype),je(I$.prototype,"scrollThreshold",[Yi,_$,g$],Object.getOwnPropertyDescriptor(I$.prototype,"scrollThreshold"),I$.prototype),je(I$.prototype,"pageTurningEventTiming",[Yi,m$,y$],Object.getOwnPropertyDescriptor(I$.prototype,"pageTurningEventTiming"),I$.prototype),je(I$.prototype,"indicator",[v$,b$],Object.getOwnPropertyDescriptor(I$.prototype,"indicator"),I$.prototype),L$=je(I$.prototype,"autoPageTurningThreshold",[ei,S$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),je(I$.prototype,"verticalScrollBar",[T$,Qe,A$],Object.getOwnPropertyDescriptor(I$.prototype,"verticalScrollBar"),I$.prototype),je(I$.prototype,"horizontalScrollBar",[E$,Qe,C$],Object.getOwnPropertyDescriptor(I$.prototype,"horizontalScrollBar"),I$.prototype),F$=je(I$.prototype,"horizontal",[Qe,ei,R$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),k$=je(I$.prototype,"vertical",[Qe,ei,w$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),N$=je(I$.prototype,"cancelInnerEvents",[Qe,ei,x$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),G$=je(I$.prototype,"scrollEvents",[O$,ei,Qe,P$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),U$=je(I$.prototype,"pageTurningSpeed",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),z$=je(I$.prototype,"pageEvents",[D$,ei,M$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),V$=je(I$.prototype,"_sizeMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return q$.Unified}}),H$=je(I$.prototype,"_direction",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Z$.Horizontal}}),W$=je(I$.prototype,"_scrollThreshold",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),X$=je(I$.prototype,"_pageTurningEventTiming",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Y$=je(I$.prototype,"_indicator",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B$=I$))||B$)||B$)||B$)||B$)),e0=new Si,i0=new _i,r0=new _i,n0=new _i(1,1),s0=new _i,a0=new _i;function o0(t,e){if(!e._hadAlignOnce){e.alignMode===PQ.ONCE&&(e._hadAlignOnce=!0);var i,r=e.target,n=r0,s=n0;r?FQ(t,i=r,n,s):i=t.parent;var a=LQ(i),o=i instanceof es||!i.getComponent(Ml),l=o?i0:i.getComponent(Ml).anchorPoint,h=o;t.getPosition(e0);var u=t._uiProps.uiTransformComp,c=e0.x,p=e0.y,d=u.anchorPoint,f=t.getScale();if(e.alignFlags&DQ.HORIZONTAL){var _=0,g=0,m=a.width;h?(_=Di.left.x,g=Di.right.x):g=(_=-l.x*m)+m,_+=e.isAbsoluteLeft?e.left:e.left*m,g-=e.isAbsoluteRight?e.right:e.right*m,r&&(_+=n.x,_*=s.x,g+=n.x,g*=s.x);var y=0,v=d.x,b=f.x;if(b<0&&(v=1-v,b=-b),e.isStretchWidth)y=g-_,0!==b&&(u.width=y/b),c=_+v*y;else if(y=u.width*b,e.isAlignHorizontalCenter){var S=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*m,T=(.5-l.x)*a.width;r&&(S*=s.x,T+=n.x,T*=s.x),c=T+(v-.5)*y+S}else c=e.isAlignLeft?_+v*y:g+(v-1)*y;e._lastSize.width=y}if(e.alignFlags&DQ.VERTICAL){var A=0,E=0,C=a.height;h?(E=Di.bottom.y,A=Di.top.y):A=(E=-l.y*C)+C,E+=e.isAbsoluteBottom?e.bottom:e.bottom*C,A-=e.isAbsoluteTop?e.top:e.top*C,r&&(E+=n.y,E*=s.y,A+=n.y,A*=s.y);var R=0,w=d.y,x=f.y;if(x<0&&(w=1-w,x=-x),e.isStretchHeight)R=A-E,0!==x&&(u.height=R/x),p=E+w*R;else if(R=u.height*x,e.isAlignVerticalCenter){var O=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*C,P=(.5-l.y)*a.height;r&&(O*=s.y,P+=n.y,P*=s.y),p=P+(w-.5)*R+O}else p=e.isAlignBottom?E+w*R:A+(w-1)*R;e._lastSize.height=R}t.setPosition(c,p,e0.z),Si.set(e._lastPos,c,p,e0.z)}}function l0(t){var e=t.getComponent(n$);if(e&&e.enabled){if(!Xe.isValid(t,!0))return;g0.push(e)}for(var i,r=t.children,n=ke(r);!(i=n()).done;){var s=i.value;s.active&&l0(s)}}function h0(){var t=Ai.getScene();if(t){m0.isAligning=!0,m0._nodesOrderDirty&&(g0.length=0,l0(t),m0._nodesOrderDirty=!1);var e=null,i=m0._activeWidgetsIterator;for(i.i=0;i.i<g0.length;++i.i)(e=g0[i.i])._dirty&&(o0(e.node,e),e._dirty=!1);m0.isAligning=!1}}var u0,c0,p0,d0,f0,_0,g0=[],m0=t("widgetManager",Xe._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new rs.MutableForwardIterator(g0),animationState:null,init:function(){Ai.on(Ei.EVENT_AFTER_UPDATE,h0),ns.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);ns.instance.on("canvas-resize",t),Ne.onOrientationChange(t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=Ai.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=Yr.isNode(t)&&t.getComponent(n$);e&&e.enabled&&(e.alignMode===PQ.ON_WINDOW_RESIZE||e.alignMode===PQ.ALWAYS)&&e.setDirty();for(var i,r=t.children,n=ke(r);!(i=n()).done;){var s=i.value;this.refreshWidgetOnResized(s)}},updateOffsetsToStayPut:function(t,e){function i(t,e){return Math.abs(t-e)>1e-10?e:t}var r=t.node,n=r.parent;if(n){var s=s0;s.set(0,0);var a=a0;if(a.set(1,1),t.target&&FQ(r,n=t.target,s,a),!e)return;var o=n._uiProps&&n._uiProps.uiTransformComp,l=o?o.anchorPoint:i0,h=r._uiProps.uiTransformComp,u=LQ(n),c=h.anchorPoint,p=r.getPosition(),d=DQ,f=r.getScale(),_=0;if(e&d.LEFT){var g=-l.x*u.width;g+=s.x,g*=a.x,_=p.x-c.x*h.width*f.x-g,t.isAbsoluteLeft||(_/=u.width),_/=a.x,t.left=i(t.left,_)}if(e&d.RIGHT){var m=(1-l.x)*u.width;m+=s.x,_=(m*=a.x)-(p.x+(1-c.x)*h.width*f.x),t.isAbsoluteRight||(_/=u.width),_/=a.x,t.right=i(t.right,_)}if(e&d.TOP){var y=(1-l.y)*u.height;y+=s.y,_=(y*=a.y)-(p.y+(1-c.y)*h.height*f.y),t.isAbsoluteTop||(_/=u.height),_/=a.y,t.top=i(t.top,_)}if(e&d.BOT){var v=-l.y*u.height;v+=s.y,v*=a.y,_=p.y-c.y*h.height*f.y-v,t.isAbsoluteBottom||(_/=u.height),_/=a.y,t.bottom=i(t.bottom,_)}}},updateAlignment:function t(e){var i=e.parent;i&&Yr.isNode(i)&&t(i);var r=e.getComponent(n$);r&&i&&o0(e,r)},AlignMode:PQ,AlignFlags:DQ});Ai.on(Ei.EVENT_INIT,(function(){m0.init()}));var y0,v0,b0,S0,T0,A0,E0,C0,R0,w0,x0,O0,P0,D0,M0,B0,I0,L0,F0,k0,N0,G0=function(e){return t({SafeArea:e,SafeAreaComponent:e}),e}((u0=Ze("cc.SafeArea"),c0=ai(),p0=Ci(110),d0=oi(),f0=xi(n$),u0(_0=c0(_0=p0(_0=vi(_0=d0(_0=f0(_0=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._boundUpdateArea=this.updateArea.bind(this)},i.onEnable=function(){this.updateArea(),Ne.onViewResize(this._boundUpdateArea),Ne.onOrientationChange(this._boundUpdateArea)},i.onDisable=function(){Ne.offViewResize(this._boundUpdateArea),Ne.offOrientationChange(this._boundUpdateArea)},i.updateArea=function(){var t=this.node.getComponent(n$),e=this.node.getComponent(Ml);if(t&&e){t.updateAlignment();var i=this.node.position.clone(),r=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var n=Xe.winSize.width,s=Xe.winSize.height,a=Ue.getSafeAreaRect();t.top=s-a.y-a.height,t.bottom=a.y,t.left=a.x,t.right=n-a.x-a.width,t.updateAlignment();var o=this.node.position.clone(),l=r.x-(o.x-i.x)/e.width,h=r.y-(o.y-i.y)/e.height;e.setAnchorPoint(l,h),m0.add(t)}},e}(ui))||_0)||_0)||_0)||_0)||_0)||_0)),U0=function(e){return t({UICoordinateTracker:e,UICoordinateTrackerComponent:e}),e}((y0=Ze("cc.UICoordinateTracker"),v0=ai(),b0=oi(),S0=Ci(110),T0=si(Yr),A0=li(),E0=si(Pi),C0=li(),R0=li(),w0=li(),x0=si([Xi]),O0=li(),y0(P0=v0(P0=b0(P0=S0((k0=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"syncEvents",M0,ti(e)),$e(e,"_target",B0,ti(e)),$e(e,"_camera",I0,ti(e)),$e(e,"_useScale",L0,ti(e)),$e(e,"_distance",F0,ti(e)),e._transformPos=new Si,e._viewPos=new Si,e._canMove=!0,e._lastWPos=new Si,e._lastCameraPos=new Si,e}Me(e,t);var i=e.prototype;return i.onEnable=function(){this._checkCanMove()},i.update=function(){var t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&Si.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){var i=this._distance/Math.abs(this._viewPos.z);Xi.emitEvents(this.syncEvents,this._transformPos,i)}},i._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},Be(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),e}(ui),je((D0=k0).prototype,"target",[T0,A0],Object.getOwnPropertyDescriptor(D0.prototype,"target"),D0.prototype),je(D0.prototype,"camera",[E0,C0],Object.getOwnPropertyDescriptor(D0.prototype,"camera"),D0.prototype),je(D0.prototype,"useScale",[R0],Object.getOwnPropertyDescriptor(D0.prototype,"useScale"),D0.prototype),je(D0.prototype,"distance",[w0],Object.getOwnPropertyDescriptor(D0.prototype,"distance"),D0.prototype),M0=je(D0.prototype,"syncEvents",[x0,ei,O0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),B0=je(D0.prototype,"_target",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I0=je(D0.prototype,"_camera",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L0=je(D0.prototype,"_useScale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),F0=je(D0.prototype,"_distance",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),P0=D0))||P0)||P0)||P0)||P0)),z0=[bi.TOUCH_START,bi.TOUCH_END,bi.TOUCH_MOVE,bi.MOUSE_DOWN,bi.MOUSE_MOVE,bi.MOUSE_UP,bi.MOUSE_ENTER,bi.MOUSE_LEAVE,bi.MOUSE_WHEEL];function V0(t){t.propagationStopped=!0}var H0,W0,X0,Y0,j0,K0,q0,Z0,J0,Q0,$0,t1,e1,i1=function(e){return t({BlockInputEvents:e,BlockInputEventsComponent:e}),e}(Ze("cc.BlockInputEvents")(N0=ai()(N0=oi()(N0=function(t){function e(){return t.apply(this,arguments)||this}Me(e,t);var i=e.prototype;return i.onEnable=function(){for(var t=0;t<z0.length;t++)this.node.on(z0[t],V0,this)},i.onDisable=function(){for(var t=0;t<z0.length;t++)this.node.off(z0[t],V0,this)},e}(ui))||N0)||N0)||N0),r1={},n1=t("SubContextView",(H0=Ze("cc.SubContextView"),W0=ai(),X0=Ci(110),Y0=xi(Ml),j0=oi(),K0=li(),q0=li(),H0(Z0=W0(Z0=X0(Z0=Y0(Z0=j0((t1=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_fps",Q0,ti(e)),e._sprite=void 0,e._imageAsset=void 0,e._updatedTime=0,e._updateInterval=0,e._openDataContext=void 0,e._content=void 0,$e(e,"_designResolutionSize",$0,ti(e)),e._content=new Yr("content"),e._content.hideFlags|=Ki.Flags.DontSave|Ki.Flags.HideInHierarchy,e._sprite=null,e._imageAsset=new er,e._openDataContext=null,e._updatedTime=performance.now(),e}Me(e,t);var i=e.prototype;return i.onLoad=function(){r1.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=r1.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1},i.onEnable=function(){this._registerNodeEvent()},i.onDisable=function(){this._unregisterNodeEvent()},i._initSharedCanvas=function(){if(this._openDataContext){var t=this._openDataContext.canvas;t.width=this._designResolutionSize.width,t.height=this._designResolutionSize.height}},i._initContentNode=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),e._texture.create(t.width,t.height),this._sprite=this._content.getComponent(lz),this._sprite||(this._sprite=this._content.addComponent(lz)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._imageAsset._texture;else{var i=new KL;i.texture=this._imageAsset._texture,this._sprite.spriteFrame=i}this._content.parent=this.node}},i._updateSubContextView=function(){if(this._openDataContext&&r1.getSystemInfoSync){var t=this.node.getComponent(Ml),e=this._content.getComponent(Ml),i=t.width/e.width,r=t.height/e.height,n=i>r?r:i;e.width*=n,e.height*=n;var s=r1.getSystemInfoSync(),a=e.getBoundingBoxToWorld(),o=Bi.getVisibleSize(),l=s.screenWidth*(a.x/o.width),h=s.screenHeight*(a.y/o.height),u=s.screenWidth*(a.width/o.width),c=s.screenHeight*(a.height/o.height);this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:l,y:h,width:u,height:c})}},i._updateSubContextTexture=function(){var t=this._imageAsset;if(t&&this._openDataContext&&!(t.width<=0||t.height<=0)){var e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._imageAsset._texture.create(e.width,e.height),this._imageAsset._texture.uploadData(e)}},i._registerNodeEvent=function(){this.node.on(Yr.EventType.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(Yr.EventType.SIZE_CHANGED,this._updateSubContextView,this),this.node.on(bi.LAYER_CHANGED,this._updateContentLayer,this)},i._unregisterNodeEvent=function(){this.node.off(Yr.EventType.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(Yr.EventType.SIZE_CHANGED,this._updateSubContextView,this),this.node.off(bi.LAYER_CHANGED,this._updateContentLayer,this)},i._updateContentLayer=function(){this._content.layer=this.node.layer},i.update=function(t){void 0===t?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},Be(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}}]),e}(ui),je((J0=t1).prototype,"designResolutionSize",[K0],Object.getOwnPropertyDescriptor(J0.prototype,"designResolutionSize"),J0.prototype),je(J0.prototype,"fps",[q0],Object.getOwnPropertyDescriptor(J0.prototype,"fps"),J0.prototype),Q0=je(J0.prototype,"_fps",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),$0=je(J0.prototype,"_designResolutionSize",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wi(640,960)}}),Z0=J0))||Z0)||Z0)||Z0)||Z0)||Z0));Xe.SubContextView=n1;var s1,a1,o1=t("UIReorderComponent",Ze("cc.UIReorderComponent")(e1=function(){He(1408,"UIReorderComponent")})||e1);function l1(t,e){var i=e.length;return e[t<0?i- -t%i:t%i]}function h1(t,e,i){for(var r=[];e<t;)e+=i.length;for(;t<=e;++t)r.push(l1(t,i));return r}function u1(t,e,i){if(c1(t,i)){if(f1(l1(t,i),l1(t-1,i),l1(e,i))&&_1(l1(t,i),l1(t+1,i),l1(e,i)))return!1}else if(_1(l1(t,i),l1(t+1,i),l1(e,i))||f1(l1(t,i),l1(t-1,i),l1(e,i)))return!1;if(c1(e,i)){if(f1(l1(e,i),l1(e-1,i),l1(t,i))&&_1(l1(e,i),l1(e+1,i),l1(t,i)))return!1}else if(_1(l1(e,i),l1(e+1,i),l1(t,i))||f1(l1(e,i),l1(e-1,i),l1(t,i)))return!1;for(var r=0;r<i.length;++r)if((r+1)%i.length!=t&&r!=t&&(r+1)%i.length!=e&&r!=e){var n=new _i;if(b1(l1(t,i),l1(e,i),l1(r,i),l1(r+1,i),n))return!1}return!0}function c1(t,e){return p1(t,e)}function p1(t,e,i){if(void 0===i){var r=t,n=e;t=l1(r-1,n),e=l1(r,n),i=l1(r+1,n)}return S1(t,e,i)<0}function d1(t,e,i){return S1(t,e,i)>0}function f1(t,e,i){return S1(t,e,i)>=0}function _1(t,e,i){return S1(t,e,i)<=0}function g1(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function m1(t){y1(t)||t.reverse()}function y1(t){return t.length<3||function(t){var e,i=0;for(e=0;e<t.length;e++){var r=(e+1)%t.length;i+=t[e].x*t[r].y,i-=t[e].y*t[r].x}return i/2}(t)>0}function v1(t,e,i,r){var n,s=new _i,a=e.y-t.y,o=t.x-e.x,l=a*t.x+o*t.y,h=r.y-i.y,u=i.x-r.x,c=h*i.x+u*i.y,p=a*u-h*o;return n=p,0,Math.abs(n-0)<=1e-6||(s.x=(u*l-o*c)/p,s.y=(a*c-h*l)/p),s}function b1(t,e,i,r,n){if(t==i||t==r||e==i||e==r)return!1;var s=t.x,a=t.y,o=e.x,l=e.y,h=i.x,u=i.y,c=r.x,p=r.y;if(Math.max(s,o)<Math.min(h,c)||Math.max(h,c)<Math.min(s,o))return!1;if(Math.max(a,l)<Math.min(u,p)||Math.max(u,p)<Math.min(a,l))return!1;var d=(c-h)*(a-u)-(p-u)*(s-h),f=(o-s)*(a-u)-(l-a)*(s-h),_=(p-u)*(o-s)-(c-h)*(l-a);return!(Math.abs(_)<1e-6)&&(f/=_,(d/=_)>0&&d<1&&f>0&&f<1&&(n.x=s+d*(o-s),n.y=a+d*(l-a),!0))}function S1(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)}Xe.UIReorderComponent=o1,Xe.ButtonComponent=rY,di.setClassAlias(rY,"cc.ButtonComponent"),Xe.EditBoxComponent=vK,di.setClassAlias(vK,"cc.EditBoxComponent"),Xe.LayoutComponent=JK,di.setClassAlias(JK,"cc.LayoutComponent"),Xe.ProgressBarComponent=Aq,di.setClassAlias(Aq,"cc.ProgressBarComponent"),Xe.ScrollViewComponent=rJ,di.setClassAlias(rJ,"cc.ScrollViewComponent"),Xe.ScrollBarComponent=CZ,di.setClassAlias(CZ,"cc.ScrollBarComponent"),Xe.SliderComponent=CJ,di.setClassAlias(CJ,"cc.SliderComponent"),Xe.ToggleComponent=MQ,di.setClassAlias(MQ,"cc.ToggleComponent"),Xe.ToggleContainerComponent=BQ,di.setClassAlias(BQ,"cc.ToggleContainerComponent"),Xe.WidgetComponent=n$,di.setClassAlias(n$,"cc.WidgetComponent"),Xe.PageViewComponent=t0,di.setClassAlias(t0,"cc.PageViewComponent"),Xe.PageViewIndicatorComponent=Q$,di.setClassAlias(Q$,"cc.PageViewIndicatorComponent"),Xe.SafeAreaComponent=G0,di.setClassAlias(G0,"cc.SafeAreaComponent"),di.setClassAlias(U0,"cc.UICoordinateTrackerComponent"),Xe.BlockInputEventsComponent=i1,di.setClassAlias(i1,"cc.BlockInputEventsComponent");var T1,A1,E1,C1,R1=Object.freeze({__proto__:null,ConvexPartition:function t(e){m1(e);for(var i,r,n,s,a,o,l=[],h=new _i,u=new _i,c=0,p=0,d=0;d<e.length;++d)if(c1(d,e)){r=n=1e8;for(var f=0;f<e.length;++f)d1(l1(d-1,e),l1(d,e),l1(f,e))&&_1(l1(d-1,e),l1(d,e),l1(f-1,e))&&(s=v1(l1(d-1,e),l1(d,e),l1(f,e),l1(f-1,e)),p1(l1(d+1,e),l1(d,e),s)&&(i=g1(l1(d,e),s))<r&&(r=i,h=s,c=f)),d1(l1(d+1,e),l1(d,e),l1(f+1,e))&&_1(l1(d+1,e),l1(d,e),l1(f,e))&&(s=v1(l1(d+1,e),l1(d,e),l1(f,e),l1(f+1,e)),d1(l1(d-1,e),l1(d,e),s)&&(i=g1(l1(d,e),s))<n&&(n=i,p=f,u=s));if(c==(p+1)%e.length){var _=h.add(u).multiplyScalar(.5);(a=h1(d,p,e)).push(_),(o=h1(c,d,e)).push(_)}else{for(var g=0,m=c;p<c;)p+=e.length;for(var y=c;y<=p;++y)if(u1(d,y,e)){var v=1/(g1(l1(d,e),l1(y,e))+1);c1(y,e)?_1(l1(y-1,e),l1(y,e),l1(d,e))&&f1(l1(y+1,e),l1(y,e),l1(d,e))?v+=3:v+=2:v+=1,v>g&&(m=y,g=v)}a=h1(d,m,e),o=h1(m,d,e)}return(l=l.concat(t(a))).concat(t(o))}l.push(e);for(var b=l.length-1;b>=0;b--)0==l[b].length&&l.splice(b,0);return l},ForceCounterClockWise:m1,IsCounterClockWise:y1});!function(t){t[t.Static=0]="Static",t[t.Kinematic=1]="Kinematic",t[t.Dynamic=2]="Dynamic",t[t.Animated=3]="Animated"}(T1||(T1=t("ERigidBody2DType",{}))),Oi(T1),function(t){t[t.None=0]="None",t[t.BOX=1]="BOX",t[t.CIRCLE=2]="CIRCLE",t[t.POLYGON=3]="POLYGON"}(A1||(A1=t("ECollider2DType",{}))),Oi(A1),function(t){t[t.None=0]="None",t[t.DISTANCE=1]="DISTANCE",t[t.SPRING=2]="SPRING",t[t.WHEEL=3]="WHEEL",t[t.MOUSE=4]="MOUSE",t[t.FIXED=5]="FIXED",t[t.SLIDER=6]="SLIDER",t[t.RELATIVE=7]="RELATIVE",t[t.HINGE=8]="HINGE"}(E1||(E1=t("EJoint2DType",{}))),Oi(E1),function(t){t[t.Closest=0]="Closest",t[t.Any=1]="Any",t[t.AllClosest=2]="AllClosest",t[t.All=3]="All"}(C1||(C1=t("ERaycast2DType",{})));var w1,x1=t("Contact2DType",{None:"none-contact",BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"});!function(t){t[t.None=0]="None",t[t.Shape=1]="Shape",t[t.Joint=2]="Joint",t[t.Aabb=4]="Aabb",t[t.Pair=8]="Pair",t[t.CenterOfMass=16]="CenterOfMass",t[t.Particle=32]="Particle",t[t.Controller=64]="Controller",t[t.All=63]="All"}(w1||(w1=t("EPhysics2DDrawFlags",{})));var O1=t("PHYSICS_2D_PTM_RATIO",32),P1=function(){return 0},D1={impl:null,rigidBody:null,isAwake:!1,isSleeping:!1,initialize:P1,setType:P1,setLinearDamping:P1,setAngularDamping:P1,setGravityScale:P1,setFixedRotation:P1,setAllowSleep:P1,isActive:P1,setActive:P1,wakeUp:P1,sleep:P1,getMass:P1,getInertia:P1,getLinearVelocity:P1,setLinearVelocity:P1,getLinearVelocityFromWorldPoint:P1,getAngularVelocity:P1,setAngularVelocity:P1,getLocalVector:P1,getWorldVector:P1,getLocalPoint:P1,getWorldPoint:P1,getLocalCenter:P1,getWorldCenter:P1,applyForce:P1,applyForceToCenter:P1,applyTorque:P1,applyLinearImpulse:P1,applyLinearImpulseToCenter:P1,applyAngularImpulse:P1,onEnable:P1,onDisable:P1,onDestroy:P1},M1={INITED:!1};var B1={INITED:!1},I1={impl:null,initialize:P1,setDampingRatio:P1,setFrequency:P1,setMaxForce:P1,setTarget:P1,setDistance:P1,setAngularOffset:P1,setCorrectionFactor:P1,setLinearOffset:P1,setMaxLength:P1,setMaxTorque:P1,setLowerLimit:P1,setUpperLimit:P1,setMaxMotorForce:P1,setMaxMotorTorque:P1,setMotorSpeed:P1,enableLimit:P1,enableMotor:P1,setLowerAngle:P1,setUpperAngle:P1};var L1,F1,k1,N1,G1,U1,z1,V1,H1,W1,X1,Y1,j1,K1,q1,Z1,J1,Q1,$1,t2,e2=null,i2=t("PhysicsSystem2D",function(t){function e(){var e;(e=t.call(this)||this).velocityIterations=10,e.positionIterations=10,e.physicsWorld=void 0,e.collisionMatrix=new WO,e._enable=!0,e._allowSleep=!0,e._maxSubSteps=1,e._fixedTimeStep=1/60,e._autoSimulation=!0,e._accumulator=0,e._steping=!1,e._gravity=new _i(0,-10*O1),e._delayEvents=[];var i=Mi.config?Mi.config.physics:null;if(i&&(_i.copy(e._gravity,i.gravity),e._gravity.multiplyScalar(O1),e._allowSleep=i.allowSleep,e._fixedTimeStep=i.fixedTimeStep,e._maxSubSteps=i.maxSubSteps,e._autoSimulation=i.autoSimulation,i.collisionMatrix))for(var r in i.collisionMatrix){var n=parseInt(r),s=1<<parseInt(r);e.collisionMatrix[""+s]=i.collisionMatrix[n]}return e.physicsWorld=new s1.PhysicsWorld,e.gravity=e._gravity,e.allowSleep=e._allowSleep,e}Me(e,t);var i=e.prototype;return i.postUpdate=function(t){if(this._enable&&this._autoSimulation){Ai.emit(Ei.EVENT_BEFORE_PHYSICS),this._steping=!0;var e=this._fixedTimeStep,i=this.velocityIterations,r=this.positionIterations;this._accumulator+=t;for(var n=0;n++<this._maxSubSteps&&this._accumulator>e;)this.physicsWorld.step(e,i,r),this._accumulator-=e;for(var s=this._delayEvents,a=0,o=s.length;a<o;a++){var l=s[a];l.func.call(l.target)}s.length=0,this.physicsWorld.syncPhysicsToScene(),this.debugDrawFlags&&this.physicsWorld.drawDebug(),this._steping=!1,Ai.emit(Ei.EVENT_AFTER_PHYSICS)}},i._callAfterStep=function(t,e){this._steping?this._delayEvents.push({target:t,func:e}):e.call(t)},i.resetAccumulator=function(t){void 0===t&&(t=0),this._accumulator=t},i.step=function(t){this.physicsWorld.step(t,this.velocityIterations,this.positionIterations)},i.raycast=function(t,e,i,r){return void 0===i&&(i=C1.Closest),void 0===r&&(r=4294967295),this.physicsWorld.raycast(t,e,i,r)},i.testPoint=function(t){return this.physicsWorld.testPoint(t)},i.testAABB=function(t){return this.physicsWorld.testAABB(t)},Be(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this.physicsWorld.setAllowSleep(t)}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity.set(t),this.physicsWorld.setGravity(new _i(t.x/O1,t.y/O1))}},{key:"maxSubSteps",get:function(){return this._maxSubSteps},set:function(t){this._maxSubSteps=t}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}},{key:"autoSimulation",get:function(){return this._autoSimulation},set:function(t){this._autoSimulation=t}},{key:"debugDrawFlags",get:function(){return this.physicsWorld.debugDrawFlags},set:function(t){this.physicsWorld.debugDrawFlags=t}},{key:"stepping",get:function(){return this._steping}}],[{key:"PHYSICS_NONE",get:function(){return!a1}},{key:"PHYSICS_BUILTIN",get:function(){return"builtin"===a1}},{key:"PHYSICS_BOX2D",get:function(){return"box2d"===a1}},{key:"instance",get:function(){return e2||(e2=new e),e2}}]),e}(mn(qi)));i2.ID="PHYSICS_2D",Ai.once(Ei.EVENT_INIT,(function(){i2.PHYSICS_NONE||tn||Ai.registerSystem(i2.ID,i2.instance,0)})),function(t){t[t.Circles=0]="Circles",t[t.FaceA=1]="FaceA",t[t.FaceB=2]="FaceB"}(L1||(L1=t("Physics2DManifoldType",{})));var r2,n2,s2,a2,o2,l2,h2,u2,c2,p2,d2,f2,_2,g2,m2,y2,v2,b2,S2,T2,A2,E2,C2,R2,w2,x2,O2,P2,D2,M2,B2,I2,L2,F2,k2,N2,G2,U2,z2,V2,H2,W2,X2,Y2,j2,K2,q2,Z2,J2,Q2,$2,t3,e3,i3,r3,n3,s3,a3,o3,l3,h3,u3,c3,p3,d3,f3,_3,g3,m3,y3,v3,b3,S3,T3,A3,E3,C3,R3,w3,x3,O3,P3,D3,M3,B3,I3,L3,F3,k3,N3,G3,U3,z3,V3,H3,W3,X3,Y3,j3,K3,q3=ss,Z3=si,J3=oi,Q3=t("RigidBody2D",(F1=Ze("cc.RigidBody2D"),k1=J3(),N1=Z3(mO),G1=Z3(T1),F1(U1=k1((t2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"enabledContactListener",V1,ti(e)),$e(e,"bullet",H1,ti(e)),$e(e,"awakeOnLoad",W1,ti(e)),e._body=null,$e(e,"_group",X1,ti(e)),$e(e,"_type",Y1,ti(e)),$e(e,"_allowSleep",j1,ti(e)),$e(e,"_gravityScale",K1,ti(e)),$e(e,"_linearDamping",q1,ti(e)),$e(e,"_angularDamping",Z1,ti(e)),$e(e,"_linearVelocity",J1,ti(e)),$e(e,"_angularVelocity",Q1,ti(e)),$e(e,"_fixedRotation",$1,ti(e)),e}Me(e,t);var i=e.prototype;return i.isAwake=function(){return!!this._body&&this._body.isAwake},i.wakeUp=function(){this._body&&this._body.wakeUp()},i.sleep=function(){this._body&&this._body.sleep()},i.getMass=function(){return this._body?this._body.getMass():0},i.applyForce=function(t,e,i){this._body&&this._body.applyForce(t,e,i)},i.applyForceToCenter=function(t,e){this._body&&this._body.applyForceToCenter(t,e)},i.applyTorque=function(t,e){this._body&&this._body.applyTorque(t,e)},i.applyLinearImpulse=function(t,e,i){this._body&&this._body.applyLinearImpulse(t,e,i)},i.applyLinearImpulseToCenter=function(t,e){this._body&&this._body.applyLinearImpulseToCenter(t,e)},i.applyAngularImpulse=function(t,e){this._body&&this._body.applyAngularImpulse(t,e)},i.getLinearVelocityFromWorldPoint=function(t,e){return this._body?this._body.getLinearVelocityFromWorldPoint(t,e):e},i.getLocalVector=function(t,e){return this._body?this._body.getLocalVector(t,e):e},i.getWorldVector=function(t,e){return this._body?this._body.getWorldVector(t,e):e},i.getLocalPoint=function(t,e){return this._body?this._body.getLocalPoint(t,e):e},i.getWorldPoint=function(t,e){return this._body?this._body.getWorldPoint(t,e):e},i.getLocalCenter=function(t){return this._body?this._body.getLocalCenter(t):t},i.getWorldCenter=function(t){return this._body?this._body.getWorldCenter(t):t},i.getInertia=function(){return this._body&&this._body.getInertia(),0},i.onLoad=function(){this._body=Xe._global.CC_PHYSICS_2D_BUILTIN?D1:new s1.RigidBody,this._body.initialize(this)},i.onEnable=function(){this._body&&this._body.onEnable()},i.onDisable=function(){this._body&&this._body.onDisable()},i.onDestroy=function(){this._body&&this._body.onDestroy()},Be(e,[{key:"group",get:function(){return this._group},set:function(t){this._group=t}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._body&&(t===T1.Animated?this._body.setType(T1.Kinematic):this._body.setType(t))}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this._body&&this._body.setAllowSleep(t)}},{key:"gravityScale",get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._body&&this._body.setGravityScale(t)}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&this._body.setLinearDamping(t)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&this._body.setAngularDamping(t)}},{key:"linearVelocity",get:function(){return this._body&&this._body.getLinearVelocity(this._linearVelocity),this._linearVelocity},set:function(t){this._linearVelocity=t,this._body&&this._body.setLinearVelocity(t)}},{key:"angularVelocity",get:function(){return this._body&&(this._angularVelocity=this._body.getAngularVelocity()),this._angularVelocity},set:function(t){this._angularVelocity=t,this._body&&this._body.setAngularVelocity(t)}},{key:"fixedRotation",get:function(){return this._fixedRotation},set:function(t){this._fixedRotation=t,this._body&&this._body.setFixedRotation(t)}},{key:"impl",get:function(){return this._body}}]),e}(ui),je((z1=t2).prototype,"group",[N1],Object.getOwnPropertyDescriptor(z1.prototype,"group"),z1.prototype),V1=je(z1.prototype,"enabledContactListener",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),H1=je(z1.prototype,"bullet",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(z1.prototype,"type",[G1],Object.getOwnPropertyDescriptor(z1.prototype,"type"),z1.prototype),je(z1.prototype,"allowSleep",[q3],Object.getOwnPropertyDescriptor(z1.prototype,"allowSleep"),z1.prototype),je(z1.prototype,"gravityScale",[q3],Object.getOwnPropertyDescriptor(z1.prototype,"gravityScale"),z1.prototype),je(z1.prototype,"linearDamping",[q3],Object.getOwnPropertyDescriptor(z1.prototype,"linearDamping"),z1.prototype),je(z1.prototype,"angularDamping",[q3],Object.getOwnPropertyDescriptor(z1.prototype,"angularDamping"),z1.prototype),je(z1.prototype,"linearVelocity",[q3],Object.getOwnPropertyDescriptor(z1.prototype,"linearVelocity"),z1.prototype),je(z1.prototype,"angularVelocity",[q3],Object.getOwnPropertyDescriptor(z1.prototype,"angularVelocity"),z1.prototype),je(z1.prototype,"fixedRotation",[q3],Object.getOwnPropertyDescriptor(z1.prototype,"fixedRotation"),z1.prototype),W1=je(z1.prototype,"awakeOnLoad",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),X1=je(z1.prototype,"_group",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mO.DEFAULT}}),Y1=je(z1.prototype,"_type",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T1.Dynamic}}),j1=je(z1.prototype,"_allowSleep",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),K1=je(z1.prototype,"_gravityScale",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),q1=je(z1.prototype,"_linearDamping",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Z1=je(z1.prototype,"_angularDamping",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),J1=je(z1.prototype,"_linearVelocity",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),Q1=je(z1.prototype,"_angularVelocity",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$1=je(z1.prototype,"_fixedRotation",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),U1=z1))||U1)||U1)),$3=t("Collider2D",(r2=Ze("cc.Collider2D"),n2=si(mO),r2((_2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"editing",o2,ti(e)),$e(e,"tag",l2,ti(e)),e.TYPE=A1.None,e._shape=null,e._body=null,$e(e,"_group",h2,ti(e)),$e(e,"_density",u2,ti(e)),$e(e,"_sensor",c2,ti(e)),$e(e,"_friction",p2,ti(e)),$e(e,"_restitution",d2,ti(e)),$e(e,"_offset",f2,ti(e)),e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._shape=function(t){return M1.INITED||(M1.INITED=!0,M1[A1.BOX]=function(){return new s1.BoxShape},M1[A1.CIRCLE]=function(){return new s1.CircleShape},M1[A1.POLYGON]=function(){return new s1.PolygonShape}),M1[t]()}(this.TYPE),this._shape.initialize(this),this._shape.onLoad&&this._shape.onLoad(),this._body=this.getComponent(Q3)},i.onEnable=function(){this._shape&&this._shape.onEnable()},i.onDisable=function(){this._shape&&this._shape.onDisable&&this._shape.onDisable()},i.onDestroy=function(){this._shape&&this._shape.onDestroy&&this._shape.onDestroy()},i.apply=function(){this._shape&&this._shape.apply&&this._shape.apply()},Be(e,[{key:"group",get:function(){return this._group},set:function(t){this._group=t,this._shape&&this._shape.onGroupChanged&&this._shape.onGroupChanged()}},{key:"density",get:function(){return this._density},set:function(t){this._density=t}},{key:"sensor",get:function(){return this._sensor},set:function(t){this._sensor=t}},{key:"friction",get:function(){return this._friction},set:function(t){this._friction=t}},{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t}},{key:"body",get:function(){return this._body}},{key:"impl",get:function(){return this._shape}},{key:"worldAABB",get:function(){return this._shape?this._shape.worldAABB:new mi}}]),e}(mn(ui)),o2=je((a2=_2).prototype,"editing",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l2=je(a2.prototype,"tag",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(a2.prototype,"group",[n2],Object.getOwnPropertyDescriptor(a2.prototype,"group"),a2.prototype),je(a2.prototype,"density",[ss],Object.getOwnPropertyDescriptor(a2.prototype,"density"),a2.prototype),je(a2.prototype,"sensor",[ss],Object.getOwnPropertyDescriptor(a2.prototype,"sensor"),a2.prototype),je(a2.prototype,"friction",[ss],Object.getOwnPropertyDescriptor(a2.prototype,"friction"),a2.prototype),je(a2.prototype,"restitution",[ss],Object.getOwnPropertyDescriptor(a2.prototype,"restitution"),a2.prototype),je(a2.prototype,"offset",[ss],Object.getOwnPropertyDescriptor(a2.prototype,"offset"),a2.prototype),h2=je(a2.prototype,"_group",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mO.DEFAULT}}),u2=je(a2.prototype,"_density",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),c2=je(a2.prototype,"_sensor",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p2=je(a2.prototype,"_friction",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),d2=je(a2.prototype,"_restitution",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f2=je(a2.prototype,"_offset",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),s2=a2))||s2)),t5=(t("BoxCollider2D",Ze("cc.BoxCollider2D")(g2=oi()((v2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_size",y2,ti(e)),e.TYPE=A1.BOX,e}return Me(e,t),Be(e,[{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"worldPoints",get:function(){return this._shape?this._shape.worldPoints:[]}}]),e}($3),y2=je((m2=v2).prototype,"_size",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wi(1,1)}}),je(m2.prototype,"size",[ss],Object.getOwnPropertyDescriptor(m2.prototype,"size"),m2.prototype),g2=m2))||g2)||g2),t("CircleCollider2D",Ze("cc.CircleCollider2D")(b2=oi()((A2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_radius",T2,ti(e)),e.TYPE=A1.CIRCLE,e}return Me(e,t),Be(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}},{key:"worldPosition",get:function(){return this._shape?this._shape.worldPosition:new _i}},{key:"worldRadius",get:function(){return this._shape?this._shape.worldRadius:0}}]),e}($3),T2=je((S2=A2).prototype,"_radius",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),je(S2.prototype,"radius",[ss],Object.getOwnPropertyDescriptor(S2.prototype,"radius"),S2.prototype),b2=S2))||b2)||b2),t("PolygonCollider2D",(E2=Ze("cc.PolygonCollider2D"),C2=oi(),R2=ss({serializable:!1}),w2=ss({type:_i}),E2(x2=C2((M2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"threshold",P2,ti(e)),$e(e,"_points",D2,ti(e)),e.TYPE=A1.POLYGON,e}return Me(e,t),Be(e,[{key:"points",get:function(){return this._points},set:function(t){this._points=t}},{key:"worldPoints",get:function(){return this._shape?this._shape.worldPoints:[]}}]),e}($3),P2=je((O2=M2).prototype,"threshold",[R2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),D2=je(O2.prototype,"_points",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new _i(-1,-1),new _i(1,-1),new _i(1,1),new _i(-1,1)]}}),je(O2.prototype,"points",[w2],Object.getOwnPropertyDescriptor(O2.prototype,"points"),O2.prototype),x2=O2))||x2)||x2)),t("Joint2D",(B2=Ze("cc.Joint2D"),I2=si(Q3),B2((z2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"anchor",k2,ti(e)),$e(e,"connectedAnchor",N2,ti(e)),$e(e,"collideConnected",G2,ti(e)),$e(e,"connectedBody",U2,ti(e)),e._body=null,e._joint=null,e.TYPE=E1.None,e}Me(e,t);var i=e.prototype;return i.onLoad=function(){this._joint=function(t){return function(){if(!B1.INITED){B1.INITED=!0;var t=Xe._global.CC_PHYSICS_2D_BUILTIN;B1[E1.SPRING]=function(){return t?I1:new s1.SpringJoint},B1[E1.DISTANCE]=function(){return t?I1:new s1.DistanceJoint},B1[E1.FIXED]=function(){return t?I1:new s1.FixedJoint},B1[E1.MOUSE]=function(){return t?I1:new s1.MouseJoint},B1[E1.RELATIVE]=function(){return t?I1:new s1.RelativeJoint},B1[E1.SLIDER]=function(){return t?I1:new s1.SliderJoint},B1[E1.WHEEL]=function(){return t?I1:new s1.WheelJoint},B1[E1.HINGE]=function(){return t?I1:new s1.HingeJoint}}}(),B1[t]()}(this.TYPE),this._joint.initialize(this),this._body=this.getComponent(Q3)},i.onEnable=function(){this._joint&&this._joint.onEnable&&this._joint.onEnable()},i.onDisable=function(){this._joint&&this._joint.onDisable&&this._joint.onDisable()},i.start=function(){this._joint&&this._joint.start&&this._joint.start()},i.onDestroy=function(){this._joint&&this._joint.onDestroy&&this._joint.onDestroy()},Be(e,[{key:"body",get:function(){return this._body}},{key:"impl",get:function(){return this._joint}}]),e}(ui),k2=je((F2=z2).prototype,"anchor",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),N2=je(F2.prototype,"connectedAnchor",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),G2=je(F2.prototype,"collideConnected",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),U2=je(F2.prototype,"connectedBody",[I2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L2=F2))||L2))),e5=(t("DistanceJoint2D",Ze("cc.DistanceJoint2D")(V2=oi()((Y2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).TYPE=E1.DISTANCE,$e(e,"_maxLength",W2,ti(e)),$e(e,"_autoCalcDistance",X2,ti(e)),e}return Me(e,t),Be(e,[{key:"maxLength",get:function(){return this._autoCalcDistance&&this.connectedBody?Si.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.setMaxLength(t)}},{key:"autoCalcDistance",get:function(){return this._autoCalcDistance},set:function(t){this._autoCalcDistance=t}}]),e}(t5),je((H2=Y2).prototype,"maxLength",[ss],Object.getOwnPropertyDescriptor(H2.prototype,"maxLength"),H2.prototype),je(H2.prototype,"autoCalcDistance",[ss],Object.getOwnPropertyDescriptor(H2.prototype,"autoCalcDistance"),H2.prototype),W2=je(H2.prototype,"_maxLength",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),X2=je(H2.prototype,"_autoCalcDistance",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),V2=H2))||V2)||V2),t("SpringJoint2D",Ze("cc.SpringJoint2D")(j2=oi()(($2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).TYPE=E1.SPRING,$e(e,"_frequency",q2,ti(e)),$e(e,"_dampingRatio",Z2,ti(e)),$e(e,"_distance",J2,ti(e)),$e(e,"_autoCalcDistance",Q2,ti(e)),e}return Me(e,t),Be(e,[{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}},{key:"distance",get:function(){return this._autoCalcDistance&&this.connectedBody?Si.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):this._distance},set:function(t){this._distance=t,this._joint&&this._joint.setDistance(t)}},{key:"autoCalcDistance",get:function(){return this._autoCalcDistance},set:function(t){this._autoCalcDistance=t}}]),e}(t5),je((K2=$2).prototype,"frequency",[ss],Object.getOwnPropertyDescriptor(K2.prototype,"frequency"),K2.prototype),je(K2.prototype,"dampingRatio",[ss],Object.getOwnPropertyDescriptor(K2.prototype,"dampingRatio"),K2.prototype),je(K2.prototype,"distance",[ss],Object.getOwnPropertyDescriptor(K2.prototype,"distance"),K2.prototype),je(K2.prototype,"autoCalcDistance",[ss],Object.getOwnPropertyDescriptor(K2.prototype,"autoCalcDistance"),K2.prototype),q2=je(K2.prototype,"_frequency",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Z2=je(K2.prototype,"_dampingRatio",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),J2=je(K2.prototype,"_distance",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Q2=je(K2.prototype,"_autoCalcDistance",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),j2=K2))||j2)||j2),t("MouseJoint2D",Ze("cc.MouseJoint2D")(t3=oi()((s3=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).TYPE=E1.MOUSE,$e(e,"_maxForce",i3,ti(e)),$e(e,"_dampingRatio",r3,ti(e)),$e(e,"_frequency",n3,ti(e)),e._target=new _i,e}return Me(e,t),e.prototype.update=function(t){this._joint.update(t)},Be(e,[{key:"target",get:function(){return this._target},set:function(t){this._target=t,this._joint&&this._joint.setTarget(t)}},{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}},{key:"maxForce",get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.setMaxForce(t)}}]),e}(t5),je((e3=s3).prototype,"frequency",[ss],Object.getOwnPropertyDescriptor(e3.prototype,"frequency"),e3.prototype),je(e3.prototype,"dampingRatio",[ss],Object.getOwnPropertyDescriptor(e3.prototype,"dampingRatio"),e3.prototype),je(e3.prototype,"maxForce",[ss],Object.getOwnPropertyDescriptor(e3.prototype,"maxForce"),e3.prototype),i3=je(e3.prototype,"_maxForce",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),r3=je(e3.prototype,"_dampingRatio",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),n3=je(e3.prototype,"_frequency",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),t3=e3))||t3)||t3),new Si),i5=new Si,r5=(t("RelativeJoint2D",Ze("cc.RelativeJoint2D")(a3=oi()((f3=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).TYPE=E1.RELATIVE,$e(e,"_maxForce",l3,ti(e)),$e(e,"_maxTorque",h3,ti(e)),$e(e,"_correctionFactor",u3,ti(e)),$e(e,"_angularOffset",c3,ti(e)),$e(e,"_linearOffset",p3,ti(e)),$e(e,"_autoCalcOffset",d3,ti(e)),e}return Me(e,t),Be(e,[{key:"maxForce",get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.setMaxForce(t)}},{key:"maxTorque",get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.setMaxTorque(t)}},{key:"correctionFactor",get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.setCorrectionFactor(t)}},{key:"linearOffset",get:function(){return this._autoCalcOffset&&this.connectedBody?_i.subtract(this._linearOffset,this.connectedBody.node.worldPosition,this.node.worldPosition):this._linearOffset},set:function(t){this._linearOffset.set(t),this._joint&&this._joint.setLinearOffset(t)}},{key:"angularOffset",get:function(){return this._autoCalcOffset&&this.connectedBody&&(ur.toEuler(e5,this.node.worldRotation),ur.toEuler(i5,this.connectedBody.node.worldRotation),this._angularOffset=i5.z-e5.z),this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.setAngularOffset(t)}},{key:"autoCalcOffset",get:function(){return this._autoCalcOffset},set:function(t){this._autoCalcOffset=t}}]),e}(t5),je((o3=f3).prototype,"maxForce",[ss],Object.getOwnPropertyDescriptor(o3.prototype,"maxForce"),o3.prototype),je(o3.prototype,"maxTorque",[ss],Object.getOwnPropertyDescriptor(o3.prototype,"maxTorque"),o3.prototype),je(o3.prototype,"correctionFactor",[ss],Object.getOwnPropertyDescriptor(o3.prototype,"correctionFactor"),o3.prototype),je(o3.prototype,"linearOffset",[ss],Object.getOwnPropertyDescriptor(o3.prototype,"linearOffset"),o3.prototype),je(o3.prototype,"angularOffset",[ss],Object.getOwnPropertyDescriptor(o3.prototype,"angularOffset"),o3.prototype),je(o3.prototype,"autoCalcOffset",[ss],Object.getOwnPropertyDescriptor(o3.prototype,"autoCalcOffset"),o3.prototype),l3=je(o3.prototype,"_maxForce",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),h3=je(o3.prototype,"_maxTorque",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),u3=je(o3.prototype,"_correctionFactor",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),c3=je(o3.prototype,"_angularOffset",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),p3=je(o3.prototype,"_linearOffset",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _i}}),d3=je(o3.prototype,"_autoCalcOffset",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),a3=o3))||a3)||a3),new _i),n5=(t("SliderJoint2D",Ze("cc.SliderJoint2D")(_3=oi()((C3=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).TYPE=E1.SLIDER,$e(e,"_angle",m3,ti(e)),$e(e,"_autoCalcAngle",y3,ti(e)),$e(e,"_enableMotor",v3,ti(e)),$e(e,"_maxMotorForce",b3,ti(e)),$e(e,"_motorSpeed",S3,ti(e)),$e(e,"_enableLimit",T3,ti(e)),$e(e,"_lowerLimit",A3,ti(e)),$e(e,"_upperLimit",E3,ti(e)),e}return Me(e,t),Be(e,[{key:"angle",get:function(){return this._autoCalcAngle&&this.connectedBody&&(_i.subtract(r5,this.connectedBody.node.worldPosition,this.node.worldPosition),this._angle=Jr(Math.atan2(r5.y,r5.x))),this._angle},set:function(t){this._angle=t}},{key:"autoCalcAngle",get:function(){return this._autoCalcAngle},set:function(t){this._autoCalcAngle=t}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t}},{key:"maxMotorForce",get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.setMaxMotorForce(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}},{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t}},{key:"lowerLimit",get:function(){return this._lowerLimit},set:function(t){this._lowerLimit=t,this._joint&&this._joint.setLowerLimit(t)}},{key:"upperLimit",get:function(){return this._upperLimit},set:function(t){this._upperLimit=t,this._joint&&this._joint.setUpperLimit(t)}}]),e}(t5),je((g3=C3).prototype,"angle",[ss],Object.getOwnPropertyDescriptor(g3.prototype,"angle"),g3.prototype),je(g3.prototype,"autoCalcAngle",[ss],Object.getOwnPropertyDescriptor(g3.prototype,"autoCalcAngle"),g3.prototype),je(g3.prototype,"enableMotor",[ss],Object.getOwnPropertyDescriptor(g3.prototype,"enableMotor"),g3.prototype),je(g3.prototype,"maxMotorForce",[ss],Object.getOwnPropertyDescriptor(g3.prototype,"maxMotorForce"),g3.prototype),je(g3.prototype,"motorSpeed",[ss],Object.getOwnPropertyDescriptor(g3.prototype,"motorSpeed"),g3.prototype),je(g3.prototype,"enableLimit",[ss],Object.getOwnPropertyDescriptor(g3.prototype,"enableLimit"),g3.prototype),je(g3.prototype,"lowerLimit",[ss],Object.getOwnPropertyDescriptor(g3.prototype,"lowerLimit"),g3.prototype),je(g3.prototype,"upperLimit",[ss],Object.getOwnPropertyDescriptor(g3.prototype,"upperLimit"),g3.prototype),m3=je(g3.prototype,"_angle",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y3=je(g3.prototype,"_autoCalcAngle",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),v3=je(g3.prototype,"_enableMotor",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),b3=je(g3.prototype,"_maxMotorForce",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),S3=je(g3.prototype,"_motorSpeed",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),T3=je(g3.prototype,"_enableLimit",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),A3=je(g3.prototype,"_lowerLimit",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E3=je(g3.prototype,"_upperLimit",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_3=g3))||_3)||_3),t("FixedJoint2D",Ze("cc.FixedJoint2D")(R3=oi()((P3=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).TYPE=E1.FIXED,$e(e,"_frequency",x3,ti(e)),$e(e,"_dampingRatio",O3,ti(e)),e}return Me(e,t),Be(e,[{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}}]),e}(t5),je((w3=P3).prototype,"frequency",[ss],Object.getOwnPropertyDescriptor(w3.prototype,"frequency"),w3.prototype),je(w3.prototype,"dampingRatio",[ss],Object.getOwnPropertyDescriptor(w3.prototype,"dampingRatio"),w3.prototype),x3=je(w3.prototype,"_frequency",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),O3=je(w3.prototype,"_dampingRatio",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),R3=w3))||R3)||R3),t("WheelJoint2D",Ze("cc.WheelJoint2D")(D3=oi()((G3=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).TYPE=E1.WHEEL,$e(e,"_angle",B3,ti(e)),$e(e,"_enableMotor",I3,ti(e)),$e(e,"_maxMotorTorque",L3,ti(e)),$e(e,"_motorSpeed",F3,ti(e)),$e(e,"_frequency",k3,ti(e)),$e(e,"_dampingRatio",N3,ti(e)),e}return Me(e,t),Be(e,[{key:"angle",get:function(){return this._angle},set:function(t){this._angle=t}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.enableMotor(t)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.setMaxMotorTorque(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}},{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}}]),e}(t5),je((M3=G3).prototype,"angle",[ss],Object.getOwnPropertyDescriptor(M3.prototype,"angle"),M3.prototype),je(M3.prototype,"enableMotor",[ss],Object.getOwnPropertyDescriptor(M3.prototype,"enableMotor"),M3.prototype),je(M3.prototype,"maxMotorTorque",[ss],Object.getOwnPropertyDescriptor(M3.prototype,"maxMotorTorque"),M3.prototype),je(M3.prototype,"motorSpeed",[ss],Object.getOwnPropertyDescriptor(M3.prototype,"motorSpeed"),M3.prototype),je(M3.prototype,"frequency",[ss],Object.getOwnPropertyDescriptor(M3.prototype,"frequency"),M3.prototype),je(M3.prototype,"dampingRatio",[ss],Object.getOwnPropertyDescriptor(M3.prototype,"dampingRatio"),M3.prototype),B3=je(M3.prototype,"_angle",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),I3=je(M3.prototype,"_enableMotor",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L3=je(M3.prototype,"_maxMotorTorque",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),F3=je(M3.prototype,"_motorSpeed",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),k3=je(M3.prototype,"_frequency",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),N3=je(M3.prototype,"_dampingRatio",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),D3=M3))||D3)||D3),t("HingeJoint2D",Ze("cc.HingeJoint2D")(U3=oi()((K3=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).TYPE=E1.HINGE,$e(e,"_enableLimit",V3,ti(e)),$e(e,"_lowerAngle",H3,ti(e)),$e(e,"_upperAngle",W3,ti(e)),$e(e,"_enableMotor",X3,ti(e)),$e(e,"_maxMotorTorque",Y3,ti(e)),$e(e,"_motorSpeed",j3,ti(e)),e}return Me(e,t),Be(e,[{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t}},{key:"lowerAngle",get:function(){return this._lowerAngle},set:function(t){this._lowerAngle=t,this._joint&&this._joint.setLowerAngle(t)}},{key:"upperAngle",get:function(){return this._upperAngle},set:function(t){this._upperAngle=t,this._joint&&this._joint.setUpperAngle(t)}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.enableMotor(t)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.setMaxMotorTorque(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}}]),e}(t5),je((z3=K3).prototype,"enableLimit",[ss],Object.getOwnPropertyDescriptor(z3.prototype,"enableLimit"),z3.prototype),je(z3.prototype,"lowerAngle",[ss],Object.getOwnPropertyDescriptor(z3.prototype,"lowerAngle"),z3.prototype),je(z3.prototype,"upperAngle",[ss],Object.getOwnPropertyDescriptor(z3.prototype,"upperAngle"),z3.prototype),je(z3.prototype,"enableMotor",[ss],Object.getOwnPropertyDescriptor(z3.prototype,"enableMotor"),z3.prototype),je(z3.prototype,"maxMotorTorque",[ss],Object.getOwnPropertyDescriptor(z3.prototype,"maxMotorTorque"),z3.prototype),je(z3.prototype,"motorSpeed",[ss],Object.getOwnPropertyDescriptor(z3.prototype,"motorSpeed"),z3.prototype),V3=je(z3.prototype,"_enableLimit",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),H3=je(z3.prototype,"_lowerAngle",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),W3=je(z3.prototype,"_upperAngle",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),X3=je(z3.prototype,"_enableMotor",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Y3=je(z3.prototype,"_maxMotorTorque",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),j3=je(z3.prototype,"_motorSpeed",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),U3=z3))||U3)||U3),t("Physics2DUtils",{PolygonSeparator:R1}),function(){function t(){this._collider=null,this._worldAabb=new mi}var e=t.prototype;return e.apply=function(){},e.initialize=function(t){this._collider=t},e.onLoad=function(){},e.onEnable=function(){i2.instance.physicsWorld.addShape(this)},e.onDisable=function(){i2.instance.physicsWorld.removeShape(this)},e.start=function(){},e.update=function(){},e.containsPoint=function(t){return!!this.worldAABB.contains(t)},e.intersectsRect=function(t){return!!this.worldAABB.intersects(t)},e.onGroupChanged=function(){i2.instance.physicsWorld.updateShapeGroup(this)},Be(t,[{key:"impl",get:function(){return null}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){return this._worldAabb}}]),t}());function s5(t,e,i,r){var n=(r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),a=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0!==a){var o=n/a,l=s/a;if(o>=0&&o<=1&&l>=0&&l<=1)return!0}return!1}var a5=new _i,o5=new _i,l5=new _i,h5=new _i;function u5(t,e,i){for(var r=i.length,n=0;n<r;++n)if(s5(t,e,i[n],i[(n+1)%r]))return!0;return!1}function c5(t,e){for(var i=!1,r=t.x,n=t.y,s=e.length,a=0,o=s-1;a<s;o=a++){var l=e[a].x,h=e[a].y,u=e[o].x,c=e[o].y;h>n!=c>n&&r<(u-l)*(n-h)/(c-h)+l&&(i=!i)}return i}function p5(t,e,i,r){var n,s=i.x-e.x,a=i.y-e.y,o=s*s+a*a,l=((t.x-e.x)*s+(t.y-e.y)*a)/o;return n=r?o?l<0?e:l>1?i:a5.set(e.x+l*s,e.y+l*a):e:a5.set(e.x+l*s,e.y+l*a),s=t.x-n.x,a=t.y-n.y,Math.sqrt(s*s+a*a)}var d5=t("Intersection2D",(function(){}));d5.lineLine=s5,d5.lineRect=function(t,e,i){var r=a5.set(i.x,i.y),n=o5.set(i.x,i.yMax),s=l5.set(i.xMax,i.yMax),a=h5.set(i.xMax,i.y);return!!(s5(t,e,r,n)||s5(t,e,n,s)||s5(t,e,s,a)||s5(t,e,a,r))},d5.linePolygon=u5,d5.rectRect=function(t,e){var i=t.x,r=t.y,n=t.x+t.width,s=t.y+t.height,a=e.x,o=e.y,l=e.x+e.width,h=e.y+e.height;return i<=l&&n>=a&&r<=h&&s>=o},d5.rectPolygon=function(t,e){var i=a5.set(t.x,t.y),r=o5.set(t.x,t.yMax),n=l5.set(t.xMax,t.yMax),s=h5.set(t.xMax,t.y);if(u5(i,r,e))return!0;if(u5(r,n,e))return!0;if(u5(n,s,e))return!0;if(u5(s,i,e))return!0;for(var a=0,o=e.length;a<o;++a)if(t.contains(e[a]))return!0;return!!(c5(i,e)||c5(r,e)||c5(n,e)||c5(s,e))},d5.rectCircle=function(t,e,i){var r=e.x,n=e.y,s=t.x,a=t.y,o=t.width,l=t.height,h=r,u=n;r<s?h=s:r>s+o&&(h=s+o),n<a?u=a:n>a+l&&(u=a+l);var c=r-h,p=n-u;return Math.sqrt(c*c+p*p)<=i},d5.polygonPolygon=function(t,e){var i,r;for(i=0,r=t.length;i<r;++i)if(u5(t[i],t[(i+1)%r],e))return!0;for(i=0,r=e.length;i<r;++i)if(c5(e[i],t))return!0;for(i=0,r=t.length;i<r;++i)if(c5(t[i],e))return!0;return!1},d5.circleCircle=function(t,e,i,r){return _i.distance(t,i)<e+r},d5.polygonCircle=function(t,e,i){var r=e;if(c5(r,t))return!0;for(var n=0,s=t.length;n<s;n++)if(p5(r,0===n?t[t.length-1]:t[n-1],t[n],!0)<i)return!0;return!1},d5.pointInPolygon=c5,d5.pointLineDistance=p5;var f5,_5=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._worldPoints=[new _i,new _i,new _i,new _i],e}Me(e,t);var i=e.prototype;return i.update=function(){var t=this._worldAabb,e=this.collider,i=e.size,r=e.offset;t.x=r.x-i.width/2,t.y=r.y-i.height/2,t.width=i.width,t.height=i.height;var n=this._worldPoints,s=n[0],a=n[1],o=n[2],l=n[3];t.transformMat4ToPoints(e.node.worldMatrix,s,a,o,l);var h=Math.min(s.x,a.x,o.x,l.x),u=Math.min(s.y,a.y,o.y,l.y),c=Math.max(s.x,a.x,o.x,l.x),p=Math.max(s.y,a.y,o.y,l.y);t.x=h,t.y=u,t.width=c-h,t.height=p-u},i.containsPoint=function(t){return!!this.worldAABB.contains(t)&&d5.pointInPolygon(t,this.worldPoints)},i.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&d5.rectPolygon(t,this.worldPoints)},Be(e,[{key:"worldPoints",get:function(){return this._worldPoints}}]),e}(n5),g5=new _i,m5=new gi,y5=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._worldPosition=new _i,e._worldRadius=0,e}Me(e,t);var i=e.prototype;return i.update=function(){var t=this._worldAabb,e=this.collider,i=e.node.getWorldMatrix(m5);_i.transformMat4(g5,e.offset,i);var r=this._worldPosition;r.x=g5.x,r.y=g5.y,i.m12=i.m13=0,g5.x=e.radius,g5.y=0,_i.transformMat4(g5,g5,i);var n=this._worldRadius=g5.length();t.x=r.x-n,t.y=r.y-n,t.width=2*n,t.height=2*n},i.containsPoint=function(t){return!!this.worldAABB.contains(t)&&_i.subtract(g5,t,this.worldPosition).length()<this.worldRadius},i.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&d5.rectCircle(t,this.worldPosition,this.worldRadius)},Be(e,[{key:"worldPosition",get:function(){return this._worldPosition}},{key:"worldRadius",get:function(){return this._worldRadius}}]),e}(n5),v5=new _i,b5=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._worldPoints=[],e}Me(e,t);var i=e.prototype;return i.update=function(){var t=this._worldAabb,e=this.collider,i=e.points,r=e.offset,n=e.node.worldMatrix,s=this._worldPoints;s.length=i.length;for(var a=1e6,o=1e6,l=-1e6,h=-1e6,u=0,c=i.length;u<c;u++){s[u]||(s[u]=new _i),v5.x=i[u].x+r.x,v5.y=i[u].y+r.y,_i.transformMat4(v5,v5,n);var p=v5.x,d=v5.y;s[u].x=p,s[u].y=d,p>l&&(l=p),p<a&&(a=p),d>h&&(h=d),d<o&&(o=d)}t.x=a,t.y=o,t.width=l-a,t.height=h-o},i.containsPoint=function(t){return!!this.worldAABB.contains(t)&&d5.pointInPolygon(t,this.worldPoints)},i.intersectsRect=function(t){return!!this.worldAABB.intersects(t)&&d5.rectPolygon(t,this.worldPoints)},Be(e,[{key:"worldPoints",get:function(){return this._worldPoints}}]),e}(n5),S5=function(){function t(t,e){this.shape1=void 0,this.shape2=void 0,this.testFunc=void 0,this.touching=!1,this.type=x1.None,this.shape1=t,this.shape2=e,this.touching=!1;var i=t instanceof _5||t instanceof b5,r=e instanceof _5||e instanceof b5,n=t instanceof y5,s=e instanceof y5;i&&r?this.testFunc=d5.polygonPolygon:n&&s?this.testFunc=d5.circleCircle:i&&s?this.testFunc=d5.polygonCircle:n&&r?(this.testFunc=d5.polygonCircle,this.shape1=e,this.shape2=t):Le("Can not find contact for builtin shape: "+t.constructor.name+", "+e.constructor.name)}var e=t.prototype;return e.test=function(){var t=this.shape1,e=this.shape2;return!!t.worldAABB.intersects(e.worldAABB)&&(this.testFunc===d5.polygonPolygon?d5.polygonPolygon(t.worldPoints,e.worldPoints):this.testFunc===d5.circleCircle?d5.circleCircle(t.worldPosition,t.worldRadius,e.worldPosition,e.worldRadius):this.testFunc===d5.polygonCircle&&d5.polygonCircle(t.worldPoints,e.worldPosition,e.worldRadius))},e.updateState=function(){var t=this.test(),e=x1.None;return t&&!this.touching?(this.touching=!0,e=x1.BEGIN_CONTACT):!t&&this.touching&&(this.touching=!1,e=x1.END_CONTACT),this.type=e,e},t}(),T5=[],A5=[];f5={PhysicsWorld:function(){function t(){this._contacts=[],this._shapes=[],this._debugGraphics=null,this._debugDrawFlags=0}var e=t.prototype;return e.shouldCollide=function(t,e){var i=t.collider,r=e.collider,n=i2.instance.collisionMatrix;return i!==r&&i.node!==r.node&&n[i.group]&r.group&&n[r.group]&i.group},e.addShape=function(t){var e=this._shapes;if(-1===e.indexOf(t)){for(var i=0,r=e.length;i<r;i++){var n=e[i];if(this.shouldCollide(t,n)){var s=new S5(t,n);this._contacts.push(s)}}e.push(t)}},e.removeShape=function(t){var e=this._shapes,i=e.indexOf(t);if(i>=0){e.splice(i,1);for(var r=this._contacts,n=r.length-1;n>=0;n--){var s=r[n];s.shape1!==t&&s.shape2!==t||(s.touching&&this._emitCollide(s,x1.END_CONTACT),r.splice(n,1))}}},e.updateShapeGroup=function(t){this.removeShape(t),this.addShape(t)},e.step=function(){for(var t=this._shapes,e=0,i=t.length;e<i;e++)t[e].update();var r=this._contacts;T5.length=0;for(var n=0,s=r.length;n<s;n++)r[n].updateState()!==x1.None&&T5.push(r[n]);for(var a=0,o=T5.length;a<o;a++){var l=T5[a];this._emitCollide(l)}},e.drawDebug=function(){if(this._debugDrawFlags){this._checkDebugDrawValid();var t=this._debugGraphics;if(t){t.clear();for(var e=this._shapes,i=0,r=e.length;i<r;i++){var n=e[i];if(t.strokeColor=Ii.WHITE,n instanceof _5||n instanceof b5){var s=n.worldPoints;if(s.length>0){t.moveTo(s[0].x,s[0].y);for(var a=1;a<s.length;a++)t.lineTo(s[a].x,s[a].y);t.close(),t.stroke()}}else n instanceof y5&&(t.circle(n.worldPosition.x,n.worldPosition.y,n.worldRadius),t.stroke());if(this._debugDrawFlags&w1.Aabb){var o=n.worldAABB;t.strokeColor=Ii.BLUE,t.moveTo(o.xMin,o.yMin),t.lineTo(o.xMin,o.yMax),t.lineTo(o.xMax,o.yMax),t.lineTo(o.xMax,o.yMin),t.close(),t.stroke()}}}}},e._emitCollide=function(t,e){e=e||t.type;var i=t.shape1.collider,r=t.shape2.collider;i2.instance.emit(e,i,r),i.emit(e,i,r),r.emit(e,r,i)},e._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var t=fr("Canvas");if(!t){var e=Ai.getScene();if(!e)return;(t=new Yr("Canvas")).addComponent(Zl),t.parent=e}var i=new Yr("PHYSICS_2D_DEBUG_DRAW");i.hideFlags|=Ki.Flags.DontSave,i.parent=t,i.worldPosition=Si.ZERO,this._debugGraphics=i.addComponent(gG),this._debugGraphics.lineWidth=2}var r=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(r.children.length-1)},e.testPoint=function(t){var e=this._shapes;A5.length=0;for(var i=0;i<e.length;i++){var r=e[i];r.containsPoint(t)&&A5.push(r.collider)}return A5},e.testAABB=function(t){var e=this._shapes;A5.length=0;for(var i=0;i<e.length;i++){var r=e[i];r.intersectsRect(t)&&A5.push(r.collider)}return A5},e.impl=function(){return null},e.setGravity=function(){},e.setAllowSleep=function(){},e.syncPhysicsToScene=function(){},e.syncSceneToPhysics=function(){},e.raycast=function(){return[]},Be(t,[{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){this._debugDrawFlags=t}}]),t}(),RigidBody:null,BoxShape:_5,CircleShape:y5,PolygonShape:b5,MouseJoint:null,DistanceJoint:null,SpringJoint:null,RelativeJoint:null,SliderJoint:null,FixedJoint:null,WheelJoint:null,HingeJoint:null},a1="builtin",Xe._global.CC_PHYSICS_2D_BUILTIN=!0,Xe._global.CC_PHYSICS_2D_BOX2D=!1,s1=f5;var E5,C5,R5,w5,x5=Oi({GRAVITY:0,RADIUS:1}),O5=Oi({FREE:0,RELATIVE:1,GROUPED:2}),P5=new _i(0,0),D5=new _i,M5=new _i,B5=new _i,I5=new _i,L5=GN(kN),F5=function(){this.pos=new _i(0,0),this.startPos=new _i(0,0),this.color=new Ii(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new _i(0,0),this.aspectRatio=1,this.dir=new _i(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},k5=new(function(t){function e(){return t.apply(this,arguments)||this}return Me(e,t),e.prototype.get=function(){return this._get()||new F5},e}(Rn))((function(t){t.pos.set(P5),t.startPos.set(P5),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(P5),t.aspectRatio=1,t.dir.set(P5),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),N5=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)k5.put(t[e]);t.length=0},e.emitParticle=function(t){var e=this.sys,i=k5.get();this.particles.push(i),i.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var r=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,i.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2;var n,s,a,o,l=e.startColor,h=e.startColorVar,u=e.endColor,c=e.endColorVar;i.color.r=n=zn(l.r+h.r*(Math.random()-.5)*2,0,255),i.color.g=s=zn(l.g+h.g*(Math.random()-.5)*2,0,255),i.color.b=a=zn(l.b+h.b*(Math.random()-.5)*2,0,255),i.color.a=o=zn(l.a+h.a*(Math.random()-.5)*2,0,255),i.deltaColor.r=(zn(u.r+c.r*(Math.random()-.5)*2,0,255)-n)/r,i.deltaColor.g=(zn(u.g+c.g*(Math.random()-.5)*2,0,255)-s)/r,i.deltaColor.b=(zn(u.b+c.b*(Math.random()-.5)*2,0,255)-a)/r,i.deltaColor.a=(zn(u.a+c.a*(Math.random()-.5)*2,0,255)-o)/r;var p=e.startSize+e.startSizeVar*(Math.random()-.5)*2;if(p=Math.max(0,p),i.size=p,-1===e.endSize)i.deltaSize=0;else{var d=e.endSize+e.endSizeVar*(Math.random()-.5)*2;d=Math.max(0,d),i.deltaSize=(d-p)/r}var f=e.startSpin+e.startSpinVar*(Math.random()-.5)*2,_=e.endSpin+e.endSpinVar*(Math.random()-.5)*2;i.rotation=f,i.deltaRotation=(_-f)/r,i.startPos.x=t.x,i.startPos.y=t.y,i.aspectRatio=e.aspectRatio||1;var g=as(e.angle+this._worldRotation+e.angleVar*(Math.random()-.5)*2);if(e.emitterMode===x5.GRAVITY){var m=e.speed+e.speedVar*(Math.random()-.5)*2;i.dir.x=Math.cos(g),i.dir.y=Math.sin(g),i.dir.multiplyScalar(m),i.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,i.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(i.rotation=-os(Math.atan2(i.dir.y,i.dir.x)))}else{var y=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,v=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2;i.radius=y,i.deltaRadius=-1===e.endRadius?0:(v-y)/r,i.angle=g,i.degreesPerSecond=as(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var i=e.vData,r=this.sys._renderSpriteFrame.uv,n=t?0:this.uvFilled,s=this.particles.length,a=n;a<s;a++){var o=a*L5*4;i[o+3]=r[0],i[o+4]=r[1],i[o+12]=r[2],i[o+13]=r[3],i[o+21]=r[4],i[o+22]=r[5],i[o+30]=r[6],i[o+31]=r[7]}this.uvFilled=s}},e.updateParticleBuffer=function(t,e,i,r){var n=i.vData,s=e.x,a=e.y,o=t.size,l=o,h=t.aspectRatio;h>1?l=o/h:o=l*h;var u=o/2,c=l/2;if(t.rotation){var p=-u,d=-c,f=u,_=c,g=-as(t.rotation),m=Math.cos(g),y=Math.sin(g);n[r]=p*m-d*y+s,n[r+1]=p*y+d*m+a,n[r+2]=0,n[r+9]=f*m-d*y+s,n[r+10]=f*y+d*m+a,n[r+11]=0,n[r+18]=p*m-_*y+s,n[r+19]=p*y+_*m+a,n[r+20]=0,n[r+27]=f*m-_*y+s,n[r+28]=f*y+_*m+a,n[r+29]=0}else n[r]=s-u,n[r+1]=a-c,n[r+2]=0,n[r+9]=s+u,n[r+10]=a-c,n[r+11]=0,n[r+18]=s-u,n[r+19]=a+c,n[r+20]=0,n[r+27]=s+u,n[r+28]=a+c,n[r+29]=0;Ii.toArray(n,t.color,r+5),Ii.toArray(n,t.color,r+14),Ii.toArray(n,t.color,r+23),Ii.toArray(n,t.color,r+32)},e.step=function(t){var e=this.sys.assembler,i=this.sys,r=i.node,n=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,r.updateWorldTransform(),i.positionType===O5.FREE){this._worldRotation=function(t){for(var e=0,i=t;i;)e+=i.eulerAngles.z,i=i.parent;return e}(r);var s=r.worldMatrix;D5.x=s.m12,D5.y=s.m13}else i.positionType===O5.RELATIVE?(this._worldRotation=r.eulerAngles.z,D5.x=r.position.x,D5.y=r.position.y):this._worldRotation=0;if(this.active&&i.emissionRate){var a=1/i.emissionRate;for(n.length<i.totalParticles&&(this.emitCounter+=t);n.length<i.totalParticles&&this.emitCounter>a;)this.emitParticle(D5),this.emitCounter-=a;this.elapsed+=t,-1!==i.duration&&i.duration<this.elapsed&&i.stopSystem()}var o=this.renderData,l=n.length;o.reset(),this.requestData(4*l,6*l),l>this.uvFilled&&this.updateUVs();for(var h=0;h<n.length;){M5.x=M5.y=B5.x=B5.y=I5.x=I5.y=0;var u=n[h];if(u.timeToLive-=t,u.timeToLive>0){if(i.emitterMode===x5.GRAVITY){var c=I5,p=M5,d=B5;(u.pos.x||u.pos.y)&&(p.set(u.pos),p.normalize()),d.set(p),p.multiplyScalar(u.radialAccel);var f=d.x;d.x=-d.y,d.y=f,d.multiplyScalar(u.tangentialAccel),c.set(p),c.add(d),c.add(i.gravity),c.multiplyScalar(t),u.dir.add(c),c.set(u.dir),c.multiplyScalar(t),u.pos.add(c)}else u.angle+=u.degreesPerSecond*t,u.radius+=u.deltaRadius*t,u.pos.x=-Math.cos(u.angle)*u.radius,u.pos.y=-Math.sin(u.angle)*u.radius;u.color.r+=u.deltaColor.r*t,u.color.g+=u.deltaColor.g*t,u.color.b+=u.deltaColor.b*t,u.color.a+=u.deltaColor.a*t,u.size+=u.deltaSize*t,u.size<0&&(u.size=0),u.rotation+=u.deltaRotation*t;var _=M5;_.set(u.pos),i.positionType!==O5.GROUPED&&_.add(u.startPos);var g=L5*h*4;this.updateParticleBuffer(u,_,o,g),++h}else{var m=n[h];h!==n.length-1&&(n[h]=n[n.length-1]),k5.put(m),n.length--,o.indicesCount-=6,o.vertexCount-=4}}0!==n.length||this.active||this.readyToPlay||(this.finished=!0,i._finishedSimulation())},e.requestData=function(t,e){var i=this.renderData.indicesCount;this.renderData.request(t,e);for(var r=this.renderData.indicesCount/6,n=this.renderData.iData,s=i;s<r;s++){var a=4*s;n[i++]=a,n[i++]=a+1,n[i++]=a+2,n[i++]=a+1,n[i++]=a+3,n[i++]=a+2}},t}(),G5=t("ParticleAsset",Ze("cc.ParticleAsset")((w5=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"spriteFrame",R5,ti(e)),e}return Me(e,t),e}(Je),R5=je((C5=w5).prototype,"spriteFrame",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E5=C5))||E5);Xe.ParticleAsset=G5;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var U5={};(function(){function t(t){throw t}var e=void 0,i=!0,r=this;function n(t,i){var n,s=t.split("."),a=r;!(s[0]in a)&&a.execScript&&a.execScript("var "+s[0]);for(;s.length&&(n=s.shift());)s.length||i===e?a=a[n]?a[n]:a[n]={}:a[n]=i}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function a(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var n,s=1,a=0,o=t.length,l=0;0<o;){o-=n=1024<o?1024:o;do{a+=s+=t[l++]}while(--n);s%=65521,a%=65521}return(a<<16|s)>>>0}function o(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(s?Uint8Array:Array)?e:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}o.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(s?Uint8Array:Array)(i<<1);if(s)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},o.prototype.d=function(t,e,i){var r,n=this.buffer,s=this.index,a=this.i,o=n[s];if(i&&1<e&&(t=8<e?(d[255&t]<<24|d[t>>>8&255]<<16|d[t>>>16&255]<<8|d[t>>>24&255])>>32-e:d[t]>>8-e),8>e+a)o=o<<e|t,a+=e;else for(r=0;r<e;++r)o=o<<1|t>>e-r-1&1,8==++a&&(a=0,n[s++]=d[o],o=0,s===n.length&&(n=this.f()));n[s]=o,this.buffer=n,this.i=a,this.index=s},o.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=d[e[i]],i++),s?t=e.subarray(0,i):(e.length=i,t=e),t};var l,h=new(s?Uint8Array:Array)(256);for(l=0;256>l;++l){for(var u=p=l,c=7,p=p>>>1;p;p>>>=1)u<<=1,u|=1&p,--c;h[l]=(u<<c&255)>>>0}var d=h;function f(t){this.buffer=new(s?Uint16Array:Array)(2*t),this.length=0}function _(t){var e,i,r,n,a,o,l,h,u,c=t.length,p=0,d=Number.POSITIVE_INFINITY;for(h=0;h<c;++h)t[h]>p&&(p=t[h]),t[h]<d&&(d=t[h]);for(e=1<<p,i=new(s?Uint32Array:Array)(e),r=1,n=0,a=2;r<=p;){for(h=0;h<c;++h)if(t[h]===r){for(o=0,l=n,u=0;u<r;++u)o=o<<1|1&l,l>>=1;for(u=o;u<e;u+=a)i[u]=r<<16|h;++n}++r,n<<=1,a<<=1}return[i,p,d]}function g(t,e){this.h=y,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=s&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}f.prototype.getParent=function(t){return 2*((t-2)/4|0)},f.prototype.push=function(t,e){var i,r,n,s=this.buffer;for(i=this.length,s[this.length++]=e,s[this.length++]=t;0<i&&(r=this.getParent(i),s[i]>s[r]);)n=s[i],s[i]=s[r],s[r]=n,n=s[i+1],s[i+1]=s[r+1],s[r+1]=n,i=r;return this.length},f.prototype.pop=function(){var t,e,i,r,n,s=this.buffer;for(e=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],n=0;!((r=2*n+2)>=this.length)&&(r+2<this.length&&s[r+2]>s[r]&&(r+=2),s[r]>s[n]);)i=s[n],s[n]=s[r],s[r]=i,i=s[n+1],s[n+1]=s[r+1],s[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var m,y=2,v={NONE:0,r:1,j:y,N:3},b=[];for(m=0;288>m;m++)switch(i){case 143>=m:b.push([m+48,8]);break;case 255>=m:b.push([m-144+400,9]);break;case 279>=m:b.push([m-256+0,7]);break;case 287>=m:b.push([m-280+192,8]);break;default:t("invalid literal: "+m)}function S(t,e){this.length=t,this.G=e}function T(){var e=A;switch(i){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}g.prototype.n=function(){var r,n,a,l,h=this.input;switch(this.h){case 0:for(a=0,l=h.length;a<l;){var u,c,p,d=n=s?h.subarray(a,a+65535):h.slice(a,a+65535),f=(a+=n.length)===l,_=e,g=e,m=this.a,v=this.b;if(s){for(m=new Uint8Array(this.a.buffer);m.length<=v+d.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(u=f?1:0,m[v++]=0|u,p=65536+~(c=d.length)&65535,m[v++]=255&c,m[v++]=c>>>8&255,m[v++]=255&p,m[v++]=p>>>8&255,s)m.set(d,v),v+=d.length,m=m.subarray(0,v);else{for(_=0,g=d.length;_<g;++_)m[v++]=d[_];m.length=v}this.b=v,this.a=m}break;case 1:var S=new o(new Uint8Array(this.a.buffer),this.b);S.d(1,1,i),S.d(1,2,i);var T,A,E,C=w(this,h);for(T=0,A=C.length;T<A;T++)if(E=C[T],o.prototype.d.apply(S,b[E]),256<E)S.d(C[++T],C[++T],i),S.d(C[++T],5),S.d(C[++T],C[++T],i);else if(256===E)break;this.a=S.finish(),this.b=this.a.length;break;case y:var R,P,D,M,B,I,L,F,k,N,G,U,z,V,H,W=new o(new Uint8Array(this.a),this.b),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=Array(19);for(R=y,W.d(1,1,i),W.d(R,2,i),P=w(this,h),L=O(I=x(this.L,15)),k=O(F=x(this.K,7)),D=286;257<D&&0===I[D-1];D--);for(M=30;1<M&&0===F[M-1];M--);var j,K,q,Z,J,Q,$=D,tt=M,et=new(s?Uint32Array:Array)($+tt),it=new(s?Uint32Array:Array)(316),rt=new(s?Uint8Array:Array)(19);for(j=K=0;j<$;j++)et[K++]=I[j];for(j=0;j<tt;j++)et[K++]=F[j];if(!s)for(j=0,Z=rt.length;j<Z;++j)rt[j]=0;for(j=J=0,Z=et.length;j<Z;j+=K){for(K=1;j+K<Z&&et[j+K]===et[j];++K);if(q=K,0===et[j])if(3>q)for(;0<q--;)it[J++]=0,rt[0]++;else for(;0<q;)(Q=138>q?q:138)>q-3&&Q<q&&(Q=q-3),10>=Q?(it[J++]=17,it[J++]=Q-3,rt[17]++):(it[J++]=18,it[J++]=Q-11,rt[18]++),q-=Q;else if(it[J++]=et[j],rt[et[j]]++,3>--q)for(;0<q--;)it[J++]=et[j],rt[et[j]]++;else for(;0<q;)(Q=6>q?q:6)>q-3&&Q<q&&(Q=q-3),it[J++]=16,it[J++]=Q-3,rt[16]++,q-=Q}for(r=s?it.subarray(0,J):it.slice(0,J),N=x(rt,7),V=0;19>V;V++)Y[V]=N[X[V]];for(B=19;4<B&&0===Y[B-1];B--);for(G=O(N),W.d(D-257,5,i),W.d(M-1,5,i),W.d(B-4,4,i),V=0;V<B;V++)W.d(Y[V],3,i);for(V=0,H=r.length;V<H;V++)if(U=r[V],W.d(G[U],N[U],i),16<=U){switch(V++,U){case 16:z=2;break;case 17:z=3;break;case 18:z=7;break;default:t("invalid code: "+U)}W.d(r[V],z,i)}var nt,st,at,ot,lt,ht,ut,ct,pt=[L,I],dt=[k,F];for(lt=pt[0],ht=pt[1],ut=dt[0],ct=dt[1],nt=0,st=P.length;nt<st;++nt)if(at=P[nt],W.d(lt[at],ht[at],i),256<at)W.d(P[++nt],P[++nt],i),ot=P[++nt],W.d(ut[ot],ct[ot],i),W.d(P[++nt],P[++nt],i);else if(256===at)break;this.a=W.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var A,E,C=[];for(A=3;258>=A;A++)E=T(),C[A]=E[2]<<24|E[1]<<16|E[0];var R=s?new Uint32Array(C):C;function w(r,n){function a(e,r){var n,s,a,o,l=e.G,h=[],u=0;switch(n=R[e.length],h[u++]=65535&n,h[u++]=n>>16&255,h[u++]=n>>24,i){case 1===l:s=[0,l-1,0];break;case 2===l:s=[1,l-2,0];break;case 3===l:s=[2,l-3,0];break;case 4===l:s=[3,l-4,0];break;case 6>=l:s=[4,l-5,1];break;case 8>=l:s=[5,l-7,1];break;case 12>=l:s=[6,l-9,2];break;case 16>=l:s=[7,l-13,2];break;case 24>=l:s=[8,l-17,3];break;case 32>=l:s=[9,l-25,3];break;case 48>=l:s=[10,l-33,4];break;case 64>=l:s=[11,l-49,4];break;case 96>=l:s=[12,l-65,5];break;case 128>=l:s=[13,l-97,5];break;case 192>=l:s=[14,l-129,6];break;case 256>=l:s=[15,l-193,6];break;case 384>=l:s=[16,l-257,7];break;case 512>=l:s=[17,l-385,7];break;case 768>=l:s=[18,l-513,8];break;case 1024>=l:s=[19,l-769,8];break;case 1536>=l:s=[20,l-1025,9];break;case 2048>=l:s=[21,l-1537,9];break;case 3072>=l:s=[22,l-2049,10];break;case 4096>=l:s=[23,l-3073,10];break;case 6144>=l:s=[24,l-4097,11];break;case 8192>=l:s=[25,l-6145,11];break;case 12288>=l:s=[26,l-8193,12];break;case 16384>=l:s=[27,l-12289,12];break;case 24576>=l:s=[28,l-16385,13];break;case 32768>=l:s=[29,l-24577,13];break;default:t("invalid distance")}for(n=s,h[u++]=n[0],h[u++]=n[1],h[u++]=n[2],a=0,o=h.length;a<o;++a)m[y++]=h[a];b[h[0]]++,T[h[3]]++,v=e.length+r-1,f=null}var o,l,h,u,c,p,d,f,_,g={},m=s?new Uint16Array(2*n.length):[],y=0,v=0,b=new(s?Uint32Array:Array)(286),T=new(s?Uint32Array:Array)(30),A=r.w;if(!s){for(h=0;285>=h;)b[h++]=0;for(h=0;29>=h;)T[h++]=0}for(b[256]=1,o=0,l=n.length;o<l;++o){for(h=c=0,u=3;h<u&&o+h!==l;++h)c=c<<8|n[o+h];if(g[c]===e&&(g[c]=[]),p=g[c],!(0<v--)){for(;0<p.length&&32768<o-p[0];)p.shift();if(o+3>=l){for(f&&a(f,-1),h=0,u=l-o;h<u;++h)_=n[o+h],m[y++]=_,++b[_];break}if(0<p.length){var E=e,C=e,w=0,x=e,O=e,P=e,D=n.length,M=(O=0,p.length);t:for(;O<M;O++){if(E=p[M-O-1],x=3,3<w){for(P=w;3<P;P--)if(n[E+P-1]!==n[o+P-1])continue t;x=w}for(;258>x&&o+x<D&&n[E+x]===n[o+x];)++x;if(x>w&&(C=E,w=x),258===x)break}d=new S(w,o-C),f?f.length<d.length?(_=n[o-1],m[y++]=_,++b[_],a(d,0)):a(f,-1):d.length<A?f=d:a(d,0)}else f?a(f,-1):(_=n[o],m[y++]=_,++b[_])}p.push(o)}return m[y++]=256,b[256]++,r.L=b,r.K=T,s?m.subarray(0,y):m}function x(t,e){function i(t){var e=A[t][E[t]];e===y?(i(t+1),i(t+1)):--S[e],++E[t]}var r,n,a,o,l,h=t.length,u=new f(572),c=new(s?Uint8Array:Array)(h);if(!s)for(o=0;o<h;o++)c[o]=0;for(o=0;o<h;++o)0<t[o]&&u.push(o,t[o]);if(r=Array(u.length/2),n=new(s?Uint32Array:Array)(u.length/2),1===r.length)return c[u.pop().index]=1,c;for(o=0,l=u.length/2;o<l;++o)r[o]=u.pop(),n[o]=r[o].value;var p,d,_,g,m,y=n.length,v=new(s?Uint16Array:Array)(e),b=new(s?Uint8Array:Array)(e),S=new(s?Uint8Array:Array)(y),T=Array(e),A=Array(e),E=Array(e),C=(1<<e)-y,R=1<<e-1;for(v[e-1]=y,d=0;d<e;++d)C<R?b[d]=0:(b[d]=1,C-=R),C<<=1,v[e-2-d]=(v[e-1-d]/2|0)+y;for(v[0]=b[0],T[0]=Array(v[0]),A[0]=Array(v[0]),d=1;d<e;++d)v[d]>2*v[d-1]+b[d]&&(v[d]=2*v[d-1]+b[d]),T[d]=Array(v[d]),A[d]=Array(v[d]);for(p=0;p<y;++p)S[p]=e;for(_=0;_<v[e-1];++_)T[e-1][_]=n[_],A[e-1][_]=_;for(p=0;p<e;++p)E[p]=0;for(1===b[e-1]&&(--S[0],++E[e-1]),d=e-2;0<=d;--d){for(g=p=0,m=E[d+1],_=0;_<v[d];_++)(g=T[d+1][m]+T[d+1][m+1])>n[p]?(T[d][_]=g,A[d][_]=y,m+=2):(T[d][_]=n[p],A[d][_]=p,++p);E[d]=0,1===b[d]&&i(d)}for(a=S,o=0,l=r.length;o<l;++o)c[r[o].index]=a[o];return c}function O(e){var i,r,n,a,o=new(s?Uint16Array:Array)(e.length),l=[],h=[],u=0;for(i=0,r=e.length;i<r;i++)l[e[i]]=1+(0|l[e[i]]);for(i=1,r=16;i<=r;i++)h[i]=u,(u+=0|l[i])>1<<i&&t("overcommitted"),u<<=1;for(65536>u&&t("undercommitted"),i=0,r=e.length;i<r;i++)for(u=h[e[i]],h[e[i]]+=1,n=o[i]=0,a=e[i];n<a;n++)o[i]=o[i]<<1|1&u,u>>>=1;return o}function P(t,e){this.input=t,this.a=new(s?Uint8Array:Array)(32768),this.h=D.j;var i,r={};for(i in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)r[i]=e[i];r.outputBuffer=this.a,this.z=new g(this.input,r)}var D=v;function M(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(e):e,this.s=!1,this.m=I,this.B=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case B:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.l+258);break;case I:this.b=0,this.a=new(s?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}P.prototype.n=function(){var e,i,r,n,o,l,h,u=0;switch(h=this.a,e=ut){case ut:i=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=i<<4|e,h[u++]=r,e){case ut:switch(this.h){case D.NONE:o=0;break;case D.r:o=1;break;case D.j:o=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return n=o<<6|0,h[u++]=n|31-(256*r+n)%31,l=a(this.input),this.z.b=u,u=(h=this.z.n()).length,s&&((h=new Uint8Array(h.buffer)).length<=u+4&&(this.a=new Uint8Array(h.length+4),this.a.set(h),h=this.a),h=h.subarray(0,u+4)),h[u++]=l>>24&255,h[u++]=l>>16&255,h[u++]=l>>8&255,h[u++]=255&l,h},n("Zlib.Deflate",P),n("Zlib.Deflate.compress",(function(t,e){return new P(t,e).n()})),n("Zlib.Deflate.CompressionType",D),n("Zlib.Deflate.CompressionType.NONE",D.NONE),n("Zlib.Deflate.CompressionType.FIXED",D.r),n("Zlib.Deflate.CompressionType.DYNAMIC",D.j);var B=0,I=1,L={D:B,C:I};M.prototype.p=function(){for(;!this.s;){var r=tt(this,3);switch(1&r&&(this.s=i),r>>>=1){case 0:var n=this.input,a=this.c,o=this.a,l=this.b,h=e,u=e,c=e,p=o.length,d=e;switch(this.e=this.g=0,(h=n[a++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),u=h,(h=n[a++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),u|=h<<8,(h=n[a++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=h,(h=n[a++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),u===~(c|=h<<8)&&t(Error("invalid uncompressed block header: length verify")),a+u>n.length&&t(Error("input buffer is broken")),this.m){case B:for(;l+u>o.length;){if(u-=d=p-l,s)o.set(n.subarray(a,a+d),l),l+=d,a+=d;else for(;d--;)o[l++]=n[a++];this.b=l,o=this.f(),l=this.b}break;case I:for(;l+u>o.length;)o=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(s)o.set(n.subarray(a,a+u),l),l+=u,a+=u;else for(;u--;)o[l++]=n[a++];this.c=a,this.b=l,this.a=o;break;case 1:this.o(J,$);break;case 2:it(this);break;default:t(Error("unknown BTYPE: "+r))}}return this.t()};var F,k,N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=s?new Uint16Array(N):N,U=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],z=s?new Uint16Array(U):U,V=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],H=s?new Uint8Array(V):V,W=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],X=s?new Uint16Array(W):W,Y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=s?new Uint8Array(Y):Y,K=new(s?Uint8Array:Array)(288);for(F=0,k=K.length;F<k;++F)K[F]=143>=F?8:255>=F?9:279>=F?7:8;var q,Z,J=_(K),Q=new(s?Uint8Array:Array)(30);for(q=0,Z=Q.length;q<Z;++q)Q[q]=5;var $=_(Q);function tt(i,r){for(var n,s=i.g,a=i.e,o=i.input,l=i.c;a<r;)(n=o[l++])===e&&t(Error("input buffer is broken")),s|=n<<a,a+=8;return n=s&(1<<r)-1,i.g=s>>>r,i.e=a-r,i.c=l,n}function et(i,r){for(var n,s,a,o=i.g,l=i.e,h=i.input,u=i.c,c=r[0],p=r[1];l<p;)(n=h[u++])===e&&t(Error("input buffer is broken")),o|=n<<l,l+=8;return a=(s=c[o&(1<<p)-1])>>>16,i.g=o>>a,i.e=l-a,i.c=u,65535&s}function it(t){function e(t,e,i){var r,n,s,a;for(a=0;a<t;)switch(r=et(this,e)){case 16:for(s=3+tt(this,2);s--;)i[a++]=n;break;case 17:for(s=3+tt(this,3);s--;)i[a++]=0;n=0;break;case 18:for(s=11+tt(this,7);s--;)i[a++]=0;n=0;break;default:n=i[a++]=r}return i}var i,r,n,a,o=tt(t,5)+257,l=tt(t,5)+1,h=tt(t,4)+4,u=new(s?Uint8Array:Array)(G.length);for(a=0;a<h;++a)u[G[a]]=tt(t,3);i=_(u),r=new(s?Uint8Array:Array)(o),n=new(s?Uint8Array:Array)(l),t.o(_(e.call(t,o,i,r)),_(e.call(t,l,i,n)))}function rt(e,i){var r,n;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),r=e[this.c++],n=e[this.c++],15&r){case ut:this.method=ut;break;default:t(Error("unsupported compression method"))}0!=((r<<8)+n)%31&&t(Error("invalid fcheck flag:"+((r<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.A=new M(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}M.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,s,a,o,l=i.length-258;256!==(n=et(this,t));)if(256>n)r>=l&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(o=z[s=n-257],0<H[s]&&(o+=tt(this,H[s])),n=et(this,e),a=X[n],0<j[n]&&(a+=tt(this,j[n])),r>=l&&(this.b=r,i=this.f(),r=this.b);o--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},M.prototype.I=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,s,a,o,l=i.length;256!==(n=et(this,t));)if(256>n)r>=l&&(l=(i=this.f()).length),i[r++]=n;else for(o=z[s=n-257],0<H[s]&&(o+=tt(this,H[s])),n=et(this,e),a=X[n],0<j[n]&&(a+=tt(this,j[n])),r+o>l&&(l=(i=this.f()).length);o--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},M.prototype.f=function(){var t,e,i=new(s?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(s)i.set(n.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=n[t+32768];if(this.k.push(i),this.q+=i.length,s)n.set(n.subarray(r,r+32768));else for(t=0;32768>t;++t)n[t]=n[r+t];return this.b=32768,n},M.prototype.J=function(t){var e,i,r,n=this.input.length/this.c+1|0,a=this.input,o=this.a;return t&&("number"==typeof t.v&&(n=t.v),"number"==typeof t.F&&(n+=t.F)),i=2>n?(r=(a.length-this.c)/this.u[2]/2*258|0)<o.length?o.length+r:o.length<<1:o.length*n,s?(e=new Uint8Array(i)).set(o):e=o,this.a=e},M.prototype.t=function(){var t,e,i,r,n,a=0,o=this.a,l=this.k,h=new(s?Uint8Array:Array)(this.q+(this.b-32768));if(0===l.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=l.length;e<i;++e)for(r=0,n=(t=l[e]).length;r<n;++r)h[a++]=t[r];for(e=32768,i=this.b;e<i;++e)h[a++]=o[e];return this.k=[],this.buffer=h},M.prototype.H=function(){var t,e=this.b;return s?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},rt.prototype.p=function(){var e,i=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==a(e)&&t(Error("invalid adler-32 checksum")),e},n("Zlib.Inflate",rt),n("Zlib.Inflate.BufferType",L),L.ADAPTIVE=L.C,L.BLOCK=L.D,n("Zlib.Inflate.prototype.decompress",rt.prototype.p);var nt,st,at=new(s?Uint8Array:Array)(288);for(nt=0,st=at.length;nt<st;++nt)at[nt]=143>=nt?8:255>=nt?9:279>=nt?7:8;_(at);var ot,lt,ht=new(s?Uint8Array:Array)(30);for(ot=0,lt=ht.length;ot<lt;++ot)ht[ot]=5;_(ht);var ut=8}).call(U5);var z5=U5.Zlib;z5.Deflate=z5.Deflate,z5.Deflate.compress=z5.Deflate.compress,z5.Inflate=z5.Inflate,z5.Inflate.BufferType=z5.Inflate.BufferType,z5.Inflate.prototype.decompress=z5.Inflate.prototype.decompress;for(var V5=function(){function t(t){var e,i=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=t,this.transparency={indexed:[],rgb:0,grayscale:0};for(var r=0,n=0,s=0;;){s=this.readUInt32();var a=function(){var t=[];for(r=0;r<4;++r)t.push(String.fromCharCode(i.data[i.pos++]));return t}.call(this).join("");switch(a){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(s);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var o=this.readUInt16(),l=this.readUInt16()||100;e.delay=1e3*o/l,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for("fdAT"===a&&(this.pos+=4,s-=4),t=(null!=e?e.data:void 0)||this.imgData,r=0;s>=0?r<s:r>s;s>=0?++r:--r)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(s);var h=255-this.transparency.indexed.length;if(h>0)for(n=0;h>=0?n<h:n>h;h>=0?++n:--n)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(s)[0];break;case 2:this.transparency.rgb=this.read(s)}break;case"tEXt":var u=this.read(s),c=u.indexOf(0),p=String.fromCharCode.apply(String,u.slice(0,c));this.text[p]=String.fromCharCode.apply(String,u.slice(c+1));break;case"IEND":e&&this.animation.frames.push(e),this.colors=function(){switch(i.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var d=this.colorType;this.hasAlphaChannel=4===d||6===d;var f=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*f,this.colorSpace=function(){switch(i.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=s}if(this.pos+=4,this.pos>this.data.length)throw new Error(ls(6017))}}var e=t.prototype;return e.read=function(t){var e=0,i=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)i.push(this.data[this.pos++]);return i},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new z5.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,i=e*this.width,r=new Uint8Array(i*this.height),n=t.length,s=0,a=0,o=0,l=0,h=0,u=0,c=0,p=0,d=0,f=0,_=0,g=0,m=0,y=0,v=0,b=0,S=0,T=0,A=0;a<n;){switch(t[a++]){case 0:for(u=c=0;c<i;u=c+=1)r[o++]=t[a++];break;case 1:for(u=p=0;p<i;u=p+=1)l=t[a++],g=u<e?0:r[o-e],r[o++]=(l+g)%256;break;case 2:for(u=d=0;d<i;u=d+=1)l=t[a++],h=(u-u%e)/e,T=s&&r[(s-1)*i+h*e+u%e],r[o++]=(T+l)%256;break;case 3:for(u=f=0;f<i;u=f+=1)l=t[a++],h=(u-u%e)/e,g=u<e?0:r[o-e],T=s&&r[(s-1)*i+h*e+u%e],r[o++]=(l+Math.floor((g+T)/2))%256;break;case 4:for(u=_=0;_<i;u=_+=1)l=t[a++],h=(u-u%e)/e,g=u<e?0:r[o-e],0===s?T=A=0:(T=r[(s-1)*i+h*e+u%e],A=h&&r[(s-1)*i+(h-1)*e+u%e]),m=g+T-A,y=Math.abs(m-g),b=Math.abs(m-T),S=Math.abs(m-A),v=y<=b&&y<=S?g:b<=S?T:A,r[o++]=(l+v)%256;break;default:throw new Error(ls(6018,t[a-1]))}s++}return r},e.copyToImageData=function(t,e){var i,r=this.hasAlphaChannel,n=this.colors;this.palette.length&&(i=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),n=4,r=!0);var s=t.data||t,a=s.length,o=i||e,l=0,h=0,u=0,c=0;if(1===n)for(;l<a;)u=i?4*e[l/4]:h,c=o[u++],s[l++]=c,s[l++]=c,s[l++]=c,s[l++]=r?o[u++]:255,h=u;else for(;l<a;)u=i?4*e[l/4]:h,s[l++]=o[u++],s[l++]=o[u++],s[l++]=o[u++],s[l++]=r?o[u++]:255,h=u},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],i=new Uint8Array((e.length||0)+t.length),r=0,n=0,s=0,a=0,o=0,l=t.length;o<l;a=o+=3)i[r++]=t[a],i[r++]=t[a+1],i[r++]=t[a+2],s=e[n++],i[r++]=null!=s?s:255;return i},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d"),i=e.createImageData(this.width,this.height);return this.copyToImageData(i,this.decodePixels(null)),e.putImageData(i,0,0)},t}(),H5=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(ls(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(ls(6020));return!0},e.getFieldTypeName=function(t){return t in X5?X5[t]:null},e.getFieldTagName=function(t){return t in W5?W5[t]:(ji(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,i,r){var n=[],s=this.getFieldTypeLength(e);if(s*i<=4)!1===this._littleEndian?n.push(r>>>8*(4-s)):n.push(r);else for(var a=0;a<i;a++){var o=s*a;s>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(n.push(this.getUint32(r+o)),n.push(this.getUint32(r+o+4))):ji(8e3):n.push(this.getBytes(s,r+o))}return"ASCII"===e&&n.forEach((function(t,e,i){i[e]=String.fromCharCode(t)})),n},e.getBytes=function(t,e){if(t<=0)ji(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);ji(8002)}return 0},e.getBits=function(t,e,i){i=i||0;var r=e+Math.floor(i/8),n=i+t,s=32-t,a=0,o=0;return n<=0?ji(6023):n<=8?(a=24+i,o=this.getUint8(r)):n<=16?(a=16+i,o=this.getUint16(r)):n<=32?(a=i,o=this.getUint32(r)):ji(6022),{bits:o<<a>>>s,byteOffset:r+Math.floor(n/8),bitOffset:n%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),i=[],r=0,n=0;for(r=t+2,n=0;n<e;r+=12,n++){var s=this.getUint16(r),a=this.getUint16(r+2),o=this.getUint32(r+4),l=this.getUint32(r+8),h=this.getFieldTagName(s),u=this.getFieldTypeName(a),c=this.getFieldValues(h,u,o,l);i[h]={type:u,values:c}}this._fileDirectories.push(i);var p=this.getUint32(r);0!==p&&this.parseFileDirectory(p)},e.clampColorSample=function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},e.parseTIFF=function(t,e){var i=this;if(e=e||document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var r=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(r);var n=this._fileDirectories[0],s=n.ImageWidth.values[0],a=n.ImageLength.values[0];this._canvas.width=s,this._canvas.height=a;var o=[],l=n.Compression?n.Compression.values[0]:1,h=n.SamplesPerPixel.values[0],u=[],c=0,p=!1;n.BitsPerSample.values.forEach((function(t,e){u[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(u[e].hasBytesPerSample=!0,u[e].bytesPerSample=t/8),c+=t}),this);var d=0;c%8==0&&(p=!0,d=c/8);var f,_=n.StripOffsets.values,g=_.length;if(n.StripByteCounts)f=n.StripByteCounts.values;else{if(ji(8003),1!==g)throw Error(ls(6024));f=[Math.ceil(s*a*c/8)]}for(var m=1,y=1,v=0;v<g;v++){var b=_[v];o[v]=[];for(var S=f[v],T=0,A=0,E=1,C=!0,R=[],w=0,x=0,O=0;T<S;T+=E)switch(l){case 1:R=[];for(var P=0;P<h;P++){var D=u[P];if(!D.hasBytesPerSample){var M=this.getBits(D.bitsPerSample,b+T,A);throw R.push(M.bits),T=M.byteOffset-b,A=M.bitOffset,RangeError(ls(6025))}var B=D.bytesPerSample*P;R.push(this.getBytes(D.bytesPerSample,b+T+B))}if(o[v].push(R),!p)throw E=0,RangeError(ls(6026));E=d;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(C){C=!1;var I=this.getUint8(b+T);I>=0&&I<=127?m=I+1:I>=-127&&I<=-1?y=1-I:C=!0}else{for(var L=this.getUint8(b+T),F=0;F<y;F++){var k=u[x];if(!k.hasBytesPerSample)throw RangeError(ls(6025));O=O<<8*w|L,++w===k.bytesPerSample&&(R.push(O),O=w=0,x++),x===h&&(o[v].push(R),R=[],x=0)}0==--m&&(C=!0)}E=1}}if(e.getContext){var N=this._canvas.getContext("2d");N.fillStyle="rgba(255, 255, 255, 0)";var G=n.RowsPerStrip?n.RowsPerStrip.values[0]:a,U=o.length,z=a%G,V=0===z?G:z,H=G,W=0,X=n.PhotometricInterpretation.values[0],Y=[],j=0;n.ExtraSamples&&(j=(Y=n.ExtraSamples.values).length);var K=[],q=0;n.ColorMap&&(K=n.ColorMap.values,q=Math.pow(2,u[0].bitsPerSample));for(var Z=0;Z<U;Z++){Z+1===U&&(H=V);for(var J=o[Z].length,Q=W*Z,$=0,tt=0;$<H&&tt<J;$++)for(var et=0;et<s;et++,tt++){var it=o[Z][tt],rt=0,nt=0,st=0,at=1;if(j>0)for(var ot=0;ot<j;ot++)if(1===Y[ot]||2===Y[ot]){at=it[3+ot]/256;break}!function(){switch(X){case 0:var t=0;u[0].hasBytesPerSample&&(t=Math.pow(16,2*u[0].bytesPerSample)),it.forEach((function(e,i,r){r[i]=t-e}));case 1:rt=nt=st=i.clampColorSample(it[0],u[0].bitsPerSample);break;case 2:rt=i.clampColorSample(it[0],u[0].bitsPerSample),nt=i.clampColorSample(it[1],u[1].bitsPerSample),st=i.clampColorSample(it[2],u[2].bitsPerSample);break;case 3:if(void 0===K)throw Error(ls(6027));var e=it[0];rt=i.clampColorSample(K[e],16),nt=i.clampColorSample(K[q+e],16),st=i.clampColorSample(K[2*q+e],16);break;default:throw RangeError(ls(6028,X))}}(),N.fillStyle="rgba("+rt+", "+nt+", "+st+", "+at+")",N.fillRect(et,Q+$,1,1)}W=H}}return this._canvas}},t}(),W5={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},X5={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},Y5=new Array(123),j5=0;j5<123;++j5)Y5[j5]=64;for(var K5=0;K5<64;++K5)Y5["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(K5)]=K5;var q5={name:"Jacob__Codec__Base64",decode:function(t){var e,i,r,n,s,a,o=[],l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)e=Y5[t.charCodeAt(l++)]<<2|(n=Y5[t.charCodeAt(l++)])>>4,i=(15&n)<<4|(s=Y5[t.charCodeAt(l++)])>>2,r=(3&s)<<6|(a=Y5[t.charCodeAt(l++)]),o.push(String.fromCharCode(e)),64!==s&&o.push(String.fromCharCode(i)),64!==a&&o.push(String.fromCharCode(r));return o.join("")},decodeAsArray:function(t,e){var i,r,n,s=this.decode(t),a=[];for(i=0,n=s.length/e;i<n;i++)for(a[i]=0,r=e-1;r>=0;--r)a[i]+=s.charCodeAt(i*e+r)<<8*r;return a}},Z5=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(Z5.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};Z5.gunzip=function(t){return t.constructor===Array||t.constructor,new Z5(t).gunzip()[0][0]},Z5.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},Z5.LITERALS=288,Z5.NAMEMAX=256,Z5.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],Z5.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Z5.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],Z5.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Z5.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Z5.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z5.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},Z5.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},Z5.prototype.byteAlign=function(){this.bb=1},Z5.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},Z5.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=Z5.bitReverse[e]>>8-t),e},Z5.prototype.flushBuffer=function(){this.bIdx=0},Z5.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},Z5.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},Z5.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},Z5.prototype.CreateTree=function(t,e,i){var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},Z5.prototype.DecodeValue=function(t){for(var e,i,r=0,n=t[r];;)if(this.readBit()){if(!(32768&n.b1))return n.b1;for(n=n.jump,e=t.length,i=0;i<e;i++)if(t[i]===n){r=i;break}}else{if(!(32768&n.b0))return n.b0;n=t[++r]}return-1},Z5.prototype.DeflateLoop=function(){var t,e,i;do{var r,n;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),r=this.readByte(),r|=this.readByte()<<8,n=this.readByte(),65535&(r^~(n|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");r--;)s=this.readByte(),this.addBuffer(s);else if(1===e)for(;;)if((a=Z5.bitReverse[this.readBits(7)]>>1)>23?(a=a<<1|this.readBit())>199?a=(a-=128)<<1|this.readBit():(a-=48)>143&&(a+=136):a+=256,a<256)this.addBuffer(a);else{if(256===a)break;for(a-=257,f=this.readBits(Z5.cplext[a])+Z5.cplens[a],a=Z5.bitReverse[this.readBits(5)]>>3,Z5.cpdext[a]>8?(_=this.readBits(8),_|=this.readBits(Z5.cpdext[a]-8)<<8):_=this.readBits(Z5.cpdext[a]),_+=Z5.cpdist[a],a=0;a<f;a++){var s=this.buf32k[this.bIdx-_&32767];this.addBuffer(s)}}else if(2===e){var a,o,l,h,u,c=new Array(320);for(l=257+this.readBits(5),h=1+this.readBits(5),u=4+this.readBits(4),a=0;a<19;a++)c[a]=0;for(a=0;a<u;a++)c[Z5.border[a]]=this.readBits(3);for(f=this.distanceTree.length,i=0;i<f;i++)this.distanceTree[i]=new Z5.HufNode;if(this.CreateTree(this.distanceTree,19,c,0))return this.flushBuffer(),1;for(o=l+h,i=0;i<o;)if((a=this.DecodeValue(this.distanceTree))<16)c[i++]=a;else if(16===a){var p;if(i+(a=3+this.readBits(2))>o)return this.flushBuffer(),1;for(p=i?c[i-1]:0;a--;)c[i++]=p}else{if(i+(a=17===a?3+this.readBits(3):11+this.readBits(7))>o)return this.flushBuffer(),1;for(;a--;)c[i++]=0}for(f=this.literalTree.length,i=0;i<f;i++)this.literalTree[i]=new Z5.HufNode;if(this.CreateTree(this.literalTree,l,c,0))return this.flushBuffer(),1;for(f=this.literalTree.length,i=0;i<f;i++)this.distanceTree[i]=new Z5.HufNode;var d=new Array;for(i=l;i<c.length;i++)d[i-l]=c[i];if(this.CreateTree(this.distanceTree,h,d,0))return this.flushBuffer(),1;for(;;)if((a=this.DecodeValue(this.literalTree))>=256){var f,_;if(0==(a-=256))break;for(a--,f=this.readBits(Z5.cplext[a])+Z5.cplens[a],a=this.DecodeValue(this.distanceTree),Z5.cpdext[a]>8?(_=this.readBits(8),_|=this.readBits(Z5.cpdext[a]-8)<<8):_=this.readBits(Z5.cpdext[a]),_+=Z5.cpdist[a];f--;)s=this.buf32k[this.bIdx-_&32767],this.addBuffer(s)}else this.addBuffer(a)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},Z5.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},Z5.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8;var r=this.readByte();for(r|=this.readByte()<<8,s=0,this.nameBuf=[];i--;){var n=this.readByte();"/"===n|":"===n?s=0:s<Z5.NAMEMAX-1&&(this.nameBuf[s++]=String.fromCharCode(n))}this.fileout||(this.fileout=this.nameBuf);for(var s=0;s<r;)n=this.readByte(),s++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},Z5.prototype.skipdir=function(){var t,e,i=[];if(8&this.gpflags&&(i[0]=this.readByte(),i[1]=this.readByte(),i[2]=this.readByte(),i[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),i[0]=this.readByte(),8!==i[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(i[0]=this.readByte(),i[2]=this.readByte(),this.len=i[0]+256*i[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<Z5.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var J5,Q5,$5,t8,e8,i8,r8,n8,s8,a8,o8,l8,h8,u8,c8,p8,d8,f8,_8,g8,m8,y8,v8,b8,S8,T8,A8,E8,C8,R8,w8,x8,O8,P8,D8,M8,B8,I8,L8,F8,k8,N8,G8,U8,z8,V8,H8,W8,X8,Y8,j8,K8,q8,Z8,J8,Q8,$8,t4,e4,i4,r4,n4,s4,a4,o4,l4,h4,u4,c4,p4,d4,f4,_4,g4,m4,y4,v4,b4,S4,T4,A4,E4,C4,R4,w4,x4,O4,P4,D4,M4,B4,I4,L4,F4,k4,N4,G4={name:"Jacob__Codec"};function U4(t){var e=t.parent,i=t.getComponent(e6);return e&&i?U4(e):t.getComponentsInChildren(e6)}G4.Base64=q5,G4.GZip=Z5,G4.unzip=function(){return G4.GZip.gunzip.apply(G4.GZip,arguments)},G4.unzipBase64=function(){var t=G4.Base64.decode.apply(G4.Base64,arguments);try{return G4.GZip.gunzip.call(G4.GZip,t)}catch(e){return t.slice(7)}},G4.unzipBase64AsArray=function(t,e){e=e||1;var i,r,n,s=this.unzipBase64(t),a=[];for(i=0,n=s.length/e;i<n;i++)for(a[i]=0,r=e-1;r>=0;--r)a[i]+=s.charCodeAt(i*e+r)<<8*r;return a},G4.unzipAsArray=function(t,e){e=e||1;var i,r,n,s=this.unzip(t),a=[];for(i=0,n=s.length/e;i<n;i++)for(a[i]=0,r=e-1;r>=0;--r)a[i]+=s.charCodeAt(i*e+r)<<8*r;return a},function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}(N4||(N4={}));var z4,V4,H4,W4,X4,Y4,j4,K4,q4,Z4,J4,Q4,$4,t6,e6=t("ParticleSystem2D",(J5=Ze("cc.ParticleSystem2D"),Q5=oi(),$5=li(),t8=si(G5),e8=li(),i8=si(KL),r8=li(),n8=li(),s8=li(),a8=li(),o8=li(),l8=li(),h8=li(),u8=li(),c8=li(),p8=li(),d8=li(),f8=li(),_8=li(),g8=li(),m8=li(),y8=li(),v8=li(),b8=li(),S8=li(),T8=li(),A8=li(),E8=si(O5),C8=li(),R8=si(x5),w8=li(),x8=li(),O8=li(),P8=li(),D8=li(),M8=li(),B8=li(),I8=li(),L8=li(),F8=li(),k8=li(),N8=li(),G8=li(),U8=li(),z8=li(),V8=li(),H8=li(),W8=li(),J5(X8=Q5(X8=hs(X8=vi((k4=F4=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"duration",j8,ti(e)),$e(e,"emissionRate",K8,ti(e)),$e(e,"life",q8,ti(e)),$e(e,"lifeVar",Z8,ti(e)),$e(e,"angle",J8,ti(e)),$e(e,"angleVar",Q8,ti(e)),$e(e,"startSize",$8,ti(e)),$e(e,"startSizeVar",t4,ti(e)),$e(e,"endSize",e4,ti(e)),$e(e,"endSizeVar",i4,ti(e)),$e(e,"startSpin",r4,ti(e)),$e(e,"startSpinVar",n4,ti(e)),$e(e,"endSpin",s4,ti(e)),$e(e,"endSpinVar",a4,ti(e)),$e(e,"sourcePos",o4,ti(e)),$e(e,"posVar",l4,ti(e)),$e(e,"emitterMode",h4,ti(e)),$e(e,"gravity",u4,ti(e)),$e(e,"speed",c4,ti(e)),$e(e,"speedVar",p4,ti(e)),$e(e,"tangentialAccel",d4,ti(e)),$e(e,"tangentialAccelVar",f4,ti(e)),$e(e,"radialAccel",_4,ti(e)),$e(e,"radialAccelVar",g4,ti(e)),$e(e,"rotationIsDir",m4,ti(e)),$e(e,"startRadius",y4,ti(e)),$e(e,"startRadiusVar",v4,ti(e)),$e(e,"endRadius",b4,ti(e)),$e(e,"endRadiusVar",S4,ti(e)),$e(e,"rotatePerS",T4,ti(e)),$e(e,"rotatePerSVar",A4,ti(e)),e.aspectRatio=1,$e(e,"playOnLoad",E4,ti(e)),$e(e,"autoRemoveOnFinish",C4,ti(e)),$e(e,"preview",R4,ti(e)),$e(e,"_custom",w4,ti(e)),$e(e,"_file",x4,ti(e)),$e(e,"_spriteFrame",O4,ti(e)),$e(e,"_totalParticles",P4,ti(e)),$e(e,"_startColor",D4,ti(e)),$e(e,"_startColorVar",M4,ti(e)),$e(e,"_endColor",B4,ti(e)),$e(e,"_endColorVar",I4,ti(e)),$e(e,"_positionType",L4,ti(e)),e._stopped=!0,e._deferredloaded=!1,e.initProperties(),e}Me(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0},i.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new N5(this)},i.onFocusInEditor=function(){this._focused=!0;for(var t=U4(this.node),e=0;e<t.length;++e)t[e]._startPreview()},i.onLostFocusInEditor=function(){this._focused=!1;for(var t=U4(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},i._startPreview=function(){this.preview&&this.resetSystem()},i._stopPreview=function(){this.preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},i.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this))},i.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},i.addParticle=function(){},i.stopSystem=function(){this._stopped=!0,this._simulator.stop()},i.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._renderFlag=this._canRender()},i.isFull=function(){return this.particleCount>=this.totalParticles},i._applyFile=function(){var t=this,e=this._file;if(e){var i=function(i){!i&&e?t.isValid&&(t._plistFile=e.nativeUrl,t._custom||(t._spriteFrame!==e.spriteFrame&&(t.spriteFrame=e.spriteFrame),t._initWithDictionary(e._nativeAsset)),t._spriteFrame?!t._renderSpriteFrame&&t._spriteFrame&&t._applySpriteFrame():e.spriteFrame?t.spriteFrame=e.spriteFrame:t._custom&&t._initTextureWithDictionary(e._nativeAsset),t._deferredloaded=!1):Ie(6029)};e._nativeAsset?i(null):(this._deferredloaded=!0,Bn.postLoadNative(e,i))}},i._initTextureWithDictionary=function(t){var e,i=this;if(t.spriteFrameUuid){var r=t.spriteFrameUuid;Bn.loadAny(r,(function(e,r){e?(t.spriteFrameUuid=void 0,i._initTextureWithDictionary(t),Le(e)):i.spriteFrame=r}))}else{var n=us(this._plistFile,t.textureFileName||"");if(t.textureFileName)Bn.loadRemote(n,(function(e,r){e?(t.textureFileName=void 0,i._initTextureWithDictionary(t),Le(e)):i.spriteFrame=KL.createWithImage(r)}));else if(t.textureImageData){var s=t.textureImageData;if(!(s&&s.length>0))return!1;var a=Bn.assets.get(n);if(!a){var o=G4.unzipBase64AsArray(s,1);if(!o)return He(6030,this._file.name),!1;var l=(e=o).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?N4.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?N4.TIFF:N4.UNKNOWN;if(l!==N4.TIFF&&l!==N4.PNG)return He(6031,this._file.name),!1;var h=document.createElement("canvas");l===N4.PNG?new V5(o).render(h):(this._tiffReader||(this._tiffReader=new H5),this._tiffReader.parseTIFF(o,h)),a=new er(h),Bn.assets.add(n,a)}a||He(6032,this._file.name),this.spriteFrame=KL.createWithImage(a)}}return!0},i._initWithDictionary=function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this._srcBlendFactor=parseInt(t.blendFuncSource||w.SRC_ALPHA),this._dstBlendFactor=parseInt(t.blendFuncDestination||w.ONE_MINUS_SRC_ALPHA);var i=this._startColor;i.r=255*parseFloat(t.startColorRed||0),i.g=255*parseFloat(t.startColorGreen||0),i.b=255*parseFloat(t.startColorBlue||0),i.a=255*parseFloat(t.startColorAlpha||0);var r=this._startColorVar;r.r=255*parseFloat(t.startColorVarianceRed||0),r.g=255*parseFloat(t.startColorVarianceGreen||0),r.b=255*parseFloat(t.startColorVarianceBlue||0),r.a=255*parseFloat(t.startColorVarianceAlpha||0);var n=this._endColor;n.r=255*parseFloat(t.finishColorRed||0),n.g=255*parseFloat(t.finishColorGreen||0),n.b=255*parseFloat(t.finishColorBlue||0),n.a=255*parseFloat(t.finishColorAlpha||0);var s=this._endColorVar;if(s.r=255*parseFloat(t.finishColorVarianceRed||0),s.g=255*parseFloat(t.finishColorVarianceGreen||0),s.b=255*parseFloat(t.finishColorVarianceBlue||0),s.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:O5.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(t.sourcePositionVariancex||0),parseFloat(t.sourcePositionVariancey||0)),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||x5.GRAVITY),this.emitterMode===x5.GRAVITY){this.gravity.set(parseFloat(t.gravityx||0),parseFloat(t.gravityy||0)),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var a=t.rotationIsDir||"";null!==a?(a=a.toString().toLowerCase(),this.rotationIsDir="true"===a||"1"===a):this.rotationIsDir=!1}else{if(this.emitterMode!==x5.RADIUS)return He(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},i._onTextureLoaded=function(){this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._renderFlag=this._canRender()},i._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},i._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.textureLoaded()?this._onTextureLoaded():this._renderSpriteFrame.once("load",this._onTextureLoaded,this):this.resetSystem()},i._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},i._updateMaterial=function(){var t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this._positionType!==O5.FREE})},i._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._renderFlag=this._canRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},i._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&!this._deferredloaded&&null!==this._renderSpriteFrame},i._render=function(t){t.commitComp(this,this._renderSpriteFrame,this._assembler,this._positionType===O5.RELATIVE?this.node.parent:null)},Be(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),e}(Ch),F4.EmitterMode=x5,F4.PositionType=O5,F4.DURATION_INFINITY=-1,F4.START_SIZE_EQUAL_TO_END_SIZE=-1,F4.START_RADIUS_EQUAL_TO_END_RADIUS=-1,je((Y8=k4).prototype,"custom",[yr,$5],Object.getOwnPropertyDescriptor(Y8.prototype,"custom"),Y8.prototype),je(Y8.prototype,"file",[t8,e8],Object.getOwnPropertyDescriptor(Y8.prototype,"file"),Y8.prototype),je(Y8.prototype,"spriteFrame",[i8,r8],Object.getOwnPropertyDescriptor(Y8.prototype,"spriteFrame"),Y8.prototype),je(Y8.prototype,"totalParticles",[yr,n8],Object.getOwnPropertyDescriptor(Y8.prototype,"totalParticles"),Y8.prototype),j8=je(Y8.prototype,"duration",[ei,yr,s8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),K8=je(Y8.prototype,"emissionRate",[ei,yr,a8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),q8=je(Y8.prototype,"life",[ei,yr,o8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Z8=je(Y8.prototype,"lifeVar",[ei,yr,l8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(Y8.prototype,"startColor",[yr,h8],Object.getOwnPropertyDescriptor(Y8.prototype,"startColor"),Y8.prototype),je(Y8.prototype,"startColorVar",[yr,u8],Object.getOwnPropertyDescriptor(Y8.prototype,"startColorVar"),Y8.prototype),je(Y8.prototype,"endColor",[yr,c8],Object.getOwnPropertyDescriptor(Y8.prototype,"endColor"),Y8.prototype),je(Y8.prototype,"endColorVar",[yr,p8],Object.getOwnPropertyDescriptor(Y8.prototype,"endColorVar"),Y8.prototype),J8=je(Y8.prototype,"angle",[ei,yr,d8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),Q8=je(Y8.prototype,"angleVar",[ei,yr,f8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),$8=je(Y8.prototype,"startSize",[ei,yr,_8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),t4=je(Y8.prototype,"startSizeVar",[ei,yr,g8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),e4=je(Y8.prototype,"endSize",[ei,yr,m8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),i4=je(Y8.prototype,"endSizeVar",[ei,yr,y8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),r4=je(Y8.prototype,"startSpin",[ei,yr,v8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),n4=je(Y8.prototype,"startSpinVar",[ei,yr,b8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s4=je(Y8.prototype,"endSpin",[ei,yr,S8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a4=je(Y8.prototype,"endSpinVar",[ei,yr,T8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),o4=je(Y8.prototype,"sourcePos",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i.ZERO.clone()}}),l4=je(Y8.prototype,"posVar",[ei,yr,A8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i.ZERO.clone()}}),je(Y8.prototype,"positionType",[E8,C8],Object.getOwnPropertyDescriptor(Y8.prototype,"positionType"),Y8.prototype),h4=je(Y8.prototype,"emitterMode",[ei,yr,R8,w8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return x5.GRAVITY}}),u4=je(Y8.prototype,"gravity",[ei,yr,x8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _i.ZERO.clone()}}),c4=je(Y8.prototype,"speed",[ei,yr,O8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),p4=je(Y8.prototype,"speedVar",[ei,yr,P8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),d4=je(Y8.prototype,"tangentialAccel",[ei,yr,D8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),f4=je(Y8.prototype,"tangentialAccelVar",[ei,yr,M8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_4=je(Y8.prototype,"radialAccel",[ei,yr,B8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),g4=je(Y8.prototype,"radialAccelVar",[ei,yr,I8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m4=je(Y8.prototype,"rotationIsDir",[ei,yr,L8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),y4=je(Y8.prototype,"startRadius",[ei,yr,F8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v4=je(Y8.prototype,"startRadiusVar",[ei,yr,k8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b4=je(Y8.prototype,"endRadius",[ei,yr,N8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S4=je(Y8.prototype,"endRadiusVar",[ei,yr,G8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),T4=je(Y8.prototype,"rotatePerS",[ei,yr,U8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),A4=je(Y8.prototype,"rotatePerSVar",[ei,yr,z8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E4=je(Y8.prototype,"playOnLoad",[ei,yr,V8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),C4=je(Y8.prototype,"autoRemoveOnFinish",[ei,yr,H8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),R4=je(Y8.prototype,"preview",[ei,yr,W8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),w4=je(Y8.prototype,"_custom",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),x4=je(Y8.prototype,"_file",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O4=je(Y8.prototype,"_spriteFrame",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P4=je(Y8.prototype,"_totalParticles",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),D4=je(Y8.prototype,"_startColor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(255,255,255,255)}}),M4=je(Y8.prototype,"_startColorVar",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(0,0,0,0)}}),B4=je(Y8.prototype,"_endColor",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(255,255,255,0)}}),I4=je(Y8.prototype,"_endColorVar",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ii(0,0,0,0)}}),L4=je(Y8.prototype,"_positionType",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return O5.FREE}}),X8=Y8))||X8)||X8)||X8)||X8)),i6=function(){function t(t,e){this.point=new _i,this.dir=new _i,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),r6=t("MotionStreak",(z4=Ze("cc.MotionStreak"),V4=oi(),H4=ai(),W4=si(ir),z4(X4=vi(X4=hs(X4=V4(X4=H4((t6=$4=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"_preview",j4,ti(e)),$e(e,"_fadeTime",K4,ti(e)),$e(e,"_minSeg",q4,ti(e)),$e(e,"_stroke",Z4,ti(e)),$e(e,"_texture",J4,ti(e)),$e(e,"_fastMode",Q4,ti(e)),e._points=[],e}Me(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},i.onFocusInEditor=function(){this._preview&&this.reset()},i.onLostFocusInEditor=function(){this._preview&&this.reset()},i.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},i.lateUpdate=function(t){this._assembler&&this._assembler.update(this,t)},i._render=function(t){t.commitComp(this,this._texture,this._assembler,null)},Be(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(Ch),$4.Point=i6,je((Y4=t6).prototype,"preview",[yr],Object.getOwnPropertyDescriptor(Y4.prototype,"preview"),Y4.prototype),je(Y4.prototype,"fadeTime",[yr],Object.getOwnPropertyDescriptor(Y4.prototype,"fadeTime"),Y4.prototype),je(Y4.prototype,"minSeg",[yr],Object.getOwnPropertyDescriptor(Y4.prototype,"minSeg"),Y4.prototype),je(Y4.prototype,"stroke",[yr],Object.getOwnPropertyDescriptor(Y4.prototype,"stroke"),Y4.prototype),je(Y4.prototype,"texture",[W4],Object.getOwnPropertyDescriptor(Y4.prototype,"texture"),Y4.prototype),je(Y4.prototype,"fastMode",[yr],Object.getOwnPropertyDescriptor(Y4.prototype,"fastMode"),Y4.prototype),j4=je(Y4.prototype,"_preview",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),K4=je(Y4.prototype,"_fadeTime",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),q4=je(Y4.prototype,"_minSeg",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Z4=je(Y4.prototype,"_stroke",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),J4=je(Y4.prototype,"_texture",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q4=je(Y4.prototype,"_fastMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),X4=Y4))||X4)||X4)||X4)||X4)||X4)),n6=(new _i,new _i),s6=new _i;function a6(t,e){return t.x=-e.y,t.y=e.x,t}var o6={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=16,e.indicesCount=42,e},update:function(t,e){var i,r=t.stroke/2,n=t.node.worldMatrix,s=n.m12,a=n.m13,o=t.points;if(o.length>1){var l=o[0],h=l.point.x-s,u=l.point.y-a;h*h+u*u<t.minSeg&&(i=l)}i||(i=new r6.Point,o.splice(0,0,i)),i.setPoint(s,a),i.time=t.fadeTime+e;var c,p=0;if(!(o.length<2)){var d=t.renderData,f=t.color,_=f.r,g=f.g,m=f.b,y=f.a,v=o[1];v.distance=_i.subtract(s6,i.point,v.point).length(),s6.normalize(),v.setDir(s6.x,s6.y),i.setDir(s6.x,s6.y),d.dataLength=2*o.length;for(var b=d.data,S=t.fadeTime,T=!1,A=o.length-1;A>=0;A--){var E=o[A],C=E.point,R=E.dir;if(E.time-=e,E.time<0)o.splice(A,1);else{var w=E.time/S,x=o[A-1];if(!T){if(!x){o.splice(A,1);continue}C.x=x.point.x-R.x*w,C.y=x.point.y-R.y*w}T=!0,a6(n6,R);var O=(w*y<<24>>>0)+(m<<16)+(g<<8)+_,P=p;b[P].x=C.x+n6.x*r,b[P].y=C.y+n6.y*r,b[P].u=1,b[P].v=w,b[P].color._val=O,b[P+=1].x=C.x-n6.x*r,b[P].y=C.y-n6.y*r,b[P].u=0,b[P].v=w,b[P].color._val=O,p+=2}}c=p<=2?0:3*(p-2),d.vertexCount=p,d.indicesCount=c}},updateRenderData:function(){},fillBuffers:function(t,e){var i=t.renderData,r=i.data,n=(t.node,e.acquireBufferBatch()),s=n.byteOffset>>2,a=n.indicesOffset,o=n.vertexOffset;n.request(i.vertexCount,i.indicesCount)||(n=e.currBufferBatch,a=0,o=0);for(var l=n.vData,h=n.iData,u=i.vertexCount,c=i.indicesCount,p=0;p<u;p++){var d=r[p];l[s++]=d.x,l[s++]=d.y,l[s++]=d.z,l[s++]=d.u,l[s++]=d.v,Ii.toArray(l,d.color,s),s+=4}for(var f=0,_=c;f<_;f+=2){var g=o+f;h[a++]=g,h[a++]=g+2,h[a++]=g+1,h[a++]=g+1,h[a++]=g+2,h[a++]=g+3}}},l6=t("MotionStreakAssemblerManager",{getAssembler:function(){return o6}});r6.Assembler=l6;var h6,u6,c6,p6,d6,f6,_6,g6={maxParticleDeltaTime:0,createData:function(){return Sh.add()},updateRenderData:function(){},fillBuffers:function(t,e){if(null!==t){var i=t._simulator.renderData;if(0!==i.vertexCount&&0!==i.indicesCount){var r=e.acquireBufferBatch(),n=r.byteOffset>>2,s=r.indicesOffset,a=r.vertexOffset;r.request(i.vertexCount,i.indicesCount)||(r=e.currBufferBatch,s=0,a=0);for(var o=r.vData,l=r.iData,h=i.vData,u=i.iData,c=9*i.vertexCount,p=0;p<c;p++)o[n++]=h[p];for(var d=i.indicesCount,f=0;f<d;f++)l[s++]=u[f]+a}}}},m6=t("ParticleSystem2DAssembler",{getAssembler:function(){return g6.maxParticleDeltaTime||(g6.maxParticleDeltaTime=Xe.game.frameTime/1e3*2),g6}});e6.Assembler=m6,function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(h6||(h6={})),Li(h6),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}(u6||(u6={})),Li(u6),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(c6||(c6={})),Li(c6),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}(p6||(p6={})),Li(p6),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}(d6||(d6={})),Li(d6),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}(f6||(f6={})),Li(f6),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(_6||(_6={})),Li(_6);var y6=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageSize=new wi(0,0),this.tileOffset=new _i(0,0),this._tileSize=new wi(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var i=e||new mi(0,0,0,0);i.width=this._tileSize.width,i.height=this._tileSize.height;var r=t;r&=c6.FLIPPED_MASK,r-=this.firstGid;var n=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));return i.x=Math.round(r%n*(this._tileSize.width+this.spacing)+this.margin),i.y=Math.round(Math.floor(r/n)*(this._tileSize.height+this.spacing)+this.margin),i},t}(),v6=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new Ii(255,255,255,255),this.offset=new _i(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),b6=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new _i(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();b6.ATTRIB_NONE=1,b6.ATTRIB_BASE64=2,b6.ATTRIB_GZIP=4,b6.ATTRIB_ZLIB=8;var S6=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new _i(0,0),this.opacity=0,this.trans=new Ii(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function T6(t){var e=$k.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function A6(t){var e=$k.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function E6(t){if(!t)return new Ii(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,i=parseInt(t.substr(2,2),16)||0,r=parseInt(t.substr(4,2),16)||0,n=parseInt(t.substr(6,2),16)||0;return new Ii(i,r,n,e)}var s=parseInt(t.substr(0,2),16)||0,a=parseInt(t.substr(2,2),16)||0,o=parseInt(t.substr(4,2),16)||0;return new Ii(s,a,o,255)}function C6(t,e){for(var i=[],r=t.getElementsByTagName("properties"),n=0;n<r.length;++n)for(var s=r[n].getElementsByTagName("property"),a=0;a<s.length;++a)i.push(s[a]);e=e||{};for(var o=0;o<i.length;o++){var l=i[o],h=l.getAttribute("name"),u=l.getAttribute("type")||"string",c=l.getAttribute("value");"int"===u?c=parseInt(c):"float"===u?c=parseFloat(c):"bool"===u?c="true"===c:"color"===u&&(c=E6(c)),e[h]=c}return e}var R6,w6,x6,O6,P6,D6,M6,B6,I6,L6,F6,k6,N6,G6,U6,z6,V6=function(){function t(t,e,i,r,n){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=f6.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new wi(0,0),this._tileSize=new wi(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,i,r,n)}var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new wi(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new wi(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,i,r,n){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=i,this._imageLayerSPF=n,this._spfSizeMap=r,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=b6.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,i){var r,n=(new cs).parse(e).documentElement,s=n.getAttribute("orientation"),a=n.getAttribute("staggeraxis"),o=n.getAttribute("staggerindex"),l=n.getAttribute("hexsidelength"),h=n.getAttribute("renderorder"),u=n.getAttribute("version")||"1.0.0";if("map"===n.nodeName){var c=u.split("."),p=this._supportVersion;for(r=0;r<p.length;r++){var d=parseInt(c[r])||0;if(p[r]<d){ji(7216,u);break}}"orthogonal"===s?this.orientation=h6.ORTHO:"isometric"===s?this.orientation=h6.ISO:"hexagonal"===s?this.orientation=h6.HEX:null!==s&&ji(7217,s),this.renderOrder="right-up"===h?f6.RightUp:"left-up"===h?f6.LeftUp:"left-down"===h?f6.LeftDown:f6.RightDown,"x"===a?this.setStaggerAxis(p6.STAGGERAXIS_X):"y"===a&&this.setStaggerAxis(p6.STAGGERAXIS_Y),"odd"===o?this.setStaggerIndex(d6.STAGGERINDEX_ODD):"even"===o&&this.setStaggerIndex(d6.STAGGERINDEX_EVEN),l&&this.setHexSideLength(parseFloat(l));var f=new wi(0,0);f.width=parseFloat(n.getAttribute("width")),f.height=parseFloat(n.getAttribute("height")),this.setMapSize(f),(f=new wi(0,0)).width=parseFloat(n.getAttribute("tilewidth")),f.height=parseFloat(n.getAttribute("tileheight")),this.setTileSize(f),this.properties=C6(n)}var _=n.getElementsByTagName("tileset");for("map"!==n.nodeName&&(_=[]).push(n),r=0;r<_.length;r++){var g=_[r],m=g.getAttribute("source");if(m){var y=parseInt(g.getAttribute("firstgid")),v=this._tsxContentMap[m];v&&this.parseXMLString(v,y)}else{var b=g.getElementsByTagName("image"),S=b.length>1,T=b[0],A=T.getAttribute("source");A=A.replace(/\\/g,"/");var E=g.getElementsByTagName("tile"),C=E&&E.length||1,R=null,w=g.getAttribute("name")||"",x=parseInt(g.getAttribute("spacing"))||0,O=parseInt(g.getAttribute("margin"))||0,P=i||parseInt(g.getAttribute("firstgid"))||0,D=new wi(0,0);D.width=parseFloat(g.getAttribute("tilewidth")),D.height=parseFloat(g.getAttribute("tileheight"));var M=g.getElementsByTagName("tileoffset")[0],B=0,I=0;M&&(B=parseFloat(M.getAttribute("x"))||0,I=parseFloat(M.getAttribute("y"))||0);for(var L=null,F=0;F<C;F++){var k=b[F]?b[F]:T;if(k){var N=k.getAttribute("source");if(N=N.replace(/\\/g,"/"),!L||S){if((L=new y6).name=w,L.firstGid=P&c6.FLIPPED_MASK,L.tileOffset.x=B,L.tileOffset.y=I,L.collection=S,!S&&(L.imageName=N,L.imageSize.width=parseFloat(k.getAttribute("width"))||0,L.imageSize.height=parseFloat(k.getAttribute("height"))||0,L.sourceImage=this._spriteFrameMap[N],!L.sourceImage)){var G=t.getNameWithPostfix(N);if(L.imageName=G,L.sourceImage=this._spriteFrameMap[G],!L.sourceImage){var U=t.getShortName(N);L.imageName=U,L.sourceImage=this._spriteFrameMap[U],L.sourceImage||(console.error("[error]: "+U+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),Ie(7221,N),console.warn("Please try asset type of "+N+" to 'sprite-frame'"))}}L.spacing=x,L.margin=O,L._tileSize.width=D.width,L._tileSize.height=D.height,this.setTilesets(L)}if(R=E&&E[F]){this.parentGID=P+(parseInt(R.getAttribute("id"))||0);var z=R.getElementsByTagName("image");if(z&&z.length>0){var V=z[0],H=V.getAttribute("source");if(H=H.replace(/\\/g,"/"),L.imageName=H,L.imageSize.width=parseFloat(V.getAttribute("width"))||0,L.imageSize.height=parseFloat(V.getAttribute("height"))||0,L._tileSize.width=L.imageSize.width,L._tileSize.height=L.imageSize.height,L.sourceImage=this._spriteFrameMap[H],!L.sourceImage){var W=t.getNameWithPostfix(H);if(L.imageName=W,L.sourceImage=this._spriteFrameMap[W],!L.sourceImage){var X=t.getShortName(H);L.imageName=X,L.sourceImage=this._spriteFrameMap[X],L.sourceImage||(Ie(7221,H),console.warn("Please try asset type of "+H+" to 'sprite-frame'"))}}L.firstGid=this.parentGID&c6.FLIPPED_MASK}var Y=(c6.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(Y,C6(R));var j=R.getElementsByTagName("animation");if(j&&j.length>0){var K=j[0].getElementsByTagName("frame"),q={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(Y,q);for(var Z=q.frames,J=0;J<K.length;J++){var Q=K[J],$=P+(parseInt(Q.getAttribute("tileid"))||0),tt=parseFloat(Q.getAttribute("duration"))||0;Z.push({tileid:$,duration:tt/1e3,grid:null})}}}}}}}var et=n.childNodes;for(r=0;r<et.length;r++){var it=et[r];if(!this._shouldIgnoreNode(it)){if("imagelayer"===it.nodeName){var rt=this._parseImageLayer(it);rt&&this.setImageLayers(rt)}if("layer"===it.nodeName){var nt=this._parseLayer(it);this.setLayers(nt)}if("objectgroup"===it.nodeName){var st=this._parseObjectGroup(it);this.setObjectGroups(st)}}}return n},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var i=new S6;i.name=t.getAttribute("name"),i.offset.x=parseFloat(t.getAttribute("offsetx"))||0,i.offset.y=parseFloat(t.getAttribute("offsety"))||0;var r=t.getAttribute("visible");i.visible=!("0"===r);var n=t.getAttribute("opacity");i.opacity=n?Math.round(255*parseFloat(n)):255;var s=t.getAttribute("tintcolor");i.tintColor=s?E6(s):null;var a=e[0],o=a.getAttribute("source");return i.sourceImage=this._imageLayerSPF[o],i.width=parseInt(a.getAttribute("width"))||0,i.height=parseInt(a.getAttribute("height"))||0,i.trans=E6(a.getAttribute("trans")),i.sourceImage?i:(Ie(7221,o),console.warn("Please try asset type of "+o+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],i=new b6;i.name=t.getAttribute("name");var r=new wi(0,0);r.width=parseFloat(t.getAttribute("width")),r.height=parseFloat(t.getAttribute("height")),i.layerSize=r;var n=t.getAttribute("visible");i.visible=!("0"===n);var s=t.getAttribute("opacity");i.opacity=s?Math.round(255*parseFloat(s)):255,i.offset=new _i(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var a=t.getAttribute("tintcolor");i.tintColor=a?E6(a):null;for(var o="",l=0;l<e.childNodes.length;l++)o+=e.childNodes[l].nodeValue;o=o.trim();var h,u=e.getAttribute("compression"),c=e.getAttribute("encoding");if(u&&"gzip"!==u&&"zlib"!==u)return ji(7218),null;switch(u){case"gzip":h=G4.unzipBase64AsArray(o,4);break;case"zlib":h=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,i=window.Uint32Array?new Uint32Array(e):[],r=0;r<e;r++){var n=4*r;i[r]=t[n]+256*t[n+1]+65536*t[n+2]+t[n+3]*(1<<24)}return i}(new z5.Inflate(G4.Base64.decodeAsArray(o,1)).decompress());break;case null:case"":if("base64"===c)h=G4.Base64.decodeAsArray(o,4);else if("csv"===c){h=[];for(var p=o.split(","),d=0;d<p.length;d++)h.push(parseInt(p[d]))}else{var f=e.getElementsByTagName("tile");h=[];for(var _=0;_<f.length;_++)h.push(parseInt(f[_].getAttribute("gid")))}break;default:this.layerAttrs===b6.ATTRIB_NONE&&ji(7219)}return h&&(i.tiles=new Uint32Array(h)),i.properties=C6(t),i},e._parseObjectGroup=function(t){var e=new v6;e.name=t.getAttribute("name")||"",e.offset=new _i(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var i=t.getAttribute("opacity");e.opacity=i?Math.round(255*parseFloat(i)):255;var r=t.getAttribute("tintcolor");e.tintColor=r?E6(r):null;var n=t.getAttribute("visible");n&&0===parseInt(n)&&(e.visible=!1);var s=t.getAttribute("color");s&&e.color.fromHEX(s);var a=t.getAttribute("draworder");a&&(e.draworder=a),e.setProperties(C6(t));var o=t.getElementsByTagName("object");if(o){for(var l=0;l<o.length;l++){var h=o[l],u={};u.id=h.getAttribute("id")||l,u.name=h.getAttribute("name")||"",u.width=parseFloat(h.getAttribute("width"))||0,u.height=parseFloat(h.getAttribute("height"))||0,u.x=parseFloat(h.getAttribute("x"))||0,u.y=parseFloat(h.getAttribute("y"))||0,u.rotation=parseFloat(h.getAttribute("rotation"))||0,C6(h,u);var c=h.getAttribute("visible");u.visible=!(c&&0===parseInt(c));var p=h.getElementsByTagName("text");if(p&&p.length>0){var d=p[0];u.type=_6.TEXT,u.wrap="1"===d.getAttribute("wrap"),u.color=E6(d.getAttribute("color")),u.halign=T6(d.getAttribute("halign")),u.valign=A6(d.getAttribute("valign")),u.pixelsize=parseInt(d.getAttribute("pixelsize"))||16,u.text=d.childNodes[0].nodeValue}var f=h.getAttribute("gid");f&&(u.gid=parseInt(f),u.type=_6.IMAGE);var _=h.getElementsByTagName("ellipse");_&&_.length>0&&(u.type=_6.ELLIPSE);var g=h.getElementsByTagName("polygon");if(g&&g.length>0){u.type=_6.POLYGON;var m=g[0].getAttribute("points");m&&(u.points=this._parsePointsString(m))}var y=h.getElementsByTagName("polyline");if(y&&y.length>0){u.type=_6.POLYLINE;var v=y[0].getAttribute("points");v&&(u.polylinePoints=this._parsePointsString(v))}u.type||(u.type=_6.RECT),e.objects.push(u)}"index"!==a&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],i=t.split(" "),r=0;r<i.length;r++){var n=i[r].split(",");e.push({x:parseFloat(n[0]),y:parseFloat(n[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getNameWithPostfix=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.length;return t.substring(e,i)},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,i=t.lastIndexOf(".");return i=i<0?t.length:i,t.substring(e,i)},Be(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}},{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),H6=t("TiledTile",(R6=Ze("cc.TiledTile"),w6=ai(),x6=oi(),O6=xi(Ml),P6=si(ps),D6=si(ps),M6=si(ps),B6=si(ps),I6=si(ps),R6(L6=w6(L6=x6(L6=O6(L6=vi((G6=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,$e(e,"_x",k6,ti(e)),$e(e,"_y",N6,ti(e)),e}Me(e,t);var i=e.prototype;return i.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this._resetTile(),this.updateInfo()},i.onDisable=function(){this._resetTile()},i._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},i.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))We("There is already a TiledTile at [%s, %s]",t,e);else{var i=this._layer.getPositionAt(t,e);this.node.setPosition(i.x,i.y),this._layer.setTiledTileAt(t,e,this)}}},Be(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?We("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?We("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}(ui),k6=je((F6=G6).prototype,"_x",[P6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),N6=je(F6.prototype,"_y",[D6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),je(F6.prototype,"x",[M6],Object.getOwnPropertyDescriptor(F6.prototype,"x"),F6.prototype),je(F6.prototype,"y",[B6],Object.getOwnPropertyDescriptor(F6.prototype,"y"),F6.prototype),je(F6.prototype,"grid",[I6],Object.getOwnPropertyDescriptor(F6.prototype,"grid"),F6.prototype),L6=F6))||L6)||L6)||L6)||L6)||L6));function W6(t,e,i){var r=i||t.sourceImage,n=r.texture,s=t.collection;if(!t.imageSize.width||!t.imageSize.height){var a=t.sourceImage;t.imageSize.width=a.width,t.imageSize.height=a.height}var o=t.imageSize.width,l=t.imageSize.height,h=t._tileSize.width,u=t._tileSize.height,c=r.width,p=r.height,d=t.spacing,f=t.margin,_=1;if(!s){var g=Math.floor((o-2*f+d)/(h+d)),m=Math.floor((l-2*f+d)/(u+d));_=Math.max(1,m*g)}for(var y=t.firstGid,v=null,b=!!e.get(y),S=t.firstGid+_,T=y;T<S&&(b&&!e.get(T)&&(b=!1),b||!e.get(T));++T){if(v={tileset:t,x:0,y:0,width:h,height:u,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:T,spriteFrame:r,texture:n},t.rectForGID(T,v),!i||_>1)if(i){v._name=i.name;var A=i.unbiasUV[0],E=i.rotated?i.unbiasUV[1]:i.unbiasUV[5];v.l=A+(v.x+.5)/c,v.t=E+(v.y+.5)/p,v.r=A+(v.x+v.width-.5)/c,v.b=E+(v.y+v.height-.5)/p,v._rect=new mi(v.x,v.y,v.width,v.height)}else v.l=v.x/c,v.t=v.y/p,v.r=(v.x+v.width)/c,v.b=(v.y+v.height)/p,v._rect=new mi(v.x,v.y,v.width,v.height);else i.rotated?(v._rotated=!0,v._name=i.name,v._rect=i.getRect(),v.l=i.unbiasUV[0],v.t=i.unbiasUV[1],v.r=i.unbiasUV[4],v.b=i.unbiasUV[3]):(v._name=i.name,v._rect=i.getRect(),v.l=i.unbiasUV[0],v.t=i.unbiasUV[5],v.r=i.unbiasUV[2],v.b=i.unbiasUV[1]);v.cx=(v.l+v.r)/2,v.cy=(v.t+v.b)/2,e.set(T,v)}}function X6(t,e){var i=t.length;if(0!==i)for(var r=0,n=function(){++r>=i&&e()},s=0;s<i;s++){var a=t[s];a.loaded?n():a.once("load",(function(){n()}))}else e()}for(var Y6,j6,K6,q6,Z6,J6,Q6,$6,t7,e7,i7,r7,n7,s7,a7,o7,l7,h7,u7,c7,p7,d7,f7,_7,g7,m7,y7,v7,b7,S7,T7,A7,E7,C7,R7,w7,x7,O7,P7,D7=new gi,M7=new _i,B7=new Si,I7=new Si,L7={row:0,col:0},F7=t("TiledUserNodeData",Ze("cc.TiledUserNodeData")(U6=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return Me(e,t),e}(ui))||U6),k7=t("TiledLayer",Ze("cc.TiledLayer")(z6=function(t){function e(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._meshRenderDataArray=null,e._meshRenderDataArrayIdx=0,e}Me(e,t);var i=e.prototype;return i.hasTiledNode=function(){return this._hasTiledNodeGrid},i.hasAnimation=function(){return this._hasAniGrid},i.addUserNode=function(t){var e=t.getComponent(F7);return e?(We("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(F7),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),M7),this._positionToRowCol(M7.x,M7.y,L7),this._addUserNodeToGrid(e,L7),this._updateCullingOffsetByUserNode(t),t.on(bi.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(bi.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},i.removeUserNode=function(t){var e=t.getComponent(F7);return e?(t.off(bi.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(bi.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(We("CCTiledLayer:removeUserNode node is not exist"),!1)},i.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},i._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},i.getNodesByRowCol=function(t,e){var i=this._userNodeGrid[t];return i?i[e]:null},i.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},i._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),M7),this._positionToRowCol(M7.x,M7.y,L7),this._addUserNodeToGrid(e,L7),this._updateCullingOffsetByUserNode(e.node)}},i._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},i._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},i._userNodePosChange=function(){var t=this,e=t.node,i=t._tiledLayer;i._nodeLocalPosToLayerPos(e.getPosition(),M7),i._positionToRowCol(M7.x,M7.y,L7),i._limitInLayer(L7),L7.row===t._row&&L7.col===t._col||(i._removeUserNodeFromGrid(t),i._addUserNodeToGrid(t,L7))},i._removeUserNodeFromGrid=function(t){var e=t._row,i=t._col,r=t._index,n=this._userNodeGrid[e],s=n&&n[i];s&&(n.count--,s.count--,s.list[r]=null,s.count<=0&&(s.list.length=0,s.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},i._limitInLayer=function(t){var e=t.row,i=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),i<0&&(t.col=0),i>this._rightTop.col&&(t.col=this._rightTop.col)},i._addUserNodeToGrid=function(t,e){var i=e.row,r=e.col,n=this._userNodeGrid[i]=this._userNodeGrid[i]||{count:0},s=n[r]=n[r]||{count:0,list:[]};t._row=i,t._col=r,t._index=s.list.length,n.count++,s.count++,s.list.push(t),this._userNodeDirty=!0},i.isUserNodeDirty=function(){return this._userNodeDirty},i.setUserNodeDirty=function(t){this._userNodeDirty=t},i.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(bi.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(bi.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(bi.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(bi.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(bi.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.parent.off(bi.SIZE_CHANGED,this.updateCulling,this),this.node.parent.off(bi.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(bi.SIZE_CHANGED,this.updateCulling,this),this.node.off(bi.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(bi.ANCHOR_CHANGED,this._syncAnchorPoint,this)},i._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,i=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*i.x,this._leftDownToCenterY=e.height*e.anchorY*i.y,this._cullingDirty=!0,this.markForUpdateRenderData()},i.onDestroy=function(){t.prototype.onDestroy.call(this)},i.getLayerName=function(){return this._layerName},i.setLayerName=function(t){this._layerName=t},i.getProperty=function(t){return this._properties[t]},i.getPositionAt=function(t,e){var i;switch(void 0!==e?(i=Math.floor(t),e=Math.floor(e)):(i=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case h6.ORTHO:return this._positionForOrthoAt(i,e);case h6.ISO:return this._positionForIsoAt(i,e);case h6.HEX:return this._positionForHexAt(i,e)}return null},i.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},i._positionForIsoAt=function(t,e){var i=0,r=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=this.tiles[n];if(s){var a=(s&c6.FLIPPED_MASK)>>>0,o=this.texGrids.get(a).tileset.tileOffset;i=o.x,r=o.y}return new _i(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+i,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-r)},i._positionForOrthoAt=function(t,e){var i=0,r=0,n=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=this.tiles[n];if(s){var a=(s&c6.FLIPPED_MASK)>>>0,o=this.texGrids.get(a).tileset.tileOffset;i=o.x,r=o.y}return new _i(t*this._mapTileSize.width+i,(this._layerSize.height-e-1)*this._mapTileSize.height-r)},i._positionForHexAt=function(t,e){var i,r=this._mapTileSize.width,n=this._mapTileSize.height,s=this._layerSize.height,a=Math.floor(t)+Math.floor(e)*this._layerSize.width,o=(this.tiles[a]&c6.FLIPPED_MASK)>>>0;i=this.texGrids.get(o)?this.texGrids.get(o).tileset.tileOffset:{x:0,y:0};var l=this._staggerIndex===d6.STAGGERINDEX_ODD?1:-1,h=0,u=0,c=0,p=0;switch(this._staggerAxis){case p6.STAGGERAXIS_Y:c=0,e%2==1&&(c=r/2*l),h=t*r+c+i.x,u=(s-e-1)*(n-(n-this._hexSideLength)/2)-i.y;break;case p6.STAGGERAXIS_X:p=0,t%2==1&&(p=n/2*-l),h=t*(r-(r-this._hexSideLength)/2)+i.x,u=(s-e-1)*n+p-i.y}return new _i(h,u)},i.setTilesGIDAt=function(t,e,i,r){if(t&&0!==t.length&&!(r<=0)){i<0&&(i=0),e<0&&(e=0);for(var n=0,s=e+r,a=i;;a++)for(var o=e;o<s;o++){if(n>=t.length)return;this._updateTileForGID(t[n],o,a),n++}}},i.setTileGIDAt=function(t,e,i,r){var n=(t&c6.FLIPPED_MASK)>>>0;if(e=Math.floor(e),i=Math.floor(i),this.isInvalidPosition(e,i))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==n&&n<this._tilesets[0].firstGid?ji(7239,t):(r=r||0,this._updateTileForGID((n|r)>>>0,e,i)):ji(7238)},i._updateTileForGID=function(t,e,i){var r=0|e+i*this._layerSize.width;if(!(r>=this.tiles.length)&&t!==this.tiles[r]){var n=(t&c6.FLIPPED_MASK)>>>0;this.texGrids.get(n)?(this.tiles[r]=t,this._updateVertex(e,i)):this.tiles[r]=0,this._cullingDirty=!0}},i.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return ji(7237),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&c6.FLIPPED_MASK)>>>0},i.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return ji(7240),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[i]&c6.FLIPPED_ALL)>>>0},i.setCullingDirty=function(t){this._cullingDirty=t},i.isCullingDirty=function(){return this._cullingDirty},i.updateViewPort=function(t,e,i,r){if(this._viewPort.width!==i||this._viewPort.height!==r||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=i,this._viewPort.height=r;var n=1;this._layerOrientation===h6.ISO&&(n=2);var s=this._viewPort.x-this._offset.x+this._leftDownToCenterX,a=this._viewPort.y-this._offset.y+this._leftDownToCenterY,o=s-this._leftOffset,l=a-this._downOffset,h=s+i+this._rightOffset,u=a+r+this._topOffset,c=this._cullingRect.leftDown,p=this._cullingRect.rightTop;o<0&&(o=0),l<0&&(l=0),this._positionToRowCol(o,l,L7),L7.row-=n,L7.col-=n,L7.row=L7.row>0?L7.row:0,L7.col=L7.col>0?L7.col:0,L7.row===c.row&&L7.col===c.col||(c.row=L7.row,c.col=L7.col,this._cullingDirty=!0),h<0||u<0?(L7.row=-1,L7.col=-1):(this._positionToRowCol(h,u,L7),L7.row++,L7.col++),L7.row>this._rightTop.row&&(L7.row=this._rightTop.row),L7.col>this._rightTop.col&&(L7.col=this._rightTop.col),L7.row===p.row&&L7.col===p.col||(p.row=L7.row,p.col=L7.col,this._cullingDirty=!0,this.markForUpdateRenderData())}},i._positionToRowCol=function(t,e,i){var r=this._mapTileSize.width,n=this._mapTileSize.height,s=.5*r,a=.5*n,o=0,l=0,h=0,u=0,c=this._staggerAxis;switch(this._layerOrientation){case h6.ORTHO:l=Math.floor(t/r),o=Math.floor(e/n);break;case h6.ISO:l=Math.floor(t/s),o=Math.floor(e/a);break;case h6.HEX:c===p6.STAGGERAXIS_Y?(h=(o=Math.floor(e/(n-this._diffY1)))%2==1?s*this._odd_even:0,l=Math.floor((t-h)/r)):(u=(l=Math.floor(t/(r-this._diffX1)))%2==1?a*-this._odd_even:0,o=Math.floor((e-u)/n))}return i.row=o,i.col=l,i},i.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),gi.invert(D7,this.node.getWorldMatrix());var t=Ai.root.batcher2D.getFirstRenderCamera(this.node);t&&(B7.x=0,B7.y=0,B7.z=0,I7.x=t.width,I7.y=t.height,I7.z=0,t.screenToWorld(B7,B7),t.screenToWorld(I7,I7),Si.transformMat4(B7,B7,D7),Si.transformMat4(I7,I7,D7),this.updateViewPort(B7.x,B7.y,I7.x-B7.x,I7.y-B7.y))}},i.getLayerOrientation=function(){return this._layerOrientation},i.getProperties=function(){return this._properties},i._updateVertex=function(t,e){var i=c6.FLIPPED_MASK,r=this.vertices,n=this._layerOrientation,s=this.tiles;if(s){var a,o,l,h,u=this._rightTop,c=this._mapTileSize.width,p=this._mapTileSize.height,d=.5*c,f=.5*p,_=this._layerSize.height,g=this._layerSize.width,m=this.texGrids,y=0,v=0;n===h6.HEX&&(a=this._staggerAxis,o=this._diffX1,l=this._diffY1,h=this._odd_even);var b,S,T,A=0,E=0,C=0,R=0,w=e*g+t;b=(s[w]&i)>>>0;var x=m.get(b);if(x){switch(this._animations.get(b)&&(this._hasAniGrid=this._hasAniGrid||!0),n){case h6.ORTHO:y=(A=t)*c,v=(E=_-e-1)*p;break;case h6.ISO:y=d*(A=_+t-e-1),v=f*(E=_+g-t-e-2);break;case h6.HEX:y=t*(c-o)+(a===p6.STAGGERAXIS_Y&&e%2==1?d*h:0),v=(_-e-1)*(p-l)+(a===p6.STAGGERAXIS_X&&t%2==1?f*-h:0),A=t,E=_-e-1}var O=r[E]=r[E]||{minCol:0,maxCol:0},P=O[A]=O[A]||{};O.minCol>A&&(O.minCol=A),O.maxCol<A&&(O.maxCol=A),u.row<E&&(u.row=E),u.col<A&&(u.col=A);var D=x.tileset.tileOffset;y+=this._offset.x+D.x+x.offsetX,v+=this._offset.y-D.y-x.offsetY,C=(C=-D.y+x.tileset._tileSize.height-p)<0?0:C,S=D.y<0?0:D.y,T=-D.x<0?0:-D.x,R=(R=D.x+x.tileset._tileSize.width-c)<0?0:R,this._rightOffset<T&&(this._rightOffset=T),this._leftOffset<R&&(this._leftOffset=R),this._topOffset<S&&(this._topOffset=S),this._downOffset<C&&(this._downOffset=C),P.left=y,P.bottom=v,P.index=w,this._cullingDirty=!0}}},i._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,i=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var r=0;r<e;++r)for(var n=0;n<i;++n)this._updateVertex(n,r);this._verticesDirty=!1}},i.getTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return ji(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width,n=this.tiledTiles[r];if(!n&&i){var s=new Yr;return(n=s.addComponent(H6))._x=t,n._y=e,n._layer=this,n.updateInfo(),s.parent=this.node,n}return n},i.setTiledTileAt=function(t,e,i){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return ji(7236),null;var r=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[r]=i,this._cullingDirty=!0,this._hasTiledNodeGrid=!!i||this.tiledTiles.some((function(t){return!!t})),i},i.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},i.getTextures=function(){return this._textures},i.setTexture=function(t){this.setTextures([t])},i.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},i.getLayerSize=function(){return this._layerSize},i.getMapTileSize=function(){return this._mapTileSize},i.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},i.getTileSets=function(){return this._tilesets},i.setTileSet=function(t){this.setTileSets([t])},i.setTileSets=function(t){var e=this;this._tilesets=t;var i=this._textures=[],r=this.texGrids;r.clear();for(var n=0;n<t.length;n++){var s=t[n];s&&(i[n]=s.sourceImage)}X6(i,(function(){for(var i=0,n=t.length;i<n;++i){var s=t[i];s&&W6(s,r,s.sourceImage)}e._prepareToRender()}))},i.init=function(t,e,i,r,n){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var s=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=s,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=i,this._textures=r,this.texGrids=n,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var a=this._mapTileSize.width,o=this._mapTileSize.height,l=this._layerSize.width,h=this._layerSize.height;if(this._layerOrientation===h6.HEX){var u=0,c=0;this._odd_even=this._staggerIndex===d6.STAGGERINDEX_ODD?1:-1,this._staggerAxis===p6.STAGGERAXIS_X?(this._diffX1=(a-this._hexSideLength)/2,this._diffY1=0,c=o*(h+.5),u=(a+this._hexSideLength)*Math.floor(l/2)+a*(l%2)):(this._diffX1=0,this._diffY1=(o-this._hexSideLength)/2,u=a*(l+.5),c=(o+this._hexSideLength)*Math.floor(h/2)+o*(h%2)),this.node._uiProps.uiTransformComp.setContentSize(u,c)}else if(this._layerOrientation===h6.ISO){var p=l+h;this.node._uiProps.uiTransformComp.setContentSize(.5*a*p,.5*o*p)}else this.node._uiProps.uiTransformComp.setContentSize(l*a,h*o);this._offset=new _i(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},i._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},i.requestMeshRenderData=function(){var t=this;this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var e=this._meshRenderDataArray;e.length>0&&e[e.length-1].subNodes&&0===e[e.length-1].subNodes.length;)e.pop();if(e.length>0){var i=e[e.length-1];if(i.renderData&&0===i.renderData.byteCount)return i}var r=new Sh,n={renderData:r,texture:null};return Object.defineProperty(r,"material",{get:function(){return t.getRenderMaterial(0)}}),this._meshRenderDataArray.push(n),n},i.requestSubNodesData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var t=this._meshRenderDataArray;t.length>0&&t[t.length-1].renderData&&0===t[t.length-1].renderData.byteCount;)t.pop();if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._meshRenderDataArray.push(e),e},i.destroyRenderData=function(){this._meshRenderDataArray&&(this._meshRenderDataArray.forEach((function(t){t.renderData&&t.renderData.reset()})),this._meshRenderDataArray.length=0)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._meshRenderDataArray||this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},i._render=function(t){if(this._meshRenderDataArray){for(var e=0;e<this._meshRenderDataArray.length;e++){this._meshRenderDataArrayIdx=e;var i=this._meshRenderDataArray[e];i.subNodes?i.subNodes.forEach((function(e){e&&t.walk(e.node)})):i.texture&&t.commitComp(this,i.texture,this._assembler,null)}this.node._static=!0}},Be(e,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this.markForUpdateRenderData())}}]),e}(Ch))||z6),N7=t("TiledObjectGroup",(Y6=Ze("cc.TiledObjectGroup"),j6=ai(),K6=xi(Ml),q6=si(ds),Y6(Z6=j6(Z6=K6((Q6=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}Me(e,t);var i=e.prototype;return i.getPositionOffset=function(){return this._positionOffset},i.getProperties=function(){return this._properties},i.getGroupName=function(){return this._groupName},i.getProperty=function(t){return this._properties[t.toString()]},i.getObject=function(t){for(var e=0,i=this._objects.length;e<i;e++){var r=this._objects[e];if(r&&r.name===t)return r}return null},i.getObjects=function(){return this._objects},i._init=function(t,e,i){var r=c6.FLIPPED_MASK,n=c6.HORIZONTAL,s=c6.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new _i(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=i,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var a=e.mapSize,o=e.tileSize,l=0,h=0,u=new Ii,c=h6.ISO===e.orientation;if(e.orientation===h6.HEX)e.getStaggerAxis()===p6.STAGGERAXIS_X?(h=o.height*(a.height+.5),l=(o.width+e.getHexSideLength())*Math.floor(a.width/2)+o.width*(a.width%2)):(l=o.width*(a.width+.5),h=(o.height+e.getHexSideLength())*Math.floor(a.height/2)+o.height*(a.height%2));else if(c){var p=a.width+a.height;l=.5*o.width*p,h=.5*o.height*p}else l=a.width*o.width,h=a.height*o.height;var d=this.node._uiProps.uiTransformComp;d.setContentSize(l,h);for(var f=l*d.anchorX,_=h*(1-d.anchorY),g=t.objects,m={},y=0,v=g.length;y<v;y++){var b=g[y],S=b.type;b.offset=new _i(b.x,b.y);var T=b.points||b.polylinePoints;if(T)for(var A=0;A<T.length;A++)T[A].y*=-1;if(c){var E=b.x/o.height,C=b.y/o.height;b.x=.5*o.width*(a.height+E-C),b.y=.5*o.height*(a.width+a.height-E-C)}else b.y=h-b.y;if(S===_6.TEXT){var R="text"+b.id;m[R]=!0;var x=this.node.getChildByName(R);x||(x=new Yr),x.setRotationFromEuler(0,0,-b.rotation),x.setPosition(b.x-f,b.y-_),x.name=R,x.parent=this.node,x.setSiblingIndex(y);var O=x.getComponent($k);O||(O=x.addComponent($k));var P=x._uiProps.uiTransformComp;x.active=b.visible,P.anchorX=0,P.anchorY=1,this._tintColor?(u.set(this._tintColor),u.a*=this._opacity/255,O.color.set(u)):O.color.a*=this._opacity/255,O.overflow=$k.Overflow.SHRINK,O.lineHeight=b.height,O.string=b.text,O.horizontalAlign=b.halign,O.verticalAlign=b.valign,O.fontSize=b.pixelsize,P.setContentSize(b.width,b.height)}else if(S===_6.IMAGE){var D=b.gid,M=(D&r)>>>0,B=i.get(M);if(!B)continue;var I=B.tileset,L="img"+b.id;m[L]=!0;var F=this.node.getChildByName(L);b.width=b.width||B.width,b.height=b.height||B.height,F&&F._objFlags&Ki.Flags.HideInHierarchy&&(F.removeFromParent(),F.hideFlags|=Ki.Flags.DontSave,F.destroy(),F=null),F||(F=new Yr),this._animations.get(M)&&(this.aniObjects.push({object:b,imgNode:F,gridGID:M}),this._hasAniObj=!0);var k=I.tileOffset.x,N=I.tileOffset.y;F.active=b.visible,F.setRotationFromEuler(0,0,-b.rotation),F.setPosition(b.x-f,b.y-_),F.name=L,F.parent=this.node,F.setSiblingIndex(y);var G=F.getComponent(lz);G||(G=F.addComponent(lz));var U=F._uiProps.uiTransformComp;c?(U.anchorX=.5+k/b.width,U.anchorY=N/b.height):(U.anchorX=k/b.width,U.anchorY=N/b.height),this._tintColor?(u.set(this._tintColor),u.a*=this._opacity/255,G.color.set(u)):G.color.a*=this._opacity/255,G.sizeMode=lz.SizeMode.CUSTOM,G._srcBlendFactor=this._premultiplyAlpha?w.ONE:w.SRC_ALPHA,G._dstBlendFactor=w.ONE_MINUS_SRC_ALPHA,G._updateBlendFunc();var z=B.spriteFrame;z=z?z.clone():new KL,(D&n)>>>0&&(z.flipUVX=!z.flipUVX),(D&s)>>>0&&(z.flipUVY=!z.flipUVY),z.rotated=B._rotated,z.rect=B._rect,G.spriteFrame=z,U.setContentSize(b.width,b.height),G.markForUpdateRenderData()}}this._objects=g;for(var V=this.node.children,H=/^(?:img|text)\d+$/,W=0,X=V.length;W<X;W++){var Y=V[W],j=Y.name;H.test(j)&&!m[j]&&Y.destroy()}},i.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,i=h6.ISO===this._mapInfo.orientation,r=0,n=t.length;r<n;r++){var s=t[r],a=s.gridGID,o=e.get(a);if(o){var l=o.tileset,h=s.object,u=s.imgNode,c=l.tileOffset.x,p=l.tileOffset.y,d=u._uiProps.uiTransformComp;i?(d.anchorX=.5+c/h.width,d.anchorY=p/h.height):(d.anchorX=c/h.width,d.anchorY=p/h.height);var f=u.getComponent(lz),_=f.spriteFrame;_.rotated=o._rotated,_.rect=o._rect,f.spriteFrame=_,f.markForUpdateRenderData()}}},Be(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}(ui),je((J6=Q6).prototype,"premultiplyAlpha",[q6],Object.getOwnPropertyDescriptor(J6.prototype,"premultiplyAlpha"),J6.prototype),Z6=J6))||Z6)||Z6)||Z6)),G7=t("TiledMapAsset",($6=Ze("cc.TiledMapAsset"),t7=si([fs]),e7=si([Tr]),i7=si([KL]),r7=si([KL]),n7=si([Tr]),s7=si([Tr]),a7=si([wi]),$6((m7=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,$e(e,"tmxXmlStr",h7,ti(e)),$e(e,"tsxFiles",u7,ti(e)),$e(e,"tsxFileNames",c7,ti(e)),$e(e,"spriteFrames",p7,ti(e)),$e(e,"imageLayerSpriteFrame",d7,ti(e)),$e(e,"imageLayerSpriteFrameNames",f7,ti(e)),$e(e,"spriteFrameNames",_7,ti(e)),$e(e,"spriteFrameSizes",g7,ti(e)),e}return Me(e,t),e}(Je),h7=je((l7=m7).prototype,"tmxXmlStr",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),u7=je(l7.prototype,"tsxFiles",[ei,t7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),c7=je(l7.prototype,"tsxFileNames",[ei,e7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),p7=je(l7.prototype,"spriteFrames",[ei,i7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),d7=je(l7.prototype,"imageLayerSpriteFrame",[ei,r7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f7=je(l7.prototype,"imageLayerSpriteFrameNames",[ei,n7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_7=je(l7.prototype,"spriteFrameNames",[ei,s7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),g7=je(l7.prototype,"spriteFrameSizes",[ei,a7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o7=l7))||o7)),U7=(t("TiledMap",(y7=Ze("cc.TiledMap"),v7=ai(),b7=oi(),S7=xi(Ml),T7=si(G7),A7=Ri(),y7(E7=v7(E7=b7(E7=S7(E7=vi((P7=O7=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new wi(0,0),e._tileSize=new wi(0,0),e._preloaded=!1,e._mapOrientation=h6.ORTHO,$e(e,"_tmxFile",R7,ti(e)),$e(e,"_enableCulling",w7,ti(e)),$e(e,"cleanupImageCache",x7,ti(e)),e}Me(e,t);var i=e.prototype;return i.getMapSize=function(){return this._mapSize},i.getTileSize=function(){return this._tileSize},i.getMapOrientation=function(){return this._mapOrientation},i.getObjectGroups=function(){return this._groups},i.getObjectGroup=function(t){for(var e=this._groups,i=0,r=e.length;i<r;i++){var n=e[i];if(n&&n.getGroupName()===t)return n}return null},i.getProperties=function(){return this._properties},i.getLayers=function(){return this._layers},i.getLayer=function(t){for(var e=this._layers,i=0,r=e.length;i<r;i++){var n=e[i];if(n&&n.getLayerName()===t)return n}return null},i._changeLayer=function(t,e){for(var i=this._layers,r=0,n=i.length;r<n;r++){var s=i[r];if(s&&s.getLayerName()===t)return void(i[r]=e)}},i.getProperty=function(t){return this._properties[t.toString()]},i.getPropertiesForGID=function(t){return this._tileProperties.get(t)},i.__preload=function(){this._preloaded=!0,this._tmxFile&&this._applyFile()},i.onEnable=function(){this.node.on(bi.ANCHOR_CHANGED,this._syncAnchorPoint,this)},i.onDisable=function(){this.node.off(bi.ANCHOR_CHANGED,this._syncAnchorPoint,this)},i._applyFile=function(){var t=[],e={},i=this._tmxFile;if(i){for(var r=i.spriteFrameNames,n=i.spriteFrameSizes,s=i.spriteFrames,a={},o={},l=0;l<r.length;++l){var h=r[l];o[h]=n[l],t[l]=s[l];var u=t[l];u&&(e[u.name]=u,a[h]=u)}var c={},p=i.imageLayerSpriteFrame;r=i.imageLayerSpriteFrameNames;for(var d=0;d<p.length;++d)c[r[d]]=p[d];for(var f=i.tsxFileNames,_=i.tsxFiles,g={},m=0;m<f.length;++m)f[m].length>0&&(g[f[m]]=_[m].text);var y=new V6(i.tmxXmlStr,g,a,o,c),v=y.getTilesets();v&&0!==v.length||ji(7241),this._buildWithMapInfo(y)}else this._releaseMapInfo()},i._releaseMapInfo=function(){for(var t=this._layers,e=0,i=t.length;e<i;e++)t[e].node.removeFromParent(),t[e].node.destroy();t.length=0;for(var r=this._groups,n=0,s=r.length;n<s;n++)r[n].node.removeFromParent(),r[n].node.destroy();r.length=0;for(var a=this._images,o=0,l=a.length;o<l;o++)a[o].removeFromParent(),a[o].destroy();a.length=0},i._syncAnchorPoint=function(){var t,e,i=this.node._uiProps.uiTransformComp.anchorPoint,r=this.node._uiProps.uiTransformComp.width*i.x,n=this.node._uiProps.uiTransformComp.height*(1-i.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(i);for(t=0,e=this._groups.length;t<e;t++){var s=this._groups[t],a=s.node._uiProps.uiTransformComp;a.anchorX=.5,a.anchorY=.5;var o=s.offset.x-r+a.width*a.anchorX,l=s.offset.y+n-a.height*a.anchorY;s.node.setPosition(o,l)}for(t=0,e=this._images.length;t<e;t++){var h=this._images[t]._uiProps.uiTransformComp;h.anchorX=.5,h.anchorY=.5;var u=this._images[t]._offset.x-r+h.width*h.anchorX,c=this._images[t]._offset.y+n-h.height*h.anchorY;this._images[t].setPosition(u,c)}},i._fillAniGrids=function(t,e){for(var i,r=ke(e.keys());!(i=r()).done;){var n=i.value,s=e.get(n);if(s)for(var a=s.frames,o=0;o<a.length;o++){var l=a[o];l.grid=t.get(l.tileid)}}},i._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,i=this._animations;e.clear();for(var r=0,n=t.length;r<n;++r){var s=t[r];s&&(s.sourceImage?W6(s,e,s.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+r))}this._fillAniGrids(e,i);for(var a=this._layers,o=this._groups,l=this._images,h={},u=0,c=a.length;u<c;u++)h[a[u].node.name]=!0;for(var p=0,d=o.length;p<d;p++)h[o[p].node.name]=!0;for(var f=0,_=l.length;f<_;f++)h[l[f].name]=!0;a=this._layers=[],o=this._groups=[],l=this._images=[];var g=this._mapInfo,m=this.node,y=g.getAllChildren(),v=this._textures,b=0,S=0;if(y&&y.length>0)for(var T=0,A=y.length;T<A;T++){var E=y[T],C=E.name,R=this.node.getChildByName(C);if(h[C]=!1,R||((R=new Yr).name=C,R.layer=m.layer,m.addChild(R)),R.setSiblingIndex(T),R.active=E.visible,E instanceof b6){var w=R.getComponent(k7);w||(w=R.addComponent(k7)),w.init(E,g,t,v,e),w.enableCulling=this._enableCulling,E.ownTiles=!1,a.push(w)}else if(E instanceof v6){var x=R.getComponent(N7);x||(x=R.addComponent(N7)),x._init(E,g,e),o.push(x)}else if(E instanceof S6){var O=E.sourceImage;R.layerInfo=E,R._offset=new _i(E.offset.x,-E.offset.y);var P=R.getComponent(lz);P||(P=R.addComponent(lz)),P.color.a*=E.opacity,P.spriteFrame=O,R._uiProps.uiTransformComp.setContentSize(O.width,O.height),l.push(R)}b=Math.max(b,R._uiProps.uiTransformComp.width),S=Math.max(S,R._uiProps.uiTransformComp.height)}for(var D=m.children,M=0,B=D.length;M<B;M++){var I=D[M];h[I.name]&&I.destroy()}this.node._uiProps.uiTransformComp.setContentSize(b,S),this._syncAnchorPoint()},i._buildWithMapInfo=function(t){var e=this;this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var i=this._tilesets;this._textures.length=0;for(var r=[],n=0,s=i.length;n<s;++n){var a=i[n];a&&a.sourceImage&&(this._textures[n]=a.sourceImage,r.push(a.sourceImage))}for(var o=0;o<this._imageLayers.length;o++){var l=this._imageLayers[o];l&&l.sourceImage&&r.push(l.sourceImage)}X6(r,(function(){e._buildLayerAndGroup(),e.cleanupImageCache&&e._textures.forEach((function(t){e.doCleanupImageCache(t)}))}))},i.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":Ue.capabilities.imageBitmap&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},i.update=function(t){for(var e,i=this._animations,r=this._texGrids,n=ke(i.keys());!(e=n()).done;){var s=e.value,a=i.get(s),o=a.frames,l=o[a.frameIdx];a.dt+=t,l.duration<a.dt&&(a.dt=0,a.frameIdx++,a.frameIdx>=o.length&&(a.frameIdx=0),l=o[a.frameIdx]),r.set(s,l.grid)}for(var h,u=ke(this.getLayers());!(h=u()).done;){var c=h.value;c.hasAnimation()&&c.markForUpdateRenderData()}},Be(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){(this._tmxFile!==t||tn)&&(this._tmxFile=t,(this._preloaded||tn)&&this._applyFile())}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,i=0;i<e.length;++i)e[i].enableCulling=t}}]),e}(ui),O7.Orientation=h6,O7.Property=u6,O7.TileFlag=c6,O7.StaggerAxis=p6,O7.StaggerIndex=d6,O7.TMXObjectType=_6,O7.RenderOrder=f6,R7=je((C7=P7).prototype,"_tmxFile",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),je(C7.prototype,"tmxAsset",[T7,A7],Object.getOwnPropertyDescriptor(C7.prototype,"tmxAsset"),C7.prototype),w7=je(C7.prototype,"_enableCulling",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),je(C7.prototype,"enableCulling",[yr],Object.getOwnPropertyDescriptor(C7.prototype,"enableCulling"),C7.prototype),x7=je(C7.prototype,"cleanupImageCache",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),E7=C7))||E7)||E7)||E7)||E7)||E7)),Math.ceil(10922.5)),z7=[],V7=0;V7<4;V7++)z7.push(new Si);var H7,W7,X7=new gi,Y7=new Si,j7={row:0,col:0},K7={x:0,y:0},q7={x:0,y:0},Z7={x:0,y:0},J7={x:0,y:0},Q7=0,$7=0,t9=0,e9=0,i9={createData:function(t){var e=t.requestMeshRenderData();return t.rightTop.col*t.rightTop.row*4>65535&&console.error("Vertex count exceeds 65535"),e},updateRenderData:function(t){t.updateCulling();var e=t.requestMeshRenderData();if(t9=t.leftDownToCenterX,e9=t.leftDownToCenterY,H7=e,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()){var i,r;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var n=t.cullingRect;i=n.leftDown,r=n.rightTop}else i=j7,r=t.rightTop;switch(t.renderOrder){case f6.RightDown:s9(i,r,-1,1,t);break;case f6.LeftDown:s9(i,r,-1,-1,t);break;case f6.RightUp:s9(i,r,1,1,t);break;case f6.LeftUp:default:s9(i,r,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}H7=null},updateColor:function(t){var e=t.color,i=new Float32Array(4);i[0]=e.r/255,i[1]=e.g/255,i[2]=e.b/255,i[0]=e.a/255;var r=t.meshRenderDataArray;if(r)for(var n,s=ke(r);!(n=s()).done;){var a=n.value;if(a.renderData)for(var o=a.renderData,l=o.vData,h=o.vertexStart,u=o.vertexCount;h<u;h++)l.set(i,9*h+5)}},fillBuffers:function(t,e){if(t&&t.meshRenderDataArray){var i=t.meshRenderDataArray,r=t.node,n=e.acquireBufferBatch(),s=n.byteOffset>>2,a=n.indicesOffset,o=n.vertexOffset,l=i[t._meshRenderDataArrayIdx].renderData;n.request(l.vertexCount,l.indicesCount)||(n=e.currBufferBatch,s=0,a=0,o=0);var h=n.vData,u=n.iData,c=r.worldMatrix,p=l.vData,d=l.vertexStart;h.set(p.slice(d,d+9*l.vertexCount),s);for(var f=0;f<l.vertexCount;f++){var _=s+9*f;Y7.set(h[_],h[_+1],h[_+2]),Y7.transformMat4(c),h[_]=Y7.x,h[_+1]=Y7.y,h[_+2]=Y7.z}for(var g=l.vertexCount/4,m=0;m<g;m+=1)u[a]=o,u[a+1]=o+1,u[a+2]=o+2,u[a+3]=o+2,u[a+4]=o+1,u[a+5]=o+3,a+=6,o+=4}}};function r9(t,e){var i;t._rotated?(K7.x=t.r,K7.y=t.t,q7.x=t.l,q7.y=t.t,Z7.x=t.r,Z7.y=t.b,J7.x=t.l,J7.y=t.b):(K7.x=t.l,K7.y=t.t,q7.x=t.l,q7.y=t.b,Z7.x=t.r,Z7.y=t.t,J7.x=t.r,J7.y=t.b),(e&c6.DIAGONAL)>>>0&&(i=q7,q7=Z7,Z7=i),(e&c6.HORIZONTAL)>>>0&&(i=K7,K7=Z7,Z7=i,i=q7,q7=J7,J7=i),(e&c6.VERTICAL)>>>0&&(i=K7,K7=q7,q7=i,i=Z7,Z7=J7,J7=i)}function n9(t,e,i){t||(t=e.texture),H7.texture||(H7.texture=t),(H7=i.requestMeshRenderData()).texture=e.texture}function s9(t,e,i,r,n){if(!(!H7||e.row<0||e.col<0)){H7.renderData||(H7=n.requestMeshRenderData());var s=H7.renderData.vData;Q7=0,$7=0;var a,o,l,h,u,c,p,d,f,_=n.tiledTiles,g=n.texGrids,m=n.tiles,y=n.vertices,v=0,b=0,S=0,T=0,A=0,E=null,C=0,R=!0;W7=r9;var w=new Float32Array(4);for(w[0]=n.color.r/255,w[1]=n.color.g/255,w[2]=n.color.b/255,w[3]=n.color.a/255,-1===i?(h=e.row,u=t.row):(h=t.row,u=e.row);(u-h)*i>=0;h+=i)for(a=y[h],C=n.getNodesCountByRow(h),R=a&&0===C,1===r?(o=R&&t.col<a.minCol?a.minCol:t.col,l=R&&e.col>a.maxCol?a.maxCol:e.col):(o=R&&e.col>a.maxCol?a.maxCol:e.col,l=R&&t.col<a.minCol?a.minCol:t.col);(l-o)*r>=0;o+=r){if(c=a&&a[o],C>0){var x=n.requestSubNodesData(),O=n.getNodesByRowCol(h,o);O&&O.count>0&&(x.subNodes=n.getNodesByRowCol(h,o).list,E=null,H7=n.requestMeshRenderData())}c&&(v=m[c.index],(d=g.get((v&c6.FLIPPED_MASK)>>>0))&&(E!==d.texture&&(n9(E,d,n),E=d.texture),p=d.tileset._tileSize,b=c.left-t9,S=c.bottom-e9,T=b+p.width,A=S+p.height,f=_[c.index],H7.renderData.reserve(4,0),$7=9*H7.renderData.vertexCount,s=H7.renderData.vData,f?f.node.active&&a9(f.node,w,s,b,T,A,S,!1):(s[$7]=b,s[$7+1]=A,s[$7+9]=b,s[$7+9+1]=S,s[$7+18]=T,s[$7+18+1]=A,s[$7+27]=T,s[$7+27+1]=S,s.set(w,$7+5),s.set(w,$7+9+5),s.set(w,$7+18+5),s.set(w,$7+27+5)),W7(d,v),s[$7+3]=K7.x,s[$7+4]=K7.y,s[$7+9+3]=q7.x,s[$7+9+4]=q7.y,s[$7+18+3]=Z7.x,s[$7+18+4]=Z7.y,s[$7+27+3]=J7.x,s[$7+27+4]=J7.y,Q7++,H7.renderData.advance(4,6),Q7>=U7&&(n9(E,d,n),E=d.texture)))}}}function a9(t,e,i,r,n,s,a,o){var l=18,h=27;t.updateWorldTransform(),gi.fromRTS(X7,t.getRotation(),t.getPosition(),t.getScale()),Si.set(Y7,-(r+t9),-(a+e9),0),gi.transform(X7,X7,Y7);var u=X7,c=u.m12,p=u.m13,d=u.m00,f=u.m01,_=u.m04,g=u.m05,m=1===d&&0===f&&0===_&&1===g;if(o){var y=(r+n)/2,v=(s+a)/2;m?(i[$7]=y+c,i[$7+1]=s+p,i[$7+9]=r+c,i[$7+9+1]=v+p,i[$7+l]=n+c,i[$7+l+1]=v+p,i[$7+h]=y+c,i[$7+h+1]=a+p):(i[$7]=y*d+s*_+c,i[$7+1]=y*f+s*g+p,i[$7+9]=r*d+v*_+c,i[$7+9+1]=r*f+v*g+p,i[$7+l]=n*d+v*_+c,i[$7+l+1]=n*f+v*g+p,i[$7+h]=y*d+a*_+c,i[$7+h+1]=y*f+a*g+p)}else m?(i[$7]=r+c,i[$7+1]=s+p,i[$7+9]=r+c,i[$7+9+1]=a+p,i[$7+l]=n+c,i[$7+l+1]=s+p,i[$7+h]=n+c,i[$7+h+1]=a+p):(i[$7]=r*d+s*_+c,i[$7+1]=r*f+s*g+p,i[$7+9]=r*d+a*_+c,i[$7+9+1]=r*f+a*g+p,i[$7+l]=n*d+s*_+c,i[$7+l+1]=n*f+s*g+p,i[$7+h]=n*d+a*_+c,i[$7+h+1]=n*f+a*g+p);i.set(e,$7+5),i.set(e,$7+9+5),i.set(e,$7+l+5),i.set(e,$7+h+5)}var o9=t("tiledLayerAssembler",{getAssembler:function(){return i9}});k7.Assembler=o9;var l9,h9,u9=(l9=function(t,e){return(l9=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}l9(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});!function(t){var e,i,r,n=function(){function t(t,e,i){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var r=0;r<e.length;r++)this.timelineIds[e[r].getPropertyId()]=!0;this.duration=i}return t.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},t.prototype.apply=function(t,e,i,r,n,s,a,o){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(i%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,h=0,u=l.length;h<u;h++)l[h].apply(t,e,i,n,s,a,o)},t.binarySearch=function(t,e,i){void 0===i&&(i=1);var r=0,n=t.length/i-2;if(0==n)return i;for(var s=n>>>1;;){if(t[(s+1)*i]<=e?r=s+1:n=s,r==n)return(r+1)*i;s=r+n>>>1}},t.linearSearch=function(t,e,i){for(var r=0,n=t.length-i;r<=n;r+=i)if(t[r]>e)return r;return-1},t}();t.Animation=n,function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(e=t.MixBlend||(t.MixBlend={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(i=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(r=t.TimelineType||(t.TimelineType={}));var s=function(){function e(i){if(i<=0)throw new Error("frameCount must be > 0: "+i);this.curves=t.Utils.newFloatArray((i-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(t){this.curves[t*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(t){this.curves[t*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(t){var i=t*e.BEZIER_SIZE;if(i==this.curves.length)return e.LINEAR;var r=this.curves[i];return r==e.LINEAR?e.LINEAR:r==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(t,i,r,n,s){var a=.03*(2*-i+n),o=.03*(2*-r+s),l=.006*(3*(i-n)+1),h=.006*(3*(r-s)+1),u=2*a+l,c=2*o+h,p=.3*i+a+.16666667*l,d=.3*r+o+.16666667*h,f=t*e.BEZIER_SIZE,_=this.curves;_[f++]=e.BEZIER;for(var g=p,m=d,y=f+e.BEZIER_SIZE-1;f<y;f+=2)_[f]=g,_[f+1]=m,p+=u,d+=c,u+=l,c+=h,g+=p,m+=d},e.prototype.getCurvePercent=function(i,r){r=t.MathUtils.clamp(r,0,1);var n=this.curves,s=i*e.BEZIER_SIZE,a=n[s];if(a==e.LINEAR)return r;if(a==e.STEPPED)return 0;for(var o=0,l=++s,h=s+e.BEZIER_SIZE-1;s<h;s+=2)if((o=n[s])>=r){var u=void 0,c=void 0;return s==l?(u=0,c=0):(u=n[s-2],c=n[s-1]),c+(n[s+1]-c)*(r-u)/(o-u)}var p=n[s-1];return p+(1-p)*(r-o)/(1-o)},e.LINEAR=0,e.STEPPED=1,e.BEZIER=2,e.BEZIER_SIZE=19,e}();t.CurveTimeline=s;var a=function(i){function s(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e<<1),r}return u9(s,i),s.prototype.getPropertyId=function(){return(r.rotate<<24)+this.boneIndex},s.prototype.setFrame=function(t,e,i){t<<=1,this.frames[t]=e,this.frames[t+s.ROTATION]=i},s.prototype.apply=function(t,i,r,a,o,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(r<h[0])switch(l){case e.setup:return void(u.rotation=u.data.rotation);case e.first:var c=u.data.rotation-u.rotation;u.rotation+=(c-360*(16384-(16384.499999999996-c/360|0)))*o}else if(r>=h[h.length-s.ENTRIES]){var p=h[h.length+s.PREV_ROTATION];switch(l){case e.setup:u.rotation=u.data.rotation+p*o;break;case e.first:case e.replace:p+=u.data.rotation-u.rotation,p-=360*(16384-(16384.499999999996-p/360|0));case e.add:u.rotation+=p*o}}else{var d=n.binarySearch(h,r,s.ENTRIES),f=h[d+s.PREV_ROTATION],_=h[d],g=this.getCurvePercent((d>>1)-1,1-(r-_)/(h[d+s.PREV_TIME]-_)),m=h[d+s.ROTATION]-f;switch(m=f+(m-360*(16384-(16384.499999999996-m/360|0)))*g,l){case e.setup:u.rotation=u.data.rotation+(m-360*(16384-(16384.499999999996-m/360|0)))*o;break;case e.first:case e.replace:m+=u.data.rotation-u.rotation;case e.add:u.rotation+=(m-360*(16384-(16384.499999999996-m/360|0)))*o}}},s.ENTRIES=2,s.PREV_TIME=-2,s.PREV_ROTATION=-1,s.ROTATION=1,s}(s);t.RotateTimeline=a;var o=function(i){function s(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*s.ENTRIES),r}return u9(s,i),s.prototype.getPropertyId=function(){return(r.translate<<24)+this.boneIndex},s.prototype.setFrame=function(t,e,i,r){t*=s.ENTRIES,this.frames[t]=e,this.frames[t+s.X]=i,this.frames[t+s.Y]=r},s.prototype.apply=function(t,i,r,a,o,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(r<h[0])switch(l){case e.setup:return u.x=u.data.x,void(u.y=u.data.y);case e.first:u.x+=(u.data.x-u.x)*o,u.y+=(u.data.y-u.y)*o}else{var c=0,p=0;if(r>=h[h.length-s.ENTRIES])c=h[h.length+s.PREV_X],p=h[h.length+s.PREV_Y];else{var d=n.binarySearch(h,r,s.ENTRIES);c=h[d+s.PREV_X],p=h[d+s.PREV_Y];var f=h[d],_=this.getCurvePercent(d/s.ENTRIES-1,1-(r-f)/(h[d+s.PREV_TIME]-f));c+=(h[d+s.X]-c)*_,p+=(h[d+s.Y]-p)*_}switch(l){case e.setup:u.x=u.data.x+c*o,u.y=u.data.y+p*o;break;case e.first:case e.replace:u.x+=(u.data.x+c-u.x)*o,u.y+=(u.data.y+p-u.y)*o;break;case e.add:u.x+=c*o,u.y+=p*o}}},s.ENTRIES=3,s.PREV_TIME=-3,s.PREV_X=-2,s.PREV_Y=-1,s.X=1,s.Y=2,s}(s);t.TranslateTimeline=o;var l=function(s){function a(t){return s.call(this,t)||this}return u9(a,s),a.prototype.getPropertyId=function(){return(r.scale<<24)+this.boneIndex},a.prototype.apply=function(r,s,o,l,h,u,c){var p=this.frames,d=r.bones[this.boneIndex];if(d.active)if(o<p[0])switch(u){case e.setup:return d.scaleX=d.data.scaleX,void(d.scaleY=d.data.scaleY);case e.first:d.scaleX+=(d.data.scaleX-d.scaleX)*h,d.scaleY+=(d.data.scaleY-d.scaleY)*h}else{var f=0,_=0;if(o>=p[p.length-a.ENTRIES])f=p[p.length+a.PREV_X]*d.data.scaleX,_=p[p.length+a.PREV_Y]*d.data.scaleY;else{var g=n.binarySearch(p,o,a.ENTRIES);f=p[g+a.PREV_X],_=p[g+a.PREV_Y];var m=p[g],y=this.getCurvePercent(g/a.ENTRIES-1,1-(o-m)/(p[g+a.PREV_TIME]-m));f=(f+(p[g+a.X]-f)*y)*d.data.scaleX,_=(_+(p[g+a.Y]-_)*y)*d.data.scaleY}if(1==h)u==e.add?(d.scaleX+=f-d.data.scaleX,d.scaleY+=_-d.data.scaleY):(d.scaleX=f,d.scaleY=_);else{var v=0,b=0;if(c==i.mixOut)switch(u){case e.setup:v=d.data.scaleX,b=d.data.scaleY,d.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-v)*h,d.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-b)*h;break;case e.first:case e.replace:v=d.scaleX,b=d.scaleY,d.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-v)*h,d.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-b)*h;break;case e.add:v=d.scaleX,b=d.scaleY,d.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-d.data.scaleX)*h,d.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-d.data.scaleY)*h}else switch(u){case e.setup:v=Math.abs(d.data.scaleX)*t.MathUtils.signum(f),b=Math.abs(d.data.scaleY)*t.MathUtils.signum(_),d.scaleX=v+(f-v)*h,d.scaleY=b+(_-b)*h;break;case e.first:case e.replace:v=Math.abs(d.scaleX)*t.MathUtils.signum(f),b=Math.abs(d.scaleY)*t.MathUtils.signum(_),d.scaleX=v+(f-v)*h,d.scaleY=b+(_-b)*h;break;case e.add:v=t.MathUtils.signum(f),b=t.MathUtils.signum(_),d.scaleX=Math.abs(d.scaleX)*v+(f-Math.abs(d.data.scaleX)*v)*h,d.scaleY=Math.abs(d.scaleY)*b+(_-Math.abs(d.data.scaleY)*b)*h}}}},a}(o);t.ScaleTimeline=l;var h=function(t){function i(e){return t.call(this,e)||this}return u9(i,t),i.prototype.getPropertyId=function(){return(r.shear<<24)+this.boneIndex},i.prototype.apply=function(t,r,s,a,o,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(s<h[0])switch(l){case e.setup:return u.shearX=u.data.shearX,void(u.shearY=u.data.shearY);case e.first:u.shearX+=(u.data.shearX-u.shearX)*o,u.shearY+=(u.data.shearY-u.shearY)*o}else{var c=0,p=0;if(s>=h[h.length-i.ENTRIES])c=h[h.length+i.PREV_X],p=h[h.length+i.PREV_Y];else{var d=n.binarySearch(h,s,i.ENTRIES);c=h[d+i.PREV_X],p=h[d+i.PREV_Y];var f=h[d],_=this.getCurvePercent(d/i.ENTRIES-1,1-(s-f)/(h[d+i.PREV_TIME]-f));c+=(h[d+i.X]-c)*_,p+=(h[d+i.Y]-p)*_}switch(l){case e.setup:u.shearX=u.data.shearX+c*o,u.shearY=u.data.shearY+p*o;break;case e.first:case e.replace:u.shearX+=(u.data.shearX+c-u.shearX)*o,u.shearY+=(u.data.shearY+p-u.shearY)*o;break;case e.add:u.shearX+=c*o,u.shearY+=p*o}}},i}(o);t.ShearTimeline=h;var u=function(i){function s(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*s.ENTRIES),r}return u9(s,i),s.prototype.getPropertyId=function(){return(r.color<<24)+this.slotIndex},s.prototype.setFrame=function(t,e,i,r,n,a){t*=s.ENTRIES,this.frames[t]=e,this.frames[t+s.R]=i,this.frames[t+s.G]=r,this.frames[t+s.B]=n,this.frames[t+s.A]=a},s.prototype.apply=function(t,i,r,a,o,l){var h=t.slots[this.slotIndex];if(h.bone.active){var u=this.frames;if(r<u[0])switch(l){case e.setup:return void h.color.setFromColor(h.data.color);case e.first:var c=h.color,p=h.data.color;c.add((p.r-c.r)*o,(p.g-c.g)*o,(p.b-c.b)*o,(p.a-c.a)*o)}else{var d=0,f=0,_=0,g=0;if(r>=u[u.length-s.ENTRIES]){var m=u.length;d=u[m+s.PREV_R],f=u[m+s.PREV_G],_=u[m+s.PREV_B],g=u[m+s.PREV_A]}else{var y=n.binarySearch(u,r,s.ENTRIES);d=u[y+s.PREV_R],f=u[y+s.PREV_G],_=u[y+s.PREV_B],g=u[y+s.PREV_A];var v=u[y],b=this.getCurvePercent(y/s.ENTRIES-1,1-(r-v)/(u[y+s.PREV_TIME]-v));d+=(u[y+s.R]-d)*b,f+=(u[y+s.G]-f)*b,_+=(u[y+s.B]-_)*b,g+=(u[y+s.A]-g)*b}1==o?h.color.set(d,f,_,g):(c=h.color,l==e.setup&&c.setFromColor(h.data.color),c.add((d-c.r)*o,(f-c.g)*o,(_-c.b)*o,(g-c.a)*o))}}},s.ENTRIES=5,s.PREV_TIME=-5,s.PREV_R=-4,s.PREV_G=-3,s.PREV_B=-2,s.PREV_A=-1,s.R=1,s.G=2,s.B=3,s.A=4,s}(s);t.ColorTimeline=u;var c=function(i){function s(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*s.ENTRIES),r}return u9(s,i),s.prototype.getPropertyId=function(){return(r.twoColor<<24)+this.slotIndex},s.prototype.setFrame=function(t,e,i,r,n,a,o,l,h){t*=s.ENTRIES,this.frames[t]=e,this.frames[t+s.R]=i,this.frames[t+s.G]=r,this.frames[t+s.B]=n,this.frames[t+s.A]=a,this.frames[t+s.R2]=o,this.frames[t+s.G2]=l,this.frames[t+s.B2]=h},s.prototype.apply=function(t,i,r,a,o,l){var h=t.slots[this.slotIndex];if(h.bone.active){var u=this.frames;if(r<u[0])switch(l){case e.setup:return h.color.setFromColor(h.data.color),void h.darkColor.setFromColor(h.data.darkColor);case e.first:var c=h.color,p=h.darkColor,d=h.data.color,f=h.data.darkColor;c.add((d.r-c.r)*o,(d.g-c.g)*o,(d.b-c.b)*o,(d.a-c.a)*o),p.add((f.r-p.r)*o,(f.g-p.g)*o,(f.b-p.b)*o,0)}else{var _=0,g=0,m=0,y=0,v=0,b=0,S=0;if(r>=u[u.length-s.ENTRIES]){var T=u.length;_=u[T+s.PREV_R],g=u[T+s.PREV_G],m=u[T+s.PREV_B],y=u[T+s.PREV_A],v=u[T+s.PREV_R2],b=u[T+s.PREV_G2],S=u[T+s.PREV_B2]}else{var A=n.binarySearch(u,r,s.ENTRIES);_=u[A+s.PREV_R],g=u[A+s.PREV_G],m=u[A+s.PREV_B],y=u[A+s.PREV_A],v=u[A+s.PREV_R2],b=u[A+s.PREV_G2],S=u[A+s.PREV_B2];var E=u[A],C=this.getCurvePercent(A/s.ENTRIES-1,1-(r-E)/(u[A+s.PREV_TIME]-E));_+=(u[A+s.R]-_)*C,g+=(u[A+s.G]-g)*C,m+=(u[A+s.B]-m)*C,y+=(u[A+s.A]-y)*C,v+=(u[A+s.R2]-v)*C,b+=(u[A+s.G2]-b)*C,S+=(u[A+s.B2]-S)*C}1==o?(h.color.set(_,g,m,y),h.darkColor.set(v,b,S,1)):(c=h.color,p=h.darkColor,l==e.setup&&(c.setFromColor(h.data.color),p.setFromColor(h.data.darkColor)),c.add((_-c.r)*o,(g-c.g)*o,(m-c.b)*o,(y-c.a)*o),p.add((v-p.r)*o,(b-p.g)*o,(S-p.b)*o,0))}}},s.ENTRIES=8,s.PREV_TIME=-8,s.PREV_R=-7,s.PREV_G=-6,s.PREV_B=-5,s.PREV_A=-4,s.PREV_R2=-3,s.PREV_G2=-2,s.PREV_B2=-1,s.R=1,s.G=2,s.B=3,s.A=4,s.R2=5,s.G2=6,s.B2=7,s}(s);t.TwoColorTimeline=c;var p=function(){function s(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=new Array(e)}return s.prototype.getPropertyId=function(){return(r.attachment<<24)+this.slotIndex},s.prototype.getFrameCount=function(){return this.frames.length},s.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},s.prototype.apply=function(t,r,s,a,o,l,h){var u=t.slots[this.slotIndex];if(u.bone.active)if(h!=i.mixOut||l!=e.setup){var c=this.frames;if(s<c[0]){if(l==e.setup||l==e.first){var p=u.data.attachmentName;u.setAttachment(null==p?null:t.getAttachment(this.slotIndex,p))}}else{var d;d=s>=c[c.length-1]?c.length-1:n.binarySearch(c,s,1)-1;var f=this.attachmentNames[d];t.slots[this.slotIndex].setAttachment(null==f?null:t.getAttachment(this.slotIndex,f))}}else{var _=u.data.attachmentName;u.setAttachment(null==_?null:t.getAttachment(this.slotIndex,_))}},s}();t.AttachmentTimeline=p;var d=null,f=function(i){function s(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e),r.frameVertices=new Array(e),null==d&&(d=t.Utils.newFloatArray(64)),r}return u9(s,i),s.prototype.getPropertyId=function(){return(r.deform<<27)+ +this.attachment.id+this.slotIndex},s.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},s.prototype.apply=function(i,r,s,a,o,l){var h=i.slots[this.slotIndex];if(h.bone.active){var u=h.getAttachment();if(u instanceof t.VertexAttachment&&u.deformAttachment==this.attachment){var c=h.deform;0==c.length&&(l=e.setup);var p=this.frameVertices,d=p[0].length,f=this.frames;if(s<f[0]){var _=u;switch(l){case e.setup:return void(c.length=0);case e.first:if(1==o){c.length=0;break}var g=t.Utils.setArraySize(c,d);if(null==_.bones)for(var m=_.vertices,y=0;y<d;y++)g[y]+=(m[y]-g[y])*o;else for(o=1-o,y=0;y<d;y++)g[y]*=o}}else{var v=t.Utils.setArraySize(c,d);if(s>=f[f.length-1]){var b=p[f.length-1];if(1==o)if(l==e.add)if(null==(_=u).bones){m=_.vertices;for(var S=0;S<d;S++)v[S]+=b[S]-m[S]}else for(var T=0;T<d;T++)v[T]+=b[T];else t.Utils.arrayCopy(b,0,v,0,d);else switch(l){case e.setup:var A=u;if(null==A.bones){m=A.vertices;for(var E=0;E<d;E++){var C=m[E];v[E]=C+(b[E]-C)*o}}else for(var R=0;R<d;R++)v[R]=b[R]*o;break;case e.first:case e.replace:for(var w=0;w<d;w++)v[w]+=(b[w]-v[w])*o;case e.add:if(null==(_=u).bones){m=_.vertices;for(var x=0;x<d;x++)v[x]+=(b[x]-m[x])*o}else for(var O=0;O<d;O++)v[O]+=b[O]*o}}else{var P=n.binarySearch(f,s),D=p[P-1],M=p[P],B=f[P],I=this.getCurvePercent(P-1,1-(s-B)/(f[P-1]-B));if(1==o)if(l==e.add)if(null==(_=u).bones){m=_.vertices;for(var L=0;L<d;L++){var F=D[L];v[L]+=F+(M[L]-F)*I-m[L]}}else for(var k=0;k<d;k++)F=D[k],v[k]+=F+(M[k]-F)*I;else for(var N=0;N<d;N++)F=D[N],v[N]=F+(M[N]-F)*I;else switch(l){case e.setup:var G=u;if(null==G.bones){m=G.vertices;for(var U=0;U<d;U++)F=D[U],C=m[U],v[U]=C+(F+(M[U]-F)*I-C)*o}else for(var z=0;z<d;z++)F=D[z],v[z]=(F+(M[z]-F)*I)*o;break;case e.first:case e.replace:for(var V=0;V<d;V++)F=D[V],v[V]+=(F+(M[V]-F)*I-v[V])*o;break;case e.add:if(null==(_=u).bones){m=_.vertices;for(var H=0;H<d;H++)F=D[H],v[H]+=(F+(M[H]-F)*I-m[H])*o}else for(var W=0;W<d;W++)F=D[W],v[W]+=(F+(M[W]-F)*I)*o}}}}}},s}(s);t.DeformTimeline=f;var _=function(){function e(e){this.frames=t.Utils.newFloatArray(e),this.events=new Array(e)}return e.prototype.getPropertyId=function(){return r.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,i,r,s,a,o){if(null!=r){var l=this.frames,h=this.frames.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,r,s,a,o),e=-1;else if(e>=l[h-1])return;if(!(i<l[0])){var u=0;if(e<l[0])u=0;else for(var c=l[u=n.binarySearch(l,e)];u>0&&l[u-1]==c;)u--;for(;u<h&&i>=l[u];u++)r.push(this.events[u])}}},e}();t.EventTimeline=_;var g=function(){function s(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=new Array(e)}return s.prototype.getPropertyId=function(){return r.drawOrder<<24},s.prototype.getFrameCount=function(){return this.frames.length},s.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},s.prototype.apply=function(r,s,a,o,l,h,u){var c=r.drawOrder,p=r.slots;if(u!=i.mixOut||h!=e.setup){var d=this.frames;if(a<d[0])h!=e.setup&&h!=e.first||t.Utils.arrayCopy(r.slots,0,r.drawOrder,0,r.slots.length);else{var f;f=a>=d[d.length-1]?d.length-1:n.binarySearch(d,a)-1;var _=this.drawOrders[f];if(null==_)t.Utils.arrayCopy(p,0,c,0,p.length);else for(var g=0,m=_.length;g<m;g++)c[g]=p[_[g]]}}else t.Utils.arrayCopy(r.slots,0,r.drawOrder,0,r.slots.length)},s}();t.DrawOrderTimeline=g;var m=function(s){function a(e){var i=s.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return u9(a,s),a.prototype.getPropertyId=function(){return(r.ikConstraint<<24)+this.ikConstraintIndex},a.prototype.setFrame=function(t,e,i,r,n,s,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.MIX]=i,this.frames[t+a.SOFTNESS]=r,this.frames[t+a.BEND_DIRECTION]=n,this.frames[t+a.COMPRESS]=s?1:0,this.frames[t+a.STRETCH]=o?1:0},a.prototype.apply=function(t,r,s,o,l,h,u){var c=this.frames,p=t.ikConstraints[this.ikConstraintIndex];if(p.active)if(s<c[0])switch(h){case e.setup:return p.mix=p.data.mix,p.softness=p.data.softness,p.bendDirection=p.data.bendDirection,p.compress=p.data.compress,void(p.stretch=p.data.stretch);case e.first:p.mix+=(p.data.mix-p.mix)*l,p.softness+=(p.data.softness-p.softness)*l,p.bendDirection=p.data.bendDirection,p.compress=p.data.compress,p.stretch=p.data.stretch}else if(s>=c[c.length-a.ENTRIES])h==e.setup?(p.mix=p.data.mix+(c[c.length+a.PREV_MIX]-p.data.mix)*l,p.softness=p.data.softness+(c[c.length+a.PREV_SOFTNESS]-p.data.softness)*l,u==i.mixOut?(p.bendDirection=p.data.bendDirection,p.compress=p.data.compress,p.stretch=p.data.stretch):(p.bendDirection=c[c.length+a.PREV_BEND_DIRECTION],p.compress=0!=c[c.length+a.PREV_COMPRESS],p.stretch=0!=c[c.length+a.PREV_STRETCH])):(p.mix+=(c[c.length+a.PREV_MIX]-p.mix)*l,p.softness+=(c[c.length+a.PREV_SOFTNESS]-p.softness)*l,u==i.mixIn&&(p.bendDirection=c[c.length+a.PREV_BEND_DIRECTION],p.compress=0!=c[c.length+a.PREV_COMPRESS],p.stretch=0!=c[c.length+a.PREV_STRETCH]));else{var d=n.binarySearch(c,s,a.ENTRIES),f=c[d+a.PREV_MIX],_=c[d+a.PREV_SOFTNESS],g=c[d],m=this.getCurvePercent(d/a.ENTRIES-1,1-(s-g)/(c[d+a.PREV_TIME]-g));h==e.setup?(p.mix=p.data.mix+(f+(c[d+a.MIX]-f)*m-p.data.mix)*l,p.softness=p.data.softness+(_+(c[d+a.SOFTNESS]-_)*m-p.data.softness)*l,u==i.mixOut?(p.bendDirection=p.data.bendDirection,p.compress=p.data.compress,p.stretch=p.data.stretch):(p.bendDirection=c[d+a.PREV_BEND_DIRECTION],p.compress=0!=c[d+a.PREV_COMPRESS],p.stretch=0!=c[d+a.PREV_STRETCH])):(p.mix+=(f+(c[d+a.MIX]-f)*m-p.mix)*l,p.softness+=(_+(c[d+a.SOFTNESS]-_)*m-p.softness)*l,u==i.mixIn&&(p.bendDirection=c[d+a.PREV_BEND_DIRECTION],p.compress=0!=c[d+a.PREV_COMPRESS],p.stretch=0!=c[d+a.PREV_STRETCH]))}},a.ENTRIES=6,a.PREV_TIME=-6,a.PREV_MIX=-5,a.PREV_SOFTNESS=-4,a.PREV_BEND_DIRECTION=-3,a.PREV_COMPRESS=-2,a.PREV_STRETCH=-1,a.MIX=1,a.SOFTNESS=2,a.BEND_DIRECTION=3,a.COMPRESS=4,a.STRETCH=5,a}(s);t.IkConstraintTimeline=m;var y=function(i){function s(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*s.ENTRIES),r}return u9(s,i),s.prototype.getPropertyId=function(){return(r.transformConstraint<<24)+this.transformConstraintIndex},s.prototype.setFrame=function(t,e,i,r,n,a){t*=s.ENTRIES,this.frames[t]=e,this.frames[t+s.ROTATE]=i,this.frames[t+s.TRANSLATE]=r,this.frames[t+s.SCALE]=n,this.frames[t+s.SHEAR]=a},s.prototype.apply=function(t,i,r,a,o,l){var h=this.frames,u=t.transformConstraints[this.transformConstraintIndex];if(u.active)if(r<h[0]){var c=u.data;switch(l){case e.setup:return u.rotateMix=c.rotateMix,u.translateMix=c.translateMix,u.scaleMix=c.scaleMix,void(u.shearMix=c.shearMix);case e.first:u.rotateMix+=(c.rotateMix-u.rotateMix)*o,u.translateMix+=(c.translateMix-u.translateMix)*o,u.scaleMix+=(c.scaleMix-u.scaleMix)*o,u.shearMix+=(c.shearMix-u.shearMix)*o}}else{var p=0,d=0,f=0,_=0;if(r>=h[h.length-s.ENTRIES]){var g=h.length;p=h[g+s.PREV_ROTATE],d=h[g+s.PREV_TRANSLATE],f=h[g+s.PREV_SCALE],_=h[g+s.PREV_SHEAR]}else{var m=n.binarySearch(h,r,s.ENTRIES);p=h[m+s.PREV_ROTATE],d=h[m+s.PREV_TRANSLATE],f=h[m+s.PREV_SCALE],_=h[m+s.PREV_SHEAR];var y=h[m],v=this.getCurvePercent(m/s.ENTRIES-1,1-(r-y)/(h[m+s.PREV_TIME]-y));p+=(h[m+s.ROTATE]-p)*v,d+=(h[m+s.TRANSLATE]-d)*v,f+=(h[m+s.SCALE]-f)*v,_+=(h[m+s.SHEAR]-_)*v}l==e.setup?(c=u.data,u.rotateMix=c.rotateMix+(p-c.rotateMix)*o,u.translateMix=c.translateMix+(d-c.translateMix)*o,u.scaleMix=c.scaleMix+(f-c.scaleMix)*o,u.shearMix=c.shearMix+(_-c.shearMix)*o):(u.rotateMix+=(p-u.rotateMix)*o,u.translateMix+=(d-u.translateMix)*o,u.scaleMix+=(f-u.scaleMix)*o,u.shearMix+=(_-u.shearMix)*o)}},s.ENTRIES=5,s.PREV_TIME=-5,s.PREV_ROTATE=-4,s.PREV_TRANSLATE=-3,s.PREV_SCALE=-2,s.PREV_SHEAR=-1,s.ROTATE=1,s.TRANSLATE=2,s.SCALE=3,s.SHEAR=4,s}(s);t.TransformConstraintTimeline=y;var v=function(i){function s(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*s.ENTRIES),r}return u9(s,i),s.prototype.getPropertyId=function(){return(r.pathConstraintPosition<<24)+this.pathConstraintIndex},s.prototype.setFrame=function(t,e,i){t*=s.ENTRIES,this.frames[t]=e,this.frames[t+s.VALUE]=i},s.prototype.apply=function(t,i,r,a,o,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(r<h[0])switch(l){case e.setup:return void(u.position=u.data.position);case e.first:u.position+=(u.data.position-u.position)*o}else{var c=0;if(r>=h[h.length-s.ENTRIES])c=h[h.length+s.PREV_VALUE];else{var p=n.binarySearch(h,r,s.ENTRIES);c=h[p+s.PREV_VALUE];var d=h[p],f=this.getCurvePercent(p/s.ENTRIES-1,1-(r-d)/(h[p+s.PREV_TIME]-d));c+=(h[p+s.VALUE]-c)*f}l==e.setup?u.position=u.data.position+(c-u.data.position)*o:u.position+=(c-u.position)*o}},s.ENTRIES=2,s.PREV_TIME=-2,s.PREV_VALUE=-1,s.VALUE=1,s}(s);t.PathConstraintPositionTimeline=v;var b=function(t){function i(e){return t.call(this,e)||this}return u9(i,t),i.prototype.getPropertyId=function(){return(r.pathConstraintSpacing<<24)+this.pathConstraintIndex},i.prototype.apply=function(t,r,s,a,o,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(s<h[0])switch(l){case e.setup:return void(u.spacing=u.data.spacing);case e.first:u.spacing+=(u.data.spacing-u.spacing)*o}else{var c=0;if(s>=h[h.length-i.ENTRIES])c=h[h.length+i.PREV_VALUE];else{var p=n.binarySearch(h,s,i.ENTRIES);c=h[p+i.PREV_VALUE];var d=h[p],f=this.getCurvePercent(p/i.ENTRIES-1,1-(s-d)/(h[p+i.PREV_TIME]-d));c+=(h[p+i.VALUE]-c)*f}l==e.setup?u.spacing=u.data.spacing+(c-u.data.spacing)*o:u.spacing+=(c-u.spacing)*o}},i}(v);t.PathConstraintSpacingTimeline=b;var S=function(i){function s(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*s.ENTRIES),r}return u9(s,i),s.prototype.getPropertyId=function(){return(r.pathConstraintMix<<24)+this.pathConstraintIndex},s.prototype.setFrame=function(t,e,i,r){t*=s.ENTRIES,this.frames[t]=e,this.frames[t+s.ROTATE]=i,this.frames[t+s.TRANSLATE]=r},s.prototype.apply=function(t,i,r,a,o,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(r<h[0])switch(l){case e.setup:return u.rotateMix=u.data.rotateMix,void(u.translateMix=u.data.translateMix);case e.first:u.rotateMix+=(u.data.rotateMix-u.rotateMix)*o,u.translateMix+=(u.data.translateMix-u.translateMix)*o}else{var c=0,p=0;if(r>=h[h.length-s.ENTRIES])c=h[h.length+s.PREV_ROTATE],p=h[h.length+s.PREV_TRANSLATE];else{var d=n.binarySearch(h,r,s.ENTRIES);c=h[d+s.PREV_ROTATE],p=h[d+s.PREV_TRANSLATE];var f=h[d],_=this.getCurvePercent(d/s.ENTRIES-1,1-(r-f)/(h[d+s.PREV_TIME]-f));c+=(h[d+s.ROTATE]-c)*_,p+=(h[d+s.TRANSLATE]-p)*_}l==e.setup?(u.rotateMix=u.data.rotateMix+(c-u.data.rotateMix)*o,u.translateMix=u.data.translateMix+(p-u.data.translateMix)*o):(u.rotateMix+=(c-u.rotateMix)*o,u.translateMix+=(p-u.translateMix)*o)}},s.ENTRIES=3,s.PREV_TIME=-3,s.PREV_ROTATE=-2,s.PREV_TRANSLATE=-1,s.ROTATE=1,s.TRANSLATE=2,s}(s);t.PathConstraintMixTimeline=S}(h9||(h9={})),function(t){var e=function(){function e(e){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new n(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.trackEntryPool=new t.Pool((function(){return new i})),this.data=e}return e.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,i=0,r=e.length;i<r;i++){var n=e[i];if(null!=n){n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;var s=t*n.timeScale;if(n.delay>0){if(n.delay-=s,n.delay>0)continue;s=-n.delay,n.delay=0}var a=n.next;if(null!=a){var o=n.trackLast-a.delay;if(o>=0){for(a.delay=0,a.trackTime+=0==n.timeScale?0:(o/n.timeScale+t)*a.timeScale,n.trackTime+=s,this.setCurrent(i,a,!0);null!=a.mixingFrom;)a.mixTime+=t,a=a.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&null==n.mixingFrom){e[i]=null,this.queue.end(n),this.disposeNext(n);continue}if(null!=n.mixingFrom&&this.updateMixingFrom(n,t)){var l=n.mixingFrom;for(n.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}n.trackTime+=s}}this.queue.drain()},e.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var r=this.updateMixingFrom(i,e);return i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=i.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=i.mixingFrom,null!=i.mixingFrom&&(i.mixingFrom.mixingTo=t),t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),r):(i.trackTime+=e*i.timeScale,t.mixTime+=e,!1)},e.prototype.apply=function(i){if(null==i)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var r=this.events,n=this.tracks,s=!1,a=0,o=n.length;a<o;a++){var l=n[a];if(!(null==l||l.delay>0)){s=!0;var h=0==a?t.MixBlend.first:l.mixBlend,u=l.alpha;null!=l.mixingFrom?u*=this.applyMixingFrom(l,i,h):l.trackTime>=l.trackEnd&&null==l.next&&(u=0);var c=l.animationLast,p=l.getAnimationTime(),d=l.animation.timelines.length,f=l.animation.timelines;if(0==a&&1==u||h==t.MixBlend.add)for(var _=0;_<d;_++)t.Utils.webkit602BugfixHelper(u,h),f[_].apply(i,c,p,r,u,h,t.MixDirection.mixIn);else{var g=l.timelineMode,m=0==l.timelinesRotation.length;m&&t.Utils.setArraySize(l.timelinesRotation,d<<1,null);var y=l.timelinesRotation;for(_=0;_<d;_++){var v=f[_],b=(g[_]&e.NOT_LAST-1)==e.SUBSEQUENT?h:t.MixBlend.setup;v instanceof t.RotateTimeline?this.applyRotateTimeline(v,i,p,u,b,y,_<<1,m):(t.Utils.webkit602BugfixHelper(u,h),v.apply(i,c,p,r,u,b,t.MixDirection.mixIn))}}this.queueEvents(l,p),r.length=0,l.nextAnimationLast=p,l.nextTrackLast=l.trackTime}}return this.queue.drain(),s},e.prototype.applyMixingFrom=function(i,r,n){var s=i.mixingFrom;null!=s.mixingFrom&&this.applyMixingFrom(s,r,n);var a=0;0==i.mixDuration?(a=1,n==t.MixBlend.first&&(n=t.MixBlend.setup)):((a=i.mixTime/i.mixDuration)>1&&(a=1),n!=t.MixBlend.first&&(n=s.mixBlend));var o=a<s.eventThreshold?this.events:null,l=a<s.attachmentThreshold,h=a<s.drawOrderThreshold,u=s.animationLast,c=s.getAnimationTime(),p=s.animation.timelines.length,d=s.animation.timelines,f=s.alpha*i.interruptAlpha,_=f*(1-a);if(n==t.MixBlend.add)for(var g=0;g<p;g++)d[g].apply(r,u,c,o,_,n,t.MixDirection.mixOut);else{var m=s.timelineMode,y=s.timelineHoldMix,v=0==s.timelinesRotation.length;v&&t.Utils.setArraySize(s.timelinesRotation,p<<1,null);var b=s.timelinesRotation;for(s.totalAlpha=0,g=0;g<p;g++){var S=d[g],T=t.MixDirection.mixOut,A=void 0,E=0;switch(m[g]&e.NOT_LAST-1){case e.SUBSEQUENT:if(A=n,!l&&S instanceof t.AttachmentTimeline){if((m[g]&e.NOT_LAST)==e.NOT_LAST)continue;A=t.MixBlend.setup}if(!h&&S instanceof t.DrawOrderTimeline)continue;E=_;break;case e.FIRST:A=t.MixBlend.setup,E=_;break;case e.HOLD:A=t.MixBlend.setup,E=f;break;default:A=t.MixBlend.setup;var C=y[g];E=f*Math.max(0,1-C.mixTime/C.mixDuration)}s.totalAlpha+=E,S instanceof t.RotateTimeline?this.applyRotateTimeline(S,r,c,E,A,b,g<<1,v):(t.Utils.webkit602BugfixHelper(E,n),A==t.MixBlend.setup&&(S instanceof t.AttachmentTimeline?(l||(m[g]&e.NOT_LAST)==e.NOT_LAST)&&(T=t.MixDirection.mixIn):S instanceof t.DrawOrderTimeline&&h&&(T=t.MixDirection.mixIn)),S.apply(r,u,c,o,E,A,T))}}return i.mixDuration>0&&this.queueEvents(s,c),this.events.length=0,s.nextAnimationLast=c,s.nextTrackLast=s.trackTime,a},e.prototype.applyRotateTimeline=function(e,i,r,n,s,a,o,l){if(l&&(a[o]=0),1!=n){var h=e,u=h.frames,c=i.bones[h.boneIndex];if(c.active){var p=0,d=0;if(r<u[0])switch(s){case t.MixBlend.setup:c.rotation=c.data.rotation;default:return;case t.MixBlend.first:p=c.rotation,d=c.data.rotation}else if(p=s==t.MixBlend.setup?c.data.rotation:c.rotation,r>=u[u.length-t.RotateTimeline.ENTRIES])d=c.data.rotation+u[u.length+t.RotateTimeline.PREV_ROTATION];else{var f=t.Animation.binarySearch(u,r,t.RotateTimeline.ENTRIES),_=u[f+t.RotateTimeline.PREV_ROTATION],g=u[f],m=h.getCurvePercent((f>>1)-1,1-(r-g)/(u[f+t.RotateTimeline.PREV_TIME]-g));d=u[f+t.RotateTimeline.ROTATION]-_,d=_+(d-=360*(16384-(16384.499999999996-d/360|0)))*m+c.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}var y=0,v=d-p;if(0==(v-=360*(16384-(16384.499999999996-v/360|0))))y=a[o];else{var b=0,S=0;l?(b=0,S=v):(b=a[o],S=a[o+1]);var T=v>0,A=b>=0;t.MathUtils.signum(S)!=t.MathUtils.signum(v)&&Math.abs(S)<=90&&(Math.abs(b)>180&&(b+=360*t.MathUtils.signum(b)),A=T),y=v+b-b%360,A!=T&&(y+=360*t.MathUtils.signum(b)),a[o]=y}a[o+1]=v,p+=y*n,c.rotation=p-360*(16384-(16384.499999999996-p/360|0))}}else e.apply(i,0,r,null,1,s,t.MixDirection.mixIn)},e.prototype.queueEvents=function(t,e){for(var i=t.animationStart,r=t.animationEnd,n=r-i,s=t.trackLast%n,a=this.events,o=0,l=a.length;o<l;o++){var h=a[o];if(h.time<s)break;h.time>r||this.queue.event(t,h)}for((t.loop?0==n||s>t.trackTime%n:e>=r&&t.animationLast<r)&&this.queue.complete(t);o<l;o++)a[o].time<i||this.queue.event(t,a[o])},e.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var i=e;;){var r=i.mixingFrom;if(null==r)break;this.queue.end(r),i.mixingFrom=null,i.mixingTo=null,i=r}this.tracks[e.trackIndex]=null,this.queue.drain()}}},e.prototype.setCurrent=function(t,e,i){var r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(i&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)},e.prototype.setAnimation=function(t,e,i){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,i)},e.prototype.setAnimationWith=function(t,e,i){if(null==e)throw new Error("animation cannot be null.");var r=!0,n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,r=!1):this.disposeNext(n));var s=this.trackEntry(t,e,i,n);return this.setCurrent(t,s,r),this.queue.drain(),s},e.prototype.addAnimation=function(t,e,i,r){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,n,i,r)},e.prototype.addAnimationWith=function(t,e,i,r){if(null==e)throw new Error("animation cannot be null.");var n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;var s=this.trackEntry(t,e,i,n);if(null==n)this.setCurrent(t,s,!0),this.queue.drain();else if(n.next=s,r<=0){var a=n.animationEnd-n.animationStart;0!=a?(n.loop?r+=a*(1+(n.trackTime/a|0)):r+=Math.max(a,n.trackTime),r-=this.data.getMix(n.animation,e)):r=n.trackTime}return s.delay=r,s},e.prototype.setEmptyAnimation=function(t,i){var r=this.setAnimationWith(t,e.emptyAnimation,!1);return r.mixDuration=i,r.trackEnd=i,r},e.prototype.addEmptyAnimation=function(t,i,r){r<=0&&(r-=i);var n=this.addAnimationWith(t,e.emptyAnimation,!1,r);return n.mixDuration=i,n.trackEnd=i,n},e.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,r=this.tracks.length;i<r;i++){var n=this.tracks[i];null!=n&&this.setEmptyAnimation(n.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},e.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)},e.prototype.trackEntry=function(t,e,i,r){var n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=i,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==r?0:this.data.getMix(r.animation,e),n},e.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var e=0,i=this.tracks.length;e<i;e++)if(null!=(r=this.tracks[e])){for(;null!=r.mixingFrom;)r=r.mixingFrom;do{null!=r.mixingFrom&&r.mixBlend==t.MixBlend.add||this.computeHold(r),r=r.mixingTo}while(null!=r)}for(this.propertyIDs.clear(),e=this.tracks.length-1;e>=0;e--)for(var r=this.tracks[e];null!=r;)this.computeNotLast(r),r=r.mixingFrom},e.prototype.computeHold=function(i){var r=i.mixingTo,n=i.animation.timelines,s=i.animation.timelines.length,a=t.Utils.setArraySize(i.timelineMode,s);i.timelineHoldMix.length=0;var o=t.Utils.setArraySize(i.timelineHoldMix,s),l=this.propertyIDs;if(null!=r&&r.holdPrevious)for(var h=0;h<s;h++)l.add(n[h].getPropertyId()),a[h]=e.HOLD;else t:for(h=0;h<s;h++){var u=n[h],c=u.getPropertyId();if(l.add(c))if(null==r||u instanceof t.AttachmentTimeline||u instanceof t.DrawOrderTimeline||u instanceof t.EventTimeline||!r.animation.hasTimeline(c))a[h]=e.FIRST;else{for(var p=r.mixingTo;null!=p;p=p.mixingTo)if(!p.animation.hasTimeline(c)){if(i.mixDuration>0){a[h]=e.HOLD_MIX,o[h]=p;continue t}break}a[h]=e.HOLD}else a[h]=e.SUBSEQUENT}},e.prototype.computeNotLast=function(i){for(var r=i.animation.timelines,n=i.animation.timelines.length,s=i.timelineMode,a=this.propertyIDs,o=0;o<n;o++)if(r[o]instanceof t.AttachmentTimeline){var l=r[o];a.add(l.slotIndex)||(s[o]|=e.NOT_LAST)}},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},e.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e.emptyAnimation=new t.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.HOLD=2,e.HOLD_MIX=3,e.NOT_LAST=4,e}();t.AnimationState=e;var i=function(){function e(){this.mixBlend=t.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},e.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},e}();t.TrackEntry=i;var r,n=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(r.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(r.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(r.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(r.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(r.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(r.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,i=0;i<t.length;i+=2){var n=t[i],s=t[i+1];switch(n){case r.start:null!=s.listener&&s.listener.start&&s.listener.start(s);for(var a=0;a<e.length;a++)e[a].start&&e[a].start(s);break;case r.interrupt:for(null!=s.listener&&s.listener.interrupt&&s.listener.interrupt(s),a=0;a<e.length;a++)e[a].interrupt&&e[a].interrupt(s);break;case r.end:for(null!=s.listener&&s.listener.end&&s.listener.end(s),a=0;a<e.length;a++)e[a].end&&e[a].end(s);case r.dispose:for(null!=s.listener&&s.listener.dispose&&s.listener.dispose(s),a=0;a<e.length;a++)e[a].dispose&&e[a].dispose(s);this.animState.trackEntryPool.free(s);break;case r.complete:for(null!=s.listener&&s.listener.complete&&s.listener.complete(s),a=0;a<e.length;a++)e[a].complete&&e[a].complete(s);break;case r.event:var o=t[2+i++];for(null!=s.listener&&s.listener.event&&s.listener.event(s,o),a=0;a<e.length;a++)e[a].event&&e[a].event(s,o)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=n,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(r=t.EventType||(t.EventType={}));var s=function(){function t(){}return t.prototype.start=function(){},t.prototype.interrupt=function(){},t.prototype.end=function(){},t.prototype.dispose=function(){},t.prototype.complete=function(){},t.prototype.event=function(){},t}();t.AnimationStateAdapter=s}(h9||(h9={})),function(t){var e=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,i){var r=this.skeletonData.findAnimation(t);if(null==r)throw new Error("Animation not found: "+t);var n=this.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);this.setMixWith(r,n,i)},t.prototype.setMixWith=function(t,e,i){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var r=t.name+"."+e.name;this.animationToMixTime[r]=i},t.prototype.getMix=function(t,e){var i=t.name+"."+e.name,r=this.animationToMixTime[i];return void 0===r?this.defaultMix:r},t}();t.AnimationStateData=e}(h9||(h9={})),function(t){var e=function(){function e(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}return e.downloadText=function(t,e,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(){200==r.status?e(r.responseText):i(r.status,r.responseText)},r.onerror=function(){i(r.status,r.responseText)},r.send()},e.downloadBinary=function(t,e,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status?e(new Uint8Array(r.response)):i(r.status,r.responseText)},r.onerror=function(){i(r.status,r.responseText)},r.send()},e.prototype.loadBinary=function(t,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++,e.downloadBinary(t,(function(e){n.assets[t]=e,i&&i(t,e),n.toLoad--,n.loaded++}),(function(e,i){n.errors[t]="Couldn't load binary "+t+": status "+status+", "+i,r&&r(t,"Couldn't load binary "+t+": status "+status+", "+i),n.toLoad--,n.loaded++}))},e.prototype.loadText=function(t,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++,e.downloadText(t,(function(e){n.assets[t]=e,i&&i(t,e),n.toLoad--,n.loaded++}),(function(e,i){n.errors[t]="Couldn't load text "+t+": status "+status+", "+i,r&&r(t,"Couldn't load text "+t+": status "+status+", "+i),n.toLoad--,n.loaded++}))},e.prototype.loadTexture=function(t,e,i){var r=this;void 0===e&&(e=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var n=new Image;n.crossOrigin="anonymous",n.onload=function(){var i=r.textureLoader(n);r.assets[t]=i,r.toLoad--,r.loaded++,e&&e(t,n)},n.onerror=function(){r.errors[t]="Couldn't load image "+t,r.toLoad--,r.loaded++,i&&i(t,"Couldn't load image "+t)},n.src=t},e.prototype.loadTextureData=function(t,e,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++;var s=new Image;s.onload=function(){var e=n.textureLoader(s);n.assets[t]=e,n.toLoad--,n.loaded++,i&&i(t,s)},s.onerror=function(){n.errors[t]="Couldn't load image "+t,n.toLoad--,n.loaded++,r&&r(t,"Couldn't load image "+t)},s.src=e},e.prototype.loadTextureAtlas=function(i,r,n){var s=this;void 0===r&&(r=null),void 0===n&&(n=null);var a=i.lastIndexOf("/")>=0?i.substring(0,i.lastIndexOf("/")):"";i=this.pathPrefix+i,this.toLoad++,e.downloadText(i,(function(e){var o={count:0},l=new Array;try{new t.TextureAtlas(e,(function(e){l.push(a+"/"+e);var i=document.createElement("img");return i.width=16,i.height=16,new t.FakeTexture(i)}))}catch(t){var h=t;return s.errors[i]="Couldn't load texture atlas "+i+": "+h.message,n&&n(i,"Couldn't load texture atlas "+i+": "+h.message),s.toLoad--,void s.loaded++}for(var u=function(h){var u=!1;s.loadTexture(h,(function(h){if(o.count++,o.count==l.length)if(u)s.errors[i]="Couldn't load texture atlas page "+h+"} of atlas "+i,n&&n(i,"Couldn't load texture atlas page "+h+" of atlas "+i),s.toLoad--,s.loaded++;else try{var c=new t.TextureAtlas(e,(function(t){return s.get(a+"/"+t)}));s.assets[i]=c,r&&r(i,c),s.toLoad--,s.loaded++}catch(t){var p=t;s.errors[i]="Couldn't load texture atlas "+i+": "+p.message,n&&n(i,"Couldn't load texture atlas "+i+": "+p.message),s.toLoad--,s.loaded++}}),(function(t){u=!0,o.count++,o.count==l.length&&(s.errors[i]="Couldn't load texture atlas page "+t+"} of atlas "+i,n&&n(i,"Couldn't load texture atlas page "+t+" of atlas "+i),s.toLoad--,s.loaded++)}))},c=0,p=l;c<p.length;c++)u(p[c])}),(function(t,e){s.errors[i]="Couldn't load texture atlas "+i+": status "+status+", "+e,n&&n(i,"Couldn't load texture atlas "+i+": status "+status+", "+e),s.toLoad--,s.loaded++}))},e.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},e.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},e.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},e.prototype.isLoadingComplete=function(){return 0==this.toLoad},e.prototype.getToLoad=function(){return this.toLoad},e.prototype.getLoaded=function(){return this.loaded},e.prototype.dispose=function(){this.removeAll()},e.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},e.prototype.getErrors=function(){return this.errors},e}();t.AssetManager=e}(h9||(h9={})),function(t){var e=function(){function e(t){this.atlas=t}return e.prototype.newRegionAttachment=function(e,i,r){var n=this.atlas.findRegion(r);if(null==n)return null;n.renderObject=n;var s=new t.RegionAttachment(i);return s.setRegion(n),s},e.prototype.newMeshAttachment=function(e,i,r){var n=this.atlas.findRegion(r);if(null==n)return null;n.renderObject=n;var s=new t.MeshAttachment(i);return s.region=n,s},e.prototype.newBoundingBoxAttachment=function(e,i){return new t.BoundingBoxAttachment(i)},e.prototype.newPathAttachment=function(e,i){return new t.PathAttachment(i)},e.prototype.newPointAttachment=function(e,i){return new t.PointAttachment(i)},e.prototype.newClippingAttachment=function(e,i){return new t.ClippingAttachment(i)},e}();t.AtlasAttachmentLoader=e}(h9||(h9={})),function(t){var e;(e=t.BlendMode||(t.BlendMode={}))[e.Normal=0]="Normal",e[e.Additive=1]="Additive",e[e.Multiply=2]="Multiply",e[e.Screen=3]="Screen"}(h9||(h9={})),function(t){var e=function(){function e(t,e,i){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}return e.prototype.isActive=function(){return this.active},e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(e,i,r,n,s,a,o){this.ax=e,this.ay=i,this.arotation=r,this.ascaleX=n,this.ascaleY=s,this.ashearX=a,this.ashearY=o,this.appliedValid=!0;var l=this.parent;if(null==l){var h=this.skeleton,u=r+90+o,c=h.scaleX,p=h.scaleY;return this.a=t.MathUtils.cosDeg(r+a)*n*c,this.b=t.MathUtils.cosDeg(u)*s*c,this.c=t.MathUtils.sinDeg(r+a)*n*p,this.d=t.MathUtils.sinDeg(u)*s*p,this.worldX=e*c+h.x,void(this.worldY=i*p+h.y)}var d=l.a,f=l.b,_=l.c,g=l.d;switch(this.worldX=d*e+f*i+l.worldX,this.worldY=_*e+g*i+l.worldY,this.data.transformMode){case t.TransformMode.Normal:u=r+90+o;var m=t.MathUtils.cosDeg(r+a)*n,y=t.MathUtils.cosDeg(u)*s,v=t.MathUtils.sinDeg(r+a)*n,b=t.MathUtils.sinDeg(u)*s;return this.a=d*m+f*v,this.b=d*y+f*b,this.c=_*m+g*v,void(this.d=_*y+g*b);case t.TransformMode.OnlyTranslation:u=r+90+o,this.a=t.MathUtils.cosDeg(r+a)*n,this.b=t.MathUtils.cosDeg(u)*s,this.c=t.MathUtils.sinDeg(r+a)*n,this.d=t.MathUtils.sinDeg(u)*s;break;case t.TransformMode.NoRotationOrReflection:var S=0;(E=d*d+_*_)>1e-4?(f=_*(E=Math.abs(d*g-f*_)/E),g=d*E,S=Math.atan2(_,d)*t.MathUtils.radDeg):(d=0,_=0,S=90-Math.atan2(g,f)*t.MathUtils.radDeg);var T=r+a-S,A=r+o-S+90;m=t.MathUtils.cosDeg(T)*n,y=t.MathUtils.cosDeg(A)*s,v=t.MathUtils.sinDeg(T)*n,b=t.MathUtils.sinDeg(A)*s,this.a=d*m-f*v,this.b=d*y-f*b,this.c=_*m+g*v,this.d=_*y+g*b;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var E,C=t.MathUtils.cosDeg(r),R=t.MathUtils.sinDeg(r),w=(d*C+f*R)/this.skeleton.scaleX,x=(_*C+g*R)/this.skeleton.scaleY;(E=Math.sqrt(w*w+x*x))>1e-5&&(E=1/E),w*=E,x*=E,E=Math.sqrt(w*w+x*x),this.data.transformMode==t.TransformMode.NoScale&&d*g-f*_<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(E=-E);var O=Math.PI/2+Math.atan2(x,w),P=Math.cos(O)*E,D=Math.sin(O)*E;m=t.MathUtils.cosDeg(a)*n,y=t.MathUtils.cosDeg(90+o)*s,v=t.MathUtils.sinDeg(a)*n,b=t.MathUtils.sinDeg(90+o)*s,this.a=w*m+P*v,this.b=w*y+P*b,this.c=x*m+D*v,this.d=x*y+D*b}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},e.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var i=e.a,r=e.b,n=e.c,s=e.d,a=1/(i*s-r*n),o=this.worldX-e.worldX,l=this.worldY-e.worldY;this.ax=o*s*a-l*r*a,this.ay=l*i*a-o*n*a;var h=a*s,u=a*i,c=a*r,p=a*n,d=h*this.a-c*this.c,f=h*this.b-c*this.d,_=u*this.c-p*this.a,g=u*this.d-p*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(d*d+_*_),this.ascaleX>1e-4){var m=d*g-f*_;this.ascaleY=m/this.ascaleX,this.ashearY=Math.atan2(d*f+_*g,m)*t.MathUtils.radDeg,this.arotation=Math.atan2(_,d)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+g*g),this.ashearY=0,this.arotation=90-Math.atan2(g,f)*t.MathUtils.radDeg},e.prototype.worldToLocal=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,s=1/(e*n-i*r),a=t.x-this.worldX,o=t.y-this.worldY;return t.x=a*n*s-o*i*s,t.y=o*e*s-a*r*s,t},e.prototype.localToWorld=function(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t},e.prototype.worldToLocalRotation=function(e){var i=t.MathUtils.sinDeg(e),r=t.MathUtils.cosDeg(e);return Math.atan2(this.a*i-this.c*r,this.d*r-this.b*i)*t.MathUtils.radDeg+this.rotation-this.shearX},e.prototype.localToWorldRotation=function(e){e-=this.rotation-this.shearX;var i=t.MathUtils.sinDeg(e),r=t.MathUtils.cosDeg(e);return Math.atan2(r*this.c+i*this.d,r*this.a+i*this.b)*t.MathUtils.radDeg},e.prototype.rotateWorld=function(e){var i=this.a,r=this.b,n=this.c,s=this.d,a=t.MathUtils.cosDeg(e),o=t.MathUtils.sinDeg(e);this.a=a*i-o*n,this.b=a*r-o*s,this.c=o*i+a*n,this.d=o*r+a*s,this.appliedValid=!1},e}();t.Bone=e}(h9||(h9={})),function(t){var e;t.BoneData=function(i,r,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=e.Normal,this.skinRequired=!1,this.color=new t.Color,i<0)throw new Error("index must be >= 0.");if(null==r)throw new Error("name cannot be null.");this.index=i,this.name=r,this.parent=n},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(h9||(h9={})),function(t){t.ConstraintData=function(t,e,i){this.name=t,this.order=e,this.skinRequired=i}}(h9||(h9={})),function(t){t.Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}(h9||(h9={})),function(t){t.EventData=function(t){this.name=t}}(h9||(h9={})),function(t){var e=function(){function e(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},e.prototype.apply1=function(e,i,r,n,s,a,o){e.appliedValid||e.updateAppliedTransform();var l=e.parent,h=1/(l.a*l.d-l.b*l.c),u=i-l.worldX,c=r-l.worldY,p=(u*l.d-c*l.b)*h-e.ax,d=(c*l.a-u*l.c)*h-e.ay,f=Math.atan2(d,p)*t.MathUtils.radDeg-e.ashearX-e.arotation;e.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);var _=e.ascaleX,g=e.ascaleY;if(n||s){var m=e.data.length*_,y=Math.sqrt(p*p+d*d);if(n&&y<m||s&&y>m&&m>1e-4){var v=(y/m-1)*o+1;_*=v,a&&(g*=v)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+f*o,_,g,e.ashearX,e.ashearY)},e.prototype.apply2=function(e,i,r,n,s,a,o,l){if(0!=l){e.appliedValid||e.updateAppliedTransform(),i.appliedValid||i.updateAppliedTransform();var h=e.ax,u=e.ay,c=e.ascaleX,p=c,d=e.ascaleY,f=i.ascaleX,_=0,g=0,m=0;c<0?(c=-c,_=180,m=-1):(_=0,m=1),d<0&&(d=-d,m=-m),f<0?(f=-f,g=180):g=0;var y=i.ax,v=0,b=0,S=0,T=e.a,A=e.b,E=e.c,C=e.d,R=Math.abs(c-d)<=1e-4;R?(b=T*y+A*(v=i.ay)+e.worldX,S=E*y+C*v+e.worldY):(v=0,b=T*y+e.worldX,S=E*y+e.worldY);var w=e.parent;T=w.a,A=w.b,E=w.c;var x,O,P=1/(T*(C=w.d)-A*E),D=b-w.worldX,M=S-w.worldY,B=(D*C-M*A)*P-h,I=(M*T-D*E)*P-u,L=Math.sqrt(B*B+I*I),F=i.data.length*f;if(L<1e-4)return this.apply1(e,r,n,!1,a,!1,l),void i.updateWorldTransformWith(y,v,0,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY);var k=((D=r-w.worldX)*C-(M=n-w.worldY)*A)*P-h,N=(M*T-D*E)*P-u,G=k*k+N*N;if(0!=o){o*=c*(f+1)/2;var U=Math.sqrt(G),z=U-L-F*c+o;if(z>0){var V=Math.min(1,z/(2*o))-1;G=(k-=(V=(z-o*(1-V*V))/U)*k)*k+(N-=V*N)*N}}t:if(R){var H=(G-L*L-(F*=c)*F)/(2*L*F);H<-1?H=-1:H>1&&(H=1,a&&(p*=(Math.sqrt(G)/(L+F)-1)*l+1)),O=Math.acos(H)*s,T=L+F*H,A=F*Math.sin(O),x=Math.atan2(N*T-k*A,k*T+N*A)}else{var W=(T=c*F)*T,X=(A=d*F)*A,Y=Math.atan2(N,k),j=-2*X*L,K=X-W;if((C=j*j-4*K*(E=X*L*L+W*G-W*X))>=0){var q=Math.sqrt(C);j<0&&(q=-q);var Z=(q=-(j+q)/2)/K,J=E/q,Q=Math.abs(Z)<Math.abs(J)?Z:J;if(Q*Q<=G){M=Math.sqrt(G-Q*Q)*s,x=Y-Math.atan2(M,Q),O=Math.atan2(M/d,(Q-L)/c);break t}}var $=t.MathUtils.PI,tt=L-T,et=tt*tt,it=0,rt=0,nt=L+T,st=nt*nt,at=0;(E=-T*L/(W-X))>=-1&&E<=1&&(E=Math.acos(E),(C=(D=T*Math.cos(E)+L)*D+(M=A*Math.sin(E))*M)<et&&($=E,et=C,tt=D,it=M),C>st&&(rt=E,st=C,nt=D,at=M)),G<=(et+st)/2?(x=Y-Math.atan2(it*s,tt),O=$*s):(x=Y-Math.atan2(at*s,nt),O=rt*s)}var ot=Math.atan2(v,y)*m,lt=e.arotation;(x=(x-ot)*t.MathUtils.radDeg+_-lt)>180?x-=360:x<-180&&(x+=360),e.updateWorldTransformWith(h,u,lt+x*l,p,e.ascaleY,0,0),lt=i.arotation,(O=((O+ot)*t.MathUtils.radDeg-i.ashearX)*m+g-lt)>180?O-=360:O<-180&&(O+=360),i.updateWorldTransformWith(y,v,lt+O*l,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY)}else i.updateWorldTransform()},e}();t.IkConstraint=e}(h9||(h9={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i.bendDirection=1,i.compress=!1,i.stretch=!1,i.uniform=!1,i.mix=1,i.softness=0,i}return u9(e,t),e}(t.ConstraintData);t.IkConstraintData=e}(h9||(h9={})),function(t){var e=function(){function e(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var i=0,r=t.bones.length;i<r;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var i=this.target.getAttachment();if(i instanceof t.PathAttachment){var r=this.rotateMix,n=this.translateMix,s=r>0;if(n>0||s){var a=this.data,o=a.spacingMode==t.SpacingMode.Percent,l=a.rotateMode,h=l==t.RotateMode.Tangent,u=l==t.RotateMode.ChainScale,c=this.bones.length,p=h?c:c+1,d=this.bones,f=t.Utils.setArraySize(this.spaces,p),_=null,g=this.spacing;if(u||!o){u&&(_=t.Utils.setArraySize(this.lengths,c));for(var m=a.spacingMode==t.SpacingMode.Length,y=0,v=p-1;y<v;){var b=(D=d[y]).data.length;if(b<e.epsilon)u&&(_[y]=0),f[++y]=0;else if(o){if(u){var S=b*D.a,T=b*D.c,A=Math.sqrt(S*S+T*T);_[y]=A}f[++y]=g}else{S=b*D.a,T=b*D.c;var E=Math.sqrt(S*S+T*T);u&&(_[y]=E),f[++y]=(m?b+g:g)*E/b}}}else for(y=1;y<p;y++)f[y]=g;var C=this.computeWorldPositions(i,p,h,a.positionMode==t.PositionMode.Percent,o),R=C[0],w=C[1],x=a.offsetRotation,O=!1;0==x?O=l==t.RotateMode.Chain:(O=!1,x*=(P=this.target.bone).a*P.d-P.b*P.c>0?t.MathUtils.degRad:-t.MathUtils.degRad),y=0;for(var P=3;y<c;y++,P+=3){var D;(D=d[y]).worldX+=(R-D.worldX)*n,D.worldY+=(w-D.worldY)*n;var M=(S=C[P])-R,B=(T=C[P+1])-w;if(u){var I=_[y];if(0!=I){var L=(Math.sqrt(M*M+B*B)/I-1)*r+1;D.a*=L,D.c*=L}}if(R=S,w=T,s){var F=D.a,k=D.b,N=D.c,G=D.d,U=0,z=0,V=0;if(U=h?C[P-1]:0==f[y+1]?C[P+2]:Math.atan2(B,M),U-=Math.atan2(N,F),O){z=Math.cos(U),V=Math.sin(U);var H=D.data.length;R+=(H*(z*F-V*N)-M)*r,w+=(H*(V*F+z*N)-B)*r}else U+=x;U>t.MathUtils.PI?U-=t.MathUtils.PI2:U<-t.MathUtils.PI&&(U+=t.MathUtils.PI2),U*=r,z=Math.cos(U),V=Math.sin(U),D.a=z*F-V*N,D.b=z*k-V*G,D.c=V*F+z*N,D.d=V*k+z*G}D.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(i,r,n,s,a){var o=this.target,l=this.position,h=this.spaces,u=t.Utils.setArraySize(this.positions,3*r+2),c=null,p=i.closed,d=i.worldVerticesLength,f=d/6,_=e.NONE;if(!i.constantSpeed){var g=i.lengths,m=g[f-=p?1:2];if(s&&(l*=m),a)for(var y=1;y<r;y++)h[y]*=m;c=t.Utils.setArraySize(this.world,8),y=0;for(var v=0,b=0;y<r;y++,v+=3){var S=l+=X=h[y];if(p)(S%=m)<0&&(S+=m),b=0;else{if(S<0){_!=e.BEFORE&&(_=e.BEFORE,i.computeWorldVertices(o,2,4,c,0,2)),this.addBeforePosition(S,c,0,u,v);continue}if(S>m){_!=e.AFTER&&(_=e.AFTER,i.computeWorldVertices(o,d-6,4,c,0,2)),this.addAfterPosition(S-m,c,0,u,v);continue}}for(;;b++){var T=g[b];if(!(S>T)){0==b?S/=T:S=(S-(q=g[b-1]))/(T-q);break}}b!=_&&(_=b,p&&b==f?(i.computeWorldVertices(o,d-4,4,c,0,2),i.computeWorldVertices(o,0,4,c,4,2)):i.computeWorldVertices(o,6*b+2,8,c,0,2)),this.addCurvePosition(S,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],u,v,n||y>0&&0==X)}return u}p?(d+=2,c=t.Utils.setArraySize(this.world,d),i.computeWorldVertices(o,2,d-4,c,0,2),i.computeWorldVertices(o,0,2,c,d-4,2),c[d-2]=c[0],c[d-1]=c[1]):(f--,d-=4,c=t.Utils.setArraySize(this.world,d),i.computeWorldVertices(o,2,d,c,0,2));for(var A=t.Utils.setArraySize(this.curves,f),E=0,C=c[0],R=c[1],w=0,x=0,O=0,P=0,D=0,M=0,B=0,I=0,L=0,F=0,k=0,N=0,G=0,U=0,z=(y=0,2);y<f;y++,z+=6)w=c[z],x=c[z+1],O=c[z+2],P=c[z+3],k=2*(B=.1875*(C-2*w+O))+(L=.09375*(3*(w-O)-C+(D=c[z+4]))),N=2*(I=.1875*(R-2*x+P))+(F=.09375*(3*(x-P)-R+(M=c[z+5]))),G=.75*(w-C)+B+.16666667*L,U=.75*(x-R)+I+.16666667*F,E+=Math.sqrt(G*G+U*U),G+=k,U+=N,k+=L,N+=F,E+=Math.sqrt(G*G+U*U),G+=k,U+=N,E+=Math.sqrt(G*G+U*U),G+=k+L,U+=N+F,E+=Math.sqrt(G*G+U*U),A[y]=E,C=D,R=M;if(l*=s?E:E/i.lengths[f-1],a)for(y=1;y<r;y++)h[y]*=E;for(var V=this.segments,H=0,W=(y=0,v=0,b=0,0);y<r;y++,v+=3){var X;if(S=l+=X=h[y],p)(S%=E)<0&&(S+=E),b=0;else{if(S<0){this.addBeforePosition(S,c,0,u,v);continue}if(S>E){this.addAfterPosition(S-E,c,d-4,u,v);continue}}for(;;b++){var Y=A[b];if(!(S>Y)){0==b?S/=Y:S=(S-(q=A[b-1]))/(Y-q);break}}if(b!=_){_=b;var j=6*b;for(C=c[j],R=c[j+1],w=c[j+2],x=c[j+3],O=c[j+4],P=c[j+5],k=2*(B=.03*(C-2*w+O))+(L=.006*(3*(w-O)-C+(D=c[j+6]))),N=2*(I=.03*(R-2*x+P))+(F=.006*(3*(x-P)-R+(M=c[j+7]))),G=.3*(w-C)+B+.16666667*L,U=.3*(x-R)+I+.16666667*F,H=Math.sqrt(G*G+U*U),V[0]=H,j=1;j<8;j++)G+=k,U+=N,k+=L,N+=F,H+=Math.sqrt(G*G+U*U),V[j]=H;G+=k,U+=N,H+=Math.sqrt(G*G+U*U),V[8]=H,G+=k+L,U+=N+F,H+=Math.sqrt(G*G+U*U),V[9]=H,W=0}for(S*=H;;W++){var K=V[W];if(!(S>K)){var q;0==W?S/=K:S=W+(S-(q=V[W-1]))/(K-q);break}}this.addCurvePosition(.1*S,C,R,w,x,O,P,D,M,u,v,n||y>0&&0==X)}return u},e.prototype.addBeforePosition=function(t,e,i,r,n){var s=e[i],a=e[i+1],o=e[i+2]-s,l=e[i+3]-a,h=Math.atan2(l,o);r[n]=s+t*Math.cos(h),r[n+1]=a+t*Math.sin(h),r[n+2]=h},e.prototype.addAfterPosition=function(t,e,i,r,n){var s=e[i+2],a=e[i+3],o=s-e[i],l=a-e[i+1],h=Math.atan2(l,o);r[n]=s+t*Math.cos(h),r[n+1]=a+t*Math.sin(h),r[n+2]=h},e.prototype.addCurvePosition=function(t,e,i,r,n,s,a,o,l,h,u,c){if(0==t||isNaN(t))return h[u]=e,h[u+1]=i,void(h[u+2]=Math.atan2(n-i,r-e));var p=t*t,d=p*t,f=1-t,_=f*f,g=_*f,m=f*t,y=3*m,v=f*y,b=y*t,S=e*g+r*v+s*b+o*d,T=i*g+n*v+a*b+l*d;h[u]=S,h[u+1]=T,c&&(h[u+2]=t<.001?Math.atan2(n-i,r-e):Math.atan2(T-(i*_+n*m*2+a*p),S-(e*_+r*m*2+s*p)))},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,e.epsilon=1e-5,e}();t.PathConstraint=e}(h9||(h9={})),function(t){var e,i,r,n=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i}return u9(e,t),e}(t.ConstraintData);t.PathConstraintData=n,(r=t.PositionMode||(t.PositionMode={}))[r.Fixed=0]="Fixed",r[r.Percent=1]="Percent",(i=t.SpacingMode||(t.SpacingMode={}))[i.Length=0]="Length",i[i.Fixed=1]="Fixed",i[i.Percent=2]="Percent",(e=t.RotateMode||(t.RotateMode={}))[e.Tangent=0]="Tangent",e[e.Chain=1]="Chain",e[e.ChainScale=2]="ChainScale"}(h9||(h9={})),function(t){var e=function(){function t(t){this.toLoad=new Array,this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t},t}(),i=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,i,r){var n=this.clientAssets[t];return null==n&&(n=new e(t),this.clientAssets[t]=n),null!==i&&(n.textureLoader=i),n.toLoad.push(r),this.queuedAssets[r]!==r&&(this.queuedAssets[r]=r,!0)},t.prototype.loadText=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(r.status>=200&&r.status<300?i.rawAssets[e]=r.responseText:i.errors[e]="Couldn't load text "+e+": status "+r.status+", "+r.responseText)},r.open("GET",e,!0),r.send()}},t.prototype.loadJson=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(r.status>=200&&r.status<300?i.rawAssets[e]=JSON.parse(r.responseText):i.errors[e]="Couldn't load text "+e+": status "+r.status+", "+r.responseText)},r.open("GET",e,!0),r.send()}},t.prototype.loadTexture=function(t,e,i){var r=this;if(i=this.pathPrefix+i,this.queueAsset(t,e,i)){var n=new Image;n.src=i,n.crossOrigin="anonymous",n.onload=function(){r.rawAssets[i]=n},n.onerror=function(){r.errors[i]="Couldn't load image "+i}}},t.prototype.get=function(t,e){e=this.pathPrefix+e;var i=this.clientAssets[t];return null==i||i.assets[e]},t.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var i=t.toLoad[e];if(null==t.assets[i]){var r=this.rawAssets[i];if(null==r)continue;r instanceof HTMLImageElement?t.assets[i]=t.textureLoader(r):t.assets[i]=r}}},t.prototype.isLoadingComplete=function(t){var e=this.clientAssets[t];return null==e||(this.updateClientAssets(e),e.toLoad.length==e.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=i}(h9||(h9={})),function(t){var e=function(){function e(e){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var i=0;i<e.bones.length;i++){var r=e.bones[i],n=void 0;if(null==r.parent)n=new t.Bone(r,this,null);else{var s=this.bones[r.parent.index];n=new t.Bone(r,this,s),s.children.push(n)}this.bones.push(n)}for(this.slots=new Array,this.drawOrder=new Array,i=0;i<e.slots.length;i++){var a=e.slots[i],o=(n=this.bones[a.boneData.index],new t.Slot(a,n));this.slots.push(o),this.drawOrder.push(o)}for(this.ikConstraints=new Array,i=0;i<e.ikConstraints.length;i++){var l=e.ikConstraints[i];this.ikConstraints.push(new t.IkConstraint(l,this))}for(this.transformConstraints=new Array,i=0;i<e.transformConstraints.length;i++){var h=e.transformConstraints[i];this.transformConstraints.push(new t.TransformConstraint(h,this))}for(this.pathConstraints=new Array,i=0;i<e.pathConstraints.length;i++){var u=e.pathConstraints[i];this.pathConstraints.push(new t.PathConstraint(u,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,i=t.length;e<i;e++)(n=t[e]).sorted=n.data.skinRequired,n.active=!n.sorted;if(null!=this.skin){var r=this.skin.bones;for(e=0,i=this.skin.bones.length;e<i;e++){var n=this.bones[r[e].index];do{n.sorted=!1,n.active=!0,n=n.parent}while(null!=n)}}var s=this.ikConstraints,a=this.transformConstraints,o=this.pathConstraints,l=s.length,h=a.length,u=o.length,c=l+h+u;t:for(e=0;e<c;e++){for(var p=0;p<l;p++)if((d=s[p]).data.order==e){this.sortIkConstraint(d);continue t}for(p=0;p<h;p++)if((d=a[p]).data.order==e){this.sortTransformConstraint(d);continue t}for(p=0;p<u;p++){var d;if((d=o[p]).data.order==e){this.sortPathConstraint(d);continue t}}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e])},e.prototype.sortIkConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var i=e.target;this.sortBone(i);var r=e.bones,n=r[0];if(this.sortBone(n),r.length>1){var s=r[r.length-1];this._updateCache.indexOf(s)>-1||this.updateCacheReset.push(s)}this._updateCache.push(e),this.sortReset(n.children),r[r.length-1].sorted=!0}},e.prototype.sortPathConstraint=function(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var i=e.target,r=i.data.index,n=i.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,r,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,r,n);for(var s=0,a=this.data.skins.length;s<a;s++)this.sortPathConstraintAttachment(this.data.skins[s],r,n);var o=i.getAttachment();o instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(o,n);var l=e.bones,h=l.length;for(s=0;s<h;s++)this.sortBone(l[s]);for(this._updateCache.push(e),s=0;s<h;s++)this.sortReset(l[s].children);for(s=0;s<h;s++)l[s].sorted=!0}},e.prototype.sortTransformConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){this.sortBone(e.target);var i=e.bones,r=i.length;if(e.data.local)for(var n=0;n<r;n++){var s=i[n];this.sortBone(s.parent),this._updateCache.indexOf(s)>-1||this.updateCacheReset.push(s)}else for(n=0;n<r;n++)this.sortBone(i[n]);this._updateCache.push(e);for(var a=0;a<r;a++)this.sortReset(i[a].children);for(a=0;a<r;a++)i[a].sorted=!0}},e.prototype.sortPathConstraintAttachment=function(t,e,i){var r=t.attachments[e];if(r)for(var n in r)this.sortPathConstraintAttachmentWith(r[n],i)},e.prototype.sortPathConstraintAttachmentWith=function(e,i){if(e instanceof t.PathAttachment){var r=e.bones;if(null==r)this.sortBone(i);else for(var n=this.bones,s=0;s<r.length;)for(var a=r[s++],o=s+a;s<o;s++){var l=r[s];this.sortBone(n[l])}}},e.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},e.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1)}},e.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,i=t.length;e<i;e++){var r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}var n=this._updateCache;for(e=0,i=n.length;e<i;e++)n[e].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var r=this.ikConstraints;for(e=0,i=r.length;e<i;e++)(o=r[e]).mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch;var n=this.transformConstraints;for(e=0,i=n.length;e<i;e++){var s=(o=n[e]).data;o.rotateMix=s.rotateMix,o.translateMix=s.translateMix,o.scaleMix=s.scaleMix,o.shearMix=s.shearMix}var a=this.pathConstraints;for(e=0,i=a.length;e<i;e++){var o;s=(o=a[e]).data,o.position=s.position,o.spacing=s.spacing,o.rotateMix=s.rotateMix,o.translateMix=s.translateMix}},e.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var i=0,r=e.length;i<r;i++)e[i].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++)if(e[i].data.name==t)return i;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++)if(e[i].data.name==t)return i;return-1},e.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},e.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i],s=n.data.attachmentName;if(null!=s){var a=t.getAttachment(i,s);null!=a&&n.setAttachment(a)}}this.skin=t,this.updateCache()}},e.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},e.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},e.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,r=0,n=i.length;r<n;r++){var s=i[r];if(s.data.name==t){var a=null;if(null!=e&&null==(a=this.getAttachment(r,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void s.setAttachment(a)}}throw new Error("Slot not found: "+t)},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.getBounds=function(e,i,r){if(void 0===r&&(r=new Array(2)),null==e)throw new Error("offset cannot be null.");if(null==i)throw new Error("size cannot be null.");for(var n=this.drawOrder,s=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=0,u=n.length;h<u;h++){var c=n[h];if(c.bone.active){var p=0,d=null,f=c.getAttachment();if(f instanceof t.RegionAttachment)p=8,d=t.Utils.setArraySize(r,p,0),f.computeWorldVertices(c.bone,d,0,2);else if(f instanceof t.MeshAttachment){var _=f;p=_.worldVerticesLength,d=t.Utils.setArraySize(r,p,0),_.computeWorldVertices(c,0,p,d,0,2)}if(null!=d)for(var g=0,m=d.length;g<m;g+=2){var y=d[g],v=d[g+1];s=Math.min(s,y),a=Math.min(a,v),o=Math.max(o,y),l=Math.max(l,v)}}}e.set(s,a),i.set(o-s,l-a)},e.prototype.update=function(t){this.time+=t},e}();t.Skeleton=e}(h9||(h9={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(r){var n=this.scale,s=new t.SkeletonData;s.name="";var a=new i(r);s.hash=a.readString(),s.version=a.readString(),s.x=a.readFloat(),s.y=a.readFloat(),s.width=a.readFloat(),s.height=a.readFloat();var o=a.readBoolean();o&&(s.fps=a.readFloat(),s.imagesPath=a.readString(),s.audioPath=a.readString());var l=0;l=a.readInt(!0);for(var h=0;h<l;h++)a.strings.push(a.readString());for(l=a.readInt(!0),h=0;h<l;h++){var u=a.readString(),c=0==h?null:s.bones[a.readInt(!0)];(f=new t.BoneData(h,u,c)).rotation=a.readFloat(),f.x=a.readFloat()*n,f.y=a.readFloat()*n,f.scaleX=a.readFloat(),f.scaleY=a.readFloat(),f.shearX=a.readFloat(),f.shearY=a.readFloat(),f.length=a.readFloat()*n,f.transformMode=e.TransformModeValues[a.readInt(!0)],f.skinRequired=a.readBoolean(),o&&t.Color.rgba8888ToColor(f.color,a.readInt32()),s.bones.push(f)}for(l=a.readInt(!0),h=0;h<l;h++){var p=a.readString(),d=s.bones[a.readInt(!0)],f=new t.SlotData(h,p,d);t.Color.rgba8888ToColor(f.color,a.readInt32());var _=a.readInt32();-1!=_&&t.Color.rgb888ToColor(f.darkColor=new t.Color,_),f.attachmentName=a.readStringRef(),f.blendMode=e.BlendModeValues[a.readInt(!0)],s.slots.push(f)}l=a.readInt(!0),h=0;for(var g=void 0;h<l;h++){(f=new t.IkConstraintData(a.readString())).order=a.readInt(!0),f.skinRequired=a.readBoolean(),g=a.readInt(!0);for(var m=0;m<g;m++)f.bones.push(s.bones[a.readInt(!0)]);f.target=s.bones[a.readInt(!0)],f.mix=a.readFloat(),f.softness=a.readFloat()*n,f.bendDirection=a.readByte(),f.compress=a.readBoolean(),f.stretch=a.readBoolean(),f.uniform=a.readBoolean(),s.ikConstraints.push(f)}for(l=a.readInt(!0),h=0,g=void 0;h<l;h++){for((f=new t.TransformConstraintData(a.readString())).order=a.readInt(!0),f.skinRequired=a.readBoolean(),g=a.readInt(!0),m=0;m<g;m++)f.bones.push(s.bones[a.readInt(!0)]);f.target=s.bones[a.readInt(!0)],f.local=a.readBoolean(),f.relative=a.readBoolean(),f.offsetRotation=a.readFloat(),f.offsetX=a.readFloat()*n,f.offsetY=a.readFloat()*n,f.offsetScaleX=a.readFloat(),f.offsetScaleY=a.readFloat(),f.offsetShearY=a.readFloat(),f.rotateMix=a.readFloat(),f.translateMix=a.readFloat(),f.scaleMix=a.readFloat(),f.shearMix=a.readFloat(),s.transformConstraints.push(f)}for(l=a.readInt(!0),h=0,g=void 0;h<l;h++){for((f=new t.PathConstraintData(a.readString())).order=a.readInt(!0),f.skinRequired=a.readBoolean(),g=a.readInt(!0),m=0;m<g;m++)f.bones.push(s.bones[a.readInt(!0)]);f.target=s.slots[a.readInt(!0)],f.positionMode=e.PositionModeValues[a.readInt(!0)],f.spacingMode=e.SpacingModeValues[a.readInt(!0)],f.rotateMode=e.RotateModeValues[a.readInt(!0)],f.offsetRotation=a.readFloat(),f.position=a.readFloat(),f.positionMode==t.PositionMode.Fixed&&(f.position*=n),f.spacing=a.readFloat(),f.spacingMode!=t.SpacingMode.Length&&f.spacingMode!=t.SpacingMode.Fixed||(f.spacing*=n),f.rotateMix=a.readFloat(),f.translateMix=a.readFloat(),s.pathConstraints.push(f)}var y=this.readSkin(a,s,!0,o);for(null!=y&&(s.defaultSkin=y,s.skins.push(y)),h=s.skins.length,t.Utils.setArraySize(s.skins,l=h+a.readInt(!0));h<l;h++)s.skins[h]=this.readSkin(a,s,!1,o);for(l=this.linkedMeshes.length,h=0;h<l;h++){var v=this.linkedMeshes[h],b=null==v.skin?s.defaultSkin:s.findSkin(v.skin);if(null==b)throw new Error("Skin not found: "+v.skin);var S=b.getAttachment(v.slotIndex,v.parent);if(null==S)throw new Error("Parent mesh not found: "+v.parent);v.mesh.deformAttachment=v.inheritDeform?S:v.mesh,v.mesh.setParentMesh(S),v.mesh.updateUVs()}for(this.linkedMeshes.length=0,l=a.readInt(!0),h=0;h<l;h++)(f=new t.EventData(a.readStringRef())).intValue=a.readInt(!1),f.floatValue=a.readFloat(),f.stringValue=a.readString(),f.audioPath=a.readString(),null!=f.audioPath&&(f.volume=a.readFloat(),f.balance=a.readFloat()),s.events.push(f);for(l=a.readInt(!0),h=0;h<l;h++)s.animations.push(this.readAnimation(a,a.readString(),s));return s},e.prototype.readSkin=function(e,i,r,n){var s=null,a=0;if(r){if(0==(a=e.readInt(!0)))return null;s=new t.Skin("default")}else{(s=new t.Skin(e.readStringRef())).bones.length=e.readInt(!0);for(var o=0,l=s.bones.length;o<l;o++)s.bones[o]=i.bones[e.readInt(!0)];for(o=0,l=e.readInt(!0);o<l;o++)s.constraints.push(i.ikConstraints[e.readInt(!0)]);for(o=0,l=e.readInt(!0);o<l;o++)s.constraints.push(i.transformConstraints[e.readInt(!0)]);for(o=0,l=e.readInt(!0);o<l;o++)s.constraints.push(i.pathConstraints[e.readInt(!0)]);a=e.readInt(!0)}for(o=0;o<a;o++)for(var h=e.readInt(!0),u=0,c=e.readInt(!0);u<c;u++){var p=e.readStringRef(),d=this.readAttachment(e,i,s,h,p,n);null!=d&&s.setAttachment(h,p,d)}return s},e.prototype.readAttachment=function(i,n,s,a,o,l){var h=this.scale,u=i.readStringRef();null==u&&(u=o);var c=i.readByte();switch(e.AttachmentTypeValues[c]){case t.AttachmentType.Region:var p=i.readStringRef(),d=i.readFloat(),f=i.readFloat(),_=i.readFloat(),g=i.readFloat(),m=i.readFloat(),y=i.readFloat(),v=i.readFloat(),b=i.readInt32();null==p&&(p=u);var S=this.attachmentLoader.newRegionAttachment(s,u,p);return null==S?null:(S.path=p,S.x=f*h,S.y=_*h,S.scaleX=g,S.scaleY=m,S.rotation=d,S.width=y*h,S.height=v*h,t.Color.rgba8888ToColor(S.color,b),S.updateOffset(),S);case t.AttachmentType.BoundingBox:var T=i.readInt(!0),A=this.readVertices(i,T),E=(b=l?i.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(s,u));return null==E?null:(E.worldVerticesLength=T<<1,E.vertices=A.vertices,E.bones=A.bones,l&&t.Color.rgba8888ToColor(E.color,b),E);case t.AttachmentType.Mesh:p=i.readStringRef(),b=i.readInt32(),T=i.readInt(!0);var C=this.readFloatArray(i,T<<1,1),R=this.readShortArray(i),w=(A=this.readVertices(i,T),i.readInt(!0)),x=null;return y=0,v=0,l&&(x=this.readShortArray(i),y=i.readFloat(),v=i.readFloat()),null==p&&(p=u),null==(O=this.attachmentLoader.newMeshAttachment(s,u,p))?null:(O.path=p,t.Color.rgba8888ToColor(O.color,b),O.bones=A.bones,O.vertices=A.vertices,O.worldVerticesLength=T<<1,O.triangles=R,O.regionUVs=C,O.updateUVs(),O.hullLength=w<<1,l&&(O.edges=x,O.width=y*h,O.height=v*h),O);case t.AttachmentType.LinkedMesh:p=i.readStringRef(),b=i.readInt32();var O,P=i.readStringRef(),D=i.readStringRef(),M=i.readBoolean();return y=0,v=0,l&&(y=i.readFloat(),v=i.readFloat()),null==p&&(p=u),null==(O=this.attachmentLoader.newMeshAttachment(s,u,p))?null:(O.path=p,t.Color.rgba8888ToColor(O.color,b),l&&(O.width=y*h,O.height=v*h),this.linkedMeshes.push(new r(O,P,a,D,M)),O);case t.AttachmentType.Path:for(var B=i.readBoolean(),I=i.readBoolean(),L=(T=i.readInt(!0),A=this.readVertices(i,T),t.Utils.newArray(T/3,0)),F=0,k=L.length;F<k;F++)L[F]=i.readFloat()*h;return b=l?i.readInt32():0,null==(p=this.attachmentLoader.newPathAttachment(s,u))?null:(p.closed=B,p.constantSpeed=I,p.worldVerticesLength=T<<1,p.vertices=A.vertices,p.bones=A.bones,p.lengths=L,l&&t.Color.rgba8888ToColor(p.color,b),p);case t.AttachmentType.Point:d=i.readFloat(),f=i.readFloat(),_=i.readFloat(),b=l?i.readInt32():0;var N=this.attachmentLoader.newPointAttachment(s,u);return null==N?null:(N.x=f*h,N.y=_*h,N.rotation=d,l&&t.Color.rgba8888ToColor(N.color,b),N);case t.AttachmentType.Clipping:var G=i.readInt(!0),U=(T=i.readInt(!0),A=this.readVertices(i,T),b=l?i.readInt32():0,this.attachmentLoader.newClippingAttachment(s,u));return null==U?null:(U.endSlot=n.slots[G],U.worldVerticesLength=T<<1,U.vertices=A.vertices,U.bones=A.bones,l&&t.Color.rgba8888ToColor(U.color,b),U)}return null},e.prototype.readVertices=function(e,i){var r=i<<1,s=new n,a=this.scale;if(!e.readBoolean())return s.vertices=this.readFloatArray(e,r,a),s;for(var o=new Array,l=new Array,h=0;h<i;h++){var u=e.readInt(!0);l.push(u);for(var c=0;c<u;c++)l.push(e.readInt(!0)),o.push(e.readFloat()*a),o.push(e.readFloat()*a),o.push(e.readFloat())}return s.vertices=t.Utils.toFloatArray(o),s.bones=l,s},e.prototype.readFloatArray=function(t,e,i){var r=new Array(e);if(1==i)for(var n=0;n<e;n++)r[n]=t.readFloat();else for(n=0;n<e;n++)r[n]=t.readFloat()*i;return r},e.prototype.readShortArray=function(t){for(var e=t.readInt(!0),i=new Array(e),r=0;r<e;r++)i[r]=t.readShort();return i},e.prototype.readAnimation=function(i,r,n){for(var s=new Array,a=this.scale,o=0,l=new t.Color,h=new t.Color,u=0,c=i.readInt(!0);u<c;u++)for(var p=i.readInt(!0),d=0,f=i.readInt(!0);d<f;d++){var _=i.readByte(),g=i.readInt(!0);switch(_){case e.SLOT_ATTACHMENT:(b=new t.AttachmentTimeline(g)).slotIndex=p;for(var m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readStringRef());s.push(b),o=Math.max(o,b.frames[g-1]);break;case e.SLOT_COLOR:for((b=new t.ColorTimeline(g)).slotIndex=p,m=0;m<g;m++){var y=i.readFloat();t.Color.rgba8888ToColor(l,i.readInt32()),b.setFrame(m,y,l.r,l.g,l.b,l.a),m<g-1&&this.readCurve(i,m,b)}s.push(b),o=Math.max(o,b.frames[(g-1)*t.ColorTimeline.ENTRIES]);break;case e.SLOT_TWO_COLOR:for((b=new t.TwoColorTimeline(g)).slotIndex=p,m=0;m<g;m++)y=i.readFloat(),t.Color.rgba8888ToColor(l,i.readInt32()),t.Color.rgb888ToColor(h,i.readInt32()),b.setFrame(m,y,l.r,l.g,l.b,l.a,h.r,h.g,h.b),m<g-1&&this.readCurve(i,m,b);s.push(b),o=Math.max(o,b.frames[(g-1)*t.TwoColorTimeline.ENTRIES])}}for(u=0,c=i.readInt(!0);u<c;u++){var v=i.readInt(!0);for(d=0,f=i.readInt(!0);d<f;d++)switch(_=i.readByte(),g=i.readInt(!0),_){case e.BONE_ROTATE:for((b=new t.RotateTimeline(g)).boneIndex=v,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat()),m<g-1&&this.readCurve(i,m,b);s.push(b),o=Math.max(o,b.frames[(g-1)*t.RotateTimeline.ENTRIES]);break;case e.BONE_TRANSLATE:case e.BONE_SCALE:case e.BONE_SHEAR:var b=void 0,S=1;for(_==e.BONE_SCALE?b=new t.ScaleTimeline(g):_==e.BONE_SHEAR?b=new t.ShearTimeline(g):(b=new t.TranslateTimeline(g),S=a),b.boneIndex=v,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat()*S,i.readFloat()*S),m<g-1&&this.readCurve(i,m,b);s.push(b),o=Math.max(o,b.frames[(g-1)*t.TranslateTimeline.ENTRIES])}}for(u=0,c=i.readInt(!0);u<c;u++){var T=i.readInt(!0);for(g=i.readInt(!0),(b=new t.IkConstraintTimeline(g)).ikConstraintIndex=T,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat(),i.readFloat()*a,i.readByte(),i.readBoolean(),i.readBoolean()),m<g-1&&this.readCurve(i,m,b);s.push(b),o=Math.max(o,b.frames[(g-1)*t.IkConstraintTimeline.ENTRIES])}for(u=0,c=i.readInt(!0);u<c;u++){for(T=i.readInt(!0),g=i.readInt(!0),(b=new t.TransformConstraintTimeline(g)).transformConstraintIndex=T,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat()),m<g-1&&this.readCurve(i,m,b);s.push(b),o=Math.max(o,b.frames[(g-1)*t.TransformConstraintTimeline.ENTRIES])}for(u=0,c=i.readInt(!0);u<c;u++){T=i.readInt(!0);var A=n.pathConstraints[T];for(d=0,f=i.readInt(!0);d<f;d++)switch(_=i.readByte(),g=i.readInt(!0),_){case e.PATH_POSITION:case e.PATH_SPACING:for(b=void 0,S=1,_==e.PATH_SPACING?(b=new t.PathConstraintSpacingTimeline(g),A.spacingMode!=t.SpacingMode.Length&&A.spacingMode!=t.SpacingMode.Fixed||(S=a)):(b=new t.PathConstraintPositionTimeline(g),A.positionMode==t.PositionMode.Fixed&&(S=a)),b.pathConstraintIndex=T,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat()*S),m<g-1&&this.readCurve(i,m,b);s.push(b),o=Math.max(o,b.frames[(g-1)*t.PathConstraintPositionTimeline.ENTRIES]);break;case e.PATH_MIX:for((b=new t.PathConstraintMixTimeline(g)).pathConstraintIndex=T,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat(),i.readFloat()),m<g-1&&this.readCurve(i,m,b);s.push(b),o=Math.max(o,b.frames[(g-1)*t.PathConstraintMixTimeline.ENTRIES])}}for(u=0,c=i.readInt(!0);u<c;u++){var E=n.skins[i.readInt(!0)];for(d=0,f=i.readInt(!0);d<f;d++){p=i.readInt(!0);for(var C=0,R=i.readInt(!0);C<R;C++){var w=E.getAttachment(p,i.readStringRef()),x=null!=w.bones,O=w.vertices,P=x?O.length/3*2:O.length;for(g=i.readInt(!0),(b=new t.DeformTimeline(g)).slotIndex=p,b.attachment=w,m=0;m<g;m++){y=i.readFloat();var D=void 0,M=i.readInt(!0);if(0==M)D=x?t.Utils.newFloatArray(P):O;else{D=t.Utils.newFloatArray(P);var B=i.readInt(!0);if(M+=B,1==a)for(var I=B;I<M;I++)D[I]=i.readFloat();else for(I=B;I<M;I++)D[I]=i.readFloat()*a;if(!x){I=0;for(var L=D.length;I<L;I++)D[I]+=O[I]}}b.setFrame(m,y,D),m<g-1&&this.readCurve(i,m,b)}s.push(b),o=Math.max(o,b.frames[g-1])}}}var F=i.readInt(!0);if(F>0){b=new t.DrawOrderTimeline(F);var k=n.slots.length;for(u=0;u<F;u++){y=i.readFloat();var N=i.readInt(!0),G=t.Utils.newArray(k,0);for(d=k-1;d>=0;d--)G[d]=-1;var U=t.Utils.newArray(k-N,0),z=0,V=0;for(d=0;d<N;d++){for(p=i.readInt(!0);z!=p;)U[V++]=z++;G[z+i.readInt(!0)]=z++}for(;z<k;)U[V++]=z++;for(d=k-1;d>=0;d--)-1==G[d]&&(G[d]=U[--V]);b.setFrame(u,y,G)}s.push(b),o=Math.max(o,b.frames[F-1])}var H=i.readInt(!0);if(H>0){for(b=new t.EventTimeline(H),u=0;u<H;u++){y=i.readFloat();var W=n.events[i.readInt(!0)],X=new t.Event(y,W);X.intValue=i.readInt(!1),X.floatValue=i.readFloat(),X.stringValue=i.readBoolean()?i.readString():W.stringValue,null!=X.data.audioPath&&(X.volume=i.readFloat(),X.balance=i.readFloat()),b.setFrame(u,X)}s.push(b),o=Math.max(o,b.frames[H-1])}return new t.Animation(r,s,o)},e.prototype.readCurve=function(t,i,r){switch(t.readByte()){case e.CURVE_STEPPED:r.setStepped(i);break;case e.CURVE_BEZIER:this.setCurve(r,i,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},e.prototype.setCurve=function(t,e,i,r,n,s){t.setCurve(e,i,r,n,s)},e.AttachmentTypeValues=[0,1,2,3,4,5,6],e.TransformModeValues=[t.TransformMode.Normal,t.TransformMode.OnlyTranslation,t.TransformMode.NoRotationOrReflection,t.TransformMode.NoScale,t.TransformMode.NoScaleOrReflection],e.PositionModeValues=[t.PositionMode.Fixed,t.PositionMode.Percent],e.SpacingModeValues=[t.SpacingMode.Length,t.SpacingMode.Fixed,t.SpacingMode.Percent],e.RotateModeValues=[t.RotateMode.Tangent,t.RotateMode.Chain,t.RotateMode.ChainScale],e.BlendModeValues=[t.BlendMode.Normal,t.BlendMode.Additive,t.BlendMode.Multiply,t.BlendMode.Screen],e.BONE_ROTATE=0,e.BONE_TRANSLATE=1,e.BONE_SCALE=2,e.BONE_SHEAR=3,e.SLOT_ATTACHMENT=0,e.SLOT_COLOR=1,e.SLOT_TWO_COLOR=2,e.PATH_POSITION=0,e.PATH_SPACING=1,e.PATH_MIX=2,e.CURVE_LINEAR=0,e.CURVE_STEPPED=1,e.CURVE_BEZIER=2,e}();t.SkeletonBinary=e;var i=function(){function t(t,e,i,r){void 0===e&&(e=new Array),void 0===i&&(i=0),void 0===r&&(r=new DataView(t.buffer)),this.strings=e,this.index=i,this.buffer=r}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},t.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},t.prototype.readInt=function(t){var e=this.readByte(),i=127&e;return 0!=(128&e)&&(i|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<28)))),t?i:i>>>1^-(1&i)},t.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},t.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",i=0;i<t;){var r=this.readByte();switch(r>>4){case 12:case 13:e+=String.fromCharCode((31&r)<<6|63&this.readByte()),i+=2;break;case 14:e+=String.fromCharCode((15&r)<<12|(63&this.readByte())<<6|63&this.readByte()),i+=3;break;default:e+=String.fromCharCode(r),i++}}return e},t.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}(),r=function(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritDeform=n},n=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e}}(h9||(h9={})),function(t){var e=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return e.prototype.update=function(e,i){if(null==e)throw new Error("skeleton cannot be null.");var r=this.boundingBoxes,n=this.polygons,s=this.polygonPool,a=e.slots,o=a.length;r.length=0,s.freeAll(n),n.length=0;for(var l=0;l<o;l++){var h=a[l];if(h.bone.active){var u=h.getAttachment();if(u instanceof t.BoundingBoxAttachment){var c=u;r.push(c);var p=s.obtain();p.length!=c.worldVerticesLength&&(p=t.Utils.newFloatArray(c.worldVerticesLength)),n.push(p),c.computeWorldVertices(h,0,c.worldVerticesLength,p,0,2)}}}i?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=this.polygons,s=0,a=n.length;s<a;s++)for(var o=n[s],l=o,h=0,u=o.length;h<u;h+=2){var c=l[h],p=l[h+1];t=Math.min(t,c),e=Math.min(e,p),i=Math.max(i,c),r=Math.max(r,p)}this.minX=t,this.minY=e,this.maxX=i,this.maxY=r},e.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},e.prototype.aabbIntersectsSegment=function(t,e,i,r){var n=this.minX,s=this.minY,a=this.maxX,o=this.maxY;if(t<=n&&i<=n||e<=s&&r<=s||t>=a&&i>=a||e>=o&&r>=o)return!1;var l=(r-e)/(i-t),h=l*(n-t)+e;if(h>s&&h<o)return!0;if((h=l*(a-t)+e)>s&&h<o)return!0;var u=(s-e)/l+t;return u>n&&u<a||(u=(o-e)/l+t)>n&&u<a},e.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.containsPoint=function(t,e){for(var i=this.polygons,r=0,n=i.length;r<n;r++)if(this.containsPointPolygon(i[r],t,e))return this.boundingBoxes[r];return null},e.prototype.containsPointPolygon=function(t,e,i){for(var r=t,n=t.length,s=n-2,a=!1,o=0;o<n;o+=2){var l=r[o+1],h=r[s+1];if(l<i&&h>=i||h<i&&l>=i){var u=r[o];u+(i-l)/(h-l)*(r[s]-u)<e&&(a=!a)}s=o}return a},e.prototype.intersectsSegment=function(t,e,i,r){for(var n=this.polygons,s=0,a=n.length;s<a;s++)if(this.intersectsSegmentPolygon(n[s],t,e,i,r))return this.boundingBoxes[s];return null},e.prototype.intersectsSegmentPolygon=function(t,e,i,r,n){for(var s=t,a=t.length,o=e-r,l=i-n,h=e*n-i*r,u=s[a-2],c=s[a-1],p=0;p<a;p+=2){var d=s[p],f=s[p+1],_=u*f-c*d,g=u-d,m=c-f,y=o*m-l*g,v=(h*g-o*_)/y;if((v>=u&&v<=d||v>=d&&v<=u)&&(v>=e&&v<=r||v>=r&&v<=e)){var b=(h*m-l*_)/y;if((b>=c&&b<=f||b>=f&&b<=c)&&(b>=i&&b<=n||b>=n&&b<=i))return!0}u=d,c=f}return!1},e.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();t.SkeletonBounds=e}(h9||(h9={})),function(t){var e=function(){function e(){this.triangulator=new t.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return e.prototype.clipStart=function(i,r){if(null!=this.clipAttachment)return 0;this.clipAttachment=r;var n=r.worldVerticesLength,s=t.Utils.setArraySize(this.clippingPolygon,n);r.computeWorldVertices(i,0,n,s,0,2);var a=this.clippingPolygon;e.makeClockwise(a);for(var o=this.clippingPolygons=this.triangulator.decompose(a,this.triangulator.triangulate(a)),l=0,h=o.length;l<h;l++){var u=o[l];e.makeClockwise(u),u.push(u[0]),u.push(u[1])}return o.length},e.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(e,i,r,n,s,a,o,l,h,u,c){void 0===h&&(h=2),void 0===u&&(u=0),void 0===c&&(c=0);var p=this.clipOutput,d=this.clippedVertices,f=this.clippedTriangles,_=this.clippingPolygons,g=this.clippingPolygons.length,m=l?12:8,y=0;d.length=0,f.length=0;t:for(var v=0;v<n;v+=3)for(var b=r[v]*h,S=e[b+u],T=e[b+u+1],A=s[b+c],E=s[b+c+1],C=e[(b=r[v+1]*h)+u],R=e[b+u+1],w=s[b+c],x=s[b+c+1],O=e[(b=r[v+2]*h)+u],P=e[b+u+1],D=s[b+c],M=s[b+c+1],B=0;B<g;B++){var I=d.length;if(!this.clip(S,T,C,R,O,P,_[B],p)){(H=t.Utils.setArraySize(d,I+3*m))[I]=S,H[I+1]=T,H[I+2]=a.r,H[I+3]=a.g,H[I+4]=a.b,H[I+5]=a.a,l?(H[I+6]=A,H[I+7]=E,H[I+8]=o.r,H[I+9]=o.g,H[I+10]=o.b,H[I+11]=o.a,H[I+12]=C,H[I+13]=R,H[I+14]=a.r,H[I+15]=a.g,H[I+16]=a.b,H[I+17]=a.a,H[I+18]=w,H[I+19]=x,H[I+20]=o.r,H[I+21]=o.g,H[I+22]=o.b,H[I+23]=o.a,H[I+24]=O,H[I+25]=P,H[I+26]=a.r,H[I+27]=a.g,H[I+28]=a.b,H[I+29]=a.a,H[I+30]=D,H[I+31]=M,H[I+32]=o.r,H[I+33]=o.g,H[I+34]=o.b,H[I+35]=o.a):(H[I+6]=A,H[I+7]=E,H[I+8]=C,H[I+9]=R,H[I+10]=a.r,H[I+11]=a.g,H[I+12]=a.b,H[I+13]=a.a,H[I+14]=w,H[I+15]=x,H[I+16]=O,H[I+17]=P,H[I+18]=a.r,H[I+19]=a.g,H[I+20]=a.b,H[I+21]=a.a,H[I+22]=D,H[I+23]=M),I=f.length,(Q=t.Utils.setArraySize(f,I+3))[I]=y,Q[I+1]=y+1,Q[I+2]=y+2,y+=3;continue t}var L=p.length;if(0!=L){for(var F=R-P,k=O-C,N=S-O,G=P-T,U=1/(F*N+k*(T-P)),z=L>>1,V=this.clipOutput,H=t.Utils.setArraySize(d,I+z*m),W=0;W<L;W+=2){var X=V[W],Y=V[W+1];H[I]=X,H[I+1]=Y,H[I+2]=a.r,H[I+3]=a.g,H[I+4]=a.b,H[I+5]=a.a;var j=X-O,K=Y-P,q=(F*j+k*K)*U,Z=(G*j+N*K)*U,J=1-q-Z;H[I+6]=A*q+w*Z+D*J,H[I+7]=E*q+x*Z+M*J,l&&(H[I+8]=o.r,H[I+9]=o.g,H[I+10]=o.b,H[I+11]=o.a),I+=m}I=f.length;var Q=t.Utils.setArraySize(f,I+3*(z-2));for(z--,W=1;W<z;W++)Q[I]=y,Q[I+1]=y+W,Q[I+2]=y+W+1,I+=3;y+=z+1}}},e.prototype.clip=function(t,e,i,r,n,s,a,o){var l=o,h=!1,u=null;a.length%4>=2?(u=o,o=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(i),u.push(r),u.push(n),u.push(s),u.push(t),u.push(e),o.length=0;for(var c=a,p=a.length-4,d=0;;d+=2){for(var f=c[d],_=c[d+1],g=c[d+2],m=c[d+3],y=f-g,v=_-m,b=u,S=u.length-2,T=o.length,A=0;A<S;A+=2){var E=b[A],C=b[A+1],R=b[A+2],w=b[A+3],x=y*(w-m)-v*(R-g)>0;if(y*(C-m)-v*(E-g)>0){if(x){o.push(R),o.push(w);continue}var O=(D=w-C)*(g-f)-(M=R-E)*(m-_);if(Math.abs(O)>1e-6){var P=(M*(_-C)-D*(f-E))/O;o.push(f+(g-f)*P),o.push(_+(m-_)*P)}else o.push(f),o.push(_)}else if(x){var D,M;O=(D=w-C)*(g-f)-(M=R-E)*(m-_),Math.abs(O)>1e-6?(P=(M*(_-C)-D*(f-E))/O,o.push(f+(g-f)*P),o.push(_+(m-_)*P)):(o.push(f),o.push(_)),o.push(R),o.push(w)}h=!0}if(T==o.length)return l.length=0,!0;if(o.push(o[0]),o.push(o[1]),d==p)break;var B=o;(o=u).length=0,u=B}if(l!=o){l.length=0,d=0;for(var I=o.length-2;d<I;d++)l[d]=o[d]}else l.length=l.length-2;return h},e.makeClockwise=function(t){for(var e=t,i=t.length,r=e[i-2]*e[1]-e[0]*e[i-1],n=0,s=0,a=0,o=0,l=i-3;o<l;o+=2)n=e[o],s=e[o+1],a=e[o+2],r+=n*e[o+3]-a*s;if(!(r<0)){o=0;var h=i-2;for(l=i>>1;o<l;o+=2){var u=e[o],c=e[o+1],p=h-o;e[o]=e[p],e[o+1]=e[p+1],e[p]=u,e[p+1]=c}}},e}();t.SkeletonClipping=e}(h9||(h9={})),function(t){var e=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t}();t.SkeletonData=e}(h9||(h9={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(i){var r=this.scale,n=new t.SkeletonData,s="string"==typeof i?JSON.parse(i):i,a=s.skeleton;if(null!=a&&(n.hash=a.hash,n.version=a.spine,n.x=a.x,n.y=a.y,n.width=a.width,n.height=a.height,n.fps=a.fps,n.imagesPath=a.images),s.bones)for(var o=0;o<s.bones.length;o++){var l=s.bones[o],h=null,u=this.getValue(l,"parent",null);if(null!=u&&null==(h=n.findBone(u)))throw new Error("Parent bone not found: "+u);(f=new t.BoneData(n.bones.length,l.name,h)).length=this.getValue(l,"length",0)*r,f.x=this.getValue(l,"x",0)*r,f.y=this.getValue(l,"y",0)*r,f.rotation=this.getValue(l,"rotation",0),f.scaleX=this.getValue(l,"scaleX",1),f.scaleY=this.getValue(l,"scaleY",1),f.shearX=this.getValue(l,"shearX",0),f.shearY=this.getValue(l,"shearY",0),f.transformMode=e.transformModeFromString(this.getValue(l,"transform","normal")),f.skinRequired=this.getValue(l,"skin",!1),n.bones.push(f)}if(s.slots)for(o=0;o<s.slots.length;o++){var c=(O=s.slots[o]).name,p=O.bone,d=n.findBone(p);if(null==d)throw new Error("Slot bone not found: "+p);var f=new t.SlotData(n.slots.length,c,d),_=this.getValue(O,"color",null);null!=_&&f.color.setFromString(_);var g=this.getValue(O,"dark",null);null!=g&&(f.darkColor=new t.Color(1,1,1,1),f.darkColor.setFromString(g)),f.attachmentName=this.getValue(O,"attachment",null),f.blendMode=e.blendModeFromString(this.getValue(O,"blend","normal")),n.slots.push(f)}if(s.ik)for(o=0;o<s.ik.length;o++){var m=s.ik[o];(f=new t.IkConstraintData(m.name)).order=this.getValue(m,"order",0),f.skinRequired=this.getValue(m,"skin",!1);for(var y=0;y<m.bones.length;y++){if(p=m.bones[y],null==(R=n.findBone(p)))throw new Error("IK bone not found: "+p);f.bones.push(R)}var v=m.target;if(f.target=n.findBone(v),null==f.target)throw new Error("IK target bone not found: "+v);f.mix=this.getValue(m,"mix",1),f.softness=this.getValue(m,"softness",0)*r,f.bendDirection=this.getValue(m,"bendPositive",!0)?1:-1,f.compress=this.getValue(m,"compress",!1),f.stretch=this.getValue(m,"stretch",!1),f.uniform=this.getValue(m,"uniform",!1),n.ikConstraints.push(f)}if(s.transform)for(o=0;o<s.transform.length;o++){for(m=s.transform[o],(f=new t.TransformConstraintData(m.name)).order=this.getValue(m,"order",0),f.skinRequired=this.getValue(m,"skin",!1),y=0;y<m.bones.length;y++){if(p=m.bones[y],null==(R=n.findBone(p)))throw new Error("Transform constraint bone not found: "+p);f.bones.push(R)}if(v=m.target,f.target=n.findBone(v),null==f.target)throw new Error("Transform constraint target bone not found: "+v);f.local=this.getValue(m,"local",!1),f.relative=this.getValue(m,"relative",!1),f.offsetRotation=this.getValue(m,"rotation",0),f.offsetX=this.getValue(m,"x",0)*r,f.offsetY=this.getValue(m,"y",0)*r,f.offsetScaleX=this.getValue(m,"scaleX",0),f.offsetScaleY=this.getValue(m,"scaleY",0),f.offsetShearY=this.getValue(m,"shearY",0),f.rotateMix=this.getValue(m,"rotateMix",1),f.translateMix=this.getValue(m,"translateMix",1),f.scaleMix=this.getValue(m,"scaleMix",1),f.shearMix=this.getValue(m,"shearMix",1),n.transformConstraints.push(f)}if(s.path)for(o=0;o<s.path.length;o++){for(m=s.path[o],(f=new t.PathConstraintData(m.name)).order=this.getValue(m,"order",0),f.skinRequired=this.getValue(m,"skin",!1),y=0;y<m.bones.length;y++){if(p=m.bones[y],null==(R=n.findBone(p)))throw new Error("Transform constraint bone not found: "+p);f.bones.push(R)}if(v=m.target,f.target=n.findSlot(v),null==f.target)throw new Error("Path target slot not found: "+v);f.positionMode=e.positionModeFromString(this.getValue(m,"positionMode","percent")),f.spacingMode=e.spacingModeFromString(this.getValue(m,"spacingMode","length")),f.rotateMode=e.rotateModeFromString(this.getValue(m,"rotateMode","tangent")),f.offsetRotation=this.getValue(m,"rotation",0),f.position=this.getValue(m,"position",0),f.positionMode==t.PositionMode.Fixed&&(f.position*=r),f.spacing=this.getValue(m,"spacing",0),f.spacingMode!=t.SpacingMode.Length&&f.spacingMode!=t.SpacingMode.Fixed||(f.spacing*=r),f.rotateMix=this.getValue(m,"rotateMix",1),f.translateMix=this.getValue(m,"translateMix",1),n.pathConstraints.push(f)}if(s.skins){var b=s.skins;if(!(b instanceof Array)){var S=[];for(var T in b)S.push({name:T,attachments:b[T]});b=S}for(o=0;o<b.length;o++){var A=b[o],E=new t.Skin(A.name);if(A.bones)for(var C=0;C<A.bones.length;C++){var R;if(null==(R=n.findBone(A.bones[C])))throw new Error("Skin bone not found: "+A.bones[o]);E.bones.push(R)}if(A.ik)for(C=0;C<A.ik.length;C++){if(null==(w=n.findIkConstraint(A.ik[C])))throw new Error("Skin IK constraint not found: "+A.ik[o]);E.constraints.push(w)}if(A.transform)for(C=0;C<A.transform.length;C++){if(null==(w=n.findTransformConstraint(A.transform[C])))throw new Error("Skin transform constraint not found: "+A.transform[o]);E.constraints.push(w)}if(A.path)for(C=0;C<A.path.length;C++){var w;if(null==(w=n.findPathConstraint(A.path[C])))throw new Error("Skin path constraint not found: "+A.path[o]);E.constraints.push(w)}for(var c in A.attachments){var x=n.findSlot(c);if(null==x)throw new Error("Slot not found: "+c);var O=A.attachments[c];for(var P in O){var D=this.readAttachment(O[P],E,x.index,P,n);null!=D&&E.setAttachment(x.index,P,D)}}n.skins.push(E),"default"==E.name&&(n.defaultSkin=E)}}o=0;for(var M=this.linkedMeshes.length;o<M;o++){var B=this.linkedMeshes[o];if(null==(E=null==B.skin?n.defaultSkin:n.findSkin(B.skin)))throw new Error("Skin not found: "+B.skin);var I=E.getAttachment(B.slotIndex,B.parent);if(null==I)throw new Error("Parent mesh not found: "+B.parent);B.mesh.deformAttachment=B.inheritDeform?I:B.mesh,B.mesh.setParentMesh(I),B.mesh.updateUVs()}if(this.linkedMeshes.length=0,s.events)for(var L in s.events){var F=s.events[L];(f=new t.EventData(L)).intValue=this.getValue(F,"int",0),f.floatValue=this.getValue(F,"float",0),f.stringValue=this.getValue(F,"string",""),f.audioPath=this.getValue(F,"audio",null),null!=f.audioPath&&(f.volume=this.getValue(F,"volume",1),f.balance=this.getValue(F,"balance",0)),n.events.push(f)}if(s.animations)for(var k in s.animations){var N=s.animations[k];this.readAnimation(N,k,n)}return n},e.prototype.readAttachment=function(e,r,n,s,a){var o=this.scale;switch(s=this.getValue(e,"name",s),this.getValue(e,"type","region")){case"region":var l=this.getValue(e,"path",s),h=this.attachmentLoader.newRegionAttachment(r,s,l);return null==h?null:(h.path=l,h.x=this.getValue(e,"x",0)*o,h.y=this.getValue(e,"y",0)*o,h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.rotation=this.getValue(e,"rotation",0),h.width=e.width*o,h.height=e.height*o,null!=(v=this.getValue(e,"color",null))&&h.color.setFromString(v),h.updateOffset(),h);case"boundingbox":var u=this.attachmentLoader.newBoundingBoxAttachment(r,s);return null==u?null:(this.readVertices(e,u,e.vertexCount<<1),null!=(v=this.getValue(e,"color",null))&&u.color.setFromString(v),u);case"mesh":case"linkedmesh":l=this.getValue(e,"path",s);var c=this.attachmentLoader.newMeshAttachment(r,s,l);if(null==c)return null;c.path=l,null!=(v=this.getValue(e,"color",null))&&c.color.setFromString(v),c.width=this.getValue(e,"width",0)*o,c.height=this.getValue(e,"height",0)*o;var p=this.getValue(e,"parent",null);if(null!=p)return this.linkedMeshes.push(new i(c,this.getValue(e,"skin",null),n,p,this.getValue(e,"deform",!0))),c;var d=e.uvs;return this.readVertices(e,c,d.length),c.triangles=e.triangles,c.regionUVs=d,c.updateUVs(),c.edges=this.getValue(e,"edges",null),c.hullLength=2*this.getValue(e,"hull",0),c;case"path":if(null==(l=this.attachmentLoader.newPathAttachment(r,s)))return null;l.closed=this.getValue(e,"closed",!1),l.constantSpeed=this.getValue(e,"constantSpeed",!0);var f=e.vertexCount;this.readVertices(e,l,f<<1);for(var _=t.Utils.newArray(f/3,0),g=0;g<e.lengths.length;g++)_[g]=e.lengths[g]*o;return l.lengths=_,null!=(v=this.getValue(e,"color",null))&&l.color.setFromString(v),l;case"point":var m=this.attachmentLoader.newPointAttachment(r,s);return null==m?null:(m.x=this.getValue(e,"x",0)*o,m.y=this.getValue(e,"y",0)*o,m.rotation=this.getValue(e,"rotation",0),null!=(v=this.getValue(e,"color",null))&&m.color.setFromString(v),m);case"clipping":var y=this.attachmentLoader.newClippingAttachment(r,s);if(null==y)return null;var v,b=this.getValue(e,"end",null);if(null!=b){var S=a.findSlot(b);if(null==S)throw new Error("Clipping end slot not found: "+b);y.endSlot=S}return f=e.vertexCount,this.readVertices(e,y,f<<1),null!=(v=this.getValue(e,"color",null))&&y.color.setFromString(v),y}return null},e.prototype.readVertices=function(e,i,r){var n=this.scale;i.worldVerticesLength=r;var s=e.vertices;if(r!=s.length){var a=new Array,o=new Array;for(c=0,p=s.length;c<p;){var l=s[c++];o.push(l);for(var h=c+4*l;c<h;c+=4)o.push(s[c]),a.push(s[c+1]*n),a.push(s[c+2]*n),a.push(s[c+3])}i.bones=o,i.vertices=t.Utils.toFloatArray(a)}else{var u=t.Utils.toFloatArray(s);if(1!=n)for(var c=0,p=s.length;c<p;c++)u[c]*=n;i.vertices=u}},e.prototype.readAnimation=function(e,i,r){var n=this.scale,s=new Array,a=0;if(e.slots)for(var o in e.slots){var l=e.slots[o];if(-1==(J=r.findSlotIndex(o)))throw new Error("Slot not found: "+o);for(var h in l){var u=l[h];if("attachment"==h){(b=new t.AttachmentTimeline(u.length)).slotIndex=J;for(var c=0,p=0;p<u.length;p++){var d=u[p];b.setFrame(c++,this.getValue(d,"time",0),d.name)}s.push(b),a=Math.max(a,b.frames[b.getFrameCount()-1])}else if("color"==h){for((b=new t.ColorTimeline(u.length)).slotIndex=J,c=0,p=0;p<u.length;p++){d=u[p];var f=new t.Color;f.setFromString(d.color),b.setFrame(c,this.getValue(d,"time",0),f.r,f.g,f.b,f.a),this.readCurve(d,b,c),c++}s.push(b),a=Math.max(a,b.frames[(b.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=h)throw new Error("Invalid timeline type for a slot: "+h+" ("+o+")");for((b=new t.TwoColorTimeline(u.length)).slotIndex=J,c=0,p=0;p<u.length;p++){d=u[p];var _=new t.Color,g=new t.Color;_.setFromString(d.light),g.setFromString(d.dark),b.setFrame(c,this.getValue(d,"time",0),_.r,_.g,_.b,_.a,g.r,g.g,g.b),this.readCurve(d,b,c),c++}s.push(b),a=Math.max(a,b.frames[(b.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var m in e.bones){var y=e.bones[m],v=r.findBoneIndex(m);if(-1==v)throw new Error("Bone not found: "+m);for(var h in y)if(u=y[h],"rotate"===h){for((b=new t.RotateTimeline(u.length)).boneIndex=v,c=0,p=0;p<u.length;p++)d=u[p],b.setFrame(c,this.getValue(d,"time",0),this.getValue(d,"angle",0)),this.readCurve(d,b,c),c++;s.push(b),a=Math.max(a,b.frames[(b.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==h&&"scale"!==h&&"shear"!==h)throw new Error("Invalid timeline type for a bone: "+h+" ("+m+")");var b=null,S=1,T=0;for("scale"===h?(b=new t.ScaleTimeline(u.length),T=1):"shear"===h?b=new t.ShearTimeline(u.length):(b=new t.TranslateTimeline(u.length),S=n),b.boneIndex=v,c=0,p=0;p<u.length;p++){d=u[p];var A=this.getValue(d,"x",T),E=this.getValue(d,"y",T);b.setFrame(c,this.getValue(d,"time",0),A*S,E*S),this.readCurve(d,b,c),c++}s.push(b),a=Math.max(a,b.frames[(b.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(e.ik)for(var C in e.ik){var R=e.ik[C],w=r.findIkConstraint(C);for((b=new t.IkConstraintTimeline(R.length)).ikConstraintIndex=r.ikConstraints.indexOf(w),c=0,p=0;p<R.length;p++)d=R[p],b.setFrame(c,this.getValue(d,"time",0),this.getValue(d,"mix",1),this.getValue(d,"softness",0)*n,this.getValue(d,"bendPositive",!0)?1:-1,this.getValue(d,"compress",!1),this.getValue(d,"stretch",!1)),this.readCurve(d,b,c),c++;s.push(b),a=Math.max(a,b.frames[(b.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(var C in e.transform){for(R=e.transform[C],w=r.findTransformConstraint(C),(b=new t.TransformConstraintTimeline(R.length)).transformConstraintIndex=r.transformConstraints.indexOf(w),c=0,p=0;p<R.length;p++)d=R[p],b.setFrame(c,this.getValue(d,"time",0),this.getValue(d,"rotateMix",1),this.getValue(d,"translateMix",1),this.getValue(d,"scaleMix",1),this.getValue(d,"shearMix",1)),this.readCurve(d,b,c),c++;s.push(b),a=Math.max(a,b.frames[(b.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}var x=e.path||e.paths;if(x)for(var C in x){R=x[C];var O=r.findPathConstraintIndex(C);if(-1==O)throw new Error("Path constraint not found: "+C);var P=r.pathConstraints[O];for(var h in R)if(u=R[h],"position"===h||"spacing"===h){for(b=null,S=1,"spacing"===h?(b=new t.PathConstraintSpacingTimeline(u.length),P.spacingMode!=t.SpacingMode.Length&&P.spacingMode!=t.SpacingMode.Fixed||(S=n)):(b=new t.PathConstraintPositionTimeline(u.length),P.positionMode==t.PositionMode.Fixed&&(S=n)),b.pathConstraintIndex=O,c=0,p=0;p<u.length;p++)d=u[p],b.setFrame(c,this.getValue(d,"time",0),this.getValue(d,h,0)*S),this.readCurve(d,b,c),c++;s.push(b),a=Math.max(a,b.frames[(b.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===h){for((b=new t.PathConstraintMixTimeline(u.length)).pathConstraintIndex=O,c=0,p=0;p<u.length;p++)d=u[p],b.setFrame(c,this.getValue(d,"time",0),this.getValue(d,"rotateMix",1),this.getValue(d,"translateMix",1)),this.readCurve(d,b,c),c++;s.push(b),a=Math.max(a,b.frames[(b.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(e.deform)for(var D in e.deform){var M=e.deform[D],B=r.findSkin(D);if(null==B)throw new Error("Skin not found: "+D);for(var o in M){if(l=M[o],-1==(J=r.findSlotIndex(o)))throw new Error("Slot not found: "+l.name);for(var h in l){u=l[h];var I=B.getAttachment(J,h);if(null!=I){var L=null!=I.bones,F=I.vertices,k=L?F.length/3*2:F.length;(b=new t.DeformTimeline(u.length)).slotIndex=J,b.attachment=I,c=0;for(var N=0;N<u.length;N++){d=u[N];var G=void 0,U=this.getValue(d,"vertices",null);if(null==U)G=L?t.Utils.newFloatArray(k):F;else{G=t.Utils.newFloatArray(k);var z=this.getValue(d,"offset",0);if(t.Utils.arrayCopy(U,0,G,z,U.length),1!=n)for(var V=(p=z)+U.length;p<V;p++)G[p]*=n;if(!L)for(p=0;p<k;p++)G[p]+=F[p]}b.setFrame(c,this.getValue(d,"time",0),G),this.readCurve(d,b,c),c++}s.push(b),a=Math.max(a,b.frames[b.getFrameCount()-1])}}}}var H=e.drawOrder;if(null==H&&(H=e.draworder),null!=H){b=new t.DrawOrderTimeline(H.length);var W=r.slots.length;for(c=0,N=0;N<H.length;N++){var X=H[N],Y=null,j=this.getValue(X,"offsets",null);if(null!=j){Y=t.Utils.newArray(W,-1);var K=t.Utils.newArray(W-j.length,0),q=0,Z=0;for(p=0;p<j.length;p++){var J,Q=j[p];if(-1==(J=r.findSlotIndex(Q.slot)))throw new Error("Slot not found: "+Q.slot);for(;q!=J;)K[Z++]=q++;Y[q+Q.offset]=q++}for(;q<W;)K[Z++]=q++;for(p=W-1;p>=0;p--)-1==Y[p]&&(Y[p]=K[--Z])}b.setFrame(c++,this.getValue(X,"time",0),Y)}s.push(b),a=Math.max(a,b.frames[b.getFrameCount()-1])}if(e.events){for(b=new t.EventTimeline(e.events.length),c=0,p=0;p<e.events.length;p++){var $=e.events[p],tt=r.findEvent($.name);if(null==tt)throw new Error("Event not found: "+$.name);var et=new t.Event(t.Utils.toSinglePrecision(this.getValue($,"time",0)),tt);et.intValue=this.getValue($,"int",tt.intValue),et.floatValue=this.getValue($,"float",tt.floatValue),et.stringValue=this.getValue($,"string",tt.stringValue),null!=et.data.audioPath&&(et.volume=this.getValue($,"volume",1),et.balance=this.getValue($,"balance",0)),b.setFrame(c++,et)}s.push(b),a=Math.max(a,b.frames[b.getFrameCount()-1])}if(isNaN(a))throw new Error("Error while parsing animation, duration is NaN");r.animations.push(new t.Animation(i,s,a))},e.prototype.readCurve=function(t,e,i){var r=t.curve;r&&("stepped"==r?e.setStepped(i):"[object Array]"===Object.prototype.toString.call(r)?e.setCurve(i,r[0],r[1],r[2],r[3]):e.setCurve(i,r,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},e.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i},e.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+e)},e.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+e)},e.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+e)},e.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+e)},e.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+e)},e}();t.SkeletonJson=e;var i=function(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritDeform=n}}(h9||(h9={})),function(t){var e=function(t,e,i){this.slotIndex=t,this.name=e,this.attachment=i};t.SkinEntry=e;var i=function(){function i(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return i.prototype.setAttachment=function(t,e,i){if(null==i)throw new Error("attachment cannot be null.");var r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=i},i.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var i=t.bones[e],r=!1,n=0;n<this.bones.length;n++)if(this.bones[n]==i){r=!0;break}r||this.bones.push(i)}for(e=0;e<t.constraints.length;e++){var s=t.constraints[e];for(r=!1,n=0;n<this.constraints.length;n++)if(this.constraints[n]==s){r=!0;break}r||this.constraints.push(s)}var a=t.getAttachments();for(e=0;e<a.length;e++){var o=a[e];this.setAttachment(o.slotIndex,o.name,o.attachment)}},i.prototype.copySkin=function(e){for(var i=0;i<e.bones.length;i++){for(var r=e.bones[i],n=!1,s=0;s<this.bones.length;s++)if(this.bones[s]==r){n=!0;break}n||this.bones.push(r)}for(i=0;i<e.constraints.length;i++){var a=e.constraints[i];for(n=!1,s=0;s<this.constraints.length;s++)if(this.constraints[s]==a){n=!0;break}n||this.constraints.push(a)}var o=e.getAttachments();for(i=0;i<o.length;i++){var l=o[i];null!=l.attachment&&(l.attachment instanceof t.MeshAttachment?(l.attachment=l.attachment.newLinkedMesh(),this.setAttachment(l.slotIndex,l.name,l.attachment)):(l.attachment=l.attachment.copy(),this.setAttachment(l.slotIndex,l.name,l.attachment)))}},i.prototype.getAttachment=function(t,e){var i=this.attachments[t];return i?i[e]:null},i.prototype.removeAttachment=function(t,e){var i=this.attachments[t];i&&(i[e]=null)},i.prototype.getAttachments=function(){for(var t=new Array,i=0;i<this.attachments.length;i++){var r=this.attachments[i];if(r)for(var n in r){var s=r[n];s&&t.push(new e(i,n,s))}}return t},i.prototype.getAttachmentsForSlot=function(t,i){var r=this.attachments[t];if(r)for(var n in r){var s=r[n];s&&i.push(new e(t,n,s))}},i.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},i.prototype.attachAll=function(t,e){for(var i=0,r=0;r<t.slots.length;r++){var n=t.slots[r],s=n.getAttachment();if(s&&i<e.attachments.length){var a=e.attachments[i];for(var o in a)if(s==a[o]){var l=this.getAttachment(i,o);null!=l&&n.setAttachment(l);break}}i++}},i}();t.Skin=i}(h9||(h9={})),function(t){var e=function(){function e(e,i){if(this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==i)throw new Error("bone cannot be null.");this.data=e,this.bone=i,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return e.prototype.getSkeleton=function(){return this.bone.skeleton},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},e.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();t.Slot=e}(h9||(h9={})),function(t){t.SlotData=function(e,i,r){if(this.color=new t.Color(1,1,1,1),e<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");if(null==r)throw new Error("boneData cannot be null.");this.index=e,this.name=i,this.boneData=r}}(h9||(h9={})),function(t){var e,i,r=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return i.MirroredRepeat;case"clamptoedge":return i.ClampToEdge;case"repeat":return i.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=r,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(i=t.TextureWrap||(t.TextureWrap={}));t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u9(e,t),e.prototype.setFilters=function(){},e.prototype.setWraps=function(){},e.prototype.dispose=function(){},e}(r);t.FakeTexture=n}(h9||(h9={})),function(t){var e=function(){function e(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}return e.prototype.load=function(e,s){if(null==s)throw new Error("textureLoader cannot be null.");for(var a=new i(e),o=new Array(4),l=null;;){var h=a.readLine();if(null==h)break;if(0==(h=h.trim()).length)l=null;else if(l){var u=new n;u.name=h,u.page=l;var c=a.readValue();"true"==c.toLocaleLowerCase()?u.degrees=90:"false"==c.toLocaleLowerCase()?u.degrees=0:u.degrees=parseFloat(c),u.rotate=90==u.degrees,a.readTuple(o);var p=parseInt(o[0]),d=parseInt(o[1]);a.readTuple(o);var f=parseInt(o[0]),_=parseInt(o[1]);u.u=p/l.width,u.v=d/l.height,u.rotate?(u.u2=(p+_)/l.width,u.v2=(d+f)/l.height):(u.u2=(p+f)/l.width,u.v2=(d+_)/l.height),u.x=p,u.y=d,u.width=Math.abs(f),u.height=Math.abs(_),4==a.readTuple(o)&&4==a.readTuple(o)&&a.readTuple(o),u.originalWidth=parseInt(o[0]),u.originalHeight=parseInt(o[1]),a.readTuple(o),u.offsetX=parseInt(o[0]),u.offsetY=parseInt(o[1]),u.index=parseInt(a.readValue()),u.texture=l.texture,this.regions.push(u)}else{(l=new r).name=h,2==a.readTuple(o)&&(l.width=parseInt(o[0]),l.height=parseInt(o[1]),a.readTuple(o)),a.readTuple(o),l.minFilter=t.Texture.filterFromString(o[0]),l.magFilter=t.Texture.filterFromString(o[1]);var g=a.readValue();l.uWrap=t.TextureWrap.ClampToEdge,l.vWrap=t.TextureWrap.ClampToEdge,"x"==g?l.uWrap=t.TextureWrap.Repeat:"y"==g?l.vWrap=t.TextureWrap.Repeat:"xy"==g&&(l.uWrap=l.vWrap=t.TextureWrap.Repeat),l.texture=s(h),l.texture.setFilters(l.minFilter,l.magFilter),l.texture.setWraps(l.uWrap,l.vWrap),l.width=l.texture.getImage().width,l.height=l.texture.getImage().height,this.pages.push(l)}}},e.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},e.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},e}();t.TextureAtlas=e;var i=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);for(var r=0,n=i+1;r<3;r++){var s=e.indexOf(",",n);if(-1==s)break;t[r]=e.substr(n,s-n).trim(),n=s+1}return t[r]=e.substring(n).trim(),r+1},t}(),r=function(){};t.TextureAtlasPage=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u9(e,t),e}(t.TextureRegion);t.TextureAtlasRegion=n}(h9||(h9={})),function(t){var e=function(){function e(e,i){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==i)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var r=0;r<e.bones.length;r++)this.bones.push(i.findBone(e.bones[r].name));this.target=i.findBone(e.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,i=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target,a=s.a,o=s.b,l=s.c,h=s.d,u=a*h-o*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,c=this.data.offsetRotation*u,p=this.data.offsetShearY*u,d=this.bones,f=0,_=d.length;f<_;f++){var g=d[f],m=!1;if(0!=e){var y=g.a,v=g.b,b=g.c,S=g.d;(w=Math.atan2(l,a)-Math.atan2(b,y)+c)>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w*=e;var T=Math.cos(w),A=Math.sin(w);g.a=T*y-A*b,g.b=T*v-A*S,g.c=A*y+T*b,g.d=A*v+T*S,m=!0}if(0!=i){var E=this.temp;s.localToWorld(E.set(this.data.offsetX,this.data.offsetY)),g.worldX+=(E.x-g.worldX)*i,g.worldY+=(E.y-g.worldY)*i,m=!0}if(r>0){var C=Math.sqrt(g.a*g.a+g.c*g.c),R=Math.sqrt(a*a+l*l);C>1e-5&&(C=(C+(R-C+this.data.offsetScaleX)*r)/C),g.a*=C,g.c*=C,C=Math.sqrt(g.b*g.b+g.d*g.d),R=Math.sqrt(o*o+h*h),C>1e-5&&(C=(C+(R-C+this.data.offsetScaleY)*r)/C),g.b*=C,g.d*=C,m=!0}if(n>0){v=g.b,S=g.d;var w,x=Math.atan2(S,v);(w=Math.atan2(h,o)-Math.atan2(l,a)-(x-Math.atan2(g.c,g.a)))>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w=x+(w+p)*n,C=Math.sqrt(v*v+S*S),g.b=Math.cos(w)*C,g.d=Math.sin(w)*C,m=!0}m&&(g.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,i=this.translateMix,r=this.scaleMix,n=this.shearMix,s=this.target,a=s.a,o=s.b,l=s.c,h=s.d,u=a*h-o*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,c=this.data.offsetRotation*u,p=this.data.offsetShearY*u,d=this.bones,f=0,_=d.length;f<_;f++){var g,m=d[f],y=!1;if(0!=e){var v=m.a,b=m.b,S=m.c,T=m.d;(g=Math.atan2(l,a)+c)>t.MathUtils.PI?g-=t.MathUtils.PI2:g<-t.MathUtils.PI&&(g+=t.MathUtils.PI2),g*=e;var A=Math.cos(g),E=Math.sin(g);m.a=A*v-E*S,m.b=A*b-E*T,m.c=E*v+A*S,m.d=E*b+A*T,y=!0}if(0!=i){var C=this.temp;s.localToWorld(C.set(this.data.offsetX,this.data.offsetY)),m.worldX+=C.x*i,m.worldY+=C.y*i,y=!0}if(r>0){var R=(Math.sqrt(a*a+l*l)-1+this.data.offsetScaleX)*r+1;m.a*=R,m.c*=R,R=(Math.sqrt(o*o+h*h)-1+this.data.offsetScaleY)*r+1,m.b*=R,m.d*=R,y=!0}if(n>0)(g=Math.atan2(h,o)-Math.atan2(l,a))>t.MathUtils.PI?g-=t.MathUtils.PI2:g<-t.MathUtils.PI&&(g+=t.MathUtils.PI2),b=m.b,T=m.d,g=Math.atan2(T,b)+(g-t.MathUtils.PI/2+p)*n,R=Math.sqrt(b*b+T*T),m.b=Math.cos(g)*R,m.d=Math.sin(g)*R,y=!0;y&&(m.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();for(var s=this.bones,a=0,o=s.length;a<o;a++){var l=s[a];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;if(0!=t){var u=n.arotation-h+this.data.offsetRotation;h+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=l.ax,p=l.ay;0!=e&&(c+=(n.ax-c+this.data.offsetX)*e,p+=(n.ay-p+this.data.offsetY)*e);var d=l.ascaleX,f=l.ascaleY;0!=i&&(d>1e-5&&(d=(d+(n.ascaleX-d+this.data.offsetScaleX)*i)/d),f>1e-5&&(f=(f+(n.ascaleY-f+this.data.offsetScaleY)*i)/f));var _=l.ashearY;0!=r&&(u=n.ashearY-_+this.data.offsetShearY,u-=360*(16384-(16384.499999999996-u/360|0)),l.shearY+=u*r),l.updateWorldTransformWith(c,p,h,d,f,l.ashearX,_)}},e.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();for(var s=this.bones,a=0,o=s.length;a<o;a++){var l=s[a];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;0!=t&&(h+=(n.arotation+this.data.offsetRotation)*t);var u=l.ax,c=l.ay;0!=e&&(u+=(n.ax+this.data.offsetX)*e,c+=(n.ay+this.data.offsetY)*e);var p=l.ascaleX,d=l.ascaleY;0!=i&&(p>1e-5&&(p*=(n.ascaleX-1+this.data.offsetScaleX)*i+1),d>1e-5&&(d*=(n.ascaleY-1+this.data.offsetScaleY)*i+1));var f=l.ashearY;0!=r&&(f+=(n.ashearY+this.data.offsetShearY)*r),l.updateWorldTransformWith(u,c,h,p,d,l.ashearX,f)}},e}();t.TransformConstraint=e}(h9||(h9={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i.rotateMix=0,i.translateMix=0,i.scaleMix=0,i.shearMix=0,i.offsetRotation=0,i.offsetX=0,i.offsetY=0,i.offsetScaleX=0,i.offsetScaleY=0,i.offsetShearY=0,i.relative=!1,i.local=!1,i}return u9(e,t),e}(t.ConstraintData);t.TransformConstraintData=e}(h9||(h9={})),function(t){var e=function(){function e(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool((function(){return new Array})),this.polygonIndicesPool=new t.Pool((function(){return new Array}))}return e.prototype.triangulate=function(t){var i=t,r=t.length>>1,n=this.indicesArray;n.length=0;for(var s=0;s<r;s++)n[s]=s;var a=this.isConcaveArray;a.length=0,s=0;for(var o=r;s<o;++s)a[s]=e.isConcave(s,r,i,n);var l=this.triangles;for(l.length=0;r>3;){for(var h=r-1,u=(s=0,1);;){t:if(!a[s]){for(var c=n[h]<<1,p=n[s]<<1,d=n[u]<<1,f=i[c],_=i[c+1],g=i[p],m=i[p+1],y=i[d],v=i[d+1],b=(u+1)%r;b!=h;b=(b+1)%r)if(a[b]){var S=n[b]<<1,T=i[S],A=i[S+1];if(e.positiveArea(y,v,f,_,T,A)&&e.positiveArea(f,_,g,m,T,A)&&e.positiveArea(g,m,y,v,T,A))break t}break}if(0==u){do{if(!a[s])break;s--}while(s>0);break}h=s,s=u,u=(u+1)%r}l.push(n[(r+s-1)%r]),l.push(n[s]),l.push(n[(s+1)%r]),n.splice(s,1),a.splice(s,1);var E=(--r+s-1)%r,C=s==r?0:s;a[E]=e.isConcave(E,r,i,n),a[C]=e.isConcave(C,r,i,n)}return 3==r&&(l.push(n[2]),l.push(n[0]),l.push(n[1])),l},e.prototype.decompose=function(t,i){var r=t,n=this.convexPolygons;this.polygonPool.freeAll(n),n.length=0;var s=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(s),s.length=0;var a=this.polygonIndicesPool.obtain();a.length=0;var o=this.polygonPool.obtain();o.length=0;for(var l=-1,h=0,u=0,c=i.length;u<c;u+=3){var p=i[u]<<1,d=i[u+1]<<1,f=i[u+2]<<1,_=r[p],g=r[p+1],m=r[d],y=r[d+1],v=r[f],b=r[f+1],S=!1;if(l==p){var T=o.length-4,A=e.winding(o[T],o[T+1],o[T+2],o[T+3],v,b),E=e.winding(v,b,o[0],o[1],o[2],o[3]);A==h&&E==h&&(o.push(v),o.push(b),a.push(f),S=!0)}S||(o.length>0?(n.push(o),s.push(a)):(this.polygonPool.free(o),this.polygonIndicesPool.free(a)),(o=this.polygonPool.obtain()).length=0,o.push(_),o.push(g),o.push(m),o.push(y),o.push(v),o.push(b),(a=this.polygonIndicesPool.obtain()).length=0,a.push(p),a.push(d),a.push(f),h=e.winding(_,g,m,y,v,b),l=p)}for(o.length>0&&(n.push(o),s.push(a)),u=0,c=n.length;u<c;u++)if(0!=(a=s[u]).length)for(var C=a[0],R=a[a.length-1],w=(o=n[u])[T=o.length-4],x=o[T+1],O=o[T+2],P=o[T+3],D=o[0],M=o[1],B=o[2],I=o[3],L=e.winding(w,x,O,P,D,M),F=0;F<c;F++)if(F!=u){var k=s[F];if(3==k.length){var N=k[0],G=k[1],U=k[2],z=n[F];v=z[z.length-2],b=z[z.length-1],N==C&&G==R&&(A=e.winding(w,x,O,P,v,b),E=e.winding(v,b,D,M,B,I),A==L&&E==L&&(z.length=0,k.length=0,o.push(v),o.push(b),a.push(U),w=O,x=P,O=v,P=b,F=0))}}for(u=n.length-1;u>=0;u--)0==(o=n[u]).length&&(n.splice(u,1),this.polygonPool.free(o),a=s[u],s.splice(u,1),this.polygonIndicesPool.free(a));return n},e.isConcave=function(t,e,i,r){var n=r[(e+t-1)%e]<<1,s=r[t]<<1,a=r[(t+1)%e]<<1;return!this.positiveArea(i[n],i[n+1],i[s],i[s+1],i[a],i[a+1])},e.positiveArea=function(t,e,i,r,n,s){return t*(s-r)+i*(e-s)+n*(r-e)>=0},e.winding=function(t,e,i,r,n,s){var a=i-t,o=r-e;return n*o-s*a+a*e-t*o>=0?1:-1},e}();t.Triangulator=e}(h9||(h9={})),function(t){var e=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e;var i=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.r=t,this.g=e,this.b=i,this.a=r}return t.prototype.set=function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,i,r){return this.r+=t,this.g+=e,this.b+=i,this.a+=r,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},t.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=i;var r=function(){function t(){}return t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,i){return t.randomTriangularWith(e,i,.5*(e+i))},t.randomTriangularWith=function(t,e,i){var r=Math.random(),n=e-t;return r<=(i-t)/n?t+Math.sqrt(r*n*(i-t)):e-Math.sqrt((1-r)*n*(e-i))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();t.MathUtils=r;var n=function(){function t(){}return t.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i)},t}();t.Interpolation=n;var s=function(t){function e(e){var i=t.call(this)||this;return i.power=2,i.power=e,i}return u9(e,t),e.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},e}(n);t.Pow=s;var a=function(t){function e(e){return t.call(this,e)||this}return u9(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},e}(s);t.PowOut=a;var o=function(){function t(){}return t.arrayCopy=function(t,e,i,r,n){for(var s=e,a=r;s<e+n;s++,a++)i[a]=t[s]},t.setArraySize=function(t,e,i){void 0===i&&(i=0);var r=t.length;if(r==e)return t;if(t.length=e,r<e)for(var n=r;n<e;n++)t[n]=i;return t},t.ensureArrayCapacity=function(e,i,r){return void 0===r&&(r=0),e.length>=i?e:t.setArraySize(e,i,r)},t.newArray=function(t,e){for(var i=new Array(t),r=0;r<t;r++)i[r]=e;return i},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var i=new Array(e),r=0;r<i.length;r++)i[r]=0;return i},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var i=new Array(e),r=0;r<i.length;r++)i[r]=0;return i},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e},t.webkit602BugfixHelper=function(){},t.contains=function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();t.Utils=o;var l=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];console.log(i.data.name+", "+i.a+", "+i.b+", "+i.c+", "+i.d+", "+i.worldX+", "+i.worldY)}},t}();t.DebugUtils=l;var h=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=h;var u=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=u;var c=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=c;var p=function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}();t.WindowedMean=p}(h9||(h9={})),Math.fround||(Math.fround=function(t){return function(e){return t[0]=e,t[0]}}(new Float32Array(1))),function(t){var e=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=e;var i=function(e){function i(t){var r=e.call(this,t)||this;return r.id=(65535&i.nextID++)<<11,r.worldVerticesLength=0,r.deformAttachment=r,r}return u9(i,e),i.prototype.computeWorldVertices=function(t,e,i,r,n,s){i=n+(i>>1)*s;var a=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(null!=h){for(var u=0,c=0,p=0;p<e;p+=2)u+=(g=h[u])+1,c+=g;var d=a.bones;if(0==o.length)for(x=n,E=3*c;x<i;x+=s){var f=0,_=0,g=h[u++];for(g+=u;u<g;u++,E+=3){b=d[h[u]],O=l[E],P=l[E+1];var m=l[E+2];f+=(O*b.a+P*b.b+b.worldX)*m,_+=(O*b.c+P*b.d+b.worldY)*m}r[x]=f,r[x+1]=_}else for(var y=o,v=(x=n,E=3*c,c<<1);x<i;x+=s){for(f=0,_=0,g=h[u++],g+=u;u<g;u++,E+=3,v+=2)b=d[h[u]],O=l[E]+y[v],P=l[E+1]+y[v+1],m=l[E+2],f+=(O*b.a+P*b.b+b.worldX)*m,_+=(O*b.c+P*b.d+b.worldY)*m;r[x]=f,r[x+1]=_}}else{o.length>0&&(l=o);for(var b,S=(b=t.bone).worldX,T=b.worldY,A=b.a,E=b.b,C=b.c,R=b.d,w=e,x=n;x<i;w+=2,x+=s){var O=l[w],P=l[w+1];r[x]=O*A+P*E+S,r[x+1]=O*C+P*R+T}}},i.prototype.copyTo=function(e){null!=this.bones?(e.bones=new Array(this.bones.length),t.Utils.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,null!=this.vertices?(e.vertices=t.Utils.newFloatArray(this.vertices.length),t.Utils.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)):e.vertices=null,e.worldVerticesLength=this.worldVerticesLength,e.deformAttachment=this.deformAttachment},i.nextID=0,i}(e);t.VertexAttachment=i}(h9||(h9={})),function(t){var e;(e=t.AttachmentType||(t.AttachmentType={}))[e.Region=0]="Region",e[e.BoundingBox=1]="BoundingBox",e[e.Mesh=2]="Mesh",e[e.LinkedMesh=3]="LinkedMesh",e[e.Path=4]="Path",e[e.Point=5]="Point",e[e.Clipping=6]="Clipping"}(h9||(h9={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(1,1,1,1),r}return u9(i,e),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.BoundingBoxAttachment=e}(h9||(h9={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(.2275,.2275,.8078,1),r}return u9(i,e),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.ClippingAttachment=e}(h9||(h9={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(1,1,1,1),r.tempColor=new t.Color(0,0,0,0),r}return u9(i,e),i.prototype.updateUVs=function(){var e=this.regionUVs;null!=this.uvs&&this.uvs.length==e.length||(this.uvs=t.Utils.newFloatArray(e.length));var i=this.uvs,r=this.uvs.length,n=this.region.u,s=this.region.v,a=0,o=0;if(this.region instanceof t.TextureAtlasRegion){var l=this.region,h=l.texture.getImage().width,u=l.texture.getImage().height;switch(l.degrees){case 90:n-=(l.originalHeight-l.offsetY-l.height)/h,s-=(l.originalWidth-l.offsetX-l.width)/u,a=l.originalHeight/h,o=l.originalWidth/u;for(var c=0;c<r;c+=2)i[c]=n+e[c+1]*a,i[c+1]=s+(1-e[c])*o;return;case 180:for(n-=(l.originalWidth-l.offsetX-l.width)/h,s-=l.offsetY/u,a=l.originalWidth/h,o=l.originalHeight/u,c=0;c<r;c+=2)i[c]=n+(1-e[c])*a,i[c+1]=s+(1-e[c+1])*o;return;case 270:for(n-=l.offsetY/h,s-=l.offsetX/u,a=l.originalHeight/h,o=l.originalWidth/u,c=0;c<r;c+=2)i[c]=n+(1-e[c+1])*a,i[c+1]=s+e[c]*o;return}n-=l.offsetX/h,s-=(l.originalHeight-l.offsetY-l.height)/u,a=l.originalWidth/h,o=l.originalHeight/u}else null==this.region?(n=s=0,a=o=1):(a=this.region.u2-n,o=this.region.v2-s);for(c=0;c<r;c+=2)i[c]=n+e[c]*a,i[c+1]=s+e[c+1]*o},i.prototype.getParentMesh=function(){return this.parentMesh},i.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},i.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var e=new i(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),t.Utils.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),t.Utils.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),t.Utils.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),t.Utils.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e},i.prototype.newLinkedMesh=function(){var t=new i(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},i}(t.VertexAttachment);t.MeshAttachment=e}(h9||(h9={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.closed=!1,r.constantSpeed=!1,r.color=new t.Color(1,1,1,1),r}return u9(i,e),i.prototype.copy=function(){var e=new i(name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),t.Utils.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e},i}(t.VertexAttachment);t.PathAttachment=e}(h9||(h9={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(.38,.94,0,1),r}return u9(i,e),i.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},i.prototype.computeWorldRotation=function(e){var i=t.MathUtils.cosDeg(this.rotation),r=t.MathUtils.sinDeg(this.rotation),n=i*e.a+r*e.b,s=i*e.c+r*e.d;return Math.atan2(s,n)*t.MathUtils.radDeg},i.prototype.copy=function(){var t=new i(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.PointAttachment=e}(h9||(h9={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.x=0,r.y=0,r.scaleX=1,r.scaleY=1,r.rotation=0,r.width=0,r.height=0,r.color=new t.Color(1,1,1,1),r.offset=t.Utils.newFloatArray(8),r.uvs=t.Utils.newFloatArray(8),r.tempColor=new t.Color(1,1,1,1),r}return u9(i,e),i.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,s=r+this.region.width*t,a=n+this.region.height*e,o=this.rotation*Math.PI/180,l=Math.cos(o),h=Math.sin(o),u=r*l+this.x,c=r*h,p=n*l+this.y,d=n*h,f=s*l+this.x,_=s*h,g=a*l+this.y,m=a*h,y=this.offset;y[i.OX1]=u-d,y[i.OY1]=p+c,y[i.OX2]=u-m,y[i.OY2]=g+c,y[i.OX3]=f-m,y[i.OY3]=g+_,y[i.OX4]=f-d,y[i.OY4]=p+_},i.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},i.prototype.computeWorldVertices=function(t,e,r,n){var s=this.offset,a=t.worldX,o=t.worldY,l=t.a,h=t.b,u=t.c,c=t.d,p=0,d=0;p=s[i.OX1],d=s[i.OY1],e[r]=p*l+d*h+a,e[r+1]=p*u+d*c+o,r+=n,p=s[i.OX2],d=s[i.OY2],e[r]=p*l+d*h+a,e[r+1]=p*u+d*c+o,r+=n,p=s[i.OX3],d=s[i.OY3],e[r]=p*l+d*h+a,e[r+1]=p*u+d*c+o,r+=n,p=s[i.OX4],d=s[i.OY4],e[r]=p*l+d*h+a,e[r+1]=p*u+d*c+o},i.prototype.copy=function(){var e=new i(name);return e.region=this.region,e.rendererObject=this.rendererObject,e.path=this.path,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,t.Utils.arrayCopy(this.uvs,0,e.uvs,0,8),t.Utils.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e},i.OX1=0,i.OY1=1,i.OX2=2,i.OY2=3,i.OX3=4,i.OY3=5,i.OX4=6,i.OY4=7,i.X1=0,i.Y1=1,i.C1R=2,i.C1G=3,i.C1B=4,i.C1A=5,i.U1=6,i.V1=7,i.X2=8,i.Y2=9,i.C2R=10,i.C2G=11,i.C2B=12,i.C2A=13,i.U2=14,i.V2=15,i.X3=16,i.Y3=17,i.C3R=18,i.C3G=19,i.C3B=20,i.C3A=21,i.U3=22,i.V3=23,i.X4=24,i.Y4=25,i.C4R=26,i.C4G=27,i.C4B=28,i.C4A=29,i.U4=30,i.V4=31,i}(t.Attachment);t.RegionAttachment=e}(h9||(h9={})),function(t){var e=function(){function e(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return e.prototype.begin=function(){},e.prototype.transform=function(e){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();t.JitterEffect=e}(h9||(h9={})),function(t){var e=function(){function e(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}return e.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},e.prototype.transform=function(e){var i=this.angle*t.MathUtils.degreesToRadians,r=e.x-this.worldX,n=e.y-this.worldY,s=Math.sqrt(r*r+n*n);if(s<this.radius){var a=this.interpolation.apply(0,i,(this.radius-s)/this.radius),o=Math.cos(a),l=Math.sin(a);e.x=o*r-l*n+this.worldX,e.y=l*r+o*n+this.worldY}},e.prototype.end=function(){},e.interpolation=new t.PowOut(2),e}();t.SwirlEffect=e}(h9||(h9={}));var c9,p9,d9,f9,_9,g9,m9=h9,y9=function(){function t(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t.getListeners=function(e){return e.listener||(e.listener=new t),e.listener},t}(),v9=1/60,b9=[],S9=[],T9=0,A9=0,E9=0,C9=null,R9=null,w9=0,x9=0,O9=0,P9=0,D9=null,M9=null,B9=0,I9=0,L9=new m9.Color(1,1,1,1),F9=new m9.Color(1,1,1,1),k9=[0,1,2,2,3,0],N9=function(){function t(){this.frames=[],this.totalTime=0,this.isCompleted=!1,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._frameIdx=-1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.bind=function(t){var e=this;t.complete=function(t){t&&t.animation.name===e._animationName&&(e.isCompleted=!0)}},e.unbind=function(t){t.complete=null},e.begin=function(){if(this._invalid){var t=this._skeletonInfo,e=null==t?void 0:t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame());var i=null==t?void 0:t.skeleton,r=null==t?void 0:t.listener,n=null==t?void 0:t.state,s=null==i?void 0:i.data.findAnimation(this._animationName);null==n||n.setAnimationWith(0,s,!1),this.bind(r),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},e.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this.needToUpdate(t))){var e=this._skeletonInfo,i=null==e?void 0:e.skeleton,r=null==e?void 0:e.clipper,n=null==e?void 0:e.state;do{null==i||i.update(v9),null==n||n.update(v9),null==n||n.apply(i),null==i||i.updateWorldTransform(),this._frameIdx++,this.updateFrame(i,r,this._frameIdx),this.totalTime+=v9}while(this.needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.fillVertices=function(t,e,i,r,n){if(f9=i.a*e.a*t.a*255,c9=e.r*t.r*255,p9=e.g*t.g*255,d9=e.b*t.b*255,L9.r=c9*i.r,L9.g=p9*i.g,L9.b=d9*i.b,L9.a=f9,null==n.darkColor?F9.set(0,0,0,1):(F9.r=n.darkColor.r*c9,F9.g=n.darkColor.g*p9,F9.b=n.darkColor.b*d9),F9.a=0,_9=(L9.a<<24>>>0)+(L9.b<<16)+(L9.g<<8)+L9.r,g9=(F9.a<<24>>>0)+(F9.b<<16)+(F9.g<<8)+F9.r,D9!==_9||M9!==g9){var s=this._tempColors;D9=_9,M9=g9,P9>0&&(s[P9-1].vfOffset=E9),s[P9++]={fr:L9.r,fg:L9.g,fb:L9.b,fa:L9.a,dr:F9.r,dg:F9.g,db:F9.b,da:F9.a,vfOffset:0}}if(r.isClipping()){r.clipTriangles(b9,B9,S9,I9,b9,L9,F9,!0,6,E9,E9+2);var a=r.clippedVertices,o=r.clippedTriangles;I9=o.length,B9=a.length/12*6;for(var l=0,h=A9,u=o.length;l<u;)S9[h++]=o[l++];for(var c=0,p=a.length,d=E9;c<p;c+=12,d+=6)b9[d]=a[c],b9[d+1]=a[c+1],b9[d+2]=a[c+6],b9[d+3]=a[c+7],b9[d+4]=_9,b9[d+5]=g9}else for(var f=E9,_=E9+B9;f<_;f+=6)b9[f+4]=_9,b9[f+5]=g9},e.updateFrame=function(t,e,i){E9=0,T9=0,A9=0,C9=null,R9=null,w9=0,x9=0,O9=0,P9=0,D9=null,M9=null,this.frames[i]=this.frames[i]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var r=this.frames[i],n=this._tempSegments=r.segments,s=this._tempColors=r.colors,a=this._tempBoneInfos=r.boneInfos;this.traverseSkeleton(t,e),P9>0&&(s[P9-1].vfOffset=E9),s.length=P9,a.length=T9;var o=O9-1;if(o>=0)if(x9>0){var l=n[o];l.indexCount=x9,l.vfCount=13*w9,l.vertexCount=w9,n.length=O9}else n.length=O9-1;if(0!==n.length){var h=r.vertices,u=E9/6*13;(!h||h.length<u)&&(h=r.vertices=new Float32Array(u));for(var c=0,p=0;c<u;)h[c]=b9[p++],h[c+1]=b9[p++],h[c+3]=b9[p++],h[c+4]=b9[p++],this._setVerticeColor(b9[p++],h,c+5),this._setVerticeColor(b9[p++],h,c+9),c+=13;var d=r.indices;(!d||d.length<A9)&&(d=r.indices=new Uint16Array(A9));for(var f=0;f<A9;f++)d[f]=S9[f];r.vertices=h,r.indices=d}},e.needToUpdate=function(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.traverseSkeleton=function(t,e){var i,r,n,s,a,o,l,h,u,c,p,d,f=this._tempSegments,_=this._tempBoneInfos,g=t.color,m=t.bones;if(this._enableCacheAttachedInfo)for(var y=0,v=m.length;y<v;y++,T9++){var b=m[y],S=_[T9];S||(S=_[T9]={}),S.a=b.a,S.b=b.b,S.c=b.c,S.d=b.d,S.worldX=b.worldX,S.worldY=b.worldY}for(var T=0,A=t.drawOrder.length;T<A;T++)if(d=t.drawOrder[T],B9=0,I9=0,i=d.getAttachment())if(o=i instanceof m9.RegionAttachment,l=i instanceof m9.MeshAttachment,i instanceof m9.ClippingAttachment)e.clipStart(d,i);else if(o||l)if(h=i.region.texture.getRealTexture()){if(p=d.data.blendMode,C9===h.nativeUrl&&R9===p||(C9=h.nativeUrl,R9=p,(u=O9-1)>=0&&(x9>0?((c=f[u]).indexCount=x9,c.vertexCount=w9,c.vfCount=13*w9):O9--),f[O9]={tex:h,blendMode:p,indexCount:0,vertexCount:0,vfCount:0},O9++,x9=0,w9=0),o)a=k9,B9=24,I9=6,i.computeWorldVertices(d.bone,b9,E9,6);else if(l){var E=i;a=E.triangles,B9=6*(E.worldVerticesLength>>1),I9=a.length,E.computeWorldVertices(d,0,E.worldVerticesLength,b9,E9,6)}if(0!==B9&&0!==I9){for(var C=0,R=A9,w=a.length;C<w;)S9[R++]=a[C++];s=i.uvs;for(var x=E9,O=E9+B9,P=0;x<O;x+=6,P+=2)b9[x+2]=s[P],b9[x+3]=s[P+1];if(r=i.color,n=d.color,this.fillVertices(g,r,n,e,d),I9>0){for(var D=A9,M=A9+I9;D<M;D++)S9[D]+=w9;A9+=I9,E9+=B9,x9+=I9,w9+=B9/6}e.clipEndWithSlot(d)}else e.clipEndWithSlot(d)}else e.clipEndWithSlot(d);else e.clipEndWithSlot(d);else e.clipEndWithSlot(d);e.clipEnd()},e._setVerticeColor=function(t,e,i){e[i]=(255&t)/255,e[i+1]=(t>>8&255)/255,e[i+2]=(t>>16&255)/255,e[i+3]=(t>>24&255)/255},t}(),G9=function(){function t(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.clear=function(){this._animationPool={},this._skeletonCache={}},e.removeSkeleton=function(t){var e=this._skeletonCache[t];if(e){var i=e.animationsCache;for(var r in i){var n=i[r];n&&(this._animationPool[t+"#"+r]=n,n.clear())}delete this._skeletonCache[t]}},e.getSkeletonCache=function(t,e){var i=this._skeletonCache[t];if(!i){var r=new m9.Skeleton(e),n=new m9.SkeletonClipping,s=new m9.AnimationStateData(r.data),a=new m9.AnimationState(s),o=new y9;a.addListener(o),this._skeletonCache[t]=i={skeleton:r,clipper:n,state:a,listener:o,animationsCache:{},curAnimationCache:null}}return i},e.getAnimationCache=function(t,e){var i=this._skeletonCache[t];return i?i.animationsCache[e]:null},e.invalidAnimationCache=function(t){var e=this._skeletonCache[t];if(e&&e.skeleton){var i=e.animationsCache;for(var r in i)i[r].invalidAllFrame()}},e.initAnimationCache=function(t,e){if(!e)return null;var i=this._skeletonCache[t],r=i&&i.skeleton;if(!r)return null;if(!r.data.findAnimation(e))return null;var n=i.animationsCache,s=n[e];if(!s){var a=t+"#"+e;(s=this._animationPool[a])?delete this._animationPool[a]:(s=new N9)._privateMode=this._privateMode,s.init(i,e),n[e]=s}return s},e.updateAnimationCache=function(t,e){if(e){var i=this.initAnimationCache(t,e);if(!i)return null;i.updateAllFrame()}else{var r=this._skeletonCache[t];if(!r||!r.skeleton)return;var n=r.animationsCache;for(var s in n)n[s].updateAllFrame()}},t}();G9.FrameTime=v9,G9.sharedCache=new G9;var U9,z9,V9,H9,W9,X9,Y9,j9,K9,q9,Z9,J9=new gi,Q9=new Si,$9=function(){function t(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},e.reset=function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},e._syncAttachedNode=function(){if(this._inited){var t=this._skeletonComp.socketNodes;if(0!==t.size){var e;if(e=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones)for(var i,r=function(t,e){Q9.set(t.scale);var i=J9;i.m00=e.a,i.m01=e.c,i.m04=e.b,i.m05=e.d,i.m12=e.worldX,i.m13=e.worldY,t.matrix=J9,t.scale=Q9},n=ke(t.keys());!(i=n()).done;){var s=i.value,a=t.get(s);if(a&&a.isValid){var o=e[s];o?r(a,o):(a.removeFromParent(),a.destroy(),t.delete(s))}else t.delete(s)}}}},t}(),ttt=function(t){function e(e){var i;return(i=t.call(this,e)||this).name="sp.SkeletonTexture",i._texture=null,i._material=null,i}Me(e,t);var i=e.prototype;return i.setRealTexture=function(t){this._texture=t},i.getRealTexture=function(){return this._texture?this._texture instanceof er?this._texture._texture:this._texture:null},i.setFilters=function(t,e){this._texture&&this.getRealTexture().setFilters(ett(t),ett(e))},i.setWraps=function(t,e){this._texture&&this.getRealTexture().setWrapMode(itt(t),itt(e))},i.dispose=function(){},e}(m9.Texture);function ett(t){switch(t){case m9.TextureFilter.Nearest:case m9.TextureFilter.MipMapNearestNearest:case m9.TextureFilter.MipMapLinearNearest:return jr.NEAREST;case m9.TextureFilter.MipMap:case m9.TextureFilter.MipMapNearestLinear:case m9.TextureFilter.MipMapLinearLinear:case m9.TextureFilter.Linear:default:return jr.LINEAR}}function itt(t){switch(t){case m9.TextureWrap.MirroredRepeat:return en.MIRRORED_REPEAT;case m9.TextureWrap.ClampToEdge:return en.CLAMP_TO_EDGE;case m9.TextureWrap.Repeat:default:return en.REPEAT}}var rtt,ntt,stt,att,ott,ltt,htt,utt,ctt,ptt,dtt,ftt,_tt,gtt,mtt,ytt,vtt,btt,Stt,Ttt,Att,Ett,Ctt,Rtt,wtt,xtt,Ott,Ptt,Dtt,Mtt,Btt,Itt,Ltt,Ftt,ktt,Ntt,Gtt,Utt,ztt,Vtt,Htt,Wtt,Xtt,Ytt,jtt,Ktt,qtt,Ztt,Jtt,Qtt,$tt,tet,eet,iet,ret,net,set,aet=(U9=Ze("sp.SkeletonData"),z9=si([ir]),V9=si([Tr]),U9((Z9=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"_skeletonJson",X9,ti(e)),$e(e,"textures",Y9,ti(e)),$e(e,"textureNames",j9,ti(e)),$e(e,"scale",K9,ti(e)),$e(e,"_atlasText",q9,ti(e)),e._buffer=void 0,e._skeletonCache=null,e._atlasCache=null,e._skinsEnum=null,e._animsEnum=null,e.reset(),e}Me(e,t);var i=e.prototype;return i.createNode=function(t){var e=new Yr(this.name);return e.addComponent("cc.Skeleton").skeletonData=this,t(null,e)},i.reset=function(){this._skeletonCache=null,this._atlasCache=null},i.resetEnums=function(){},i.ensureTexturesLoaded=function(t,e){var i=this.textures,r=i.length;if(0!==r)for(var n=0,s=function(){++n>=r&&(t&&t.call(e,!0),t=null)},a=0;a<r;a++){var o=i[a];o.loaded?s():o.once("load",s)}else t&&t.call(e,!1)},i.isTexturesLoaded=function(){for(var t=this.textures,e=t.length,i=0;i<e;i++)if(!t[i].loaded)return!1;return!0},i.getRuntimeData=function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||console.error(this.name+" no textures found!"),null;var e=this._getAtlas(t);if(!e)return null;var i=new m9.AtlasAttachmentLoader(e),r=null,n=null;return this.skeletonJson?(n=new m9.SkeletonJson(i),r=this.skeletonJson):(n=new m9.SkeletonBinary(i),r=new Uint8Array(this._nativeAsset)),n.scale=this.scale,this._skeletonCache=n.readSkeletonData(r),e.dispose(),this._skeletonCache},i.getSkinsEnum=function(){if(this._skinsEnum)return this._skinsEnum;var t=this.getRuntimeData(!0);if(t){for(var e=t.skins,i={},r=0;r<e.length;r++)i[e[r].name]=r;return this._skinsEnum=Oi(i)}return null},i.getAnimsEnum=function(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;var t=this.getRuntimeData(!0);if(t){for(var e={"<None>":0},i=t.animations,r=0;r<i.length;r++)e[i[r].name]=r+1;return this._animsEnum=Oi(e)}return null},i.destroy=function(){return G9.sharedCache.removeSkeleton(this._uuid),t.prototype.destroy.call(this)},i._getTexture=function(t){for(var e=this.textureNames,i=0;i<e.length;i++)if(e[i]===t){var r=this.textures[i],n=new ttt({width:r.width,height:r.height});return n.setRealTexture(r),n}return console.error(this.name+" no textures found!"),null},i._getAtlas=function(t){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new m9.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||console.error(this.name+" no atlas found!"),null)},Be(e,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){this._buffer=t,this.reset()}}]),e}(Je),X9=je((W9=Z9).prototype,"_skeletonJson",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y9=je(W9.prototype,"textures",[ei,z9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j9=je(W9.prototype,"textureNames",[ei,V9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),K9=je(W9.prototype,"scale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),q9=je(W9.prototype,"_atlasText",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),H9=W9))||H9);function oet(t,e,i){_s.Attr.setClassAttr(t,e,"type","Enum"),_s.Attr.setClassAttr(t,e,"enumList",Oi.getList(i))}Xe.internal.SpineSkeletonData=aet,function(t){t[t.default=0]="default"}(iet||(iet={})),Li(iet),function(t){t[t["<None>"]=0]="<None>"}(ret||(ret={})),Li(ret),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(net||(net={})),Li(net),function(t){t[t.COLORED_TEXTURED=0]="COLORED_TEXTURED",t[t.TWO_COLORED=1]="TWO_COLORED"}(set||(set={}));var het=(rtt=Ze("sp.Skeleton.SpineSocket"),ntt=si(Yr),rtt((ott=je((att=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),$e(this,"path",ott,this),$e(this,"target",ltt,this),this.path=t,this.target=e}).prototype,"path",[ei,yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ltt=je(att.prototype,"target",[ntt,yr,ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),stt=att))||stt);di.setClassAlias(het,"sp.Skeleton.SpineSocket");var uet=(htt=Ze("sp.Skeleton"),utt=ai(),ctt=oi(),ptt=si(Fi),dtt=Ri(),ftt=Gi(),_tt=Ni(),gtt=si(aet),mtt=Gi(),ytt=si(iet),vtt=li(),btt=Gi(),Stt=si(ret),Ttt=li(),Att=Gi(),Ett=li(),Ctt=si(net),Rtt=li(),wtt=li(),xtt=li(),Ott=li(),Ptt=li(),Dtt=li(),Mtt=li(),Btt=si([het]),Itt=li(),Ltt=Ni(),Ftt=Ni(),htt(ktt=utt(ktt=ctt(ktt=vi((eet=tet=function(t){function e(){var e;return e=t.call(this)||this,$e(e,"paused",Gtt,ti(e)),$e(e,"loop",Utt,ti(e)),$e(e,"_premultipliedAlpha",ztt,ti(e)),$e(e,"_timeScale",Vtt,ti(e)),e.enableBatch=!1,e._frameCache=null,e._curFrame=null,e._effectDelegate=null,e._skeleton=void 0,e._clipper=void 0,e._debugRenderer=void 0,e._startSlotIndex=void 0,e._endSlotIndex=void 0,e._startEntry=void 0,e._endEntry=void 0,e.attachUtil=void 0,e._materialCache={},e._enumSkins=Oi({}),e._enumAnimations=Oi({}),e._accTime=0,e._playCount=0,e._skeletonCache=null,e._animationName="",e._animationQueue=[],e._headAniInfo=null,e._playTimes=0,e._isAniComplete=!0,$e(e,"_useTint",Htt,ti(e)),$e(e,"_preCacheMode",Wtt,ti(e)),$e(e,"_cacheMode",Xtt,ti(e)),$e(e,"_defaultCacheMode",Ytt,ti(e)),$e(e,"_debugBones",jtt,ti(e)),$e(e,"_debugSlots",Ktt,ti(e)),$e(e,"_skeletonData",qtt,ti(e)),$e(e,"defaultSkin",Ztt,ti(e)),$e(e,"defaultAnimation",Jtt,ti(e)),$e(e,"_sockets",Qtt,ti(e)),e._meshRenderDataArray=[],$e(e,"_debugMesh",$tt,ti(e)),e._rootBone=void 0,e._state=void 0,e._listener=void 0,e._socketNodes=new Map,e._cachedSockets=new Map,e._meshRenderDataArrayIdx=0,e._effectDelegate=null,e._skeleton=null,e._rootBone=null,e._listener=null,e._debugRenderer=null,e._startSlotIndex=-1,e._endSlotIndex=-1,e._startEntry={animation:{name:""},trackIndex:0},e._endEntry={animation:{name:""},trackIndex:0},e.attachUtil=new $9,oet(ti(e),"_defaultSkinIndex",e._enumSkins),oet(ti(e),"_animationIndex",e._enumAnimations),e}Me(e,t);var i=e.prototype;return i.disableRender=function(){this.destroyRenderData()},i.setSkeletonData=function(t){var e=this.node._uiProps.uiTransformComp;if(null!=t.width&&null!=t.height&&e.setContentSize(t.width,t.height),this._cacheMode===net.SHARED_CACHE?this._skeletonCache=G9.sharedCache:this._cacheMode===net.PRIVATE_CACHE&&(this._skeletonCache=new G9,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&We("Debug bones or slots is invalid in cached mode");var i=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t);this._skeleton=i.skeleton,this._clipper=i.clipper,this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new m9.Skeleton(t),this._clipper=new m9.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this.markForUpdateRenderData()},i.setSlotsRange=function(t,e){this.isAnimationCached()?We("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},i.setAnimationStateData=function(t){if(this.isAnimationCached())We("'setAnimationStateData' interface can not be invoked in cached mode.");else{var e=new m9.AnimationState(t);this._listener&&(this._state&&this._state.removeListener(this._listener),e.addListener(this._listener)),this._state=e}},i.__preload=function(){t.prototype.__preload.call(this);for(var e=this.node.children,i=0,r=e.length;i<r;i++){var n=e[i];n&&"DEBUG_DRAW_NODE"===n.name&&n.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings()},i.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._updateSkeletonData(),this._updateUseTint(),this._updateSocketBindings(),this.markForUpdateRenderData())},i.isAnimationCached=function(){return this._cacheMode!==net.REALTIME},i.update=function(t){if(!this.paused)if(t*=1*this._timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var e=this._frameCache;if(e&&e.isInvalid()){e.updateToFrame();var i=e.frames;this._curFrame=i[i.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>this._headAniInfo.delay){var r=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,r.animationName,r.loop)}return}this._updateCache(t)}else this._updateRealtime(t)},i.setVertexEffectDelegate=function(t){this._effectDelegate=t},i.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},i.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},i.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},i.updateAnimationCache=function(t){if(this.isAnimationCached()){var e=this._skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t)}},i.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData._uuid)},i.findBone=function(t){return this._skeleton?this._skeleton.findBone(t):null},i.findSlot=function(t){return this._skeleton?this._skeleton.findSlot(t):null},i.setSkin=function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},i.getAttachment=function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},i.setAttachment=function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},i.getTextureAtlas=function(t){return t.region},i.setMix=function(t,e,i){this._state&&this._state.data.setMix(t,e,i)},i.setAnimation=function(t,e,i){if(this._playTimes=i?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&We("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var r=this._skeletonCache.getAnimationCache(this._skeletonData._uuid,e);r||(r=this._skeletonCache.initAnimationCache(this._skeletonData._uuid,e)),r&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=r,this._socketNodes.size>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){var n=this._skeleton.data.findAnimation(e);if(!n)return ji(7509,e),null;var s=this._state.setAnimationWith(t,n,i);return this._state.apply(this._skeleton),s}return null},i.addAnimation=function(t,e,i,r){if(r=r||0,this.isAnimationCached())0!==t&&We("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:i,delay:r});else if(this._skeleton){var n,s=this._skeleton.data.findAnimation(e);return s?null===(n=this._state)||void 0===n?void 0:n.addAnimationWith(t,s,i,r):(ji(7510,e),null)}return null},i.findAnimation=function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},i.getCurrent=function(t){if(this.isAnimationCached())We("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},i.clearTracks=function(){this.isAnimationCached()?We("'clearTracks' interface can not be invoked in cached mode."):this._state&&(this._state.clearTracks(),this.setToSetupPose())},i.clearTrack=function(t){this.isAnimationCached()?We("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},i.setStartListener=function(t){this._ensureListener(),this._listener.start=t},i.setInterruptListener=function(t){this._ensureListener(),this._listener.interrupt=t},i.setEndListener=function(t){this._ensureListener(),this._listener.end=t},i.setDisposeListener=function(t){this._ensureListener(),this._listener.dispose=t},i.setCompleteListener=function(t){this._ensureListener(),this._listener.complete=t},i.setEventListener=function(t){this._ensureListener(),this._listener.event=t},i.setTrackStartListener=function(t,e){y9.getListeners(t).start=e},i.setTrackInterruptListener=function(t,e){y9.getListeners(t).interrupt=e},i.setTrackEndListener=function(t,e){y9.getListeners(t).end=e},i.setTrackDisposeListener=function(t,e){y9.getListeners(t).dispose=e},i.setTrackCompleteListener=function(t,e){y9.getListeners(t).complete=function(t){var i=Math.floor(t.trackTime/t.animationEnd);e(t,i)}},i.setTrackEventListener=function(t,e){y9.getListeners(t).event=e},i.getState=function(){return this._state},i.onEnable=function(){t.prototype.onEnable.call(this),this._flushAssembler()},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){this._cleanMaterialCache(),this.destroyRenderData(),t.prototype.onDestroy.call(this)},i.requestMeshRenderData=function(t){if(this._meshRenderDataArray.length>0&&0===this._meshRenderDataArray[this._meshRenderDataArray.length-1].renderData.vertexCount)return this._meshRenderDataArray[this._meshRenderDataArray.length-1];var e=new Sh(t),i={renderData:e};return e.material=null,this._meshRenderDataArray.push(i),i},i.destroyRenderData=function(){this._meshRenderDataArray.length>0&&(this._meshRenderDataArray.forEach((function(t){t.renderData.reset()})),this._meshRenderDataArray.length=0)},i.getMaterialForBlendAndTint=function(t,e,i){var r=i+"/"+t+"/"+e,n=this._materialCache[r];if(n)return n;var s=this.customMaterial;null===s&&(s=ki.get("default-spine-material"));var a=!1;switch(i){case set.TWO_COLORED:a=!0;break;case set.COLORED_TEXTURED:}return n=new nn({parent:s,subModelIdx:0,owner:this}),this._materialCache[r]=n,n.overridePipelineStates({blendState:{blendColor:Ii.WHITE,targets:[{blendEq:x.ADD,blendAlphaEq:x.ADD,blendSrc:t,blendDst:e,blendSrcAlpha:t,blendDstAlpha:e}]}}),n.recompileShaders({TWO_COLORED:a}),n},i.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc(),this._blendHash=-1},i.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},i._render=function(t){if(this._meshRenderDataArray)for(var e=0;e<this._meshRenderDataArray.length;e++){var i=this.material;this._meshRenderDataArrayIdx=e;var r=this._meshRenderDataArray[e];r.renderData.material&&(this.material=r.renderData.material),r.texture&&t.commitComp(this,r.texture,this._assembler,null),this.material=i}},i.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},i._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},i._updateCache=function(t){var e=this._frameCache;if(e.isInited()){var i=e.frames,r=G9.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var n=Math.floor(this._accTime/r);if(e.isCompleted||e.updateToFrame(n),e.isCompleted&&n>=i.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,this._emitCacheCompleteEvent(),void this.markForUpdateRenderData();this._accTime=0,n=0,this._emitCacheCompleteEvent()}this._curFrame=i[n],this.markForUpdateRenderData()}},i._updateRealtime=function(t){var e=this._skeleton,i=this._state;e&&(e.update(t),i&&(i.update(t),i.apply(e)),this.markForUpdateRenderData())},i._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var t=this._skeleton.bones,e=function e(i){return null==i.parent?i.data.name||"<Unamed>":e(t[i.parent.data.index])+"/"+i.data.name},i=0,r=t.length;i<r;i++){var n=t[i].data,s=e(t[i]);this._cachedSockets.set(s,n.index)}}},i._updateUseTint=function(){this._cleanMaterialCache(),this.destroyRenderData()},i._updateBatch=function(){this.markForUpdateRenderData()},i._validateRender=function(){var t=this.skeletonData;t&&t.isTexturesLoaded()||this.disableRender()},i._updateAnimEnum=function(){var t;t=this.skeletonData?this.skeletonData.getAnimsEnum():ret,this._enumAnimations=Oi({}),Object.assign(this._enumAnimations,t),Oi.update(this._enumAnimations),oet(this,"_animationIndex",this._enumAnimations)},i._updateSkinEnum=function(){var t;t=this.skeletonData?this.skeletonData.getSkinsEnum():iet,this._enumSkins=Oi({}),Object.assign(this._enumSkins,t),Oi.update(this._enumSkins),oet(this,"_defaultSkinIndex",this._enumSkins)},i._ensureListener=function(){this._listener||(this._listener=new y9,this._state&&this._state.addListener(this._listener))},i._updateSkeletonData=function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new m9.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(t){We(t)}this.attachUtil.init(this),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}else this.disableRender()}else this.disableRender()},i._refreshInspector=function(){this._updateAnimEnum(),this._updateSkinEnum()},i._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){var t=new Yr("DEBUG_DRAW_NODE");t.hideFlags|=Ki.Flags.DontSave|Ki.Flags.HideInHierarchy;var e=t.addComponent(gG);e.lineWidth=1,e.strokeColor=new Ii(255,0,0,255),this._debugRenderer=e,t.parent=this.node}this.isAnimationCached()&&We("Debug bones or slots is invalid in cached mode")}else this._debugRenderer&&(this._debugRenderer.node.destroy(),this._debugRenderer=null)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),0===this._meshRenderDataArray.length&&this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._colorDirty=!0,this._updateColor())},i._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var i=this._sockets[t];if(i.path&&i.target){var r=this._cachedSockets.get(i.path);if(!r){console.error("Skeleton data does not contain path "+i.path);continue}this._socketNodes.set(r,i.target)}}}},i._verifySockets=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e].target;!r||r.parent&&r.parent===this.node||console.error("Target node "+r.name+" is expected to be a direct child of "+this.node.name)}var n=new Map;t.forEach((function(t){t.target&&(n.get(t.target)?console.error("Target node "+t.target.name+" has existed."):n.set(t.target,!0))}))},i._cleanMaterialCache=function(){for(var t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}},Be(e,[{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this._cleanMaterialCache()}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(t){t&&t.resetEnums(),this._skeletonData!==t&&(this._skeletonData=t,this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData())}},{key:"animation",get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){t?(this.setAnimation(0,t,this.loop),this.destroyRenderData(),this.markForUpdateRenderData()):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())}},{key:"_defaultSkinIndex",get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getSkinsEnum()),e){var i=e[t];void 0!==i?(this.defaultSkin=i,this.setSkin(this.defaultSkin)):console.error(this.name+" skin enums are invalid")}else console.error(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var t=this.animation;if(this.skeletonData)if(t){var e=this.skeletonData.getAnimsEnum();if(e){var i=e[t];if(void 0!==i)return i}}else this._refreshInspector();return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getAnimsEnum()),e){var i=e[t];void 0!==i?(this.animation=i,this.animation=i):console.error(this.name+" animation enums are invalid")}else console.error(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._defaultCacheMode},set:function(t){this._defaultCacheMode=t,this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this.markForUpdateRenderData())}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){t!==this._timeScale&&(this._timeScale=t)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"useTint",get:function(){return this._useTint},set:function(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint(),this.markForUpdateRenderData())}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil._syncAttachedNode()}},{key:"socketNodes",get:function(){return this._socketNodes}}]),e}(Ch),tet.SpineSocket=het,tet.AnimationCacheMode=net,je((Ntt=eet).prototype,"customMaterial",[Qe,ptt,dtt,ftt],Object.getOwnPropertyDescriptor(Ntt.prototype,"customMaterial"),Ntt.prototype),Gtt=je(Ntt.prototype,"paused",[_tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),je(Ntt.prototype,"skeletonData",[yr,gtt],Object.getOwnPropertyDescriptor(Ntt.prototype,"skeletonData"),Ntt.prototype),je(Ntt.prototype,"_defaultSkinIndex",[mtt,ytt,vtt],Object.getOwnPropertyDescriptor(Ntt.prototype,"_defaultSkinIndex"),Ntt.prototype),je(Ntt.prototype,"_animationIndex",[btt,Stt,Ttt],Object.getOwnPropertyDescriptor(Ntt.prototype,"_animationIndex"),Ntt.prototype),je(Ntt.prototype,"defaultCacheMode",[Att,Ett,yr,Ctt],Object.getOwnPropertyDescriptor(Ntt.prototype,"defaultCacheMode"),Ntt.prototype),Utt=je(Ntt.prototype,"loop",[ei,Rtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ztt=je(Ntt.prototype,"_premultipliedAlpha",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),je(Ntt.prototype,"premultipliedAlpha",[yr,wtt],Object.getOwnPropertyDescriptor(Ntt.prototype,"premultipliedAlpha"),Ntt.prototype),Vtt=je(Ntt.prototype,"_timeScale",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),je(Ntt.prototype,"timeScale",[xtt,yr],Object.getOwnPropertyDescriptor(Ntt.prototype,"timeScale"),Ntt.prototype),je(Ntt.prototype,"debugSlots",[yr,Ott],Object.getOwnPropertyDescriptor(Ntt.prototype,"debugSlots"),Ntt.prototype),je(Ntt.prototype,"debugBones",[yr,Ptt],Object.getOwnPropertyDescriptor(Ntt.prototype,"debugBones"),Ntt.prototype),je(Ntt.prototype,"debugMesh",[yr,Dtt],Object.getOwnPropertyDescriptor(Ntt.prototype,"debugMesh"),Ntt.prototype),je(Ntt.prototype,"useTint",[yr,Mtt],Object.getOwnPropertyDescriptor(Ntt.prototype,"useTint"),Ntt.prototype),je(Ntt.prototype,"sockets",[Btt,Itt],Object.getOwnPropertyDescriptor(Ntt.prototype,"sockets"),Ntt.prototype),Htt=je(Ntt.prototype,"_useTint",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Wtt=je(Ntt.prototype,"_preCacheMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Xtt=je(Ntt.prototype,"_cacheMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return net.REALTIME}}),Ytt=je(Ntt.prototype,"_defaultCacheMode",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return net.REALTIME}}),jtt=je(Ntt.prototype,"_debugBones",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ktt=je(Ntt.prototype,"_debugSlots",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qtt=je(Ntt.prototype,"_skeletonData",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ztt=je(Ntt.prototype,"defaultSkin",[ei,Ltt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Jtt=je(Ntt.prototype,"defaultAnimation",[Ftt,ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Qtt=je(Ntt.prototype,"_sockets",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$tt=je(Ntt.prototype,"_debugMesh",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ktt=Ntt))||ktt)||ktt)||ktt)||ktt);Xe.internal.SpineSkeleton=uet;var cet,pet,det,fet,_et,get,met,yet,vet,bet,Tet,Aet,Eet,Cet,Ret,wet,xet,Oet,Pet,Det,Met,Bet,Iet,Let,Fet,ket,Net,Get,Uet,zet,Vet,Het,Wet,Xet,Yet,jet,Ket,qet,Zet,Jet,Qet,$et,tit=function(){function t(){this.name="sp.VertexEffectDelegate",this._vertexEffect=null,this._interpolation=null,this._effectType=void 0,this._vertexEffect=null,this._interpolation=null,this._effectType="none"}var e=t.prototype;return e.clear=function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},e.initJitter=function(t,e){return this._effectType="jitter",this._vertexEffect=new m9.JitterEffect(t,e),this._vertexEffect},e.initSwirlWithPow=function(t,e){return this._interpolation=new m9.Pow(e),this._vertexEffect=new m9.SwirlEffect(t,this._interpolation),this._vertexEffect},e.initSwirlWithPowOut=function(t,e){return this._interpolation=new m9.PowOut(e),this._vertexEffect=new m9.SwirlEffect(t,this._interpolation),this._vertexEffect},e.getJitterVertexEffect=function(){return this._vertexEffect},e.getSwirlVertexEffect=function(){return this._vertexEffect},e.getVertexEffect=function(){return this._vertexEffect},e.getEffectType=function(){return this._effectType},t}(),eit=0,iit=[0,1,2,2,3,0],rit=new Ii(0,0,255,255),nit=new Ii(255,0,0,255),sit=new Ii(0,255,0,255),ait=new Ii(255,255,0,255),oit=new m9.Color(1,1,1,1),lit=new m9.Color(1,1,1,1),hit=new m9.Vector2,uit=new m9.Vector2,cit=new Float32Array(4),pit=new Float32Array(4),dit=new Si,fit=0,_it=0,git=0,mit=0,yit=0,vit=0,bit=0,Sit=null,Tit=null,Ait=null;function Eit(t){var e,i;switch(t){case m9.BlendMode.Additive:e=cet?w.ONE:w.SRC_ALPHA,i=w.ONE;break;case m9.BlendMode.Multiply:e=w.DST_COLOR,i=w.ONE_MINUS_SRC_ALPHA;break;case m9.BlendMode.Screen:e=w.ONE,i=w.ONE_MINUS_SRC_COLOR;break;case m9.BlendMode.Normal:default:e=cet?w.ONE:w.SRC_ALPHA,i=w.ONE_MINUS_SRC_ALPHA}return Zet.getMaterialForBlendAndTint(e,i,_et?set.TWO_COLORED:set.COLORED_TEXTURED)}function Cit(t){Xet=t.fa*Aet,Get=vet*(pet=cet?Xet/255:1),Uet=bet*pet,zet=Tet*pet,Vet=t.fr*Get,Het=t.fg*Uet,Wet=t.fb*zet,cit[0]=Vet/255,cit[1]=Het/255,cit[2]=Wet/255,cit[3]=Xet/255,Yet=t.dr*Get,jet=t.dg*Uet,Ket=t.db*zet,qet=cet?255:0,pit[0]=Yet/255,pit[1]=jet/255,pit[2]=Ket/255,pit[3]=qet/255}var Rit=new Float32Array(4);function wit(t){return Rit[0]=t.r/255,Rit[1]=t.g/255,Rit[2]=t.b/255,Rit[3]=t.a/255,Rit}function xit(t){return t?13:9}var Oit={createData:function(){},updateRenderData:function(t){Zet=t;var e=t._skeleton;!t.isAnimationCached()&&e&&e.updateWorldTransform(),e&&function(t){if(t._skeleton){var e,i=t.color;vet=i.r/255,bet=i.g/255,Tet=i.b/255,Aet=i.a/255,_et=t.useTint||t.isAnimationCached(),Eet=xit(_et),Qet=t.node,t.destroyRenderData(),Jet=t.requestMeshRenderData(Eet),Zet=t,Tit=null,Pet=!0,cet=t.premultipliedAlpha,pet=1,eit=0,$et=!1,Sit=t._effectDelegate&&t._effectDelegate._vertexEffect,(4294967295!==i._val||cet)&&($et=!0),_et&&(eit|=1),Zet.enableBatch&&(e=Qet.worldMatrix,Pet=!1,eit|=16),t.isAnimationCached()?function(t){var e=Zet._curFrame;if(e){var i,r,n=e.segments;if(0!==n.length){Cet=12;var s=null,a=e.vertices,o=e.indices,l=0,h=0,u=0;t&&(Bet=t.m00,Fet=t.m01,Iet=t.m04,ket=t.m05,Let=t.m12,Net=t.m13);var c=16&eit,p=c&&(1===Bet&&0===Fet&&0===Iet&&1===ket),d=0,f=e.colors,_=f[d++],g=_.vfOffset;Cit(_);for(var m=0,y=n.length;m<y;m++){var v=n[m];if(s=Eit(v.blendMode)){Tit||(Tit=s),Ait||(Ait=v.tex),Jet.renderData.material&&(Jet.renderData.material=Tit),(Pet||s.hash!==Tit.hash||v.tex&&v.tex!==Ait)&&(Pet=!1,Jet.texture||(Jet.texture=v.tex),Jet=Zet.requestMeshRenderData(xit(_et)),Tit=s,Ait=v.tex,Jet.texture=v.tex,Jet.renderData.material=Tit),_it=v.vertexCount,yit=v.indexCount,Jet.renderData.reserve(_it,yit),vit=Jet.renderData.indicesCount,git=Jet.renderData.vertexCount,bit=Jet.renderData.vDataOffset,i=Jet.renderData.vData,r=Jet.renderData.iData;for(var b=vit,S=vit+yit;b<S;b++)r[b]=git+o[h++];u=v.vfCount;var T=a.subarray(l,l+u);l+=u;var A=bit;Eet=xit(_et);for(var E=0;E<T.length;)i[A+0]=T[E+0],i[A+1]=T[E+1],i[A+3]=T[E+3],i[A+4]=T[E+4],i[A+5]=T[E+5],i[A+6]=T[E+6],i[A+7]=T[E+7],i[A+8]=T[E+8],_et&&(i[A+9]=T[E+9],i[A+10]=T[E+10],i[A+11]=T[E+11],i[A+12]=T[E+12]),A+=Eet,E+=13;if(p)for(var C=bit,R=bit+u;C<R;C+=Eet)i[C]+=Let,i[C+1]+=Net;else if(c)for(var w=bit,x=bit+u;w<x;w+=Eet)Det=i[w],Met=i[w+1],i[w]=Det*Bet+Met*Iet+Let,i[w+1]=Det*Fet+Met*ket+Net;if(Jet.renderData.advance(_it,yit),$et)for(var O=l-u,P=bit,D=bit+u;P<D;P+=Eet,O+=6)O>=g&&(Cit(_=f[d++]),g=_.vfOffset),i.set(cit,P+5),i.set(pit,P+9)}}}}}(e):(Sit&&Sit.begin(t._skeleton),function(t){var e,i,r,n,s,a,o,l,h=Zet._skeleton,u=h.color,c=Zet._debugRenderer,p=Zet._clipper,d=null;det=Zet._startSlotIndex,fet=Zet._endSlotIndex,Oet=!1,-1===det&&(Oet=!0),get=Zet.debugSlots,met=Zet.debugBones,yet=Zet.debugMesh,c&&(met||get||yet)&&(c.clear(),c.lineWidth=5),Cet=12,fit=0,git=0,mit=0,yit=0,vit=0;for(var f=0,_=h.drawOrder.length;f<_;f++){var g;if(void 0!==(l=h.drawOrder[f]))if(det>=0&&det===l.data.index&&(Oet=!0),Oet)if(fet>=0&&fet===l.data.index&&(Oet=!1),fit=0,yit=0,r=l.getAttachment())if(a=r instanceof m9.RegionAttachment,o=r instanceof m9.MeshAttachment,r instanceof m9.ClippingAttachment)p.clipStart(l,r);else if(a||o){var m=r.region.texture.getRealTexture();if(d=Eit(l.data.blendMode)){if(Tit||(Tit=d),(null===(g=Jet)||void 0===g?void 0:g.renderData.material)||(Jet.renderData.material=Tit),(Pet||d.hash!==Tit.hash||m&&Ait!==m)&&(Pet=!1,Jet=Zet.requestMeshRenderData(Eet),Tit=d,Ait=m,Jet.texture=m,Jet.renderData.material=Tit),a){if(s=iit,fit=4*Eet,yit=6,Jet.renderData.reserve(4,6),vit=Jet.renderData.indicesCount,git=Jet.renderData.vertexCount,mit=Jet.renderData.vDataOffset,e=Jet.renderData.vData,i=Jet.renderData.iData,r.computeWorldVertices(l.bone,e,mit,Eet),c&&get){c.strokeColor=rit,c.moveTo(e[mit],e[mit+1]);for(var y=mit+Eet,v=mit+fit;y<v;y+=Eet)c.lineTo(e[y],e[y+1]);c.close(),c.stroke()}}else if(o){var b=r;if(s=b.triangles,fit=(b.worldVerticesLength>>1)*Eet,yit=s.length,Jet.renderData.reserve(b.worldVerticesLength>>1,yit),vit=Jet.renderData.indicesCount,git=Jet.renderData.vertexCount,mit=Jet.renderData.vDataOffset,e=Jet.renderData.vData,i=Jet.renderData.iData,b.computeWorldVertices(l,0,b.worldVerticesLength,e,mit,Eet),c&&yet){c.strokeColor=ait;for(var S=0,T=s.length;S<T;S+=3){var A=s[S]*Eet+mit,E=s[S+1]*Eet+mit,C=s[S+2]*Eet+mit;c.moveTo(e[A],e[A+1]),c.lineTo(e[E],e[E+1]),c.lineTo(e[C],e[C+1]),c.close(),c.stroke()}}}if(0!==fit&&0!==yit){var R=r;i.set(s,vit),n=R.uvs;for(var w=mit,x=mit+fit,O=0;w<x;w+=Eet,O+=2)e[w+3]=n[O],e[w+4]=n[O+1];if(Pit(u,R.color,l.color,p,l),e=Jet.renderData.vData,i=Jet.renderData.iData,yit>0){for(var P=vit,D=vit+yit;P<D;P++)i[P]+=git;if(t){Bet=t.m00,Iet=t.m04,Let=t.m12,Fet=t.m01,ket=t.m05,Net=t.m13;for(var M=mit,B=mit+fit;M<B;M+=Eet)Det=e[M],Met=e[M+1],e[M]=Det*Bet+Met*Iet+Let,e[M+1]=Det*Fet+Met*ket+Net}Jet.renderData.advance(fit/Eet,yit)}p.clipEndWithSlot(l)}else p.clipEndWithSlot(l)}else p.clipEndWithSlot(l)}else p.clipEndWithSlot(l);else p.clipEndWithSlot(l);else p.clipEndWithSlot(l)}if(p.clipEnd(),c&&met){var I;c.strokeColor=nit,c.fillColor=rit;for(var L=0,F=h.bones.length;L<F;L++){var k=(I=h.bones[L]).data.length*I.a+I.worldX,N=I.data.length*I.c+I.worldY;c.moveTo(I.worldX,I.worldY),c.lineTo(k,N),c.stroke(),c.circle(I.worldX,I.worldY,1.5*Math.PI),c.fill(),0===L&&(c.fillColor=sit)}}}(e),Sit&&Sit.end()),t.attachUtil._syncAttachedNode(),Qet=void 0,Jet=void 0,Zet=void 0,Sit=null}}(t)},updateColor:function(t){t&&(Zet=t).markForUpdateRenderData()},fillBuffers:function(t,e){if(t&&t.meshRenderDataArray){Zet=t;var i=t.meshRenderDataArray,r=t.node,n=i[t._meshRenderDataArrayIdx].renderData,s=e.acquireBufferBatch(9===n.floatStride?kN:NN),a=s.byteOffset>>2,o=s.indicesOffset,l=s.vertexOffset;s.request(n.vertexCount,n.indicesCount)||(s=e.currBufferBatch,a=0,o=0,l=0);var h=s.vData,u=s.iData,c=r.worldMatrix,p=n.vData,d=n.vertexStart,f=n.iData,_=n.floatStride;h.set(p.subarray(d,d+n.vertexCount*_),a);for(var g=0;g<n.vertexCount;g++){var m=a+g*_;dit.set(h[m],h[m+1],h[m+2]),dit.transformMat4(c),h[m]=dit.x,h[m+1]=dit.y,h[m+2]=dit.z}for(var y=n.indicesStart,v=0;v<n.indicesCount;v+=1)u[v+o]=f[v+y]+l}}};function Pit(t,e,i,r,n){var s=Jet.renderData.vData,a=Jet.renderData.iData;if(oit.a=i.a*e.a*t.a*Aet*255,pet=cet?oit.a:255,Ret=vet*e.r*t.r*pet,wet=bet*e.g*t.g*pet,xet=Tet*e.b*t.b*pet,oit.r=Ret*i.r,oit.g=wet*i.g,oit.b=xet*i.b,null==n.darkColor?lit.set(0,0,0,1):(lit.r=n.darkColor.r*Ret,lit.g=n.darkColor.g*wet,lit.b=n.darkColor.b*xet),lit.a=cet?255:0,r.isClipping()){Cet=_et?12:8;var o=s.subarray(mit),l=s.subarray(mit+3);r.clipTriangles(o,fit,a.subarray(vit),yit,l,oit,lit,_et,Eet);var h=new Float32Array(r.clippedVertices),u=r.clippedTriangles;if(yit=u.length,fit=h.length/Cet*Eet,Jet.renderData.reserve(fit/Eet,yit),vit=Jet.renderData.indicesCount,git=Jet.renderData.vertexCount,mit=Jet.renderData.vDataOffset,s=Jet.renderData.vData,a=Jet.renderData.iData,u.length>0&&a.set(u,vit),Sit)for(var c=0,p=h.length,d=mit;c<p;c+=Cet,d+=Eet)hit.x=h[c],hit.y=h[c+1],oit.set(h[c+2],h[c+3],h[c+4],h[c+5]),uit.x=h[c+6],uit.y=h[c+7],_et?lit.set(h[c+8],h[c+9],h[c+10],h[c+11]):lit.set(0,0,0,0),Sit.transform(hit,uit,oit,lit),s[d]=hit.x,s[d+1]=hit.y,s[d+3]=uit.x,s[d+4]=uit.y,s.set(wit(oit),d+5),_et&&s.set(wit(lit),d+9);else for(var f=0,_=h.length,g=mit;f<_;f+=Cet,g+=Eet)s[g]=h[f],s[g+1]=h[f+1],s[g+3]=h[f+6],s[g+4]=h[f+7],s[g+5]=h[f+2]/255,s[g+6]=h[f+3]/255,s[g+7]=h[f+4]/255,s[g+8]=h[f+5]/255,_et&&(s[g+9]=h[f+8]/255,s[g+10]=h[f+9]/255,s[g+11]=h[f+10]/255,s[g+12]=h[f+11]/255)}else if(Sit)for(var m=mit,y=mit+fit;m<y;m+=Eet)hit.x=s[m],hit.y=s[m+1],uit.x=s[m+3],uit.y=s[m+4],Sit.transform(hit,uit,oit,lit),s[m]=hit.x,s[m+1]=hit.y,s[m+3]=uit.x,s[m+4]=uit.y,s.set(wit(oit),m+5),_et&&s.set(wit(lit),m+9);else{cit.set(wit(oit)),pit.set(wit(lit));for(var v=mit,b=mit+fit;v<b;v+=Eet)s.set(cit,v+5),_et&&s.set(pit,v+9)}}Xe.internal.SpineAssembler=Oit;var Dit,Mit,Bit={getAssembler:function(){return Oit}};uet.Assembler=Bit,function(t){t[t.REGION=0]="REGION",t[t.BOUNDING_BOX=1]="BOUNDING_BOX",t[t.MESH=2]="MESH",t[t.SKINNED_MESH=3]="SKINNED_MESH"}(Dit||(Dit={})),Li(Dit),function(t){t[t.START=0]="START",t[t.INTERRUPT=1]="INTERRUPT",t[t.END=2]="END",t[t.DISPOSE=3]="DISPOSE",t[t.COMPLETE=4]="COMPLETE",t[t.EVENT=5]="EVENT"}(Mit||(Mit={})),Li(Mit),t("sp",Object.freeze({__proto__:null,spine:m9,get ATTACHMENT_TYPE(){return Dit},get AnimationEventType(){return Mit},timeScale:1,get DefaultSkinsEnum(){return iet},get DefaultAnimsEnum(){return ret},get AnimationCacheMode(){return net},get SpineMaterialType(){return set},SpineSocket:het,Skeleton:uet,SkeletonData:aet,SkeletonTexture:ttt,convertFilter:ett,convertWraps:itt,VertexEffectDelegate:tit,simpleSpineAssembler:Bit}))}}}));
